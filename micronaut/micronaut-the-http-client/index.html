<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Micronaut,Groovy,Gradle,Java,æ–‡æ¡£,ä¸­æ–‡">
    <meta name="description" content="Micronaut Groovy Gradle Java æ–‡æ¡£ ä¸­æ–‡">
    <meta name="author" content="æ—å¨ç¾½">
    
    <title>
        
            Micronaut ä¸­æ–‡æ–‡æ¡£ The HTTP Client |
        
        æ—å¨ç¾½çš„ç¬”è®°
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/logo.svg">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/css/font-awesome.min.css">
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"zh-CN","path":"search.json"};
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":true,"init_open":true},"style":{"primary_color":"rgb(153,153,0)","avatar":"/images/avatar.jpg","favicon":"/images/logo.svg","article_img_align":"left","left_side_width":"400px","content_max_width":"920px","hover":{"shadow":true,"scale":true},"first_screen":{"enable":true,"background_img":null,"description":"def containsğŸš€ = ['Micronaut', 'Groovy', 'Gradle', 'etc']"},"scroll":{"progress_bar":{"enable":true},"percent":{"enable":true}}},"local_search":{"enable":true,"preload":true},"code_copy":{"enable":true,"style":"mac"},"pjax":{"enable":true},"lazyload":{"enable":true},"version":"3.4.5"};
    KEEP.language_ago = {"second":"%s ç§’å‰","minute":"%s åˆ†é’Ÿå‰","hour":"%s å°æ—¶å‰","day":"%s å¤©å‰","week":"%s å‘¨å‰","month":"%s ä¸ªæœˆå‰","year":"%s å¹´å‰"};
  </script>
<meta name="generator" content="Hexo 6.1.0"></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fas fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                æ—å¨ç¾½çš„ç¬”è®°
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                é¦–é¡µ
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                åˆ†ç±»
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                æ ‡ç­¾
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                å½’æ¡£
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                å…³äº
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">é¦–é¡µ</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories">åˆ†ç±»</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags">æ ‡ç­¾</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">å½’æ¡£</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about">å…³äº</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

    <a target="_blank" rel="noopener" href="https://github.com/linweiyu21/" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80"
        viewBox="0 0 250 250" style="fill:#64CEAA; color:#fff; position: absolute; top: 0; border: 0; right: 0;"
        aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path
          d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
          fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path
          d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
          fill="currentColor" class="octo-body"></path>
      </svg></a>
    <style>
      .github-corner:hover .octo-arm {
        animation: octocat-wave 560ms ease-in-out
      }

      @keyframes octocat-wave {

        0%,
        100% {
          transform: rotate(0)
        }

        20%,
        60% {
          transform: rotate(-25deg)
        }

        40%,
        80% {
          transform: rotate(10deg)
        }
      }

      @media (max-width:500px) {
        .github-corner:hover .octo-arm {
          animation: none
        }

        .github-corner .octo-arm {
          animation: octocat-wave 560ms ease-in-out
        }
      }
    </style>
</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">Micronaut ä¸­æ–‡æ–‡æ¡£ The HTTP Client</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/avatar.jpg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">æ—å¨ç¾½</span>
                        
                            <span class="author-label">Lv8</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;
        <span class="pc">2022-04-29 09:43:43</span>
        <span class="mobile">2022-04-29 09:43</span>
    </span>
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/Micronaut-%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/">Micronaut ä¸­æ–‡æ–‡æ¡£</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/Micronaut/">Micronaut</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/Groovy/">Groovy</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/%E4%B8%AD%E6%96%87/">ä¸­æ–‡</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <!-- TOC -->

<ul>
<li><a href="#the-http-client">The HTTP Client</a><ul>
<li><a href="#using-the-low-level-http-client-%E4%BD%BF%E7%94%A8%E4%BD%8E%E7%BA%A7%E5%88%AB-http-client">Using the Low-Level HTTP Client (ä½¿ç”¨ä½çº§åˆ« HTTP Client)</a><ul>
<li><a href="#sending-your-first-http-request-%E5%8F%91%E9%80%81%E4%BD%A0%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA-http-%E8%AF%B7%E6%B1%82">Sending your first HTTP request (å‘é€ä½ çš„ç¬¬ä¸€ä¸ª HTTP è¯·æ±‚)</a><ul>
<li><a href="#obtaining-a-httpclient-%E8%8E%B7%E5%8F%96%E4%B8%80%E4%B8%AA-httpclient">Obtaining a HttpClient (è·å–ä¸€ä¸ª HttpClient)</a></li>
<li><a href="#performing-an-http-get-%E6%89%A7%E8%A1%8C%E4%B8%80%E4%B8%AA-http-get-%E8%AF%B7%E6%B1%82">Performing an HTTP GET (æ‰§è¡Œä¸€ä¸ª HTTP GET è¯·æ±‚)</a></li>
<li><a href="#debugging--tracing-the-http-client-%E8%B0%83%E8%AF%95--%E8%B7%9F%E8%B8%AA-http-client">Debugging &#x2F; Tracing the HTTP Client (è°ƒè¯• &#x2F; è·Ÿè¸ª HTTP Client)</a></li>
<li><a href="#client-specific-debugging--tracing-%E6%8C%87%E5%AE%9A%E7%9A%84-client-%E8%B0%83%E8%AF%95--%E8%B7%9F%E8%B8%AA">Client Specific Debugging &#x2F; Tracing (æŒ‡å®šçš„ Client è°ƒè¯• &#x2F; è·Ÿè¸ª)</a></li>
<li><a href="#customizing-the-http-request-%E8%87%AA%E5%AE%9A%E4%B9%89-http-%E8%AF%B7%E6%B1%82">Customizing the HTTP Request (è‡ªå®šä¹‰ HTTP è¯·æ±‚)</a></li>
<li><a href="#reading-json-response-%E8%AF%BB%E5%8F%96-json-%E5%93%8D%E5%BA%94">Reading JSON Response (è¯»å– JSON å“åº”)</a></li>
<li><a href="#decoding-other-content-types-%E8%A7%A3%E7%A0%81%E5%85%B6%E4%BB%96-content-types">Decoding Other Content Types (è§£ç å…¶ä»– Content Types)</a></li>
<li><a href="#receiving-the-full-http-response-%E6%8E%A5%E5%8F%97%E5%AE%8C%E6%95%B4%E7%9A%84-http-%E5%93%8D%E5%BA%94">Receiving the Full HTTP Response (æ¥å—å®Œæ•´çš„ HTTP å“åº”)</a></li>
</ul>
</li>
<li><a href="#posting-a-request-body-%E5%8F%91%E9%80%81%E4%B8%80%E4%B8%AA%E8%AF%B7%E6%B1%82%E4%BD%93">Posting a Request Body (å‘é€ä¸€ä¸ªè¯·æ±‚ä½“)</a><ul>
<li><a href="#sending-json-%E5%8F%91%E9%80%81-json">Sending JSON (å‘é€ JSON)</a></li>
<li><a href="#using-a-uri-template-%E4%BD%BF%E7%94%A8%E4%B8%80%E4%B8%AA-uri-%E6%A8%A1%E6%9D%BF">Using a URI Template (ä½¿ç”¨ä¸€ä¸ª URI æ¨¡æ¿)</a></li>
<li><a href="#sending-form-data-%E5%8F%91%E9%80%81%E8%A1%A8%E5%8D%95%E6%95%B0%E6%8D%AE">Sending Form Data (å‘é€è¡¨å•æ•°æ®)</a></li>
</ul>
</li>
<li><a href="#multipart-client-uploads-multipart-%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%8A%E4%BC%A0">Multipart Client Uploads (Multipart å®¢æˆ·ç«¯ä¸Šä¼ )</a></li>
<li><a href="#streaming-json-over-http-http-%E4%B8%8A%E7%9A%84%E6%B5%81%E5%BC%8F-json">Streaming JSON over HTTP (HTTP ä¸Šçš„æµå¼ JSON)</a></li>
<li><a href="#configuring-http-clients-%E9%85%8D%E7%BD%AE-http-clients">Configuring HTTP clients (é…ç½® HTTP clients)</a><ul>
<li><a href="#global-configuration-for-all-clients-%E7%94%A8%E4%BA%8E%E5%85%A8%E9%83%A8-clients-%E7%9A%84%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE">Global Configuration for All Clients (ç”¨äºå…¨éƒ¨ Clients çš„å…¨å±€é…ç½®)</a></li>
<li><a href="#client-specific-configuration-%E7%89%B9%E5%AE%9A-client-%E9%85%8D%E7%BD%AE">Client Specific Configuration (ç‰¹å®š Client é…ç½®)</a></li>
<li><a href="#using-http-client-connection-pooling-%E4%BD%BF%E7%94%A8-http-client-%E8%BF%9E%E6%8E%A5%E6%B1%A0%E5%8C%96">Using HTTP Client Connection Pooling (ä½¿ç”¨ HTTP Client è¿æ¥æ± åŒ–)</a></li>
<li><a href="#configuring-event-loop-groups-%E9%85%8D%E7%BD%AE-event-loop-%E7%BB%84">Configuring Event Loop Groups (é…ç½® Event Loop ç»„)</a></li>
</ul>
</li>
<li><a href="#error-responses-%E9%94%99%E8%AF%AF%E5%93%8D%E5%BA%94">Error Responses (é”™è¯¯å“åº”)</a></li>
<li><a href="#bind-errors-%E7%BB%91%E5%AE%9A%E9%94%99%E8%AF%AF">Bind Errors (ç»‘å®šé”™è¯¯)</a></li>
</ul>
</li>
<li><a href="#proxying-requests-with-proxyhttpclient-%E4%BD%BF%E7%94%A8-proxyinghttpclient-%E6%9D%A5%E4%BB%A3%E7%90%86%E8%AF%B7%E6%B1%82">Proxying Requests with ProxyHttpClient (ä½¿ç”¨ ProxyingHttpClient æ¥ä»£ç†è¯·æ±‚)</a></li>
<li><a href="#declarative-http-clients-with-client-%E4%BD%BF%E7%94%A8-client-%E7%9A%84%E5%A3%B0%E6%98%8E%E5%BC%8F-http-%E5%AE%A2%E6%88%B7%E7%AB%AF">Declarative HTTP Clients with <code>@Client</code> (ä½¿ç”¨ <code>@Client</code> çš„å£°æ˜å¼ HTTP å®¢æˆ·ç«¯)</a><ul>
<li><a href="#customizing-parameters-binding-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8F%82%E6%95%B0%E7%BB%91%E5%AE%9A">Customizing Parameters Binding (è‡ªå®šä¹‰å‚æ•°ç»‘å®š)</a><ul>
<li><a href="#query-values-formatting-%E8%AF%B7%E6%B1%82%E5%80%BC%E6%A0%BC%E5%BC%8F%E5%8C%96">Query values formatting (è¯·æ±‚å€¼æ ¼å¼åŒ–)</a><ul>
<li><a href="#type-based-binding-parameters-%E5%9F%BA%E4%BA%8E%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8F%82%E6%95%B0%E7%BB%91%E5%AE%9A">Type-Based Binding Parameters (åŸºäºç±»å‹çš„å‚æ•°ç»‘å®š)</a></li>
<li><a href="#custom-binding-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%91%E5%AE%9A">Custom Binding (è‡ªå®šä¹‰ç»‘å®š)</a><ul>
<li><a href="#binding-by-annotation-%E9%80%9A%E8%BF%87%E6%B3%A8%E8%A7%A3%E8%BF%9B%E8%A1%8C%E7%BB%91%E5%AE%9A">Binding By Annotation (é€šè¿‡æ³¨è§£è¿›è¡Œç»‘å®š)</a></li>
<li><a href="#binding-by-type-%E9%80%9A%E8%BF%87%E7%B1%BB%E5%9E%8B%E8%BF%9B%E8%A1%8C%E7%BB%91%E5%AE%9A">Binding By Type (é€šè¿‡ç±»å‹è¿›è¡Œç»‘å®š)</a></li>
</ul>
</li>
<li><a href="#binding-on-method-%E5%9C%A8%E6%96%B9%E6%B3%95%E4%B8%8A%E8%BF%9B%E8%A1%8C%E7%BB%91%E5%AE%9A">Binding On Method (åœ¨æ–¹æ³•ä¸Šè¿›è¡Œç»‘å®š)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#streaming-with-client-%E4%BD%BF%E7%94%A8-client-%E8%BF%9B%E8%A1%8C%E6%B5%81%E5%BC%8F%E5%A4%84%E7%90%86">Streaming with <code>@Client</code> (ä½¿ç”¨ <code>@Client</code> è¿›è¡Œæµå¼å¤„ç†)</a><ul>
<li><a href="#streaming-json-with-client-%E4%BD%BF%E7%94%A8-client-%E8%BF%9B%E8%A1%8C-json-%E6%B5%81%E5%BC%8F%E5%A4%84%E7%90%86">Streaming JSON with <code>@Client</code> (ä½¿ç”¨ <code>@Client</code> è¿›è¡Œ JSON æµå¼å¤„ç†)</a></li>
<li><a href="#streaming-clients-and-response-types-%E6%B5%81%E5%BC%8F%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%92%8C%E5%93%8D%E5%BA%94%E7%B1%BB%E5%9E%8B">Streaming Clients and Response Types (æµå¼å®¢æˆ·ç«¯å’Œå“åº”ç±»å‹)</a></li>
<li><a href="#streaming-clients-and-read-timeout-%E6%B5%81%E5%BC%8F%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%92%8C%E8%AF%BB%E5%8F%96%E8%B6%85%E6%97%B6">Streaming Clients and Read Timeout (æµå¼å®¢æˆ·ç«¯å’Œè¯»å–è¶…æ—¶)</a></li>
<li><a href="#streaming-server-sent-events-%E6%B5%81%E5%BC%8F%E6%9C%8D%E5%8A%A1%E5%8F%91%E9%80%81%E4%BA%8B%E4%BB%B6">Streaming Server Sent Events (æµå¼æœåŠ¡å‘é€äº‹ä»¶)</a></li>
</ul>
</li>
<li><a href="#error-response-%E9%94%99%E8%AF%AF%E5%93%8D%E5%BA%94">Error Response (é”™è¯¯å“åº”)</a></li>
<li><a href="#customizing-request-headers-%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AF%B7%E6%B1%82%E5%A4%B4">Customizing Request Headers (è‡ªå®šä¹‰è¯·æ±‚å¤´)</a><ul>
<li><a href="#populating-headers-using-configuration-%E4%BD%BF%E7%94%A8%E9%85%8D%E7%BD%AE%E6%9D%A5%E5%A1%AB%E5%85%85%E8%AF%B7%E6%B1%82%E5%A4%B4">Populating Headers Using Configuration (ä½¿ç”¨é…ç½®æ¥å¡«å……è¯·æ±‚å¤´)</a></li>
<li><a href="#populating-headers-using-a-client-filter-%E4%BD%BF%E7%94%A8%E4%B8%80%E4%B8%AA%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%87%E6%BB%A4%E5%99%A8%E6%9D%A5%E5%A1%AB%E5%85%85%E8%AF%B7%E6%B1%82%E5%A4%B4">Populating Headers using a Client Filter (ä½¿ç”¨ä¸€ä¸ªå®¢æˆ·ç«¯è¿‡æ»¤å™¨æ¥å¡«å……è¯·æ±‚å¤´)</a></li>
</ul>
</li>
<li><a href="#customizing-jackson-settings-%E8%87%AA%E5%AE%9A%E4%B9%89-jackson-%E8%AE%BE%E7%BD%AE">Customizing Jackson Settings (è‡ªå®šä¹‰ Jackson è®¾ç½®)</a></li>
<li><a href="#retry-and-circuit-breaker-%E9%87%8D%E8%AF%95%E4%B8%8E%E6%96%AD%E8%B7%AF%E5%99%A8">Retry and Circuit Breaker (é‡è¯•ä¸æ–­è·¯å™¨)</a></li>
<li><a href="#client-fallbacks-%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%99%8D%E7%BA%A7">Client Fallbacks (å®¢æˆ·ç«¯é™çº§)</a></li>
<li><a href="#netflix-hystrix-support-%E7%BD%91%E9%A3%9E-hystrix-%E7%9A%84%E6%94%AF%E6%8C%81">Netflix Hystrix Support (ç½‘é£ Hystrix çš„æ”¯æŒ)</a><ul>
<li><a href="#using-the-hystrixcommand-annotation-%E4%BD%BF%E7%94%A8-hystrixcommand-%E6%B3%A8%E8%A7%A3">Using the <code>@HystrixCommand</code> Annotation (ä½¿ç”¨ <code>@HystrixCommand</code> æ³¨è§£)</a></li>
<li><a href="#enabling-hystrix-stream-and-dashboard-%E5%BC%80%E5%90%AF-hystrix-%E6%B5%81%E5%92%8C%E4%BB%AA%E8%A1%A8%E6%9D%BF">Enabling Hystrix Stream and Dashboard (å¼€å¯ Hystrix æµå’Œä»ªè¡¨æ¿)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#http-clients-filters-http-%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%87%E6%BB%A4%E5%99%A8">HTTP Clients Filters (HTTP å®¢æˆ·ç«¯è¿‡æ»¤å™¨)</a><ul>
<li><a href="#injecting-another-client-into-a-httpclientfilter-%E6%B3%A8%E5%85%A5%E5%8F%A6%E4%B8%80%E4%B8%AA%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%88%B0%E8%BF%87%E6%BB%A4%E5%99%A8%E4%B8%AD">Injecting Another Client into a HttpClientFilter (æ³¨å…¥å¦ä¸€ä¸ªå®¢æˆ·ç«¯åˆ°è¿‡æ»¤å™¨ä¸­)</a></li>
<li><a href="#filter-matching-by-annotation-%E9%80%9A%E8%BF%87%E6%B3%A8%E8%A7%A3%E6%9D%A5%E8%BF%9B%E8%A1%8C%E8%BF%87%E6%BB%A4%E5%8C%B9%E9%85%8D">Filter Matching By Annotation (é€šè¿‡æ³¨è§£æ¥è¿›è¡Œè¿‡æ»¤åŒ¹é…)</a></li>
</ul>
</li>
<li><a href="#http2-support-http2-%E7%9A%84%E6%94%AF%E6%8C%81">HTTP&#x2F;2 Support (HTTP&#x2F;2 çš„æ”¯æŒ)</a></li>
<li><a href="#http-client-sample-http-%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BE%8B%E5%AD%90">HTTP Client Sample (HTTP å®¢æˆ·ç«¯ä¾‹å­)</a></li>
</ul>
</li>
</ul>
<!-- /TOC -->

<h1 id="The-HTTP-Client"><a href="#The-HTTP-Client" class="headerlink" title="The HTTP Client"></a>The HTTP Client</h1><p><strong>å£°æ˜</strong>:</p>
<ul>
<li>æœ¬æ–‡ç”±æœ¬äººç¿»è¯‘è‡ª<a class="link"   target="_blank" rel="noopener" href="https://docs.micronaut.io/latest/guide" >å®˜æ–¹æ–‡æ¡£<i class="fas fa-external-link-alt"></i></a></li>
<li>éƒ¨åˆ†å†…å®¹å¯èƒ½ä¼šæœ‰ä¿®æ”¹æˆ–åˆ å‡, ä¸€åˆ‡ä»¥å®˜æ–¹æ–‡æ¡£ä¸ºå‡†.</li>
<li>æœ¬æ–‡ç¿»è¯‘æ—¶ Micronaut ç‰ˆæœ¬ä¸º 3.4.2</li>
</ul>
<p>å¦‚æœä½ ä½¿ç”¨ Micronaut CLI åˆ›å»ºé¡¹ç›®, é‚£ä¹ˆ <code>http-client</code> ä¾èµ–å·²ç»é»˜è®¤åŒ…å«åœ¨ä½ çš„é¡¹ç›®ä¸­äº†</p>
<blockquote>
<p>Client communication between Microservices is a critical component of any Microservice architecture</p>
</blockquote>
<p>å¾®æœåŠ¡å®¢æˆ·ç«¯ä¹‹é—´çš„é€šä¿¡æ˜¯ä»»ä½•å¾®æœåŠ¡æ¶æ„çš„å…³é”®ç»„ä»¶</p>
<blockquote>
<p>With that in mind, Micronaut includes an HTTP client that has both a low-level API and a higher-level AOP-driven API.</p>
</blockquote>
<p>è€ƒè™‘åˆ°è¿™ä¸€ç‚¹, Micronaut åŒ…å«äº†ä¸€ä¸ª HTTP client, è¿™ä¸ª client åŒæ—¶å…·æœ‰ä½çº§åˆ« API å’Œé«˜çº§çš„ AOP é©±åŠ¨çš„ API</p>
<p>æ— è®ºä½ æ˜¯å¦é€‰æ‹©ä½¿ç”¨ Micronaut çš„ HTTP server, ä½ éƒ½å¯èƒ½å¸Œæœ›åœ¨ä½ çš„åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ Micronaut HTTP client, å› ä¸ºå®ƒæ˜¯ä¸€ä¸ªåŠŸèƒ½ä¸°å¯Œçš„å®¢æˆ·ç«¯å®ç°</p>
<p>è¦ä½¿ç”¨è¿™ä¸ª HTTP client, åœ¨ä½ çš„æ„å»ºä¸­æ·»åŠ  <code>http-client</code> ä¾èµ–:</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation(<span class="string">&quot;io.micronaut:micronaut-http-client&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="Using-the-Low-Level-HTTP-Client-ä½¿ç”¨ä½çº§åˆ«-HTTP-Client"><a href="#Using-the-Low-Level-HTTP-Client-ä½¿ç”¨ä½çº§åˆ«-HTTP-Client" class="headerlink" title="Using the Low-Level HTTP Client (ä½¿ç”¨ä½çº§åˆ« HTTP Client)"></a>Using the Low-Level HTTP Client (ä½¿ç”¨ä½çº§åˆ« HTTP Client)</h2><p><code>HttpClient</code> æ¥å£æ„æˆäº†ä½çº§åˆ« API çš„åŸºç¡€</p>
<p><code>HttpClient</code> æ¥å£å£°æ˜äº†ä¸€äº›æ–¹æ³•æ¥å¸®åŠ©ç®€åŒ– HTTP è¯·æ±‚çš„æ‰§è¡Œå’Œæ¥æ”¶å“åº”</p>
<p><code>HttpClient</code> æ¥å£ä¸­çš„å¤§å¤šæ•°æ–¹æ³•éƒ½è¿”å›å“åº”å¼æµ <code>Publisher</code> å®ä¾‹, è¿™å¹¶ä¸æ€»æ˜¯æœ€æœ‰ç”¨çš„æ¥å£</p>
<p>Micronaut çš„ Reactor HTTP Client ä¾èµ–æä¾›äº†ä¸€ä¸ªåç§°ä¸º <code>ReactorHttpClient</code> çš„å­æ¥å£. è¿™ä¸ªå­æ¥å£æä¾›äº† <code>HttpClient</code> æ¥å£çš„å˜ä½“æ¥è¿”å› <code>Project Reactor</code>,<code>Flux</code> ç±»å‹</p>
<h3 id="Sending-your-first-HTTP-request-å‘é€ä½ çš„ç¬¬ä¸€ä¸ª-HTTP-è¯·æ±‚"><a href="#Sending-your-first-HTTP-request-å‘é€ä½ çš„ç¬¬ä¸€ä¸ª-HTTP-è¯·æ±‚" class="headerlink" title="Sending your first HTTP request (å‘é€ä½ çš„ç¬¬ä¸€ä¸ª HTTP è¯·æ±‚)"></a>Sending your first HTTP request (å‘é€ä½ çš„ç¬¬ä¸€ä¸ª HTTP è¯·æ±‚)</h3><h4 id="Obtaining-a-HttpClient-è·å–ä¸€ä¸ª-HttpClient"><a href="#Obtaining-a-HttpClient-è·å–ä¸€ä¸ª-HttpClient" class="headerlink" title="Obtaining a HttpClient (è·å–ä¸€ä¸ª HttpClient)"></a>Obtaining a HttpClient (è·å–ä¸€ä¸ª HttpClient)</h4><p>æœ‰å¤šä¸ªæ–¹æ³•å¯ä»¥è·å–ä¸€ä¸ª <code>HttpClient</code> å¼•ç”¨. æœ€å¸¸ç”¨çš„æ–¹æ³•æ˜¯ä½¿ç”¨ <code>@Client</code> æ³¨è§£</p>
<p>Example - Injecting an HTTP client:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Inject</span></span><br><span class="line"><span class="meta">@Client</span>(<span class="string">&quot;https://api.twitter.com/1.1&quot;</span>)</span><br><span class="line">HttpClient httpClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Inject</span></span><br><span class="line"><span class="meta">@Client</span>(<span class="string">&quot;$&#123;myapp.api.twitter.uri&#125;&quot;</span>)</span><br><span class="line">HttpClient httpClient</span><br></pre></td></tr></table></figure>

<p><code>@Client</code> æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰ä½œç”¨åŸŸ, ç®¡ç†äº† <code>HttpClient</code> å®ä¾‹çš„åˆ›å»º, å¹¶ç¡®ä¿ <code>HttpClient</code> åœ¨åº”ç”¨å…³é—­æ—¶åœæ­¢</p>
<p><code>@Client</code> æ³¨è§£çš„å€¼å¯ä»¥æ˜¯å¦‚ä¸‹ä¹‹ä¸€:</p>
<ul>
<li>ä¸€ä¸ªç»å¯¹ URI, ä¾‹å¦‚ <code>https://api.twitter.com/1.1</code></li>
<li>ä¸€ä¸ªç›¸å¯¹ URI, æŒ‡å‘å½“å‰ server, åœ¨æµ‹è¯•çš„æ—¶å€™å¾ˆæœ‰ç”¨</li>
<li>ä¸€ä¸ªæœåŠ¡æ ‡è¯†(service identifier), ä½¿ç”¨æœåŠ¡å‘ç°</li>
</ul>
<p>å¦ä¸€ç§åˆ›å»ºæ–¹å¼æ˜¯ä½¿ç”¨ <code>HttpClient</code> çš„é™æ€æ–¹æ³• <code>create()</code>, è¿™ä¸ªæ–¹å¼éœ€è¦ä½ è‡ªå·±ä¿è¯ client åœ¨åº”ç”¨å…³é—­æ—¶åœæ­¢, ä¸”ä¸ä¼šä¸º client åˆ›å»ºè¿›è¡Œä¾èµ–æ³¨å…¥</p>
<h4 id="Performing-an-HTTP-GET-æ‰§è¡Œä¸€ä¸ª-HTTP-GET-è¯·æ±‚"><a href="#Performing-an-HTTP-GET-æ‰§è¡Œä¸€ä¸ª-HTTP-GET-è¯·æ±‚" class="headerlink" title="Performing an HTTP GET (æ‰§è¡Œä¸€ä¸ª HTTP GET è¯·æ±‚)"></a>Performing an HTTP GET (æ‰§è¡Œä¸€ä¸ª HTTP GET è¯·æ±‚)</h4><p>ä½¿ç”¨ <code>HttpClient</code> æ—¶, é€šå¸¸æœ‰ä¸¤ä¸ªå¯ç”¨çš„æ–¹æ³•</p>
<p>ç¬¬ä¸€ä¸ªæ˜¯ <code>retrive()</code> æ–¹æ³•, è¿™ä¸ªæ–¹æ³•æ‰§è¡Œä¸€ä¸ª HTTP è¯·æ±‚, å¹¶å°† body ä»¥ä½ è¯·æ±‚çš„ä»»ä½•ç±»å‹ (é»˜è®¤ä¸ºå­—ç¬¦ä¸²) ä½œä¸º <code>Publisher</code> è¿”å›</p>
<blockquote>
<p>Perform an HTTP request for the given request object emitting the full HTTP response from returned Publisher and converting the response body to the specified type.</p>
</blockquote>
<p><code>retrieve</code> æ–¹æ³•æ¥æ”¶ä¸€ä¸ª <code>HttpRequest</code> æˆ–è€…ä¸€ä¸ª <code>String</code> URI æ¥æŒ‡å‘ä½ æƒ³è¦è¯·æ±‚çš„ç«¯ç‚¹</p>
<p>Example - Using retrieve - Use retrieve to execute an HTTP <code>GET</code> and receive the response body as a <code>String</code>:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">when:</span></span><br><span class="line">String uri = UriBuilder.of(<span class="string">&quot;/hello/&#123;name&#125;&quot;</span>)</span><br><span class="line">                       .expand(<span class="attr">name:</span> <span class="string">&quot;John&quot;</span>)</span><br><span class="line"><span class="attr">then:</span></span><br><span class="line"><span class="string">&quot;/hello/John&quot;</span> == uri</span><br><span class="line"></span><br><span class="line"><span class="attr">when:</span></span><br><span class="line">String result = client.toBlocking()</span><br><span class="line">                      .retrieve(uri)</span><br><span class="line"><span class="attr">then:</span></span><br><span class="line"><span class="string">&quot;Hello John&quot;</span> == result</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­, è°ƒç”¨äº† <code>toBlocking()</code> æ–¹æ³•æ¥è¿”å›ä¸€ä¸ªé˜»å¡ç‰ˆæœ¬çš„ client, åœ¨ç”Ÿäº§ä»£ç ä¸­, ä¸è¦ä½¿ç”¨è¿™ä¸ªé˜»å¡çš„ client, åº”è¯¥ç›´æ¥ä½¿ç”¨éé˜»å¡è¯·æ±‚</p>
<p>Example - Using the HTTP client without blocking:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> io.micronaut.http.HttpRequest.GET</span><br><span class="line"></span><br><span class="line"><span class="meta">@Get</span>(<span class="string">&#x27;/hello/&#123;name&#125;&#x27;</span>)</span><br><span class="line"><span class="meta">@SingleResult</span></span><br><span class="line">Publisher&lt;String&gt; hello(String name) &#123;                      <span class="comment">// 1</span></span><br><span class="line">    Mono.from(httpClient.retrieve(GET(<span class="string">&quot;/hello/&#123;name&#125;&quot;</span>)))    <span class="comment">// 2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>1</code> : The <code>hello</code> method returns a <code>Mono</code> which may or may not emit an item. If an item is not emitted, a 404 is returned</p>
<p><code>2</code> : The <code>retrieve</code> method is called which returns a <code>Flux</code>. This has a <code>firstElement</code> method that returns the first emitted item or nothing</p>
<p>é€šè¿‡ä½¿ç”¨ Reactor (æˆ–è€… RxJava), ä½ å¯ä»¥å¾ˆå®¹æ˜“ä¸”é«˜æ•ˆåœ°ç»„åˆå¤šä¸ªéé˜»å¡ HTTP client è¯·æ±‚</p>
<h4 id="Debugging-x2F-Tracing-the-HTTP-Client-è°ƒè¯•-x2F-è·Ÿè¸ª-HTTP-Client"><a href="#Debugging-x2F-Tracing-the-HTTP-Client-è°ƒè¯•-x2F-è·Ÿè¸ª-HTTP-Client" class="headerlink" title="Debugging &#x2F; Tracing the HTTP Client (è°ƒè¯• &#x2F; è·Ÿè¸ª HTTP Client)"></a>Debugging &#x2F; Tracing the HTTP Client (è°ƒè¯• &#x2F; è·Ÿè¸ª HTTP Client)</h4><p>è¦è°ƒè¯•ä» HTTP client å‘é€å’Œæ¥æ”¶çš„è¯·æ±‚, å¯ä»¥åœ¨ <code>logback.xml</code> ä¸­å¼€å¯æ—¥å¿—è¿½è¸ª:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// logback.xml</span><br><span class="line"><span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;io.micronaut.http.client&quot;</span> <span class="attr">level</span>=<span class="string">&quot;TRACE&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="Client-Specific-Debugging-x2F-Tracing-æŒ‡å®šçš„-Client-è°ƒè¯•-x2F-è·Ÿè¸ª"><a href="#Client-Specific-Debugging-x2F-Tracing-æŒ‡å®šçš„-Client-è°ƒè¯•-x2F-è·Ÿè¸ª" class="headerlink" title="Client Specific Debugging &#x2F; Tracing (æŒ‡å®šçš„ Client è°ƒè¯• &#x2F; è·Ÿè¸ª)"></a>Client Specific Debugging &#x2F; Tracing (æŒ‡å®šçš„ Client è°ƒè¯• &#x2F; è·Ÿè¸ª)</h4><p>è¦å¼€å¯æŒ‡å®š client çš„æ—¥å¿—, ä½ å¯ä»¥ä¸ºæ‰€æœ‰çš„ HTTP client é…ç½®é»˜è®¤ logger</p>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨ <a class="link"   target="_blank" rel="noopener" href="https://docs.micronaut.io/latest/guide/#_client_specific_configuration" >Client-Specific Configuration<i class="fas fa-external-link-alt"></i></a> ä¸ºä¸åŒ client å®šä¹‰ä¸åŒçš„ logger</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">        <span class="attr">client:</span></span><br><span class="line">            <span class="attr">logger-name:</span> <span class="string">mylogger</span></span><br><span class="line">        <span class="attr">services:</span></span><br><span class="line">            <span class="attr">otherClient:</span></span><br><span class="line">                <span class="attr">logger-name:</span> <span class="string">other.client</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ <code>logback.xml</code> ä¸­å¼€å¯æ—¥å¿—è®°å½•:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;mylogger&quot;</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;other.client&quot;</span> <span class="attr">level</span>=<span class="string">&quot;TRACE&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="Customizing-the-HTTP-Request-è‡ªå®šä¹‰-HTTP-è¯·æ±‚"><a href="#Customizing-the-HTTP-Request-è‡ªå®šä¹‰-HTTP-è¯·æ±‚" class="headerlink" title="Customizing the HTTP Request (è‡ªå®šä¹‰ HTTP è¯·æ±‚)"></a>Customizing the HTTP Request (è‡ªå®šä¹‰ HTTP è¯·æ±‚)</h4><p><code>HttpRequest</code> æ¥å£çš„é™æ€æ–¹æ³• <code>GET</code> æ„å»ºäº†ä¸€ä¸ª <code>MutableHttpRequest</code> å®ä¾‹</p>
<p><code>MutableHttpRequest</code> å®ä¾‹æ˜¯å¯ä»¥ä¿®æ”¹è¯¥çš„, ä¾‹å¦‚å¯ä»¥æ·»åŠ  headers, è‡ªå®šä¹‰è¯·æ±‚ body:</p>
<p>Example - Passing an HttpRequest to retrieve:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> io.micronaut.http.HttpRequest.GET</span><br><span class="line"></span><br><span class="line">Flux&lt;String&gt; response = Flux.from(</span><br><span class="line">    client.retrieve(</span><br><span class="line">        GET(<span class="string">&quot;/hello/John&quot;</span>).header(<span class="string">&quot;X-My-Header&quot;</span>, <span class="string">&quot;SomeValue&quot;</span>)</span><br><span class="line">    )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="Reading-JSON-Response-è¯»å–-JSON-å“åº”"><a href="#Reading-JSON-Response-è¯»å–-JSON-å“åº”" class="headerlink" title="Reading JSON Response (è¯»å– JSON å“åº”)"></a>Reading JSON Response (è¯»å– JSON å“åº”)</h4><p>å¾®æœåŠ¡é€šå¸¸ä½¿ç”¨ JSON ç­‰æ¶ˆæ¯ç¼–ç æ ¼å¼</p>
<p>Micronaut çš„ HTTP client åˆ©ç”¨ Jackson è¿›è¡Œ JSON è§£æ, å› æ­¤ Jackson å¯ä»¥è§£ç çš„ä»»ä½•ç±»å‹éƒ½å¯ä»¥ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ <code>retrieve()</code> æ–¹æ³•:</p>
<p>Example - æœ‰ä¸€ä¸ª Controller è¿”å›ä¸€ä¸ª JSONå“åº”:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Get</span>(<span class="string">&#x27;/greet/&#123;name&#125;&#x27;</span>)</span><br><span class="line">Message greet(String name) &#123; <span class="keyword">new</span> Message(<span class="string">&quot;Hello $name&quot;</span>) &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonCreator</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonProperty</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Message</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> String text</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonCreator</span></span><br><span class="line">    Message(<span class="meta">@JsonProperty</span>(<span class="string">&quot;text&quot;</span>) String text) &#123; <span class="variable language_">this</span>.text = text&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ client ä¸­ä½ å¯ä»¥è°ƒç”¨è¿™ä¸ª Controller çš„ endpoint å¹¶ä½¿ç”¨ <code>retrieve()</code>æ–¹æ³• è§£ç  JSON ä¸ºä¸€ä¸ª <code>Map</code></p>
<p>Example - Decoding the response body to a Map:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Flux&lt;Map&gt; response = Flux.from(</span><br><span class="line">    client.retrieve(</span><br><span class="line">        GET(<span class="string">&#x27;/greet/John&#x27;</span>, Map)</span><br><span class="line">    )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ä½¿ç”¨ <code>Argument.of()</code> æ–¹æ³•æ¥è‡ªå®šä¹‰ Map çš„ key&#x2F;value çš„ç±»å‹:</p>
<p>Example - Decoding the response body to Map:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">response = Flux.from(</span><br><span class="line">    client.retrieve(</span><br><span class="line">        GET(<span class="string">&#x27;/greet/John&#x27;</span>),</span><br><span class="line">        Argument.of(Map, String, String)    <span class="comment">// this method returns a Map where the key and value types are String</span></span><br><span class="line">    )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>è™½ç„¶å°† JSON ä½œä¸º <code>Map</code> è¿›è¡Œè·å–æ˜¯å¯å–çš„, ä½†é€šå¸¸å¸Œæœ›å°†å¯¹è±¡è§£ç ä¸º POJO:</p>
<p>Example - Decoding the response body to a POJO:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">when:</span></span><br><span class="line">Flux&lt;Message&gt; response = Flux.from(</span><br><span class="line">    client.retrieve(</span><br><span class="line">        GET(<span class="string">&#x27;/greet/John&#x27;</span>),</span><br><span class="line">        Message</span><br><span class="line">    )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥å¯ä»¥å®šä¹‰ä¸€ä¸ªé€šç”¨çš„ API é¡¹ç›®, å¯ä»¥åœ¨è¿™ä¸ªé¡¹ç›®ä¸­å®šä¹‰ å®šä¹‰API çš„ interface å’Œ ç±»</p>
<h4 id="Decoding-Other-Content-Types-è§£ç å…¶ä»–-Content-Types"><a href="#Decoding-Other-Content-Types-è§£ç å…¶ä»–-Content-Types" class="headerlink" title="Decoding Other Content Types (è§£ç å…¶ä»– Content Types)"></a>Decoding Other Content Types (è§£ç å…¶ä»– Content Types)</h4><p>å¦‚æœä½ è¦è¯·æ±‚çš„æœåŠ¡ä½¿ç”¨çš„æ˜¯è‡ªå®šä¹‰çš„ content type è€Œä¸æ˜¯ JSON, é»˜è®¤æƒ…å†µä¸‹ Micronaut çš„ HTTP client å¹¶ä¸çŸ¥é“æ€æ ·å»è§£æè¿™æ ·çš„ç±»å‹</p>
<p>é€šè¿‡æ³¨å†Œä¸€ä¸ª <code>MediaTypeCodec</code> Bean æ¥è§£å†³è¿™ä¸ªé—®é¢˜, è¿™ä¸ª Bean ä¼šè‡ªåŠ¨è¢«å‘ç°å¹¶ç”¨äºç¼–è§£ç æ¶ˆæ¯</p>
<h4 id="Receiving-the-Full-HTTP-Response-æ¥å—å®Œæ•´çš„-HTTP-å“åº”"><a href="#Receiving-the-Full-HTTP-Response-æ¥å—å®Œæ•´çš„-HTTP-å“åº”" class="headerlink" title="Receiving the Full HTTP Response (æ¥å—å®Œæ•´çš„ HTTP å“åº”)"></a>Receiving the Full HTTP Response (æ¥å—å®Œæ•´çš„ HTTP å“åº”)</h4><p>æœ‰æ—¶å€™ä»…ä»…æ¥æ”¶å“åº”çš„ body æ˜¯ä¸å¤Ÿçš„, å› ä¸ºå¯èƒ½è¿˜éœ€è¦è·å–å“åº”çš„å…¶ä»–ä¿¡æ¯, ä¾‹å¦‚ headers, cookies</p>
<p>è¿™æ—¶, å¯ä»¥ä½¿ç”¨ <code>exchange()</code> æ–¹æ³•:</p>
<p>Example - Receiving the Full HTTP Response:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">when:</span></span><br><span class="line">Flux&lt;HttpResponse&gt; call = Flux.from(</span><br><span class="line">    client.exchange(            <span class="comment">// The exchange method receieves the HttpResponse</span></span><br><span class="line">        GET(<span class="string">&#x27;/greet/John&#x27;</span>),</span><br><span class="line">        Message</span><br><span class="line">    )</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">HttpResponse&lt;Message&gt; response = call.blockFirst()</span><br><span class="line">Optional&lt;Message&gt; message = response.getBody(Message)   <span class="comment">// The body is retrieved using the getBody() method of the rsponse</span></span><br><span class="line"></span><br><span class="line"><span class="attr">then:</span></span><br><span class="line">HttpStatus.OK == response.getStatus()</span><br><span class="line">message.isPresent()</span><br><span class="line"><span class="string">&#x27;Hello John&#x27;</span> == message.get().getText()</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä¾‹å­ä¸­è·å–äº†å®Œæ•´çš„ <code>HttpResponse</code></p>
<h3 id="Posting-a-Request-Body-å‘é€ä¸€ä¸ªè¯·æ±‚ä½“"><a href="#Posting-a-Request-Body-å‘é€ä¸€ä¸ªè¯·æ±‚ä½“" class="headerlink" title="Posting a Request Body (å‘é€ä¸€ä¸ªè¯·æ±‚ä½“)"></a>Posting a Request Body (å‘é€ä¸€ä¸ªè¯·æ±‚ä½“)</h3><p><code>HttpRequest</code> æ¥å£å…·æœ‰é€‚ç”¨äºæ‰€æœ‰ä¸åŒ HTTP method çš„å·¥å‚æ–¹æ³•</p>
<p>Table - HttpRequest Factory Methods:</p>
<table>
<thead>
<tr>
<th align="left">Method</th>
<th align="left">Description</th>
<th align="left">Allows Body</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>HttpRequest.GET(java.lang.String)</code></td>
<td align="left">Constructs an HTTP GET request</td>
<td align="left">false</td>
</tr>
<tr>
<td align="left"><code>HttpRequest.OPTIONS(java.lang.String)</code></td>
<td align="left">Constructs an HTTP OPTIONS request</td>
<td align="left">false</td>
</tr>
<tr>
<td align="left"><code>HttpRequest.HEAD(java.lang.String)</code></td>
<td align="left">Constructs an HTTP HEAD request</td>
<td align="left">false</td>
</tr>
<tr>
<td align="left"><code>HttpRequest.POST(java.lang.String, T)</code></td>
<td align="left">Constructs an HTTP POST request</td>
<td align="left">true</td>
</tr>
<tr>
<td align="left"><code>HttpRequest.PUT(java.lang.String, T)</code></td>
<td align="left">Constructs an HTTP PUT request</td>
<td align="left">true</td>
</tr>
<tr>
<td align="left"><code>HttpRequest.PATCH(java.lang.String, T)</code></td>
<td align="left">Constructs an HTTP PATCH request</td>
<td align="left">true</td>
</tr>
<tr>
<td align="left"><code>HttpRequest.DELETE(java.lang.String)</code></td>
<td align="left">Constructs an HTTP DELETE request</td>
<td align="left">true</td>
</tr>
</tbody></table>
<p>å­˜åœ¨ä¸€ä¸ª <code>create()</code> æ–¹æ³•æ¥æ„é€ ä¸€ä¸ªé€‚ç”¨äºä»»ä½• <code>HttpMethod</code> ç±»å‹çš„è¯·æ±‚</p>
<p>å› ä¸º <code>POST</code>,<code>PUT</code>,<code>PATCH</code> method è¦æ±‚ä¸€ä¸ª body, æ‰€ä»¥éœ€è¦ä¼ å…¥ä¸€ä¸ªä»£è¡¨è¯·æ±‚ body çš„å¯¹è±¡ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°</p>
<p>Example - Sending a <code>String</code> body:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> io.micronaut.http.HttpRequest.POST</span><br><span class="line"></span><br><span class="line">Flux&lt;HttpResponse&lt;String&gt;&gt; call = Flux.from(</span><br><span class="line">    client.exchange(</span><br><span class="line">        POST(<span class="string">&#x27;/hello&#x27;</span>, <span class="string">&#x27;Hello John&#x27;</span>)                <span class="comment">// 1</span></span><br><span class="line">            .contentType(MediaType.TEXT_PLAIN_TYPE)</span><br><span class="line">            .accept(MediaType.TEXT_PLAIN_TYPE),     <span class="comment">// 2</span></span><br><span class="line">        String                                      <span class="comment">// 3</span></span><br><span class="line">    )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><code>1</code> : The <code>POST</code> method is used; the first argument is the URI and the second is the body</p>
<p><code>2</code> : The content type and accepted type are set to <code>text/plain</code> (the default is <code>application/json</code>)</p>
<p><code>3</code> : The expected response type is a <code>String</code></p>
<h4 id="Sending-JSON-å‘é€-JSON"><a href="#Sending-JSON-å‘é€-JSON" class="headerlink" title="Sending JSON (å‘é€ JSON)"></a>Sending JSON (å‘é€ JSON)</h4><p>è¦å‘é€ JSON æ•°æ®, ä¼ å…¥è¦ç¼–ç ä¸º JSON çš„å¯¹è±¡(æ— è®ºæ˜¯ Map è¿˜æ˜¯ POJO), åªè¦ Jackson èƒ½å¤Ÿå¯¹å…¶è¿›è¡Œç¼–ç </p>
<p>Example - Sending a JSON body:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Flux&lt;HttpResponse&lt;Message&gt;&gt; call = Flux.from(</span><br><span class="line">    client.exchange(</span><br><span class="line">        POST(<span class="string">&#x27;/greet&#x27;</span>, <span class="keyword">new</span> Message(<span class="string">&#x27;Hello John&#x27;</span>)),  <span class="comment">// 1</span></span><br><span class="line">        Message                                     <span class="comment">// 2</span></span><br><span class="line">    )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><code>1</code> : An instance of <code>Message</code> is created and passed to the <code>POST</code> method</p>
<p><code>2</code> : The same class decodes the response</p>
<p>ä¸Šé¢çš„ä¾‹å­ä¸­, å¦‚ä¸‹çš„ JSON è¢«ä½œä¸ºè¯·æ±‚çš„ body:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Hello John&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="Using-a-URI-Template-ä½¿ç”¨ä¸€ä¸ª-URI-æ¨¡æ¿"><a href="#Using-a-URI-Template-ä½¿ç”¨ä¸€ä¸ª-URI-æ¨¡æ¿" class="headerlink" title="Using a URI Template (ä½¿ç”¨ä¸€ä¸ª URI æ¨¡æ¿)"></a>Using a URI Template (ä½¿ç”¨ä¸€ä¸ª URI æ¨¡æ¿)</h4><p>å¦‚æœè¦åœ¨ URI ä¸­åŒ…å«ä¸€äº›å¯¹è±¡çš„å±æ€§, å¯ä»¥ä½¿ç”¨ä¸€ä¸ª URI template</p>
<p>å‡è®¾, ä½ æœ‰ä¸€ä¸ªæ‹¥æœ‰ <code>title</code> å±æ€§çš„ <code>Book</code> ç±». ä½ å¯ä»¥åœ¨ URI template ä¸­åŒ…å« <code>title</code>, ç„¶åä½¿ç”¨ä¸€ä¸ª <code>Book</code> å®ä¾‹æ¥å¡«å……è¿™ä¸ª template çš„ <code>title</code></p>
<p>Example - Sending a JSON body with a URI template:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Flux&lt;HttpResponse&lt;Book&gt;&gt; call = Flux.from(</span><br><span class="line">    POST(<span class="string">&#x27;/amazon/book/&#123;title&#125;&#x27;</span>, <span class="keyword">new</span> Book(<span class="string">&#x27;The Stand&#x27;</span>)),</span><br><span class="line">    Book</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="Sending-Form-Data-å‘é€è¡¨å•æ•°æ®"><a href="#Sending-Form-Data-å‘é€è¡¨å•æ•°æ®" class="headerlink" title="Sending Form Data (å‘é€è¡¨å•æ•°æ®)"></a>Sending Form Data (å‘é€è¡¨å•æ•°æ®)</h4><p>å¯ä»¥å°†ä¸€ä¸ª POJO æˆ– Map ç¼–ç ä¸ºè¡¨å•æ•°æ®è€Œä¸æ˜¯ JSON</p>
<p>ä»…éœ€è¦åœ¨ POST è¯·æ±‚ä¸­å°† Content-Type è®¾ç½®ä¸º <code>application/x-www-form-urlencoded</code></p>
<p>Example - Sending a Form Data:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Flux&lt;HttpResponse&lt;Book&gt;&gt; call = client.exchange(</span><br><span class="line">    POST(<span class="string">&#x27;/amazon/book/&#123;title&#125;&#x27;</span>, <span class="keyword">new</span> Book(<span class="string">&#x27;The Stand&#x27;</span>))</span><br><span class="line">        .contentType(MediaType.APPLICATION_FORM_URLENCODED),</span><br><span class="line">    Book</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="Multipart-Client-Uploads-Multipart-å®¢æˆ·ç«¯ä¸Šä¼ "><a href="#Multipart-Client-Uploads-Multipart-å®¢æˆ·ç«¯ä¸Šä¼ " class="headerlink" title="Multipart Client Uploads (Multipart å®¢æˆ·ç«¯ä¸Šä¼ )"></a>Multipart Client Uploads (Multipart å®¢æˆ·ç«¯ä¸Šä¼ )</h3><p>Micronaut HTTP client æ”¯æŒ multipart request</p>
<p>è¦æ„å»ºä¸€ä¸ª multipart request, å°† Content-Type è®¾ç½®ä¸º <code>multipart/form-data</code>, å¹¶è®¾ç½® body ä¸ºä¸€ä¸ª <code>MultipartBody</code> å®ä¾‹</p>
<p>Example - Creating the body:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.http.multipart.CompletedFileUpload</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.multipart.StreamingFileUpload</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.client.multipart.MultipartBody</span><br><span class="line"><span class="keyword">import</span> org.reactivestreams.Publisher</span><br><span class="line"></span><br><span class="line">File file = <span class="keyword">new</span> File(uploadDir, <span class="string">&#x27;data.txt&#x27;</span>)</span><br><span class="line">file.text = <span class="string">&#x27;test file&#x27;</span></span><br><span class="line">file.createdNewFile()</span><br><span class="line"></span><br><span class="line">MultipartBody requestBody = MultipartBody.builder()             <span class="comment">// 1</span></span><br><span class="line">                                         .addPart(              <span class="comment">// 2</span></span><br><span class="line">                                             <span class="string">&quot;data&quot;</span>,</span><br><span class="line">                                             file.name,</span><br><span class="line">                                             MediaType.TEXT_PLAIN_TYPE,</span><br><span class="line">                                             file</span><br><span class="line">                                         )</span><br><span class="line">                                         .build()               <span class="comment">// 3</span></span><br></pre></td></tr></table></figure>

<p><code>1</code> : Create a MultipartBody builder for adding parts to the body</p>
<p><code>2</code> : Add a part to the body, in this cases a file. There are different variations of this method in <code>MultipartBody.Builder</code></p>
<p><code>3</code> : The build method assembles all parts from the builder into a MultipartBody. At least one part is required</p>
<p>Example - Creating a request:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HttpRequest.POST(<span class="string">&#x27;/multipart/upload&#x27;</span>, requestBody)</span><br><span class="line">           .contentType(MediaType.MULTIPART_FORM_DATA_TYPE)</span><br></pre></td></tr></table></figure>

<h3 id="Streaming-JSON-over-HTTP-HTTP-ä¸Šçš„æµå¼-JSON"><a href="#Streaming-JSON-over-HTTP-HTTP-ä¸Šçš„æµå¼-JSON" class="headerlink" title="Streaming JSON over HTTP (HTTP ä¸Šçš„æµå¼ JSON)"></a>Streaming JSON over HTTP (HTTP ä¸Šçš„æµå¼ JSON)</h3><p>Micronaut çš„ HTTP client åŒ…æ‹¬é€šè¿‡ <code>ReactorStreamingHttpClient</code> æ¥å£æ”¯æŒçš„ HTTP ä¸Šçš„æµå¼ä¼ è¾“æ•°æ®, è¿™ä¸ªæ¥å£åŒ…å«äº†ç‰¹å®šäºæµçš„æ–¹æ³•:</p>
<p>Table - HTTP Streaming Methods:</p>
<table>
<thead>
<tr>
<th align="left">Method</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>dataStream(HttpRequest&lt;I&gt; request)</code></td>
<td align="left">Returns a stream of data as a <code>Flux</code> of <code>ByteBuffer</code></td>
</tr>
<tr>
<td align="left"><code>exchangeStream(HttpRequest&lt;I&gt; request)</code></td>
<td align="left">Returns the <code>HttpResponse</code> wrapping a <code>Flux</code> of <code>ByteBuffer</code></td>
</tr>
<tr>
<td align="left"><code>jsonStream(HttpResponse&lt;I&gt; request)</code></td>
<td align="left">Returns a non-blocking stream of JSON objects</td>
</tr>
</tbody></table>
<p>è¦ä½¿ç”¨ JSON streaming, åœ¨ server ä¸­å£°æ˜ä¸€ä¸ª Controller æ–¹æ³•, è¿™ä¸ªæ–¹æ³• <code>produces</code> çš„ Content-Type æ˜¯ <code>application/x-json-stream</code></p>
<p>Example - Streaming JSON on the Server:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.http.MediaType</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Controller</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Get</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Flux</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.Duration</span><br><span class="line"><span class="keyword">import</span> java.time.ZonedDateTime</span><br><span class="line"><span class="keyword">import</span> java.time.temporal.ChronoUnit</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit</span><br><span class="line"></span><br><span class="line"><span class="meta">@Get</span>(value = <span class="string">&#x27;/headlines&#x27;</span>, processes = MediaType.APPLICATION_JSON_STREAM)           <span class="comment">// 1</span></span><br><span class="line">Flux&lt;Headline&gt; streamHeadlines() &#123;</span><br><span class="line">    Mono.fromCallable(&#123;            <span class="comment">// 2</span></span><br><span class="line">            <span class="keyword">new</span> Headline(<span class="attr">text:</span> <span class="string">&quot;Latest Headline at $&#123;ZonedDateTime.now()&#125;&quot;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">        .repeat(<span class="number">100</span>)               <span class="comment">// 3</span></span><br><span class="line">        .delayElements(Duration.of(<span class="number">1</span>, ChronoUnit.SECONDS))  <span class="comment">// 4</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>1</code> : The <code>streamHeadlines</code> method produces <code>application/x-json-stream</code>; <code>processes</code> : Shortcut that allows setting both the consumes() and produces() settings to the same media type.</p>
<p><code>2</code> : A <code>Flux</code> is created from a <code>Callable</code> function</p>
<p><code>3</code> : The <code>Flux</code> repeats 100 times</p>
<p><code>4</code> : The <code>Flux</code> emits items with a delay of one second between each</p>
<p>åœ¨å®¢æˆ·ç«¯, ä½¿ç”¨ <code>jsonSteam</code> æ¥è®¢é˜…(subscribe)è¿™ä¸ªæµ, æ¯æ¬¡ server è¾“å‡ºä¸€ä¸ª JSON å¯¹è±¡, å®¢æˆ·ç«¯å°†ä¼šè§£ç å¹¶æ¶ˆè´¹è¿™ä¸ªå¯¹è±¡</p>
<p>Example - Streaming JSON on the Client:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Flux&lt;Headline&gt; headlineStream = Flux.from(</span><br><span class="line">    client.jsonStream(  <span class="comment">// 1</span></span><br><span class="line">        GET(<span class="string">&#x27;streaming/headlines&#x27;</span>),</span><br><span class="line">        Headline</span><br><span class="line">    )</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">CompletableFuture&lt;Headline&gt; future = <span class="keyword">new</span> CompletableFuture&lt;&gt;()  <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line">headlineStream.subscribe(</span><br><span class="line">    <span class="keyword">new</span> Subscribe&lt;Headline&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="type">void</span> onSubscribe(Subscription s) &#123; s.request(<span class="number">1</span>) &#125;   <span class="comment">//3 </span></span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="type">void</span> onNext(Headline headline) &#123; println <span class="string">&quot;Received Headline = $headline.text&quot;</span>; future.complete(headline) &#125;  <span class="comment">// 4</span></span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="type">void</span> onError(Throwable t) &#123; future.completeExceptionally(t) &#125;   <span class="comment">// 5</span></span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="type">void</span> onComplete() &#123;&#125;    <span class="comment">// 6</span></span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><code>1</code> : The <code>jsonStream</code> method returns a <code>Flux</code></p>
<p><code>2</code> : A <code>CompletableFuture</code> is used to receive a value, but what you do with each emitted item is application-specific</p>
<p><code>3</code> : The <code>Subscription</code> requests a single item. You can use the <code>Subscription</code> to regulate(è°ƒèŠ‚) back pressure and demand</p>
<p><code>4</code> : The <code>onNext</code> method is called when an item is emitted</p>
<p><code>5</code> : The <code>onError</code> method is called when an error occurs</p>
<p><code>6</code> : The <code>onComplete</code> method is called when all <code>Headine</code> instances have been emitted</p>
<h3 id="Configuring-HTTP-clients-é…ç½®-HTTP-clients"><a href="#Configuring-HTTP-clients-é…ç½®-HTTP-clients" class="headerlink" title="Configuring HTTP clients (é…ç½® HTTP clients)"></a>Configuring HTTP clients (é…ç½® HTTP clients)</h3><h4 id="Global-Configuration-for-All-Clients-ç”¨äºå…¨éƒ¨-Clients-çš„å…¨å±€é…ç½®"><a href="#Global-Configuration-for-All-Clients-ç”¨äºå…¨éƒ¨-Clients-çš„å…¨å±€é…ç½®" class="headerlink" title="Global Configuration for All Clients (ç”¨äºå…¨éƒ¨ Clients çš„å…¨å±€é…ç½®)"></a>Global Configuration for All Clients (ç”¨äºå…¨éƒ¨ Clients çš„å…¨å±€é…ç½®)</h4><p>é»˜è®¤çš„ HTTP client é…ç½®æ˜¯ <a class="link"   target="_blank" rel="noopener" href="https://docs.micronaut.io/latest/guide/#_client_specific_configuration" >DefaultHttpClientConfiguration<i class="fas fa-external-link-alt"></i></a></p>
<p>å…è®¸é…ç½®æ‰€æœ‰çš„ HTTP client çš„é»˜è®¤è¡Œä¸º</p>
<p>Example - Altering default HTTP client configuration:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">//</span> <span class="string">application.yml</span></span><br><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">        <span class="attr">client:</span></span><br><span class="line">            <span class="attr">read-timeout:</span> <span class="string">5s</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä¾‹å­ä¸­è®¾ç½®äº† <a class="link"   target="_blank" rel="noopener" href="https://docs.micronaut.io/latest/api/io/micronaut/http/client/HttpClientConfiguration.html" >HttpClientConfiguration<i class="fas fa-external-link-alt"></i></a> çš„å±æ€§</p>
<h4 id="Client-Specific-Configuration-ç‰¹å®š-Client-é…ç½®"><a href="#Client-Specific-Configuration-ç‰¹å®š-Client-é…ç½®" class="headerlink" title="Client Specific Configuration (ç‰¹å®š Client é…ç½®)"></a>Client Specific Configuration (ç‰¹å®š Client é…ç½®)</h4><p>æœ‰å¤šä¸ªé€‰é¡¹æ¥ä¸ºæ¯ä¸ª client è®¾å®šä¸åŒçš„é…ç½®</p>
<p>å¯ä»¥åœ¨ <code>application.yml</code> ä¸­æ‰‹åŠ¨é…ç½®æœåŠ¡å‘ç°å¹¶åº”ç”¨åˆ°æ¯ä¸ª client é…ç½®ä¸­:</p>
<p>Example - Manually configuring HTTP services:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">        <span class="attr">services:</span></span><br><span class="line">            <span class="attr">foo:</span></span><br><span class="line">                <span class="attr">urls:</span></span><br><span class="line">                    <span class="bullet">-</span> <span class="string">https://foo1</span></span><br><span class="line">                    <span class="bullet">-</span> <span class="string">https://foo2</span></span><br><span class="line">                <span class="attr">read-timeout:</span> <span class="string">5s</span>    <span class="comment"># The read timeout is applied to the foo client</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>This client configuration can be used in conjunction with the @Client annotation, either by injecting an HttpClient directly or use on a client interface.</p>
</blockquote>
<p>è¿™ä¸ªå®¢æˆ·ç«¯é…ç½®å¯ä»¥ä¸ <code>@Client</code> æ³¨è§£ä¸€èµ·ä½¿ç”¨, å¯ä»¥é€šè¿‡ç›´æ¥æ³¨å…¥ä¸€ä¸ª <code>HttpClient</code> æˆ–åœ¨ä¸€ä¸ª client æ¥å£ä¸Šä½¿ç”¨</p>
<blockquote>
<p>In any case, all other attributes on the annotation will be ignored except the service id.</p>
</blockquote>
<p>åœ¨ä»»ä½•æƒ…å†µä¸‹, æ³¨è§£ä¸Šçš„æ‰€æœ‰å±æ€§éƒ½å°†è¢«å¿½ç•¥, é™¤äº† service id</p>
<p>ç„¶å, æ³¨å…¥å‘½åçš„ client é…ç½®:</p>
<p>Example - Injecting an HTTP client:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Client</span>(<span class="string">&quot;foo&quot;</span>) <span class="meta">@Inject</span> ReactorHttpClient httpClient</span><br></pre></td></tr></table></figure>

<p>ä½ è¿˜å¯ä»¥å®šä¹‰ä¸€ä¸ªç»§æ‰¿ <code>HttpClientConfiguration</code> çš„ Bean, å¹¶ç¡®ä¿ä½¿ç”¨ <code>javax.inject.Named</code> æ³¨è§£ä¸ºè¿™ä¸ª Bean åˆé€‚åœ°å‘½å:</p>
<p>Example - Defining an HTTP client configuration bean:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Named</span>(<span class="string">&quot;twitter&quot;</span>)</span><br><span class="line"><span class="meta">@Singleton</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TwitterHttpClientConfiguration</span> <span class="keyword">extends</span> <span class="title class_">HttpClientConfiguration</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> TwitterHttpClientConfiguration(ApplicationConfiguration configuration) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(configuration)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ é€šè¿‡ <code>@Client</code> ä½¿ç”¨æœåŠ¡å‘ç°æ³¨å…¥ä¸€ä¸ªå‘½åä¸º <code>twitter</code> çš„ service, é‚£ä¹ˆè¿™ä¸ªé…ç½®å°†ä¼šè¢«é‡‡ç”¨:</p>
<p>Example - Injecting an HTTP client:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Client</span>(<span class="string">&quot;twitter&quot;</span>) <span class="meta">@Inject</span> ReactorHttpClient httpClient</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…, å¦‚æœä½ ä¸ä½¿ç”¨æœåŠ¡å‘ç°, ä½ å¯ä»¥ä½¿ç”¨ <code>@Client</code> æ³¨è§£çš„ <code>configuration</code> æˆå‘˜å±æ€§æ¥å¼•ç”¨ä¸€ä¸ªç‰¹å®šç±»å‹:</p>
<p>Example - Injecting an HTTP client:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Client</span>(</span><br><span class="line">    value = <span class="string">&quot;https://api.twitter.com/1/1&quot;</span>,</span><br><span class="line">    configuration = TwitterHttpClientConfiguration.<span class="keyword">class</span></span><br><span class="line">)</span><br><span class="line"><span class="meta">@Inject</span></span><br><span class="line">ReactorHttpClient httpClient</span><br></pre></td></tr></table></figure>

<h4 id="Using-HTTP-Client-Connection-Pooling-ä½¿ç”¨-HTTP-Client-è¿æ¥æ± åŒ–"><a href="#Using-HTTP-Client-Connection-Pooling-ä½¿ç”¨-HTTP-Client-è¿æ¥æ± åŒ–" class="headerlink" title="Using HTTP Client Connection Pooling (ä½¿ç”¨ HTTP Client è¿æ¥æ± åŒ–)"></a>Using HTTP Client Connection Pooling (ä½¿ç”¨ HTTP Client è¿æ¥æ± åŒ–)</h4><p>ä¸€ä¸ªå¤„ç†å¤§é‡è¯·æ±‚çš„ client å°†ä¼šä»å¼€å¯ HTTP client è¿æ¥æ± åŒ–ä¸­è·ç›Š</p>
<p>å¦‚ä¸‹ä¾‹å­ä¸­ä¸º <code>foo</code> client å¼€å¯æ± åŒ–:</p>
<p>Example - Manually configuring HTTP services:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">        <span class="attr">services:</span></span><br><span class="line">            <span class="attr">foo:</span></span><br><span class="line">                <span class="attr">urls:</span></span><br><span class="line">                    <span class="bullet">-</span> <span class="string">http://foo1</span></span><br><span class="line">                    <span class="bullet">-</span> <span class="string">http://foo2</span></span><br><span class="line">                <span class="attr">pool:</span></span><br><span class="line">                    <span class="attr">enabled:</span> <span class="literal">true</span>           <span class="comment"># Enables the pool</span></span><br><span class="line">                    <span class="attr">max-connections:</span> <span class="number">50</span>     <span class="comment"># Sets the maximum number of connections in the pool</span></span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹ <a class="link"   target="_blank" rel="noopener" href="https://docs.micronaut.io/latest/api/io/micronaut/http/client/HttpClientConfiguration.ConnectionPoolConfiguration.html" >ConnectionPoolConfiguration<i class="fas fa-external-link-alt"></i></a> è·å–å¯ç”¨æ± åŒ–é…ç½®é€‰é¡¹ç»†èŠ‚ä¿¡æ¯</p>
<h4 id="Configuring-Event-Loop-Groups-é…ç½®-Event-Loop-ç»„"><a href="#Configuring-Event-Loop-Groups-é…ç½®-Event-Loop-ç»„" class="headerlink" title="Configuring Event Loop Groups (é…ç½® Event Loop ç»„)"></a>Configuring Event Loop Groups (é…ç½® Event Loop ç»„)</h4><p>é»˜è®¤æƒ…å†µä¸‹, Micronaut è®© worker çº¿ç¨‹å’Œæ‰€æœ‰ HTTP client çº¿ç¨‹å…±äº«ä¸€ä¸ªé€šç”¨ Netty <code>EventLoopGroup</code></p>
<p>è¿™ä¸ª <code>EventLoopGroup</code> å¯ä»¥é€šè¿‡ <code>micronaut.netty.event-loops.default</code> å±æ€§æ¥è¿›è¡Œé…ç½®:</p>
<p>Example - Configuring The Default Event Loop:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="symbol">netty:</span></span><br><span class="line">        event-<span class="attr">loops:</span></span><br><span class="line">            <span class="symbol">default:</span></span><br><span class="line">                num-<span class="attr">threads:</span> <span class="number">10</span></span><br><span class="line">                prefer-native-<span class="attr">transport:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ä½¿ç”¨ <code>micronaut.netty.event-loops</code> è®¾ç½®æ¥é…ç½®ä¸€ä¸ªæˆ–å¤šä¸ªé¢å¤– Event Loop</p>
<p>ä¸‹è¡¨ä¸­æ€»ç»“äº†å¯ç”¨çš„å±æ€§</p>
<p>Table - Configuration Properties for <a class="link"   target="_blank" rel="noopener" href="https://docs.micronaut.io/latest/api/io/micronaut/http/netty/channel/DefaultEventLoopGroupConfiguration.html" >DefaultEventLoopGroupConfiguration<i class="fas fa-external-link-alt"></i></a>:</p>
<table>
<thead>
<tr>
<th align="left">Property</th>
<th align="left">Type</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>micronaut.netty.event-loops.*.num-threads</code></td>
<td align="left"><code>int</code></td>
</tr>
<tr>
<td align="left"><code>micronaut.netty.event-loops.*.io-ratio</code></td>
<td align="left"><code>java.lang.Integer</code></td>
</tr>
<tr>
<td align="left"><code>micronaut.netty.event-loops.*.prefer-native-transport</code></td>
<td align="left"><code>boolean</code></td>
</tr>
<tr>
<td align="left"><code>micronaut.netty.event-loops.*.executor</code></td>
<td align="left"><code>java.lang.String</code></td>
</tr>
<tr>
<td align="left"><code>micronaut.netty.event-loops.*.shutdown-quiet-period</code></td>
<td align="left"><code>java.time.Duration</code></td>
</tr>
<tr>
<td align="left"><code>micronaut.netty.event-loops.*.shutdown-timeout</code></td>
<td align="left"><code>java.time.Duration</code></td>
</tr>
</tbody></table>
<p>ä¾‹å¦‚, å¦‚æœä½ ä¸ HTTP client çš„äº¤äº’æ¶‰åŠåˆ° CPU å¯†é›†å‹å·¥ä½œ, ä¸ºä¸€ä¸ªæˆ–æ‰€æœ‰ client é…ç½®ä¸€ä¸ªå•ç‹¬çš„ <code>EventLoopGroup</code> å¯èƒ½æ˜¯å€¼å¾—çš„</p>
<p>ä¸‹é¢çš„ä¾‹å­ä¸­é…ç½®äº†ä¸€ä¸ªé¢å¤–çš„ event loop group, å®ƒçš„åå­—æ˜¯ <code>other</code>, æœ‰ 10 ä¸ªçº¿ç¨‹:</p>
<p>Example - Configuring Additional Event Loops:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">netty:</span></span><br><span class="line">        <span class="attr">event-loops:</span></span><br><span class="line">            <span class="attr">other:</span></span><br><span class="line">                <span class="attr">num-threads:</span> <span class="number">10</span></span><br><span class="line">                <span class="attr">prefer-native-transport:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>ä¸€æ—¦é¢å¤–çš„ event loop group é…ç½®å¥½äº†, å°±å¯ä»¥ä¿®æ”¹ä¸€ä¸ª HTTP client çš„é…ç½®æ¥ä½¿ç”¨å®ƒ:</p>
<p>Example - Altering the Event Loop Group used by Clients:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">        <span class="attr">client:</span></span><br><span class="line">            <span class="attr">event-loop-group:</span> <span class="string">other</span></span><br></pre></td></tr></table></figure>

<h3 id="Error-Responses-é”™è¯¯å“åº”"><a href="#Error-Responses-é”™è¯¯å“åº”" class="headerlink" title="Error Responses (é”™è¯¯å“åº”)"></a>Error Responses (é”™è¯¯å“åº”)</h3><p>å¦‚æœä¸€ä¸ª HTTP å“åº”è¿”å›ä¸€ä¸ª 400 ä»£ç æˆ–æ›´é«˜çš„ä»£ç , å°†ä¼šåˆ›å»ºä¸€ä¸ª <code>HttpClientResponseException</code></p>
<p>è¿™ä¸ª Exception åŒ…å«äº†åŸå§‹çš„å“åº”</p>
<p>è¿™ä¸ª Exception å¦‚ä½•æŠ›å‡ºå–å†³äºæ–¹æ³•çš„è¿”å›å€¼</p>
<p>å¯¹äºé˜»å¡å¼ client, Exception è¢«æŠ›å‡º, è°ƒç”¨è€…è¦æ•æ‰å¹¶å¤„ç†å®ƒ</p>
<p>å¯¹äºå“åº”å¼ client, Exception ä½œä¸ºä¸€ä¸ª Error å¹¶é€šè¿‡ <code>Publisher</code> è¿›è¡Œä¼ é€’</p>
<h3 id="Bind-Errors-ç»‘å®šé”™è¯¯"><a href="#Bind-Errors-ç»‘å®šé”™è¯¯" class="headerlink" title="Bind Errors (ç»‘å®šé”™è¯¯)"></a>Bind Errors (ç»‘å®šé”™è¯¯)</h3><p>é€šå¸¸ä½ æƒ³æ¶ˆè´¹ä¸€ä¸ª endpoint å¹¶åœ¨è¯·æ±‚æˆåŠŸæ—¶ç»‘å®šåˆ°ä¸€ä¸ª POJO ä¸­, åœ¨å‡ºç°é”™è¯¯æ—¶ç»‘å®šåˆ°å¦ä¸€ä¸ª POJO ä¸­:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span>(<span class="string">&#x27;/books&#x27;</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Get</span>(<span class="string">&#x27;/&#123;isbn&#125;&#x27;</span>)</span><br><span class="line">    HttpResponse find(String isbn) &#123;</span><br><span class="line">        <span class="keyword">if</span> (isbn == <span class="string">&quot;1680502395&quot;</span>) &#123;</span><br><span class="line">            Map&lt;String, Object&gt; m = [</span><br><span class="line">                <span class="attr">status  :</span> <span class="number">401</span>,</span><br><span class="line">                <span class="attr">error   :</span> <span class="string">&quot;Unauthorized&quot;</span>,</span><br><span class="line">                <span class="attr">message :</span> <span class="string">&quot;No message available&quot;</span>,</span><br><span class="line">                <span class="attr">path    :</span> <span class="string">&quot;/books/$isbn&quot;</span></span><br><span class="line">            ]</span><br><span class="line">            <span class="keyword">return</span> HttpResponse.status(HttpStatus.UNAUTHORIZED)</span><br><span class="line">                               .body(m)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> HttpResponse.ok(<span class="keyword">new</span> Book(<span class="string">&quot;1491950358&quot;</span>, <span class="string">&quot;Building Microservices&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="string">&quot;after an HttpClientException the response body can be bound to a POJO&quot;</span>() &#123;</span><br><span class="line">    <span class="symbol">when:</span></span><br><span class="line">    client.toBlocking()</span><br><span class="line">          .exchange(</span><br><span class="line">              HttpRequest.GET(<span class="string">&quot;/books/1680502395&quot;</span>),</span><br><span class="line">              Argument.of(Book),        <span class="comment">// Success Type</span></span><br><span class="line">              Argument.of(CustomError)  <span class="comment">// Error Type</span></span><br><span class="line">          )</span><br><span class="line"></span><br><span class="line">    <span class="symbol">then:</span></span><br><span class="line">    <span class="keyword">def</span> e = thrown(HttpClientResponseException)</span><br><span class="line">    e.response.status == HttpStatus.UNAUTHORIZED</span><br><span class="line"></span><br><span class="line">    <span class="symbol">when:</span></span><br><span class="line">    Optional&lt;CustomError&gt; jsonError = e.response.getBody(CustomError)</span><br><span class="line"></span><br><span class="line">    <span class="symbol">then:</span></span><br><span class="line">    jsonError.get().status == <span class="number">401</span></span><br><span class="line">    jsonError.get().error == <span class="string">&#x27;Unauthorized&#x27;</span></span><br><span class="line">    jsonError.get().message == <span class="string">&#x27;No message available&#x27;</span></span><br><span class="line">    jsonError.get().path == <span class="string">&#x27;/books/1680502395&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Proxying-Requests-with-ProxyHttpClient-ä½¿ç”¨-ProxyingHttpClient-æ¥ä»£ç†è¯·æ±‚"><a href="#Proxying-Requests-with-ProxyHttpClient-ä½¿ç”¨-ProxyingHttpClient-æ¥ä»£ç†è¯·æ±‚" class="headerlink" title="Proxying Requests with ProxyHttpClient (ä½¿ç”¨ ProxyingHttpClient æ¥ä»£ç†è¯·æ±‚)"></a>Proxying Requests with ProxyHttpClient (ä½¿ç”¨ ProxyingHttpClient æ¥ä»£ç†è¯·æ±‚)</h2><blockquote>
<p>A common requirement in Microservice environments is to proxy requests in a Gateway Microservice to other backend Microservices.</p>
</blockquote>
<p>å¾®æœåŠ¡ç¯å¢ƒä¸­ä¸€ä¸ªå¸¸è§è¦æ±‚æ˜¯å°†ç½‘å…³å¾®æœåŠ¡ä¸­çš„è¯·æ±‚ä»£ç†å…¶ä»–åç«¯å¾®æœåŠ¡ä¸­</p>
<p>æ™®é€šçš„ <code>HttpClient</code> API è¢«è®¾è®¡ä¸ºå›´ç»•ç®€åŒ–æ¶ˆæ¯äº¤æ¢, ä¸æ˜¯è¢«è®¾è®¡ä¸ºä»£ç†è¯·æ±‚çš„</p>
<blockquote>
<p>For this case, use the ProxyHttpClient, which can be used from a HTTP Server Filter to proxy requests to backend Microservices.</p>
</blockquote>
<p>å¯¹äºä»£ç†çš„æƒ…å†µ, ä½¿ç”¨ <code>ProxyHttpClient</code>, å®ƒè¢«ç”¨æ¥ä» HTTP Server è¿‡æ»¤å™¨ä¸­ä»£ç†è¯·æ±‚åˆ°åç«¯å¾®æœåŠ¡</p>
<p>Example - Proxy filter that rewrites original requests - é‡å†™ <code>/proxy</code> URI ä¸º <code>/real</code> URI:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.core.async.publisher.Publishers</span><br><span class="line"><span class="keyword">import</span> io.micronaut.core.util.StringUtils</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.HttpRequest</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.MutableHttpResponse</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Filter</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.client.ProxyHttpClient</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.filter.HttpServerFilter</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.filter.ServerFilterChain</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.uri.UriBuilder</span><br><span class="line"><span class="keyword">import</span> io.micronaut.runtime.server.EmbeddedServer</span><br><span class="line"><span class="keyword">import</span> org.reactivestreams.Publisher</span><br><span class="line"></span><br><span class="line"><span class="meta">@Filter</span>(<span class="string">&#x27;/proxy/**&#x27;</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProxyFilter</span> <span class="keyword">implements</span> <span class="title class_">HttpServerFilter</span> &#123;     <span class="comment">// The filter extends HttpServerFilter</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ProxyHttpClient client</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> EmbeddedServer embeddedServer</span><br><span class="line"></span><br><span class="line">    ProxyFilter(ProxyHttpClient client,             <span class="comment">// The ProxyHttpClient is injected into the constructor</span></span><br><span class="line">                EmbeddedServer embeddedServer) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.client = client</span><br><span class="line">        <span class="variable language_">this</span>.embeddedServer = embeddedServer</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    Publisher&lt;MutableHttpResponse&lt;?&gt;&gt; doFilter(HttpRequest&lt;?&gt; request,</span><br><span class="line">                                               ServerFilterChain chain) &#123;</span><br><span class="line">        Publisher.map(</span><br><span class="line">            client.proxy(                           <span class="comment">// The proxy method proxies the request</span></span><br><span class="line">                request.mutate()                    <span class="comment">// The request is mutated to modify the URI and include an additional header</span></span><br><span class="line">                       .uri &#123; UriBuilder b -&gt;       <span class="comment">// The UriBuilder API rewrites the URI</span></span><br><span class="line">                            b.with &#123;</span><br><span class="line">                                scheme(<span class="string">&quot;http&quot;</span>)</span><br><span class="line">                                host(embeddedServer.host)</span><br><span class="line">                                port(embeddedServer.port)</span><br><span class="line">                                replacePath(StringUtils.prependUri(</span><br><span class="line">                                    <span class="string">&quot;/real&quot;</span>,</span><br><span class="line">                                    request.path.substring(<span class="string">&quot;/proxy&quot;</span>.length())</span><br><span class="line">                                ))</span><br><span class="line">                            &#125;</span><br><span class="line">                       &#125;</span><br><span class="line">                       .header(<span class="string">&quot;X-My-Request-Header&quot;</span>, <span class="string">&quot;XXX&quot;</span>)    <span class="comment">// Additional request and response headers are included</span></span><br><span class="line">            ),</span><br><span class="line">            &#123; it.header(<span class="string">&quot;X-My-Response-Header&quot;</span>, <span class="string">&quot;YYY&quot;</span>) &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>ProxyHttpClient</code> API æ˜¯ä¸€ä¸ªä½çº§åˆ« API, å¯ä»¥ä½¿ç”¨æ¥æ„å»ºä¸€ä¸ªé«˜çº§åˆ«çš„æŠ½è±¡, ä¾‹å¦‚ä¸€ä¸ª API ç½‘å…³</p>
<h2 id="Declarative-HTTP-Clients-with-Client-ä½¿ç”¨-Client-çš„å£°æ˜å¼-HTTP-å®¢æˆ·ç«¯"><a href="#Declarative-HTTP-Clients-with-Client-ä½¿ç”¨-Client-çš„å£°æ˜å¼-HTTP-å®¢æˆ·ç«¯" class="headerlink" title="Declarative HTTP Clients with @Client (ä½¿ç”¨ @Client çš„å£°æ˜å¼ HTTP å®¢æˆ·ç«¯)"></a>Declarative HTTP Clients with <code>@Client</code> (ä½¿ç”¨ <code>@Client</code> çš„å£°æ˜å¼ HTTP å®¢æˆ·ç«¯)</h2><p>æœ¬è´¨ä¸Šè¯´, <code>@Client</code> æ³¨è§£å¯ä»¥è¢«å£°æ˜åœ¨ä»»ä½•æ¥å£æˆ–æŠ½è±¡ç±»ä¸Š, é€šè¿‡ä½¿ç”¨ AOP, åœ¨ç¼–è¯‘æ—¶å®ç°å…¶ä¸­çš„æŠ½è±¡æ–¹æ³•, æå¤§åœ°ç®€åŒ–äº† HTTP Client çš„åˆ›å»º</p>
<p>é¦–å…ˆå£°æ˜ä¸€ä¸ª POJO:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Pet</span> &#123;</span><br><span class="line">    String name</span><br><span class="line">    <span class="type">int</span> age</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åå£°æ˜ä¸€ä¸ªæ¥å£æ¥ä¿å­˜ <code>Pet</code> å®ä¾‹:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Post</span><br><span class="line"><span class="keyword">import</span> io.micronaut.validation.Validated</span><br><span class="line"><span class="keyword">import</span> org.reactivestreams.Publisher</span><br><span class="line"><span class="keyword">import</span> io.micronaut.core.async.annotation.SingleResult</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Min</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotBlank</span><br><span class="line"></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">PetOperations</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Post</span></span><br><span class="line">    <span class="meta">@SingleResult</span></span><br><span class="line">    Publisher&lt;Pet&gt; save(<span class="meta">@NotBlank</span> String name,</span><br><span class="line">                        <span class="meta">@Min</span>(<span class="number">1</span>L) <span class="type">int</span> age)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„è¿™ä¸ªæ¥å£å¦‚ä½•ä½¿ç”¨ Micronaut çš„ HTTP æ³¨è§£, è¿™äº›æ³¨è§£å¯ä»¥åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¸­ä½¿ç”¨</p>
<p>ä½ è¿˜å¯ä»¥ä½¿ç”¨ <code>javax.validation</code> çº¦æŸæ¥æ ¡éªŒå‚æ•°</p>
<p>æ³¨æ„æœ‰äº›æ³¨è§£, ä¾‹å¦‚ <code>@Produces</code> å’Œ <code>@Consumes</code>, åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯æœ‰ä¸åŒçš„è¯­ä¹‰<br>ä¾‹å¦‚, <code>@Produces</code> åœ¨æœåŠ¡ç«¯ä½œç”¨äºä¸€ä¸ª Controller æ–¹æ³•ä¸Šæ—¶æŒ‡æ˜è¿™ä¸ªæ–¹æ³•çš„è¿”å›å€¼æ˜¯å¦‚ä½•æ ¼å¼åŒ–çš„<br>å½“ <code>@Produces</code> åœ¨å®¢æˆ·ç«¯æ—¶æŒ‡æ˜æ–¹æ³•å‚æ•°æ˜¯å¦‚ä½•æ ¼å¼åŒ–ååœ¨å‘é€ç»™æœåŠ¡ç«¯</p>
<p>é™¤æ­¤ä¹‹å¤–, è¦ä½¿ç”¨ <code>javax.validation</code> åŠŸèƒ½, æ·»åŠ  <code>validation</code> æ¨¡å—åˆ°ä½ çš„æ„å»ºä¸­:</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation(<span class="string">&quot;io.micronaut:micronaut-validation&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>åœ¨æœåŠ¡ç«¯çš„ Micronaut ä¸­ä½ å¯ä»¥ä½¿ç”¨ <code>PetOperations</code> æ¥å£:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Controller</span><br><span class="line"><span class="keyword">import</span> org.reactivestreams.Publisher</span><br><span class="line"><span class="keyword">import</span> io.micronaut.core.async.annotation.SingleResult</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">&#x27;/pets&#x27;</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PetController</span> <span class="keyword">implements</span> <span class="title class_">PetOperations</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@SingleResult</span></span><br><span class="line">    Publisher&lt;Pet&gt; save(String name, <span class="type">int</span> age) &#123;</span><br><span class="line">        Pet pet = <span class="keyword">new</span> Pet(<span class="attr">name:</span> name, <span class="attr">age:</span> age)</span><br><span class="line">        <span class="comment">// save to database or something</span></span><br><span class="line">        <span class="keyword">return</span> Mono.just(pet)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½ å¯ä»¥å®šä¹‰ä¸€ä¸ªå£°æ˜å¼ client åœ¨ <code>src/test/java</code> åŒ…ä¸­, ä½¿ç”¨ <code>@Client</code> æ³¨è§£æ¥ä¿®é¥°è¿™ä¸ª client ä»¥ä½¿å…¶åœ¨ç¼–è¯‘æ—¶è‡ªåŠ¨å®ç°:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.http.client.annotation.Client</span><br><span class="line"><span class="keyword">import</span> org.reactivestreams.Publisher</span><br><span class="line"><span class="keyword">import</span> io.micronaut.core.async.annotation.SingleResult</span><br><span class="line"></span><br><span class="line"><span class="meta">@Client</span>(<span class="string">&#x27;/pets&#x27;</span>)    <span class="comment">// The Client annotation is used with a value relative to the current server, in this case /pets</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">PetClient</span> <span class="keyword">extends</span> <span class="title class_">PetOperations</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@SingleResult</span></span><br><span class="line">    Publisher&lt;Pet&gt; save(String name, <span class="type">int</span> age)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸€æ—¦ä½ å®šä¹‰äº†ä¸€ä¸ª client, ä½ å°±å¯ä»¥åœ¨ä»»ä½•éœ€è¦çš„åœ°æ–¹ä½¿ç”¨ <code>@Inject</code> æ³¨è§£æ¥ä½¿ç”¨å®ƒ</p>
<p>ä¸‹é¢çš„è¡¨æ ¼å±•ç¤ºäº† <code>@Client</code> æ³¨è§£çš„æ–¹æ³•çš„è¿”å›å€¼ç±»å‹:</p>
<p>Table - Micronaut Response Types:</p>
<table>
<thead>
<tr>
<th align="left">Type</th>
<th align="left">Description</th>
<th align="left">Example Signature</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>Publisher</code></td>
<td align="left">Any type that implements the <code>Publisher</code> interface</td>
<td align="left"><code>Flux&lt;String&gt; hello()</code></td>
</tr>
<tr>
<td align="left"><code>HttpResponse</code></td>
<td align="left">An <code>HttpResponse</code> and optional response body type</td>
<td align="left"><code>Mono&lt;HttpResponse&lt;String&gt;&gt; hello()</code></td>
</tr>
<tr>
<td align="left"><code>Publisher</code></td>
<td align="left">A <code>Publisher</code> implementation that emits a POJO</td>
<td align="left"><code>Mono&lt;Book&gt; hello()</code></td>
</tr>
<tr>
<td align="left"><code>CompletableFuture</code></td>
<td align="left">A Java <code>CompletableFuture</code> instance</td>
<td align="left"><code>CompletableFuture&lt;String&gt; hello()</code></td>
</tr>
<tr>
<td align="left"><code>CharSequence</code></td>
<td align="left">A blocking native type. Such as <code>String</code></td>
<td align="left"><code>String hello()</code></td>
</tr>
<tr>
<td align="left"><code>T</code></td>
<td align="left">Any simple POJO type</td>
<td align="left"><code>Book show()</code></td>
</tr>
</tbody></table>
<blockquote>
<p>Note that returning any other type results in a blocking request and is not recommended other than for testing.</p>
</blockquote>
<p>è¯·æ³¨æ„, è¿”å›ä»»ä½•å…¶ä»–ç±»å‹ä¼šå¯¼è‡´é˜»å¡è¯·æ±‚, å¹¶ä¸”ä¸å»ºè®®ç”¨äºæµ‹è¯•ä»¥å¤–çš„å…¶ä»–ç±»å‹</p>
<h3 id="Customizing-Parameters-Binding-è‡ªå®šä¹‰å‚æ•°ç»‘å®š"><a href="#Customizing-Parameters-Binding-è‡ªå®šä¹‰å‚æ•°ç»‘å®š" class="headerlink" title="Customizing Parameters Binding (è‡ªå®šä¹‰å‚æ•°ç»‘å®š)"></a>Customizing Parameters Binding (è‡ªå®šä¹‰å‚æ•°ç»‘å®š)</h3><p>ä½¿ç”¨æ–¹æ³•å‚æ•°æ¥è¡¨ç¤º <code>POST</code> è¯·æ±‚çš„ body:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Post</span></span><br><span class="line"><span class="meta">@SingleResult</span></span><br><span class="line">Publisher&lt;Pet&gt; save(<span class="meta">@NotBlank</span> String name,</span><br><span class="line">                    <span class="meta">@Min</span>(<span class="number">1</span>L) <span class="type">int</span> age)</span><br></pre></td></tr></table></figure>

<p><code>save</code> æ–¹æ³•é»˜è®¤ä½¿ç”¨å¦‚ä¸‹ JSON æ‰§è¡Œä¸€ä¸ª HTTP <code>POST</code> è¯·æ±‚:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Dino&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">10</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯, ä½ å¯èƒ½å¸Œæœ›è‡ªå®šä¹‰ä½œä¸ºæ­£æ–‡, å‚æ•°, URIå˜é‡ç­‰å‘é€çš„å†…å®¹</p>
<p><code>@Client</code> æ³¨è§£åœ¨è¿™æ–¹æ³•éå¸¸çµæ´», æ”¯æŒä¸ Micronaut çš„ HTTP server ç›¸åŒçš„ <code>io.micronaut.http.annotation</code></p>
<p>Example - å®šä¹‰ä¸€ä¸ª URIæ¨¡æ¿, <code>name</code> å‚æ•°ä½œä¸º URIæ¨¡æ¿ çš„ä¸€éƒ¨åˆ† è€Œ <code>@Body</code> å£°æ˜å‘é€ç»™ server çš„å†…å®¹, æœ‰ <code>Pet</code> POJO è¡¨ç¤º:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Post</span>(<span class="string">&#x27;/&#123;name&#125;&#x27;</span>)</span><br><span class="line">Mono&lt;Pet&gt; save(</span><br><span class="line">    <span class="meta">@NotBlank</span> String name,  <span class="comment">// 1</span></span><br><span class="line">    <span class="meta">@Body</span> <span class="meta">@Valid</span> Pet pet    <span class="comment">// 2</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><code>1</code> : The name parameter, included as part of the URI, and declared <code>@NotBlank</code></p>
<p><code>2</code> : The <code>pet</code> parameter, used to encode the body and declared <code>@Valid</code></p>
<p>Table - Parameter Binding Annotations:</p>
<table>
<thead>
<tr>
<th align="left">Annotation</th>
<th align="left">Description</th>
<th align="left">Example</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>@Body</code></td>
<td align="left">Specific the parameter for the body of the request</td>
<td align="left"><code>@Body String body</code></td>
</tr>
<tr>
<td align="left"><code>@CookieValue</code></td>
<td align="left">Specific parameters to be sent as cookies</td>
<td align="left"><code>@CookieValue</code> String myCookie</td>
</tr>
<tr>
<td align="left"><code>@Header</code></td>
<td align="left">Specific parameters to be sent as HTTP headers</td>
<td align="left"><code>@Header String requestId</code></td>
</tr>
<tr>
<td align="left"><code>@QueryValue</code></td>
<td align="left">Customizes the name of the URI parameter to bind from</td>
<td align="left"><code>@QueryValue(&quot;userAge&quot;) Integer age</code></td>
</tr>
<tr>
<td align="left"><code>@PathVariable</code></td>
<td align="left">Binds a parameter exclusively from a <code>Path Variable</code></td>
<td align="left"><code>@PathVariable Long id</code></td>
</tr>
<tr>
<td align="left"><code>@RequestAttribute</code></td>
<td align="left">Specific parameters to be set as request attributes</td>
<td align="left"><code>@RequestAttribute Integer locationId</code></td>
</tr>
</tbody></table>
<p>å§‹ç»ˆä½¿ç”¨ <code>@Produces</code> æˆ– <code>@Consumes</code>, è€Œä¸æ˜¯æä¾›ä¸€ä¸ª <code>Content-Type</code> æˆ– <code>Accept</code> çš„ header</p>
<h4 id="Query-values-formatting-è¯·æ±‚å€¼æ ¼å¼åŒ–"><a href="#Query-values-formatting-è¯·æ±‚å€¼æ ¼å¼åŒ–" class="headerlink" title="Query values formatting (è¯·æ±‚å€¼æ ¼å¼åŒ–)"></a>Query values formatting (è¯·æ±‚å€¼æ ¼å¼åŒ–)</h4><p><code>@Format</code> æ³¨è§£å¯ä»¥å’Œ <code>@QueryValue</code> æ³¨è§£ä¸€èµ·ä½¿ç”¨æ¥æ ¼å¼åŒ– query values</p>
<p>æ”¯æŒçš„ values æ˜¯: <code>csv</code>, <code>ssv</code>, <code>pipes</code>, <code>multi</code>, <code>deep-object</code>. å’Œ <a class="link"   target="_blank" rel="noopener" href="https://swagger.io/docs/specification/serialization/" >Open API v3<i class="fas fa-external-link-alt"></i></a> è¯·æ±‚å‚æ•°çš„ <code>style</code> å±æ€§ç›¸ä¼¼</p>
<p>æ ¼å¼åŒ–åªèƒ½åº”ç”¨äº <code>java.lang.Iterable</code>, <code>java.util.Map</code>, ä½¿ç”¨äº† <code>@Introspected</code> æ³¨è§£çš„ POJO</p>
<p>Table - ä¸åŒå€¼ä¼šæ€æ ·è¢«æ ¼å¼åŒ–:</p>
<table>
<thead>
<tr>
<th align="left">Format</th>
<th align="left">Iterable example</th>
<th align="left">Map or POJO example</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Original value</td>
<td align="left">[â€œMikeâ€, â€œAdamâ€, â€œKateâ€]</td>
<td align="left">{â€œnameâ€: â€œMikeâ€, â€œageâ€: 30}</td>
</tr>
<tr>
<td align="left">â€œCSVâ€</td>
<td align="left">â€œparam&#x3D;Mike,Adam,Kateâ€</td>
<td align="left">â€œparam&#x3D;name,Mike,age,30â€</td>
</tr>
<tr>
<td align="left">â€œSSVâ€</td>
<td align="left">â€œparam&#x3D;Mike Adam Kateâ€</td>
<td align="left">â€œparam&#x3D;name Mike age 30â€</td>
</tr>
<tr>
<td align="left">â€œPIPESâ€</td>
<td align="left">â€œparam&#x3D;Mike</td>
<td align="left">Adam</td>
</tr>
<tr>
<td align="left">â€œMULTIâ€</td>
<td align="left">â€œparam&#x3D;Mike&amp;param&#x3D;Adam&amp;param&#x3D;Kateâ€</td>
<td align="left">â€œname&#x3D;Mike&amp;age&#x3D;30â€</td>
</tr>
<tr>
<td align="left">â€œDEEP_OBJECT</td>
<td align="left">â€œparam[0]&#x3D;Mike&amp;param[1]&#x3D;Adam&amp;param[2]&#x3D;Kateâ€</td>
<td align="left">â€œparam[name]&#x3D;Mike&amp;param[age]&#x3D;30â€</td>
</tr>
</tbody></table>
<h5 id="Type-Based-Binding-Parameters-åŸºäºç±»å‹çš„å‚æ•°ç»‘å®š"><a href="#Type-Based-Binding-Parameters-åŸºäºç±»å‹çš„å‚æ•°ç»‘å®š" class="headerlink" title="Type-Based Binding Parameters (åŸºäºç±»å‹çš„å‚æ•°ç»‘å®š)"></a>Type-Based Binding Parameters (åŸºäºç±»å‹çš„å‚æ•°ç»‘å®š)</h5><p>æœ‰ä¸€äº›å‚æ•°é€šè¿‡å®ƒä»¬çš„ç±»å‹è€Œä¸æ˜¯å®ƒä»¬çš„æ³¨è§£æ¥è¯†åˆ«</p>
<p>Table - Parameter types and their purpose:</p>
<table>
<thead>
<tr>
<th align="left">Type</th>
<th align="left">Description</th>
<th align="left">Example</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>BasicAuth</code></td>
<td align="left">Sets the <code>Authorization</code> header</td>
<td align="left"><code>BasicAuth basicAuth</code></td>
</tr>
<tr>
<td align="left"><code>HttpHeaders</code></td>
<td align="left">Adds multiple headers to the request</td>
<td align="left"><code>HttpHeaders headers</code></td>
</tr>
<tr>
<td align="left"><code>Cookies</code></td>
<td align="left">Adds multiple cookies to the request</td>
<td align="left"><code>Cookies cookie</code></td>
</tr>
<tr>
<td align="left"><code>Cookie</code></td>
<td align="left">Adds a cookie to the request</td>
<td align="left"><code>Cookie cookie</code></td>
</tr>
<tr>
<td align="left"><code>Locale</code></td>
<td align="left">Sets the <code>Accept-Language</code> header. Annotate with <code>@QueryValue</code> or <code>@PathVariable</code> to populate a URI variable</td>
<td align="left"><code>Locale locale</code></td>
</tr>
</tbody></table>
<h5 id="Custom-Binding-è‡ªå®šä¹‰ç»‘å®š"><a href="#Custom-Binding-è‡ªå®šä¹‰ç»‘å®š" class="headerlink" title="Custom Binding (è‡ªå®šä¹‰ç»‘å®š)"></a>Custom Binding (è‡ªå®šä¹‰ç»‘å®š)</h5><p><code>ClientArgumentRequestBinder</code> API ç»‘å®š client å‚æ•°åˆ°è¯·æ±‚ä¸­</p>
<p>åœ¨ç»‘å®šå¤„ç†æ—¶è‡ªåŠ¨ä½¿ç”¨ä½œä¸ºä¸€ä¸ª Bean è¿›è¡Œæ³¨å†Œçš„è‡ªå®šä¹‰ç»‘å®šç±»</p>
<p>å°†ä¼šä¼˜å…ˆæœç´¢åŸºäºæ³¨è§£ç»‘å®šå™¨, å…¶æ¬¡æœç´¢åŸºäºç±»å‹çš„ç»‘å®šå™¨</p>
<h6 id="Binding-By-Annotation-é€šè¿‡æ³¨è§£è¿›è¡Œç»‘å®š"><a href="#Binding-By-Annotation-é€šè¿‡æ³¨è§£è¿›è¡Œç»‘å®š" class="headerlink" title="Binding By Annotation (é€šè¿‡æ³¨è§£è¿›è¡Œç»‘å®š)"></a>Binding By Annotation (é€šè¿‡æ³¨è§£è¿›è¡Œç»‘å®š)</h6><p>è¦æ ¹æ®å‚æ•°ä¸Šçš„æ³¨è§£æ§åˆ¶å‚æ•°å¦‚ä½•ç»‘å®šåˆ°è¯·æ±‚ä¸Š, è¯·åˆ›å»º <code>AnnotatedClientArgumentRequestBinder</code> ç±»å‹çš„ Bean</p>
<p>æ‰€æœ‰çš„æ³¨è§£éƒ½å¿…é¡»ä½¿ç”¨ <code>@Bindable</code> æ³¨è§£è¿›è¡Œä¿®é¥°</p>
<p>Example - Client with <code>@Metadata</code> Argument:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Client</span>(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">MetadataClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Get</span>(<span class="string">&#x27;/client/bind&#x27;</span>)</span><br><span class="line">    String get(<span class="meta">@Metadata</span> Map metadata)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Example - <code>@Metadata</code> Annotation:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.core.bind.annotation.Bindable</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Documented</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.annotation.ElementType.PARAMETER</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.annotation.RetentionPolicy.RUNTIME</span><br><span class="line"></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Retention</span>(RUNTIME)</span><br><span class="line"><span class="meta">@Target</span>(PARAMETER)</span><br><span class="line"><span class="meta">@Bindable</span></span><br><span class="line"><span class="meta">@interface</span> Metadata &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ²¡æœ‰ä»»ä½•é¢å¤–çš„ä»£ç , client å°†ä¼šå°è¯•å°†è½¬æ¢ <code>metadata</code> ä¸ºå­—ç¬¦ä¸²å¹¶å°†å…¶ä½œä¸ºä¸€ä¸ª query parameter è¿›è¡Œé™„åŠ </p>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­, è¿™å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœ, æ‰€ä»¥è¦è‡ªå®šä¹‰ä¸€ä¸ª binder</p>
<p>ä¸‹é¢çš„ binder å¤„ç†ä¼ é€’ç»™ clients çš„ä½¿ç”¨äº† <code>@Metadata</code> æ³¨è§£ä¿®é¥°å‚æ•°, ç„¶åä¿®æ”¹è¯·æ±‚æ¥åŒ…å«ä¸€ä¸ªæƒ³è¦çš„ header.</p>
<p>binder å®ç°å¯ä»¥ä¿®æ”¹ä¸ºæ¥æ”¶é™¤ Map ä¹‹å¤–çš„æ›´å¤šç±»å‹çš„æ•°æ®</p>
<p>Example - Annotation Argument Binder:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.core.annotation.NonNull</span><br><span class="line"><span class="keyword">import</span> io.micronaut.core.convert.ArgumentConversionContext</span><br><span class="line"><span class="keyword">import</span> io.micronaut.core.naming.NameUtils</span><br><span class="line"><span class="keyword">import</span> io.micronaut.core.util.StringUtils</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.MutableHttpRequest</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.client.bind.AnnotatedClientArgumentRequestBinder</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.client.bind.ClientRequestUriContext</span><br><span class="line"><span class="keyword">import</span> org.jetbrains.annotation.NotNull</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jakarta.inject.Singleton</span><br><span class="line"></span><br><span class="line"><span class="meta">@Singleton</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MetadataClientArgumentBinder</span> <span class="keyword">implements</span> <span class="title class_">AnnotatedClientArgumentRequestBinder</span>&lt;Metadata&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> Class&lt;Metadata&gt; annotationType = Metadata</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="type">void</span> bind(<span class="meta">@NotNull</span> ArgumentConversionContext&lt;Object&gt; context,</span><br><span class="line">              <span class="meta">@NotNull</span> ClientRequestUriContext uriContext,</span><br><span class="line">              <span class="meta">@NotNull</span> Object value,</span><br><span class="line">              <span class="meta">@NotNull</span> MutableHttpRequest&lt;?&gt; request) &#123;</span><br><span class="line">        if (value instanceof Map) &#123;</span><br><span class="line">            for (entry in value.entrySet()) &#123;</span><br><span class="line">                String key = NameUtils.hyphenate(StringUtils.capitalize(entry.key as String), false)</span><br><span class="line">                request.header(<span class="string">&quot;X-Metadata-$key&quot;</span>, entry.value as String)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="Binding-By-Type-é€šè¿‡ç±»å‹è¿›è¡Œç»‘å®š"><a href="#Binding-By-Type-é€šè¿‡ç±»å‹è¿›è¡Œç»‘å®š" class="headerlink" title="Binding By Type (é€šè¿‡ç±»å‹è¿›è¡Œç»‘å®š)"></a>Binding By Type (é€šè¿‡ç±»å‹è¿›è¡Œç»‘å®š)</h6><p>ä¸ºäº†æ ¹æ®å‚æ•°çš„ç±»å‹ç»‘å®šåˆ°è¯·æ±‚, åˆ›å»ºä¸€ä¸ªç±»å‹ä¸º <code>TypedClientArgumentRequestBinder</code> çš„ Bean</p>
<p>Example - Client With Metadata Argument:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Client</span>(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">MetadataClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Get</span>(<span class="string">&#x27;/client/bind&#x27;</span>)</span><br><span class="line">    String get(Metadata metadata)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ²¡æœ‰ä»»ä½•é¢å¤–çš„ä»£ç , client å°†ä¼šå°è¯•å°†è½¬æ¢ <code>metadata</code> ä¸ºå­—ç¬¦ä¸²å¹¶å°†å…¶ä½œä¸ºä¸€ä¸ª query parameter è¿›è¡Œé™„åŠ </p>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­, è¿™å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœ, æ‰€ä»¥è¦è‡ªå®šä¹‰ä¸€ä¸ª binder</p>
<p>ä¸‹é¢ä¾‹å­ä¸­çš„ binder å¤„ç†ç±»å‹ä¸º <code>Metadata</code> çš„ä¼ é€’ç»™ client çš„å‚æ•°, å¹¶ä¿®æ”¹è¯·æ±‚ä¸ºåŒ…å«æƒ³è¦çš„ header:</p>
<p>Example - Typed Argument Binder:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.core.annotation.NonNull</span><br><span class="line"><span class="keyword">import</span> io.micronaut.core.convert.ArgumentConversionContext</span><br><span class="line"><span class="keyword">import</span> io.micronaut.core.type.Argument</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.MutableHttpRequest</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.client.bind.ClientRequestUriContext</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.client.bind.TypedClientArgumentRequestBinder</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jakarta.inject.Singleton</span><br><span class="line"></span><br><span class="line"><span class="meta">@Singleton</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MetadataClientArgumentBinder</span> <span class="keyword">implements</span> <span class="title class_">TypedClientArgumentRequestBinder</span>&lt;Metadata&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    Argument&lt;Metadata&gt; argumentType() &#123; Argument.of(Metadata) &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="type">void</span> bind(<span class="meta">@NonNull</span> ArgumentConversionContext&lt;Metadata&gt; context,</span><br><span class="line">              <span class="meta">@NonNull</span> ClientRequestUriContext uriContext,</span><br><span class="line">              <span class="meta">@NonNull</span> Metadata value,</span><br><span class="line">              <span class="meta">@NonNull</span> MutableHttpRequest&lt;?&gt; request) &#123;</span><br><span class="line">        request.header(<span class="string">&quot;X-Metadata-Version&quot;</span>, value.version.toString())</span><br><span class="line">        request.header(<span class="string">&quot;X-Metadata-Deployment-Id&quot;</span>, value.deploymentId.toString())</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Binding-On-Method-åœ¨æ–¹æ³•ä¸Šè¿›è¡Œç»‘å®š"><a href="#Binding-On-Method-åœ¨æ–¹æ³•ä¸Šè¿›è¡Œç»‘å®š" class="headerlink" title="Binding On Method (åœ¨æ–¹æ³•ä¸Šè¿›è¡Œç»‘å®š)"></a>Binding On Method (åœ¨æ–¹æ³•ä¸Šè¿›è¡Œç»‘å®š)</h5><p>ä¹Ÿå¯ä»¥åˆ›å»ºä¸€ä¸ª binder, é€šè¿‡æ–¹æ³•ä¸Šçš„è¯·æ±‚æ³¨è§£æ¥æ›´æ”¹è¯·æ±‚</p>
<p>Example - Client With Annotated Method:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Client</span>(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">NameAuthorizedClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Get</span>(<span class="string">&#x27;/client/authorized-resource&#x27;</span>)</span><br><span class="line">    <span class="meta">@NameAuthorization</span>(name = <span class="string">&#x27;Bo&#x27;</span>)</span><br><span class="line">    String get()</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Example - <code>@NameAuthorization</code> Annotation Definition:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Retention</span>(RUNTIME)</span><br><span class="line"><span class="meta">@Target</span>(METHOD)</span><br><span class="line"><span class="meta">@Bindable</span></span><br><span class="line"><span class="meta">@interface</span> NameAuthorization &#123;</span><br><span class="line">    <span class="meta">@AliasFor</span>(member = <span class="string">&quot;name&quot;</span>)</span><br><span class="line">    String value() <span class="keyword">default</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@AliasFor</span>(member = <span class="string">&quot;value&quot;</span>)</span><br><span class="line">    String name() <span class="keyword">default</span> <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Example - Specific the behaviour:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Singleton</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NameAuthorizationBinder</span> <span class="keyword">implements</span> <span class="title class_">AnnotatedClientRequestBinder</span>&lt;NameAuthorization&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    Class&lt;NameAuthorization&gt; getAnnotationType() &#123; NameAuthorization.<span class="keyword">class</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="type">void</span> bind(</span><br><span class="line">        <span class="meta">@NonNull</span> MethodInvocationContext&lt;Object, Object&gt; context,</span><br><span class="line">        <span class="meta">@NonNull</span> ClientResponseUriContext uriContext,</span><br><span class="line">        <span class="meta">@NonNull</span> MutableHttpRequest&lt;?&gt; request</span><br><span class="line">    ) &#123;</span><br><span class="line">        context.getValue(NameAuthorization.class)</span><br><span class="line">               .ifPresent(name -&gt; uriContext.addQueryParameter(<span class="string">&quot;name&quot;</span>, String.valueOf(name)))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Streaming-with-Client-ä½¿ç”¨-Client-è¿›è¡Œæµå¼å¤„ç†"><a href="#Streaming-with-Client-ä½¿ç”¨-Client-è¿›è¡Œæµå¼å¤„ç†" class="headerlink" title="Streaming with @Client (ä½¿ç”¨ @Client è¿›è¡Œæµå¼å¤„ç†)"></a>Streaming with <code>@Client</code> (ä½¿ç”¨ <code>@Client</code> è¿›è¡Œæµå¼å¤„ç†)</h3><p><code>@Client</code> æ³¨è§£è¿˜å¯ä»¥å¤„ç†æµå¼ HTTP å“åº”</p>
<h4 id="Streaming-JSON-with-Client-ä½¿ç”¨-Client-è¿›è¡Œ-JSON-æµå¼å¤„ç†"><a href="#Streaming-JSON-with-Client-ä½¿ç”¨-Client-è¿›è¡Œ-JSON-æµå¼å¤„ç†" class="headerlink" title="Streaming JSON with @Client (ä½¿ç”¨ @Client è¿›è¡Œ JSON æµå¼å¤„ç†)"></a>Streaming JSON with <code>@Client</code> (ä½¿ç”¨ <code>@Client</code> è¿›è¡Œ JSON æµå¼å¤„ç†)</h4><p>å¯ä»¥å®šä¹‰ä¸€ä¸ª client æ¥è¿”å›ä¸€ä¸ªæ— ç•Œçš„ <code>Publisher</code>, ä¾‹å¦‚ Reactor çš„ <code>Flux</code> æˆ– RxJava çš„ <code>Flowable</code></p>
<p>Example:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Get</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.client.annotation.Client</span><br><span class="line"><span class="keyword">import</span> org.reactivestreams.Publisher</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> io.micronaut.http.MediaType.APPLICATION_JSON_STREAM</span><br><span class="line"></span><br><span class="line"><span class="meta">@Client</span>(<span class="string">&#x27;/streaming&#x27;</span>)</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">HeadlineClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Get</span>(value = <span class="string">&#x27;/headlines&#x27;</span>, processes = APPLICATION_JSON_STREAM)     <span class="comment">// 1</span></span><br><span class="line">    Publisher&lt;Headline&gt; streamHeadlines()                               <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>1</code> : The <code>@Get</code> method processes responses of type <code>APPLICATION_JSON_STREAM</code></p>
<p><code>2</code> : The return type is <code>Publisher</code></p>
<p>Example - Test - Streaming HeadlineClient:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="string">&quot;test client annotation streaming&quot;</span>() <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="symbol">when:</span></span><br><span class="line">    <span class="keyword">def</span> headlineClient = embeddedServer.applicationContext</span><br><span class="line">                                       .getBean(HeadlineClient)</span><br><span class="line"></span><br><span class="line">    Mono&lt;Headline&gt; firstHeadline = Mono.from(headlineClient.streamHeadlines())</span><br><span class="line"></span><br><span class="line">    Headline headline = firstHeadline.block()</span><br><span class="line"></span><br><span class="line">    <span class="symbol">then:</span></span><br><span class="line">    headline</span><br><span class="line">    headline.text.startsWith(<span class="string">&quot;Latest Headline&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Streaming-Clients-and-Response-Types-æµå¼å®¢æˆ·ç«¯å’Œå“åº”ç±»å‹"><a href="#Streaming-Clients-and-Response-Types-æµå¼å®¢æˆ·ç«¯å’Œå“åº”ç±»å‹" class="headerlink" title="Streaming Clients and Response Types (æµå¼å®¢æˆ·ç«¯å’Œå“åº”ç±»å‹)"></a>Streaming Clients and Response Types (æµå¼å®¢æˆ·ç«¯å’Œå“åº”ç±»å‹)</h4><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­, æ˜¯æœŸæœ› server è¿”å›ä¸€ä¸ª JSON å¯¹è±¡æµçš„, å¹¶ä¸” Content-Type ä¸º <code>applicatoin/x-json-stream</code>, ä¾‹å¦‚:</p>
<p>Example - A JSON Stream:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;The Stand&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;The Shining&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>ä¸€ç³»åˆ— JSON å¯¹è±¡å®é™…ä¸Šä¸æ˜¯æœ‰æ•ˆçš„ JSON, å› æ­¤å“åº”çš„ Content-Type ä¸èƒ½æ˜¯ <code>application/json</code></p>
<p>æœ‰æ•ˆçš„ JSON è¿”å›åº”è¯¥æ˜¯è¿”å›ä¸€ä¸ªæ•°ç»„:</p>
<p>Example - A JSON Array:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;The Stand&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;The Shining&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<p>ç„¶è€Œ, Micronuat çš„å®¢æˆ·ç«¯ç¡®å®æ”¯æŒé€šè¿‡ <code>application/x-json-stream</code> ä¼ è¾“å•ä¸ª JSON å¯¹è±¡ä»¥åŠä½¿ç”¨ <code>application/json</code> å®šä¹‰çš„ JSON æ•°ç»„</p>
<p>å¦‚æœ server è¿”å› <code>application/json</code> ä¸”è¿”å›ä¸€ä¸ª non-single <code>Publisher</code>, client åœ¨æ•°ç»„å…ƒç´ å¯ç”¨æ—¶å¯¹å…¶è¿›è¡Œæµå¼ä¼ è¾“</p>
<h4 id="Streaming-Clients-and-Read-Timeout-æµå¼å®¢æˆ·ç«¯å’Œè¯»å–è¶…æ—¶"><a href="#Streaming-Clients-and-Read-Timeout-æµå¼å®¢æˆ·ç«¯å’Œè¯»å–è¶…æ—¶" class="headerlink" title="Streaming Clients and Read Timeout (æµå¼å®¢æˆ·ç«¯å’Œè¯»å–è¶…æ—¶)"></a>Streaming Clients and Read Timeout (æµå¼å®¢æˆ·ç«¯å’Œè¯»å–è¶…æ—¶)</h4><p>å½“æµå¼ä¼ è¾“æ¥è‡ªæœåŠ¡å™¨çš„å“åº”æ—¶, åº•å±‚çš„ HTTP client ä¸ä¼šåº”ç”¨é»˜è®¤çš„ <code>HttpClientConfiguration</code> ä¸­çš„ <code>readTimeout</code> è®¾ç½®, å› ä¸ºæµå¼å“åº”çš„è¯»å–ä¹‹é—´çš„å»¶è¿Ÿå¯èƒ½ä¸æ­£å¸¸çš„è¯»å–ä¸åŒ</p>
<p>ä½œä¸ºä»£æ›¿, <code>read-idle-timeout</code> è®¾ç½®(é»˜è®¤ä¸º 5 åˆ†é’Ÿ) æŒ‡æ˜äº†åœ¨ä¸€ä¸ªè¿æ¥ç©ºé—²ä¹‹åä»€ä¹ˆæ—¶å€™è¿›è¡Œå…³é—­</p>
<p>å¦‚æœä½ ä» server æµå¼ä¼ è¾“æ•°æ®, æ¯ä¸ªæ•°æ®ä¹‹é—´å®šä¹‰äº†è¶…è¿‡ 5 åˆ†é’Ÿçš„å»¶è¿Ÿ, é‚£ä¹ˆä½ å¯ä»¥è°ƒæ•´ <code>readIdleTimeout</code></p>
<p>Example - Adjusting the readIdleTimeout:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">        <span class="attr">client:</span></span><br><span class="line">            <span class="attr">read-idle-timeout:</span> <span class="string">10m</span></span><br></pre></td></tr></table></figure>

<h4 id="Streaming-Server-Sent-Events-æµå¼æœåŠ¡å‘é€äº‹ä»¶"><a href="#Streaming-Server-Sent-Events-æµå¼æœåŠ¡å‘é€äº‹ä»¶" class="headerlink" title="Streaming Server Sent Events (æµå¼æœåŠ¡å‘é€äº‹ä»¶)"></a>Streaming Server Sent Events (æµå¼æœåŠ¡å‘é€äº‹ä»¶)</h4><blockquote>
<p>Micronaut features a native client for Server Sent Events (SSE) defined by the interface SseClient.</p>
</blockquote>
<p>Micronaut å…·æœ‰ç”¨äºç”± <a class="link"   target="_blank" rel="noopener" href="https://docs.micronaut.io/latest/api/io/micronaut/http/client/sse/SseClient.html" >SseClient<i class="fas fa-external-link-alt"></i></a> æ¥å£å®šä¹‰çš„ Server Sent Events (SSE) çš„åŸç”Ÿå®¢æˆ·ç«¯</p>
<blockquote>
<p>You can use this client to stream SSE events from any server that emits them.</p>
</blockquote>
<p>ä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ªå®¢æˆ·ç«¯ä»ä»»ä½•è¾“å‡º SSE çš„ Server ä¸­æµå¼ä¼ è¾“ SSE</p>
<p>å°½ç®¡ SSE æµé€šå¸¸è¢«æµè§ˆå™¨ <code>EventSource</code> æ¶ˆè´¹, ä½†åœ¨ä¸€äº›åœºæ™¯ä¸‹ä½ å¯èƒ½éœ€è¦é€šè¿‡ <code>SseClient</code> æ¥æ¶ˆè´¹ SSE æµ, ä¾‹å¦‚åœ¨å•å…ƒæµ‹è¯•ä¸­, æˆ–åœ¨ä½œä¸ºè¯·æ±‚å…¶ä»–æœåŠ¡çš„ç½‘å…³ Micronaut ä¸­</p>
<p><code>@Client</code> æ³¨è§£ä¹Ÿæ”¯æŒæ¶ˆè´¹ SSE æµ</p>
<p>Example - è€ƒè™‘å¦‚ä¸‹è¾“å‡º SSE æµçš„ Controller æ–¹æ³•:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Get</span>(value = <span class="string">&#x27;/headlines&#x27;</span>, processes = MediaType.TEXT_EVENT_STREAM) <span class="comment">// 1</span></span><br><span class="line">Flux&lt;Event&lt;Headline&gt;&gt; streamHeadlines() &#123;</span><br><span class="line"></span><br><span class="line">    Flux.&lt;Event&lt;Headline&gt;&gt;create(   <span class="comment">// 2</span></span><br><span class="line">        &#123; emitter -&gt;</span><br><span class="line">            Headline headline = <span class="keyword">new</span> Headline(<span class="attr">text:</span> <span class="string">&quot;Latest Headline at $&#123;ZonedDateTime.now()&#125;&quot;</span>)</span><br><span class="line">            emitter.next(Event.of(headline))</span><br><span class="line">            emitter.complete()</span><br><span class="line">        &#125;,</span><br><span class="line">        FluxSink.OverflowStrategy.BUFFER</span><br><span class="line">    )</span><br><span class="line">    .repeat(<span class="number">100</span>)    <span class="comment">// 3</span></span><br><span class="line">    .delayElements(Duration.of(<span class="number">1</span>, ChronoUnit.SECONDS))  <span class="comment">// 4</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>1</code> : The controller defines a <code>@Get</code> annotation that produces a <code>MediaType.TEXT_EVENT_STREAM</code></p>
<p><code>2</code> : The method uses Reactor to emit a <code>Headline</code> object</p>
<p><code>3</code> : The <code>repeat</code> method repeats the emission 100 times</p>
<p><code>4</code> : With a delay of one second between each</p>
<p>æ³¨æ„, æ–¹æ³•çš„è¿”å›å€¼ä»ç„¶æ˜¯ <a class="link"   target="_blank" rel="noopener" href="https://docs.micronaut.io/latest/api/io/micronaut/http/sse/Event.html" >Event<i class="fas fa-external-link-alt"></i></a>, ä¸”ä½¿ç”¨ <code>Event.of</code> æ–¹æ³•æ¥åˆ›å»ºæµå¼ä¼ è¾“ç»™å®¢æˆ·ç«¯çš„äº‹ä»¶</p>
<p>è¦å®šä¹‰ä¸€ä¸ªå®¢æˆ·ç«¯æ¥æ¶ˆè´¹äº‹ä»¶, å®šä¹‰ä¸€ä¸ª processes <code>MediaType.TEXT_EVENT_STREAM</code> çš„æ–¹æ³•:</p>
<p>Example - SSE Client:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Client</span>(<span class="string">&#x27;/streaming/sse&#x27;</span>)</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">HeadlineClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Get</span>(value = <span class="string">&#x27;/headlines&#x27;</span>, processes = TEXT_EVENT_STREAM)</span><br><span class="line">    Publisher&lt;Event&lt;Headline&gt;&gt; streamHeadlines()</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Flux</code> çš„æ³›å‹ç±»å‹å¯ä»¥æ˜¯ <code>Event</code>, åœ¨è¿™ç§æƒ…å†µä¸‹ä½ å°†æ”¶åˆ°å®Œæ•´çš„äº‹ä»¶å¯¹è±¡, ä¹Ÿå¯ä»¥æ˜¯ POJO, åœ¨è¿™ç§æƒ…å†µä¸‹ä½ è®²ä»…æ”¶åˆ°ä» JSON è½¬æ¢è€Œæ¥çš„äº‹ä»¶ä¸­åŒ…å«çš„æ•°æ®</p>
<h3 id="Error-Response-é”™è¯¯å“åº”"><a href="#Error-Response-é”™è¯¯å“åº”" class="headerlink" title="Error Response (é”™è¯¯å“åº”)"></a>Error Response (é”™è¯¯å“åº”)</h3><p>å¦‚æœè¿”å›çš„ HTTP å“åº”çš„çŠ¶æ€ç æ˜¯ 400 æˆ–æ›´é«˜, é‚£ä¹ˆä¼šåˆ›å»ºä¸€ä¸ª <code>HttpClientResponseException</code></p>
<p>è¿™ä¸ª Exception åŒ…å«äº†åŸå§‹çš„å“åº”</p>
<p>Exception æ€æ ·æŠ›å‡ºå–å†³äºæ–¹æ³•çš„è¿”å›å€¼ç±»å‹:</p>
<ul>
<li>å¯¹äºå“åº”å¼å“åº”ç±»å‹, Exception ä½œä¸ºé”™è¯¯é€šè¿‡ Publisher ä¼ é€’</li>
<li>å¯¹äºé˜»å¡å¼å“åº”ç±»å‹, Exception ä¼šè¢«æŠ›å‡º, è°ƒç”¨è€…åº”è¯¥æ•è·å¹¶å¤„ç†è¿™ä¸ªå¼‚å¸¸</li>
</ul>
<blockquote>
<p>The one exception to this rule is HTTP Not Found (404) responses. This exception only applies to the declarative client.</p>
</blockquote>
<p>è¿™ä¸ªè§„åˆ™çš„ä¸€ä¸ªä¾‹å¤–æ˜¯ <code>HTTP Not Found</code> (404) å“åº”. è¿™ä¸ª Exception ä»…é€‚ç”¨äºå£°æ˜å¼ client</p>
<blockquote>
<p>HTTP Not Found (404) responses for blocking return types is not considered an error condition and the client exception will not be thrown. That behavior includes methods that return void.</p>
</blockquote>
<p>é˜»å¡å¼å“åº”ç±»å‹çš„ <code>HTTP Not Found</code> (404) å“åº”ä¸è¢«è®¤ä¸ºæ˜¯é”™è¯¯æ¡ä»¶, å¹¶ä¸”ä¸ä¼šå¼•å‘ client å¼‚å¸¸. è¿™ä¸ªè¡Œä¸ºåŒ…æ‹¬è¿”å› <code>void</code> çš„æ–¹æ³•</p>
<p>å¦‚æœæ–¹æ³•çš„è¿”å›å€¼æ˜¯ <code>HttpResponse</code>, é‚£ä¹ˆåŸå§‹çš„å“åº”ä¼šè¢«è¿”å›</p>
<p>å¦‚æœæ–¹æ³•çš„è¿”å›å€¼æ˜¯ <code>Optional</code>, é‚£ä¹ˆä¸€ä¸ª empty çš„ Optional ä¼šè¢«è¿”å›</p>
<p>å¯¹äºæ‰€æœ‰å…¶ä»–ç±»å‹, <code>null</code> å°†ä¼šè¢«è¿”å›</p>
<h3 id="Customizing-Request-Headers-è‡ªå®šä¹‰è¯·æ±‚å¤´"><a href="#Customizing-Request-Headers-è‡ªå®šä¹‰è¯·æ±‚å¤´" class="headerlink" title="Customizing Request Headers (è‡ªå®šä¹‰è¯·æ±‚å¤´)"></a>Customizing Request Headers (è‡ªå®šä¹‰è¯·æ±‚å¤´)</h3><p>è‡ªå®šä¹‰è¯·æ±‚ Header å€¼å¾—ç‰¹åˆ«è®¨è®º, å› ä¸ºæœ‰å‡ ç§æ–¹æ³•ä½¿ç”¨</p>
<h4 id="Populating-Headers-Using-Configuration-ä½¿ç”¨é…ç½®æ¥å¡«å……è¯·æ±‚å¤´"><a href="#Populating-Headers-Using-Configuration-ä½¿ç”¨é…ç½®æ¥å¡«å……è¯·æ±‚å¤´" class="headerlink" title="Populating Headers Using Configuration (ä½¿ç”¨é…ç½®æ¥å¡«å……è¯·æ±‚å¤´)"></a>Populating Headers Using Configuration (ä½¿ç”¨é…ç½®æ¥å¡«å……è¯·æ±‚å¤´)</h4><blockquote>
<p>The @Header annotation can be declared at the type level and is repeatable such that it is possible to drive the request headers sent via configuration using annotation metadata.</p>
</blockquote>
<p><code>@Header</code> æ³¨è§£å¯ä»¥åœ¨ç±»çº§åˆ«å£°æ˜ä¸”å¯ä»¥é‡å¤å£°æ˜, è¿™æ ·å°±å¯ä»¥ä½¿ç”¨æ³¨è§£å…ƒæ•°æ®(annotation metadata)æ¥é©±åŠ¨é€šè¿‡é…ç½®å‘é€çš„è¯·æ±‚ Header</p>
<p>Example - Defining Headers via Configuration:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Client</span>(<span class="string">&#x27;/pets&#x27;</span>)</span><br><span class="line"><span class="meta">@Header</span>(name = <span class="string">&#x27;X-Pet-Client&#x27;</span>, value = <span class="string">&#x27;$&#123;pet.client.id&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">PetClient</span> <span class="keyword">extends</span> <span class="title class_">PetOperations</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@SingleResult</span></span><br><span class="line">    Publisher&lt;Pet&gt; save(<span class="meta">@NotBlank</span> String name, <span class="meta">@Min</span>(<span class="number">1</span>L) <span class="type">int</span> age)</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Get</span>(<span class="string">&#x27;/&#123;name&#125;&#x27;</span>)</span><br><span class="line">    <span class="meta">@SingleResult</span></span><br><span class="line">    Publisher&lt;Pet&gt; get(String name)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä¾‹å­ä¸­åœ¨ <code>PetClient</code> æ¥å£ä¸Šå®šä¹‰äº† <code>@Header</code> æ³¨è§£, è¿™ä¸ªæ³¨è§£ä½¿ç”¨å±æ€§å ä½ç¬¦é…ç½®è¯»å– <code>pet.client.id</code> å±æ€§</p>
<p>ç„¶ååœ¨ <code>applicaton.yml</code> ä¸­é…ç½®è¿™ä¸ªå ä½ç¬¦å¯¹åº”çš„å€¼:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">pet:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="attr">id:</span> <span class="string">foo</span></span><br></pre></td></tr></table></figure>

<p>æˆ–è€…, å¯ä»¥é€šè¿‡ä¸€ä¸ªç¯å¢ƒå˜é‡ <code>PET_CLIENT_ID</code> æ¥æä¾›å ä½ç¬¦å€¼</p>
<h4 id="Populating-Headers-using-a-Client-Filter-ä½¿ç”¨ä¸€ä¸ªå®¢æˆ·ç«¯è¿‡æ»¤å™¨æ¥å¡«å……è¯·æ±‚å¤´"><a href="#Populating-Headers-using-a-Client-Filter-ä½¿ç”¨ä¸€ä¸ªå®¢æˆ·ç«¯è¿‡æ»¤å™¨æ¥å¡«å……è¯·æ±‚å¤´" class="headerlink" title="Populating Headers using a Client Filter (ä½¿ç”¨ä¸€ä¸ªå®¢æˆ·ç«¯è¿‡æ»¤å™¨æ¥å¡«å……è¯·æ±‚å¤´)"></a>Populating Headers using a Client Filter (ä½¿ç”¨ä¸€ä¸ªå®¢æˆ·ç«¯è¿‡æ»¤å™¨æ¥å¡«å……è¯·æ±‚å¤´)</h4><p>æˆ–è€…, ä¸ºäº†åŠ¨æ€å¡«å…… header, å¦ä¸€ä¸ªé€‰é¡¹æ˜¯ä½¿ç”¨ä¸€ä¸ª <a class="link"   target="_blank" rel="noopener" href="https://docs.micronaut.io/latest/guide/#clientFilter" >Client Filter<i class="fas fa-external-link-alt"></i></a></p>
<p>æŸ¥çœ‹ <a class="link"   target="_blank" rel="noopener" href="https://docs.micronaut.io/latest/guide/#clientFilter" >Client Filter<i class="fas fa-external-link-alt"></i></a> è·å–æ›´å¤šä¿¡æ¯</p>
<h3 id="Customizing-Jackson-Settings-è‡ªå®šä¹‰-Jackson-è®¾ç½®"><a href="#Customizing-Jackson-Settings-è‡ªå®šä¹‰-Jackson-è®¾ç½®" class="headerlink" title="Customizing Jackson Settings (è‡ªå®šä¹‰ Jackson è®¾ç½®)"></a>Customizing Jackson Settings (è‡ªå®šä¹‰ Jackson è®¾ç½®)</h3><p>æ­£å¦‚ä¸Šé¢æåˆ°çš„, Jackson è¢«ç”¨æ¥å°†æ¶ˆæ¯ç¼–ç ä¸º JSON</p>
<p>ä¸€ä¸ªé»˜è®¤çš„ Jackson <code>ObjectMapper</code> ä¼šè¢«é…ç½®, ç„¶åè¢« Micronaut çš„ HTTP clients ä½¿ç”¨</p>
<p>ä½ å¯ä»¥ä½¿ç”¨ <code>application.yml</code> ä¸­é€šè¿‡ <a class="link"   target="_blank" rel="noopener" href="https://docs.micronaut.io/latest/api/io/micronaut/jackson/JacksonConfiguration.html" >JacksonConfiguration<i class="fas fa-external-link-alt"></i></a> ç±»å®šä¹‰çš„å±æ€§è¦†ç›–ç”¨äºæ„é€  <code>ObjectMapper</code> çš„è®¾ç½®</p>
<p>Example- Enables indented output for Jackson:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jackson:</span></span><br><span class="line">    <span class="attr">serialization:</span></span><br><span class="line">        <span class="attr">indentOutput:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯, è¿™ä¸ªé…ç½®ä¼šåº”ç”¨åˆ°å…¨å±€, åŒæ—¶å½±å“ HTTP server æ€æ ·æ¸²æŸ“ JSON å’Œ HTTP client æ€æ ·å‘é€ JSON</p>
<p>å› æ­¤, æœ‰æ—¶å€™éœ€è¦æä¾›ä¸€ä¸ªç‰¹å®š client çš„ Jackson è®¾ç½®</p>
<p>å¯ä»¥åœ¨ä¸€ä¸ª client ä¸Šä½¿ç”¨ <code>@JacksonFeatures</code> æ³¨è§£æ¥è¿›è¡Œç‰¹æ€§ client è®¾ç½®:</p>
<p>Example - Jackson Features:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Client</span>(</span><br><span class="line">    id = EurekaClient.SERVICE_ID,</span><br><span class="line">    path = <span class="string">&#x27;/eureka&#x27;</span>,</span><br><span class="line">    configuration = EurekaConfiguration.<span class="keyword">class</span></span><br><span class="line">)</span><br><span class="line"><span class="meta">@JacksonFeatures</span>(</span><br><span class="line">    enabledSerializationFeatures = WRAP_ROOT_VALUE,</span><br><span class="line">    disabledSerializationFeatures = WRITE_SINGLE_ELEM_ARRAYS_UNWRAPPED,</span><br><span class="line">    enabledDeserializationFeatures = &#123;UNWRAP_ROOT_VALUE, ACCEPT_SINGLE_VALUE_AS_ARRAY&#125;</span><br><span class="line">)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EurekaClient</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœ <code>@JacksonFeatures</code> è¿˜ä¸èƒ½æ»¡è¶³è‡ªå®šä¹‰éœ€æ±‚, å¯ä»¥ä¸º <code>ObjectMapper</code> ç¼–å†™ä¸€ä¸ª <a class="link"   target="_blank" rel="noopener" href="https://docs.micronaut.io/latest/api/io/micronaut/context/event/BeanCreatedEventListener.html" >BeanCreatedEventListener<i class="fas fa-external-link-alt"></i></a>, ç„¶åæ·»åŠ ä»»ä½•ä½ éœ€è¦çš„è‡ªå®šä¹‰é…ç½®</p>
<h3 id="Retry-and-Circuit-Breaker-é‡è¯•ä¸æ–­è·¯å™¨"><a href="#Retry-and-Circuit-Breaker-é‡è¯•ä¸æ–­è·¯å™¨" class="headerlink" title="Retry and Circuit Breaker (é‡è¯•ä¸æ–­è·¯å™¨)"></a>Retry and Circuit Breaker (é‡è¯•ä¸æ–­è·¯å™¨)</h3><blockquote>
<p>Recovering from failure is critical for HTTP clients, and that is where Micronautâ€™s integrated Retry Advice comes in handy.</p>
</blockquote>
<p>ä»æ•…éšœä¸­æ¢å¤å¯¹äº HTTP clients æ¥è¯´è‡³å…³é‡è¦, è¿™å°±æ˜¯ Micronaut é›†æˆçš„ é‡è¯• Advice æ´¾ä¸Šç”¨åœºçš„åœ°æ–¹</p>
<p>å¯ä»¥åœ¨ä»»ä½• <code>@Client</code> æ¥å£ä¸Šå£°æ˜ <code>@Retryable</code> å’Œ <code>@CircuitBreaker</code> æ³¨è§£, ç„¶åå°±ä¼šåº”ç”¨é‡è¯•ç­–ç•¥</p>
<p>Example - Declaring <code>@Retryable</code>:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Client</span>(<span class="string">&#x27;/pets&#x27;</span>)</span><br><span class="line"><span class="meta">@Retryable</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">PetClient</span> <span class="keyword">extends</span> <span class="title class_">PetOperations</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    Mono&lt;Pet&gt; save(String name, <span class="type">int</span> age)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹ <a class="link"   target="_blank" rel="noopener" href="https://docs.micronaut.io/latest/guide/#retry" >Retry Advice<i class="fas fa-external-link-alt"></i></a> è·å–è‡ªå®šä¹‰é‡è¯•çš„ä¿¡æ¯</p>
<h3 id="Client-Fallbacks-å®¢æˆ·ç«¯é™çº§"><a href="#Client-Fallbacks-å®¢æˆ·ç«¯é™çº§" class="headerlink" title="Client Fallbacks (å®¢æˆ·ç«¯é™çº§)"></a>Client Fallbacks (å®¢æˆ·ç«¯é™çº§)</h3><p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­, ä¼šå‘ç”Ÿæ•…éšœ, æœ€å¥½åšå¥½å‡†å¤‡å¹¶ä¼˜é›…çš„å¤„ç†æ•…éšœ</p>
<p>é™¤æ­¤ä¹‹å¤–, åœ¨å¼€å‘å¾®æœåŠ¡æ—¶, åœ¨æ²¡æœ‰é¡¹ç›®éœ€è¦çš„ å…¶ä»–å¯ç”¨å¾®æœåŠ¡çš„ æƒ…å†µä¸‹å¤„ç†å•ä¸ªå¾®æœåŠ¡æ˜¯å¾ˆå¸¸è§çš„. å°±æ˜¯å½“å‰å¾®æœåŠ¡éœ€è¦ä¾èµ–çš„æœåŠ¡ä¸å¯ç”¨</p>
<blockquote>
<p>With that in mind, Micronaut features a native fallback mechanism that is integrated into Retry Advice that allows falling back to another implementation in the case of failure.</p>
</blockquote>
<p>è€ƒè™‘åˆ°è¿™ä¸€ç‚¹, Micronaut æä¾›äº†ä¸€ä¸ªåŸç”Ÿçš„é›†æˆåˆ° é‡è¯•Advice çš„é™çº§æœºåˆ¶, å…è®¸åœ¨å¤±è´¥çš„æƒ…å†µä¸‹é™çº§åˆ°å¦å¤–ä¸€ä¸ªå®ç°</p>
<p>ä½¿ç”¨ <code>@Fallback</code> æ³¨è§£, ä½ å¯ä»¥å£°æ˜ client åœ¨æ‰€æœ‰å¯èƒ½çš„é‡è¯•éƒ½ç”¨å°½æ—¶ä½¿ç”¨çš„é™çº§å®ç°</p>
<p>å®é™…ä¸Š, é™çº§æœºåˆ¶æ²¡æœ‰å’Œé‡è¯•ä¸¥æ ¼ç»‘å®š</p>
<p>ä½ å¯ä»¥å£°æ˜ä»»ä½•ä¸€ä¸ªç±»ä¸º <a class="link"   target="_blank" rel="noopener" href="https://docs.micronaut.io/latest/api/io/micronaut/retry/annotation/Recoverable.html" >@Recoverable<i class="fas fa-external-link-alt"></i></a>, å¦‚æœä¸€ä¸ªæ–¹æ³•è°ƒç”¨å¤±è´¥(æˆ–è€…åœ¨å“åº”å¼ç±»å‹ä¸­è¾“å‡ºäº†ä¸€ä¸ªé”™è¯¯), å°†ä¼šæœç´¢ä½¿ç”¨ <code>@Fallback</code> ä¿®é¥°çš„ç±»</p>
<p>Example - å®šä¹‰ä¸€ä¸ª <code>PetFallback</code> ç±»æ¥åœ¨è°ƒç”¨å¤±è´¥çš„æ—¶å€™è¢«è°ƒç”¨:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Fallback</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PetFallback</span> <span class="keyword">implements</span> <span class="title class_">PetOperations</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    Mono&lt;Pet&gt; save(String name, <span class="type">int</span> age) &#123;</span><br><span class="line">        Pet pet = <span class="keyword">new</span> Pet(<span class="attr">name:</span> name, <span class="attr">age:</span> age)</span><br><span class="line">        Mono.just(pet)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ éœ€è¦ä½¿ç”¨é™çº§æ¥å¸®åŠ©æµ‹è¯•å¤–éƒ¨å¾®æœåŠ¡, ä½ å¯ä»¥åœ¨ <code>src/test/java</code> ä¸­å®šä¹‰é™çº§å®ç°, æ‰€ä»¥è¿™äº›é™çº§å®ç°ä¸ä¼šè¢«åŒ…å«åˆ°äº§å“ä»£ç . å¦‚æœä¸é€šè¿‡ hystrix ä½¿ç”¨é™çº§, ä½ è¿˜è¦åœ¨å£°æ˜å¼ client ä¸ŠæŒ‡å®š <code>@Recoverable(api = PetOperations.class)</code></p>
<p>æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„, é™çº§ä¸ä¼šæ‰§è¡Œä»»ä½•ç½‘ç»œè¯·æ±‚ä¸”éå¸¸ç®€å•, å› æ­¤ä¼šåœ¨ä¸€ä¸ªå¤–éƒ¨ç³»ç»Ÿä¸å¯ç”¨æ—¶æä¾›æˆåŠŸçš„è¿”å›</p>
<p>å½“ç„¶, é™çº§çš„å®é™…è¡Œä¸ºå–å†³äºä½ çš„æƒ³æ³•. ä¾‹å¦‚, ä½ å¯ä»¥å®ç°ä¸€ä¸ªé™çº§å®ç°æ¥åœ¨çœŸå®æ•°æ®ä¸å¯ç”¨æ—¶ä»æœ¬åœ°ç¼“å­˜ä¸­æ‹‰å–æ•°æ®, å‘è¿è¥éƒ¨é—¨å‘é€æœ‰å…³åœæœºæ—¶é—´çš„è­¦æŠ¥ç”µå­é‚®ä»¶æˆ–å…¶ä»–é€šçŸ¥ã€‚</p>
<h3 id="Netflix-Hystrix-Support-ç½‘é£-Hystrix-çš„æ”¯æŒ"><a href="#Netflix-Hystrix-Support-ç½‘é£-Hystrix-çš„æ”¯æŒ" class="headerlink" title="Netflix Hystrix Support (ç½‘é£ Hystrix çš„æ”¯æŒ)"></a>Netflix Hystrix Support (ç½‘é£ Hystrix çš„æ”¯æŒ)</h3><p>å¦‚æœä½ ä½¿ç”¨ Micronaut CLI åˆ›å»ºé¡¹ç›®, æ·»åŠ  <code>netflix-hystrix</code> ç‰¹æ€§æ¥é…ç½® Hystrix ä½ çš„é¡¹ç›®:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mn create-app my-app --features netflix-hystrix</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Netflix Hystrix is a fault tolerance library developed by the Netflix team and is designed to improve resilience of interprocess communication.</p>
</blockquote>
<p><a class="link"   target="_blank" rel="noopener" href="https://github.com/Netflix/Hystrix" >Netflix Hystrix<i class="fas fa-external-link-alt"></i></a> æ˜¯ Netflix å›¢é˜Ÿå¼€å‘çš„å®¹é”™åº“, æ—¨åœ¨æä¾›è¿›ç¨‹é—´é€šä¿¡çš„å¼¹æ€§</p>
<p>Micronaut é€šè¿‡ <code>netflix-hystrix</code> æ¨¡å—æ¥é›†æˆ Hystrix, è¿™ä¸ªæ¨¡å—å¯ä»¥æ·»åŠ åˆ°ä½ çš„æ„å»ºä¸­:</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation(<span class="string">&quot;io.micronaut.netflix:micronaut-netflix-hystrix&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="Using-the-HystrixCommand-Annotation-ä½¿ç”¨-HystrixCommand-æ³¨è§£"><a href="#Using-the-HystrixCommand-Annotation-ä½¿ç”¨-HystrixCommand-æ³¨è§£" class="headerlink" title="Using the @HystrixCommand Annotation (ä½¿ç”¨ @HystrixCommand æ³¨è§£)"></a>Using the <code>@HystrixCommand</code> Annotation (ä½¿ç”¨ <code>@HystrixCommand</code> æ³¨è§£)</h4><p>å£°æ˜äº†ä¸Šé¢çš„æ³¨è§£ä¹‹å, ä½ å¯ä»¥ä½¿ç”¨ <a class="link"   target="_blank" rel="noopener" href="https://docs.micronaut.io/latest/guide/#proxyClient" >@HystrixCommand<i class="fas fa-external-link-alt"></i></a> æ³¨è§£ä¿®é¥°ä»»ä½•æ–¹æ³•( åŒ…æ‹¬å®šä¹‰åœ¨ <code>@Client</code> æ¥å£ä¸­çš„æ–¹æ³• ), ç„¶åæ–¹æ³•çš„æ‰§è¡Œå°±ä¼šè¢«åŒ…è£…åœ¨ä¸€ä¸ª Hystrix command ä¸­</p>
<p>Example - Using <code>@HystrixCommand</code>:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@HystrixCommand</span></span><br><span class="line">String hello(String name) &#123; <span class="string">&quot;Hello $name&quot;</span> &#125;</span><br></pre></td></tr></table></figure>

<p>è¿˜å¯ä»¥ç”¨äºå“åº”å¼è¿”å›ç±»å‹, ä¾‹å¦‚ <code>Flux</code>, å“åº”å¼ç±»å‹å°†ä¼šè¢«åŒ…è£…åˆ° <code>HystrixObservableCommand</code></p>
<p><a class="link"   target="_blank" rel="noopener" href="https://docs.micronaut.io/latest/guide/#proxyClient" >@HystrixCommand<i class="fas fa-external-link-alt"></i></a> è¿˜å’Œ Micronaut æ”¯æŒçš„ <a class="link"   target="_blank" rel="noopener" href="https://docs.micronaut.io/latest/guide/#retry" >Retry Advice<i class="fas fa-external-link-alt"></i></a> å’Œ <a class="link"   target="_blank" rel="noopener" href="https://docs.micronaut.io/latest/guide/#clientFallback" >Fallbacks<i class="fas fa-external-link-alt"></i></a> é›†æˆ</p>
<p>å…³äºå¦‚ä½•è‡ªå®šä¹‰ Hystrix çº¿ç¨‹æ± , group å’Œ properties çš„ä¿¡æ¯, æŸ¥çœ‹ <a class="link"   target="_blank" rel="noopener" href="https://micronaut-projects.github.io/micronaut-netflix/latest/api/io/micronaut/configuration/hystrix/annotation/HystrixCommand.html" >HystrixCommand<i class="fas fa-external-link-alt"></i></a> çš„ Javadoc</p>
<h4 id="Enabling-Hystrix-Stream-and-Dashboard-å¼€å¯-Hystrix-æµå’Œä»ªè¡¨æ¿"><a href="#Enabling-Hystrix-Stream-and-Dashboard-å¼€å¯-Hystrix-æµå’Œä»ªè¡¨æ¿" class="headerlink" title="Enabling Hystrix Stream and Dashboard (å¼€å¯ Hystrix æµå’Œä»ªè¡¨æ¿)"></a>Enabling Hystrix Stream and Dashboard (å¼€å¯ Hystrix æµå’Œä»ªè¡¨æ¿)</h4><p>å¯ä»¥åœ¨ <code>application.yml</code> è®¾ç½® <code>hystrix.stream.enabled</code> ä¸º <code>true</code> æ¥å¼€å¯ä¸€ä¸ª Server Sent Event æµä»¥å‘é€åˆ° <a class="link"   target="_blank" rel="noopener" href="https://github.com/Netflix-Skunkworks/hystrix-dashboard" >Hystrix Dashboard<i class="fas fa-external-link-alt"></i></a></p>
<p>Example - Enabling Hystrix Stream:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">hystrix:</span></span><br><span class="line">    <span class="attr">stream:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>è¿™å°†ä¼šæš´éœ²ä¸€ä¸ª <code>/hystrix.stream</code> ä½¿ç”¨ <a class="link"   target="_blank" rel="noopener" href="https://github.com/Netflix-Skunkworks/hystrix-dashboard" >Hystrix Dashboard<i class="fas fa-external-link-alt"></i></a>æœŸæœ›çš„æ ¼å¼çš„ ç«¯ç‚¹</p>
<h2 id="HTTP-Clients-Filters-HTTP-å®¢æˆ·ç«¯è¿‡æ»¤å™¨"><a href="#HTTP-Clients-Filters-HTTP-å®¢æˆ·ç«¯è¿‡æ»¤å™¨" class="headerlink" title="HTTP Clients Filters (HTTP å®¢æˆ·ç«¯è¿‡æ»¤å™¨)"></a>HTTP Clients Filters (HTTP å®¢æˆ·ç«¯è¿‡æ»¤å™¨)</h2><blockquote>
<p>Often, you need to include the same HTTP headers or URL parameters in a set of requests against a third-party API or when calling another Microservice.</p>
</blockquote>
<p>é€šå¸¸, ä½ éœ€è¦åœ¨é’ˆå¯¹ç¬¬ä¸‰æ–¹ API æˆ–è°ƒç”¨å¦ä¸€ä¸ªå¾®æœåŠ¡çš„ä¸€ç»„è¯·æ±‚ä¸­åŒ…å«ç›¸åŒçš„ HTTP headers æˆ– URL å‚æ•°</p>
<p>ä¸ºäº†ç®€åŒ–è¿™ä¸ªæ“ä½œ, å¯ä»¥å®šä¹‰ <code>HttpClientFilter</code> ç±», ç”¨äºæ‰€æœ‰åŒ¹é…çš„ HTTP client è¯·æ±‚</p>
<p>Example:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BintraApi</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String URL = <span class="string">&#x27;https://api.bintray.com&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Singleton</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BintrayService</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> HttpClient client</span><br><span class="line">    <span class="keyword">final</span> String org</span><br><span class="line"></span><br><span class="line">    BintrayService(</span><br><span class="line">        <span class="meta">@Client</span>(BintrayApi.URL) HttpClient client,      <span class="comment">// 1</span></span><br><span class="line">        <span class="meta">@Value</span>(<span class="string">&#x27;$&#123;bintray.organization&#125;&#x27;</span>) String org</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.client = client</span><br><span class="line">        <span class="variable language_">this</span>.org = org</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Flux&lt;HttpResponse&lt;String&gt;&gt; fetchRepositories() &#123;</span><br><span class="line">        client.exchange(HttpRequest.GET(<span class="string">&quot;/repos/$org&quot;</span>), String) <span class="comment">// 2</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Flux&lt;HttpResponse&lt;String&gt;&gt; fetchPackages(String repo) &#123;</span><br><span class="line">        client.exchange(HttpRequest.GET(<span class="string">&quot;/repos/$&#123;org&#125;/$&#123;repo&#125;/packages&quot;</span>), String)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>1</code> : An ReactorHttpClient is injected for the Bintray API</p>
<p><code>2</code> : The organization is configurable via configuration</p>
<p>Bintray API æ˜¯åŠ å¯†çš„. ä¸ºäº†éªŒè¯ä½ è¦åœ¨æ¯ä¸ªè¯·æ±‚ä¸­æ·»åŠ ä¸€ä¸ª <code>Authorization</code> header, é€šè¿‡<br>ä½¿ç”¨è¿‡æ»¤å™¨æ¥å®Œæˆ:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Filter</span>(<span class="string">&#x27;/repos/**&#x27;</span>)    <span class="comment">// You can match only a subset of paths with a Client filter</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BintrayFilter</span> <span class="keyword">implements</span> <span class="title class_">HttpClientFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> String username</span><br><span class="line">    <span class="keyword">final</span> String token</span><br><span class="line"></span><br><span class="line">    BintrayFilter(</span><br><span class="line">        <span class="meta">@Value</span>(<span class="string">&#x27;$&#123;bintray.username&#125;&#x27;</span>) String username,</span><br><span class="line">        <span class="meta">@Value</span>(<span class="string">&#x27;$&#123;bintray.token&#125;&#x27;</span>) String token</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.username = username</span><br><span class="line">        <span class="variable language_">this</span>.token = token</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    Publisher&lt;? extends HttpResponse&lt;?&gt;&gt; doFilter(</span><br><span class="line">        MutableHttpRequest&lt;?&gt; request,</span><br><span class="line">        ClientFilterChain chain</span><br><span class="line">    ) &#123;</span><br><span class="line">        chain.proceed(</span><br><span class="line">            request.basicAuth(username, token)  <span class="comment">// The basicAuth method includes HTTP Basic credentials</span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Injecting-Another-Client-into-a-HttpClientFilter-æ³¨å…¥å¦ä¸€ä¸ªå®¢æˆ·ç«¯åˆ°è¿‡æ»¤å™¨ä¸­"><a href="#Injecting-Another-Client-into-a-HttpClientFilter-æ³¨å…¥å¦ä¸€ä¸ªå®¢æˆ·ç«¯åˆ°è¿‡æ»¤å™¨ä¸­" class="headerlink" title="Injecting Another Client into a HttpClientFilter (æ³¨å…¥å¦ä¸€ä¸ªå®¢æˆ·ç«¯åˆ°è¿‡æ»¤å™¨ä¸­)"></a>Injecting Another Client into a HttpClientFilter (æ³¨å…¥å¦ä¸€ä¸ªå®¢æˆ·ç«¯åˆ°è¿‡æ»¤å™¨ä¸­)</h3><p>è¦åˆ›å»º <code>ReactorHttpClient</code>, Micronaut éœ€è¦è§£ææ‰€æœ‰çš„ <code>HttpClientFilter</code> å®ä¾‹, è¿™å°†ä¼šåœ¨å°†å¦ä¸€ä¸ª <code>ReactorHttpClient</code> æˆ– <code>@Client</code> Bean æ³¨å…¥ <code>HttpClientFilter</code> å®ä¾‹æ—¶å¯¼è‡´å¾ªç¯ä¾èµ–</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜, ä½¿ç”¨ <a class="link"   target="_blank" rel="noopener" href="https://docs.micronaut.io/latest/api/io/micronaut/context/BeanProvider.html" >BeanProvider<i class="fas fa-external-link-alt"></i></a> æ¥å£æ¥æ³¨å…¥å¦å¤–ä¸€ä¸ª <code>ReactorHttpClient</code> æˆ– <code>@Client</code> Bean åˆ°ä¸€ä¸ª <code>HttpClientFilter</code> å®ä¾‹ä¸­</p>
<p>Example:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.context.annotation.Requires</span><br><span class="line"><span class="keyword">import</span> io.micronaut.context.env.Environment</span><br><span class="line"><span class="keyword">import</span> io.micronaut.context.BeanProvider</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.HttpResponse</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.MutableHttpRequest</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Filter</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.client.HttpClient</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.filter.ClientFilterChain</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.filter.HttpClientFilter</span><br><span class="line"><span class="keyword">import</span> org.reactivestreams.Publisher</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Flux</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> io.micronaut.http.HttpRequest.GET</span><br><span class="line"></span><br><span class="line"><span class="meta">@Requires</span>(env = Environment.GOOGLE_COMPUTE)</span><br><span class="line"><span class="meta">@Filter</span>(patterns = <span class="string">&#x27;/google-auth/api/**&#x27;</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GoogleAuthFilter</span> <span class="keyword">implements</span> <span class="title class_">HttpClientFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BeanProvider&lt;HttpClient&gt; authClientProvider</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The BeanProvider interface is used to inject another client, avoiding a circular reference</span></span><br><span class="line">    <span class="comment">// The `get()` method of the `Provider` interface is used to obtain the client instance</span></span><br><span class="line">    GoogleAuthFilter(BeanProvider&lt;HttpClient&gt;) httpClientProvider) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.authClientProvider = httpClientProvider</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Filter-Matching-By-Annotation-é€šè¿‡æ³¨è§£æ¥è¿›è¡Œè¿‡æ»¤åŒ¹é…"><a href="#Filter-Matching-By-Annotation-é€šè¿‡æ³¨è§£æ¥è¿›è¡Œè¿‡æ»¤åŒ¹é…" class="headerlink" title="Filter Matching By Annotation (é€šè¿‡æ³¨è§£æ¥è¿›è¡Œè¿‡æ»¤åŒ¹é…)"></a>Filter Matching By Annotation (é€šè¿‡æ³¨è§£æ¥è¿›è¡Œè¿‡æ»¤åŒ¹é…)</h3><blockquote>
<p>For cases where a filter should be applied to a client regardless of the URL, filters can be matched by the presence of an annotation applied to both the filter and the client.</p>
</blockquote>
<p>å¯¹äºåº”è¯¥å°†è¿‡æ»¤å™¨åº”ç”¨äº client è€Œä¸è€ƒè™‘ URL çš„æƒ…å†µ, è¿‡æ»¤å™¨å¯ä»¥é€šè¿‡åŒæ—¶åº”ç”¨äºè¿‡æ»¤å™¨å’Œå®¢æˆ·ç«¯çš„æ³¨è§£æ¥åŒ¹é…</p>
<p>åœ¨ client å’Œ filter ä¸Šä½¿ç”¨ç›¸åŒçš„æ³¨è§£, è®© filter é€šè¿‡æ³¨è§£æ¥è¿›è¡ŒåŒ¹é…</p>
<p>Example:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Get</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.client.annotation.Client</span><br><span class="line"></span><br><span class="line"><span class="meta">@BasicAuth</span>  <span class="comment">// 1</span></span><br><span class="line"><span class="meta">@Client</span>(<span class="string">&#x27;/message&#x27;</span>)</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">BasicAuthClient</span> &#123;</span><br><span class="line">    <span class="meta">@Get</span></span><br><span class="line">    String getMessage()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>1</code> : The <code>@BasicAuth</code> annotation is applied to the client</p>
<p>Example - The following filter will filter the client requests:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.http.HttpResponse</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.MutableHttpRequest</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.filter.ClientFilterChain</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.filter.HttpClientFilter</span><br><span class="line"><span class="keyword">import</span> org.reactivestreams.Publisher</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jakarta.inject.Singleton</span><br><span class="line"></span><br><span class="line"><span class="meta">@BasicAuth</span>  <span class="comment">// 1</span></span><br><span class="line"><span class="meta">@Singleton</span>  <span class="comment">//2</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BasicAuthClientFilter</span> <span class="keyword">implements</span> <span class="title class_">HttpClientFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    Publisher&lt;? extends HttpResponse&lt;?&gt;&gt; doFilter(MutableHttpRequest&lt;?&gt; request,</span><br><span class="line">                                                  ClientFilterChain chain) &#123;</span><br><span class="line">        chain.proceed(request.basicAuth(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;pass&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>1</code> : The same annotation, <code>@BasicAuth</code>, is applied to the filter</p>
<p><code>2</code> : Normally the <code>@Filter</code> annotation makes filters singletons by default. Because the <code>@Filter</code> annotation is not used, the desired scope must be applied</p>
<p>Example - <code>@BasicAuth</code> æ³¨è§£æ˜¯ä¸€ä¸ªç®€å•çš„æ³¨è§£:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.FilterMatcher</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Documented</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.annotation.ElementType.PARAMETER</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.annotation.ElementType.TYPE</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.annotation.RetentionPolicy.RUNTIME</span><br><span class="line"></span><br><span class="line"><span class="meta">@FilterMatcher</span> <span class="comment">// 1</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Retention</span>(RUNTIME)</span><br><span class="line"><span class="meta">@Target</span>([TYPE, PARAMETER])</span><br><span class="line"><span class="meta">@interface</span> BasicAuth &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>1</code> : The only requirement for custom annotations is that the <code>@FilterMatcher</code> annotation must be present</p>
<h2 id="HTTP-x2F-2-Support-HTTP-x2F-2-çš„æ”¯æŒ"><a href="#HTTP-x2F-2-Support-HTTP-x2F-2-çš„æ”¯æŒ" class="headerlink" title="HTTP&#x2F;2 Support (HTTP&#x2F;2 çš„æ”¯æŒ)"></a>HTTP&#x2F;2 Support (HTTP&#x2F;2 çš„æ”¯æŒ)</h2><p>é»˜è®¤æƒ…å†µä¸‹, Micronaut çš„ HTTP client é…ç½®ä¸ºæ”¯æŒ HTTP 1.1</p>
<p>è¦å¼€å¯ HTTP&#x2F;2 çš„æ”¯æŒ, åœ¨é…ç½®ä¸­è®¾ç½®æ”¯æŒçš„ HTTP ç‰ˆæœ¬:</p>
<p>Example - Enabling HTTP&#x2F;2 in Clients:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">        <span class="attr">client:</span></span><br><span class="line">            <span class="attr">http-version:</span> <span class="number">2.0</span></span><br></pre></td></tr></table></figure>

<p>æˆ–è€…åœ¨æ³¨å…¥ client æ—¶æŒ‡å®šè¦ä½¿ç”¨çš„ HTTP ç‰ˆæœ¬:</p>
<p>Example - Injecting an HTTP&#x2F;2 client:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Inject</span></span><br><span class="line"><span class="meta">@Client</span>(httpVersion = HttpVersion.HTTP_2_0)</span><br><span class="line">ReactorHttpClient client</span><br></pre></td></tr></table></figure>

<h2 id="HTTP-Client-Sample-HTTP-å®¢æˆ·ç«¯ä¾‹å­"><a href="#HTTP-Client-Sample-HTTP-å®¢æˆ·ç«¯ä¾‹å­" class="headerlink" title="HTTP Client Sample (HTTP å®¢æˆ·ç«¯ä¾‹å­)"></a>HTTP Client Sample (HTTP å®¢æˆ·ç«¯ä¾‹å­)</h2><p>HTTP Client Guide - <a class="link"   target="_blank" rel="noopener" href="https://guides.micronaut.io/micronaut-http-client/guide/index.html" >Java<i class="fas fa-external-link-alt"></i></a></p>
<p>HTTP Client Guide - <a class="link"   target="_blank" rel="noopener" href="https://guides.micronaut.io/micronaut-http-client-groovy/guide/index.html" >Groovy<i class="fas fa-external-link-alt"></i></a></p>
<p>HTTP Client Guide - <a class="link"   target="_blank" rel="noopener" href="https://guides.micronaut.io/micronaut-http-client-kotlin/guide/index.html" >Kotlin<i class="fas fa-external-link-alt"></i></a></p>

        </div>

        
            <div class="post-copyright-info">
                <div class="article-copyright-info-container">
    <ul>
        <li>æœ¬æ–‡æ ‡é¢˜ï¼šMicronaut ä¸­æ–‡æ–‡æ¡£ The HTTP Client</li>
        <li>æœ¬æ–‡ä½œè€…ï¼šæ—å¨ç¾½</li>
        <li>åˆ›å»ºæ—¶é—´ï¼š2022-04-29 09:43:43</li>
        <li>
            æœ¬æ–‡é“¾æ¥ï¼šhttps://linweiyu21.github.io/micronaut/micronaut-the-http-client/
        </li>
        <li>
            ç‰ˆæƒå£°æ˜ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
        </li>
    </ul>
</div>

            </div>
        

        
            <ul class="post-tags-box">
                
                    <li class="tag-item">
                        <a href="/tags/Micronaut/">#Micronaut</a>&nbsp;
                    </li>
                
                    <li class="tag-item">
                        <a href="/tags/Groovy/">#Groovy</a>&nbsp;
                    </li>
                
                    <li class="tag-item">
                        <a href="/tags/%E4%B8%AD%E6%96%87/">#ä¸­æ–‡</a>&nbsp;
                    </li>
                
            </ul>
        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/micronaut/micronaut-cloud-native-features/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Micronaut ä¸­æ–‡æ–‡æ¡£ Cloud Native Features</span>
                                <span class="post-nav-item">ä¸Šä¸€ç¯‡</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/micronaut/micronaut-the-http-server/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Micronaut ä¸­æ–‡æ–‡æ¡£ The HTTP Server</span>
                                <span class="post-nav-item">ä¸‹ä¸€ç¯‡</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
            <div class="comment-container">
                <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        <i class="fas fa-comments">&nbsp;è¯„è®º</i>
    </div>
    

        
            
    <div class="valine-container">
        <script data-pjax
                src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script>
        <div id="vcomments"></div>
        <script data-pjax>
            function loadValine() {
                new Valine({
                    el: '#vcomments',
                    appId: '8xWQ0WFbKUNN4h8ixIO12etk-gzGzoHsz',
                    appKey: '7cLjTvkIsF6aIuIVSd0um89m',
                    meta: ['nick', 'mail', 'link'],
                    avatar: 'wavatar',
                    enableQQ: true,
                    placeholder: 'è¯·å¼€å§‹ä½ çš„è¡¨æ¼”',
                    lang: 'zh-CN'.toLowerCase()
                });

                function getAuthor(language) {
                    switch (language) {
                        case 'en':
                            return 'Author';
                        case 'zh-CN':
                            return 'åšä¸»';
                        default:
                            return 'Master';
                    }
                }

                // Add "Author" identify
                const getValineDomTimer = setInterval(() => {
                    const vcards = document.querySelectorAll('#vcomments .vcards .vcard');
                    if (vcards.length > 0) {
                        let author = 'æ—å¨ç¾½';

                        if (author) {
                            for (let vcard of vcards) {
                                const vnick_dom = vcard.querySelector('.vhead .vnick');
                                const vnick = vnick_dom.innerHTML;
                                if (vnick === author) {
                                    vnick_dom.innerHTML = `${vnick} <span class="author">${getAuthor(KEEP.hexo_config.language)}</span>`
                                }
                            }
                        }
                        clearInterval(getValineDomTimer);
                    } else {
                        clearInterval(getValineDomTimer);
                    }
                }, 2000);
            }

            if ('true') {
                const loadValineTimeout = setTimeout(() => {
                    loadValine();
                    clearTimeout(loadValineTimeout);
                }, 1000);
            } else {
                window.addEventListener('DOMContentLoaded', loadValine);
            }
        </script>
    </div>



        
    
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
            2022&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">æ—å¨ç¾½</a>
        </div>
        
            <script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        è®¿é—®äººæ•°&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
                    <span id="busuanzi_container_site_pv">
                        æ€»è®¿é—®é‡&nbsp;<span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            ç”± <a target="_blank" href="https://hexo.io">Hexo</a> é©±åŠ¨&nbsp;|&nbsp;ä¸»é¢˜&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.5</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fas fa-comment"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#The-HTTP-Client"><span class="nav-number">1.</span> <span class="nav-text">The HTTP Client</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Using-the-Low-Level-HTTP-Client-%E4%BD%BF%E7%94%A8%E4%BD%8E%E7%BA%A7%E5%88%AB-HTTP-Client"><span class="nav-number">1.1.</span> <span class="nav-text">Using the Low-Level HTTP Client (ä½¿ç”¨ä½çº§åˆ« HTTP Client)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Sending-your-first-HTTP-request-%E5%8F%91%E9%80%81%E4%BD%A0%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA-HTTP-%E8%AF%B7%E6%B1%82"><span class="nav-number">1.1.1.</span> <span class="nav-text">Sending your first HTTP request (å‘é€ä½ çš„ç¬¬ä¸€ä¸ª HTTP è¯·æ±‚)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Obtaining-a-HttpClient-%E8%8E%B7%E5%8F%96%E4%B8%80%E4%B8%AA-HttpClient"><span class="nav-number">1.1.1.1.</span> <span class="nav-text">Obtaining a HttpClient (è·å–ä¸€ä¸ª HttpClient)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Performing-an-HTTP-GET-%E6%89%A7%E8%A1%8C%E4%B8%80%E4%B8%AA-HTTP-GET-%E8%AF%B7%E6%B1%82"><span class="nav-number">1.1.1.2.</span> <span class="nav-text">Performing an HTTP GET (æ‰§è¡Œä¸€ä¸ª HTTP GET è¯·æ±‚)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Debugging-x2F-Tracing-the-HTTP-Client-%E8%B0%83%E8%AF%95-x2F-%E8%B7%9F%E8%B8%AA-HTTP-Client"><span class="nav-number">1.1.1.3.</span> <span class="nav-text">Debugging &#x2F; Tracing the HTTP Client (è°ƒè¯• &#x2F; è·Ÿè¸ª HTTP Client)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Client-Specific-Debugging-x2F-Tracing-%E6%8C%87%E5%AE%9A%E7%9A%84-Client-%E8%B0%83%E8%AF%95-x2F-%E8%B7%9F%E8%B8%AA"><span class="nav-number">1.1.1.4.</span> <span class="nav-text">Client Specific Debugging &#x2F; Tracing (æŒ‡å®šçš„ Client è°ƒè¯• &#x2F; è·Ÿè¸ª)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Customizing-the-HTTP-Request-%E8%87%AA%E5%AE%9A%E4%B9%89-HTTP-%E8%AF%B7%E6%B1%82"><span class="nav-number">1.1.1.5.</span> <span class="nav-text">Customizing the HTTP Request (è‡ªå®šä¹‰ HTTP è¯·æ±‚)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Reading-JSON-Response-%E8%AF%BB%E5%8F%96-JSON-%E5%93%8D%E5%BA%94"><span class="nav-number">1.1.1.6.</span> <span class="nav-text">Reading JSON Response (è¯»å– JSON å“åº”)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Decoding-Other-Content-Types-%E8%A7%A3%E7%A0%81%E5%85%B6%E4%BB%96-Content-Types"><span class="nav-number">1.1.1.7.</span> <span class="nav-text">Decoding Other Content Types (è§£ç å…¶ä»– Content Types)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Receiving-the-Full-HTTP-Response-%E6%8E%A5%E5%8F%97%E5%AE%8C%E6%95%B4%E7%9A%84-HTTP-%E5%93%8D%E5%BA%94"><span class="nav-number">1.1.1.8.</span> <span class="nav-text">Receiving the Full HTTP Response (æ¥å—å®Œæ•´çš„ HTTP å“åº”)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Posting-a-Request-Body-%E5%8F%91%E9%80%81%E4%B8%80%E4%B8%AA%E8%AF%B7%E6%B1%82%E4%BD%93"><span class="nav-number">1.1.2.</span> <span class="nav-text">Posting a Request Body (å‘é€ä¸€ä¸ªè¯·æ±‚ä½“)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Sending-JSON-%E5%8F%91%E9%80%81-JSON"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">Sending JSON (å‘é€ JSON)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Using-a-URI-Template-%E4%BD%BF%E7%94%A8%E4%B8%80%E4%B8%AA-URI-%E6%A8%A1%E6%9D%BF"><span class="nav-number">1.1.2.2.</span> <span class="nav-text">Using a URI Template (ä½¿ç”¨ä¸€ä¸ª URI æ¨¡æ¿)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Sending-Form-Data-%E5%8F%91%E9%80%81%E8%A1%A8%E5%8D%95%E6%95%B0%E6%8D%AE"><span class="nav-number">1.1.2.3.</span> <span class="nav-text">Sending Form Data (å‘é€è¡¨å•æ•°æ®)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Multipart-Client-Uploads-Multipart-%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%8A%E4%BC%A0"><span class="nav-number">1.1.3.</span> <span class="nav-text">Multipart Client Uploads (Multipart å®¢æˆ·ç«¯ä¸Šä¼ )</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Streaming-JSON-over-HTTP-HTTP-%E4%B8%8A%E7%9A%84%E6%B5%81%E5%BC%8F-JSON"><span class="nav-number">1.1.4.</span> <span class="nav-text">Streaming JSON over HTTP (HTTP ä¸Šçš„æµå¼ JSON)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Configuring-HTTP-clients-%E9%85%8D%E7%BD%AE-HTTP-clients"><span class="nav-number">1.1.5.</span> <span class="nav-text">Configuring HTTP clients (é…ç½® HTTP clients)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Global-Configuration-for-All-Clients-%E7%94%A8%E4%BA%8E%E5%85%A8%E9%83%A8-Clients-%E7%9A%84%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE"><span class="nav-number">1.1.5.1.</span> <span class="nav-text">Global Configuration for All Clients (ç”¨äºå…¨éƒ¨ Clients çš„å…¨å±€é…ç½®)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Client-Specific-Configuration-%E7%89%B9%E5%AE%9A-Client-%E9%85%8D%E7%BD%AE"><span class="nav-number">1.1.5.2.</span> <span class="nav-text">Client Specific Configuration (ç‰¹å®š Client é…ç½®)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Using-HTTP-Client-Connection-Pooling-%E4%BD%BF%E7%94%A8-HTTP-Client-%E8%BF%9E%E6%8E%A5%E6%B1%A0%E5%8C%96"><span class="nav-number">1.1.5.3.</span> <span class="nav-text">Using HTTP Client Connection Pooling (ä½¿ç”¨ HTTP Client è¿æ¥æ± åŒ–)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Configuring-Event-Loop-Groups-%E9%85%8D%E7%BD%AE-Event-Loop-%E7%BB%84"><span class="nav-number">1.1.5.4.</span> <span class="nav-text">Configuring Event Loop Groups (é…ç½® Event Loop ç»„)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Error-Responses-%E9%94%99%E8%AF%AF%E5%93%8D%E5%BA%94"><span class="nav-number">1.1.6.</span> <span class="nav-text">Error Responses (é”™è¯¯å“åº”)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Bind-Errors-%E7%BB%91%E5%AE%9A%E9%94%99%E8%AF%AF"><span class="nav-number">1.1.7.</span> <span class="nav-text">Bind Errors (ç»‘å®šé”™è¯¯)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Proxying-Requests-with-ProxyHttpClient-%E4%BD%BF%E7%94%A8-ProxyingHttpClient-%E6%9D%A5%E4%BB%A3%E7%90%86%E8%AF%B7%E6%B1%82"><span class="nav-number">1.2.</span> <span class="nav-text">Proxying Requests with ProxyHttpClient (ä½¿ç”¨ ProxyingHttpClient æ¥ä»£ç†è¯·æ±‚)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Declarative-HTTP-Clients-with-Client-%E4%BD%BF%E7%94%A8-Client-%E7%9A%84%E5%A3%B0%E6%98%8E%E5%BC%8F-HTTP-%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="nav-number">1.3.</span> <span class="nav-text">Declarative HTTP Clients with @Client (ä½¿ç”¨ @Client çš„å£°æ˜å¼ HTTP å®¢æˆ·ç«¯)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Customizing-Parameters-Binding-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8F%82%E6%95%B0%E7%BB%91%E5%AE%9A"><span class="nav-number">1.3.1.</span> <span class="nav-text">Customizing Parameters Binding (è‡ªå®šä¹‰å‚æ•°ç»‘å®š)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Query-values-formatting-%E8%AF%B7%E6%B1%82%E5%80%BC%E6%A0%BC%E5%BC%8F%E5%8C%96"><span class="nav-number">1.3.1.1.</span> <span class="nav-text">Query values formatting (è¯·æ±‚å€¼æ ¼å¼åŒ–)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Type-Based-Binding-Parameters-%E5%9F%BA%E4%BA%8E%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8F%82%E6%95%B0%E7%BB%91%E5%AE%9A"><span class="nav-number">1.3.1.1.1.</span> <span class="nav-text">Type-Based Binding Parameters (åŸºäºç±»å‹çš„å‚æ•°ç»‘å®š)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Custom-Binding-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%91%E5%AE%9A"><span class="nav-number">1.3.1.1.2.</span> <span class="nav-text">Custom Binding (è‡ªå®šä¹‰ç»‘å®š)</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#Binding-By-Annotation-%E9%80%9A%E8%BF%87%E6%B3%A8%E8%A7%A3%E8%BF%9B%E8%A1%8C%E7%BB%91%E5%AE%9A"><span class="nav-number">1.3.1.1.2.1.</span> <span class="nav-text">Binding By Annotation (é€šè¿‡æ³¨è§£è¿›è¡Œç»‘å®š)</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Binding-By-Type-%E9%80%9A%E8%BF%87%E7%B1%BB%E5%9E%8B%E8%BF%9B%E8%A1%8C%E7%BB%91%E5%AE%9A"><span class="nav-number">1.3.1.1.2.2.</span> <span class="nav-text">Binding By Type (é€šè¿‡ç±»å‹è¿›è¡Œç»‘å®š)</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Binding-On-Method-%E5%9C%A8%E6%96%B9%E6%B3%95%E4%B8%8A%E8%BF%9B%E8%A1%8C%E7%BB%91%E5%AE%9A"><span class="nav-number">1.3.1.1.3.</span> <span class="nav-text">Binding On Method (åœ¨æ–¹æ³•ä¸Šè¿›è¡Œç»‘å®š)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Streaming-with-Client-%E4%BD%BF%E7%94%A8-Client-%E8%BF%9B%E8%A1%8C%E6%B5%81%E5%BC%8F%E5%A4%84%E7%90%86"><span class="nav-number">1.3.2.</span> <span class="nav-text">Streaming with @Client (ä½¿ç”¨ @Client è¿›è¡Œæµå¼å¤„ç†)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Streaming-JSON-with-Client-%E4%BD%BF%E7%94%A8-Client-%E8%BF%9B%E8%A1%8C-JSON-%E6%B5%81%E5%BC%8F%E5%A4%84%E7%90%86"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">Streaming JSON with @Client (ä½¿ç”¨ @Client è¿›è¡Œ JSON æµå¼å¤„ç†)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Streaming-Clients-and-Response-Types-%E6%B5%81%E5%BC%8F%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%92%8C%E5%93%8D%E5%BA%94%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.3.2.2.</span> <span class="nav-text">Streaming Clients and Response Types (æµå¼å®¢æˆ·ç«¯å’Œå“åº”ç±»å‹)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Streaming-Clients-and-Read-Timeout-%E6%B5%81%E5%BC%8F%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%92%8C%E8%AF%BB%E5%8F%96%E8%B6%85%E6%97%B6"><span class="nav-number">1.3.2.3.</span> <span class="nav-text">Streaming Clients and Read Timeout (æµå¼å®¢æˆ·ç«¯å’Œè¯»å–è¶…æ—¶)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Streaming-Server-Sent-Events-%E6%B5%81%E5%BC%8F%E6%9C%8D%E5%8A%A1%E5%8F%91%E9%80%81%E4%BA%8B%E4%BB%B6"><span class="nav-number">1.3.2.4.</span> <span class="nav-text">Streaming Server Sent Events (æµå¼æœåŠ¡å‘é€äº‹ä»¶)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Error-Response-%E9%94%99%E8%AF%AF%E5%93%8D%E5%BA%94"><span class="nav-number">1.3.3.</span> <span class="nav-text">Error Response (é”™è¯¯å“åº”)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Customizing-Request-Headers-%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AF%B7%E6%B1%82%E5%A4%B4"><span class="nav-number">1.3.4.</span> <span class="nav-text">Customizing Request Headers (è‡ªå®šä¹‰è¯·æ±‚å¤´)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Populating-Headers-Using-Configuration-%E4%BD%BF%E7%94%A8%E9%85%8D%E7%BD%AE%E6%9D%A5%E5%A1%AB%E5%85%85%E8%AF%B7%E6%B1%82%E5%A4%B4"><span class="nav-number">1.3.4.1.</span> <span class="nav-text">Populating Headers Using Configuration (ä½¿ç”¨é…ç½®æ¥å¡«å……è¯·æ±‚å¤´)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Populating-Headers-using-a-Client-Filter-%E4%BD%BF%E7%94%A8%E4%B8%80%E4%B8%AA%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%87%E6%BB%A4%E5%99%A8%E6%9D%A5%E5%A1%AB%E5%85%85%E8%AF%B7%E6%B1%82%E5%A4%B4"><span class="nav-number">1.3.4.2.</span> <span class="nav-text">Populating Headers using a Client Filter (ä½¿ç”¨ä¸€ä¸ªå®¢æˆ·ç«¯è¿‡æ»¤å™¨æ¥å¡«å……è¯·æ±‚å¤´)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Customizing-Jackson-Settings-%E8%87%AA%E5%AE%9A%E4%B9%89-Jackson-%E8%AE%BE%E7%BD%AE"><span class="nav-number">1.3.5.</span> <span class="nav-text">Customizing Jackson Settings (è‡ªå®šä¹‰ Jackson è®¾ç½®)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Retry-and-Circuit-Breaker-%E9%87%8D%E8%AF%95%E4%B8%8E%E6%96%AD%E8%B7%AF%E5%99%A8"><span class="nav-number">1.3.6.</span> <span class="nav-text">Retry and Circuit Breaker (é‡è¯•ä¸æ–­è·¯å™¨)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Client-Fallbacks-%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%99%8D%E7%BA%A7"><span class="nav-number">1.3.7.</span> <span class="nav-text">Client Fallbacks (å®¢æˆ·ç«¯é™çº§)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Netflix-Hystrix-Support-%E7%BD%91%E9%A3%9E-Hystrix-%E7%9A%84%E6%94%AF%E6%8C%81"><span class="nav-number">1.3.8.</span> <span class="nav-text">Netflix Hystrix Support (ç½‘é£ Hystrix çš„æ”¯æŒ)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Using-the-HystrixCommand-Annotation-%E4%BD%BF%E7%94%A8-HystrixCommand-%E6%B3%A8%E8%A7%A3"><span class="nav-number">1.3.8.1.</span> <span class="nav-text">Using the @HystrixCommand Annotation (ä½¿ç”¨ @HystrixCommand æ³¨è§£)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Enabling-Hystrix-Stream-and-Dashboard-%E5%BC%80%E5%90%AF-Hystrix-%E6%B5%81%E5%92%8C%E4%BB%AA%E8%A1%A8%E6%9D%BF"><span class="nav-number">1.3.8.2.</span> <span class="nav-text">Enabling Hystrix Stream and Dashboard (å¼€å¯ Hystrix æµå’Œä»ªè¡¨æ¿)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HTTP-Clients-Filters-HTTP-%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="nav-number">1.4.</span> <span class="nav-text">HTTP Clients Filters (HTTP å®¢æˆ·ç«¯è¿‡æ»¤å™¨)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Injecting-Another-Client-into-a-HttpClientFilter-%E6%B3%A8%E5%85%A5%E5%8F%A6%E4%B8%80%E4%B8%AA%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%88%B0%E8%BF%87%E6%BB%A4%E5%99%A8%E4%B8%AD"><span class="nav-number">1.4.1.</span> <span class="nav-text">Injecting Another Client into a HttpClientFilter (æ³¨å…¥å¦ä¸€ä¸ªå®¢æˆ·ç«¯åˆ°è¿‡æ»¤å™¨ä¸­)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Filter-Matching-By-Annotation-%E9%80%9A%E8%BF%87%E6%B3%A8%E8%A7%A3%E6%9D%A5%E8%BF%9B%E8%A1%8C%E8%BF%87%E6%BB%A4%E5%8C%B9%E9%85%8D"><span class="nav-number">1.4.2.</span> <span class="nav-text">Filter Matching By Annotation (é€šè¿‡æ³¨è§£æ¥è¿›è¡Œè¿‡æ»¤åŒ¹é…)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HTTP-x2F-2-Support-HTTP-x2F-2-%E7%9A%84%E6%94%AF%E6%8C%81"><span class="nav-number">1.5.</span> <span class="nav-text">HTTP&#x2F;2 Support (HTTP&#x2F;2 çš„æ”¯æŒ)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HTTP-Client-Sample-HTTP-%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BE%8B%E5%AD%90"><span class="nav-number">1.6.</span> <span class="nav-text">HTTP Client Sample (HTTP å®¢æˆ·ç«¯ä¾‹å­)</span></a></li></ol></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="æœç´¢..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>



<script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/dark-light-toggle.js"></script>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/local-search.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/code-copy.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/lazyload.js"></script>


<div class="post-scripts pjax">
    
        <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/left-side-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/libs/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/toc.js"></script>
    
</div>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/libs/pjax.min.js"></script>
<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>



</body>
</html>
