<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Micronaut,Groovy,Gradle,Java,æ–‡æ¡£,ä¸­æ–‡">
    <meta name="description" content="Micronaut Groovy Gradle Java æ–‡æ¡£ ä¸­æ–‡">
    <meta name="author" content="æ—å¨ç¾½">
    
    <title>
        
            Micronaut ä¸­æ–‡æ–‡æ¡£ The HTTP Server |
        
        æ—å¨ç¾½çš„ç¬”è®°
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/logo.svg">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/css/font-awesome.min.css">
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"zh-CN","path":"search.json"};
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":true,"init_open":true},"style":{"primary_color":"rgb(153,153,0)","avatar":"/images/avatar.jpg","favicon":"/images/logo.svg","article_img_align":"left","left_side_width":"400px","content_max_width":"920px","hover":{"shadow":true,"scale":true},"first_screen":{"enable":true,"background_img":null,"description":"def containsğŸš€ = ['Micronaut', 'Groovy', 'Gradle', 'etc']"},"scroll":{"progress_bar":{"enable":true},"percent":{"enable":true}}},"local_search":{"enable":true,"preload":true},"code_copy":{"enable":true,"style":"mac"},"pjax":{"enable":true},"lazyload":{"enable":true},"version":"3.4.5"};
    KEEP.language_ago = {"second":"%s ç§’å‰","minute":"%s åˆ†é’Ÿå‰","hour":"%s å°æ—¶å‰","day":"%s å¤©å‰","week":"%s å‘¨å‰","month":"%s ä¸ªæœˆå‰","year":"%s å¹´å‰"};
  </script>
<meta name="generator" content="Hexo 6.1.0"></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fas fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                æ—å¨ç¾½çš„ç¬”è®°
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                é¦–é¡µ
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                åˆ†ç±»
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                æ ‡ç­¾
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                å½’æ¡£
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                å…³äº
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">é¦–é¡µ</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories">åˆ†ç±»</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags">æ ‡ç­¾</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">å½’æ¡£</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about">å…³äº</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

    <a target="_blank" rel="noopener" href="https://github.com/linweiyu21/" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80"
        viewBox="0 0 250 250" style="fill:#64CEAA; color:#fff; position: absolute; top: 0; border: 0; right: 0;"
        aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path
          d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
          fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path
          d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
          fill="currentColor" class="octo-body"></path>
      </svg></a>
    <style>
      .github-corner:hover .octo-arm {
        animation: octocat-wave 560ms ease-in-out
      }

      @keyframes octocat-wave {

        0%,
        100% {
          transform: rotate(0)
        }

        20%,
        60% {
          transform: rotate(-25deg)
        }

        40%,
        80% {
          transform: rotate(10deg)
        }
      }

      @media (max-width:500px) {
        .github-corner:hover .octo-arm {
          animation: none
        }

        .github-corner .octo-arm {
          animation: octocat-wave 560ms ease-in-out
        }
      }
    </style>
</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">Micronaut ä¸­æ–‡æ–‡æ¡£ The HTTP Server</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/avatar.jpg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">æ—å¨ç¾½</span>
                        
                            <span class="author-label">Lv8</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;
        <span class="pc">2022-04-29 09:43:17</span>
        <span class="mobile">2022-04-29 09:43</span>
    </span>
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/Micronaut-%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/">Micronaut ä¸­æ–‡æ–‡æ¡£</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/Micronaut/">Micronaut</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/Groovy/">Groovy</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/%E4%B8%AD%E6%96%87/">ä¸­æ–‡</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <!-- TOC -->

<ul>
<li><a href="#the-http-server">The HTTP Server</a><ul>
<li><a href="#running-the-embedded-server-%E8%BF%90%E8%A1%8C%E5%86%85%E5%B5%8C%E7%9A%84-server">Running the Embedded Server (è¿è¡Œå†…åµŒçš„ Server)</a></li>
<li><a href="#running-server-on-a-specific-port-%E5%9C%A8%E6%8C%87%E5%AE%9A%E7%AB%AF%E5%8F%A3%E4%B8%8A%E8%BF%90%E8%A1%8C-server">Running Server on a Specific Port (åœ¨æŒ‡å®šç«¯å£ä¸Šè¿è¡Œ Server)</a></li>
<li><a href="#http-routing-http-%E8%B7%AF%E7%94%B1">HTTP Routing (HTTP è·¯ç”±)</a><ul>
<li><a href="#uri-paths-uri-%E8%B7%AF%E5%BE%84">URI Paths (URI è·¯å¾„)</a></li>
<li><a href="#uri-path-variables-uri-%E8%B7%AF%E5%BE%84%E5%8F%98%E9%87%8F">URI Path Variables (URI è·¯å¾„å˜é‡)</a></li>
<li><a href="#uri-reserved-character-matching-uri-%E4%BF%9D%E7%95%99%E5%AD%97%E7%AC%A6%E5%8C%B9%E9%85%8D">URI Reserved Character Matching (URI ä¿ç•™å­—ç¬¦åŒ¹é…)</a></li>
<li><a href="#routing-annotations-%E8%B7%AF%E7%94%B1%E6%B3%A8%E8%A7%A3">Routing Annotations (è·¯ç”±æ³¨è§£)</a></li>
<li><a href="#multiple-uris-%E5%A4%9A%E4%B8%AA-uri">Multiple URIs (å¤šä¸ª URI)</a></li>
<li><a href="#building-routes-programmatically-%E7%BC%96%E7%A8%8B%E5%BC%8F%E5%9C%B0%E6%9E%84%E5%BB%BA%E8%B7%AF%E7%94%B1">Building Routes Programmatically (ç¼–ç¨‹å¼åœ°æ„å»ºè·¯ç”±)</a></li>
<li><a href="#route-compile-time-validation-%E8%B7%AF%E7%94%B1%E7%BC%96%E8%AF%91%E6%97%B6%E6%A0%A1%E9%AA%8C">Route Compile-Time Validation (è·¯ç”±ç¼–è¯‘æ—¶æ ¡éªŒ)</a></li>
<li><a href="#routing-non-standard-http-methods-%E8%B7%AF%E7%94%B1%E9%9D%9E%E6%A0%87%E5%87%86-http-%E6%96%B9%E6%B3%95">Routing non-standard HTTP methods (è·¯ç”±éæ ‡å‡† HTTP æ–¹æ³•)</a></li>
</ul>
</li>
<li><a href="#simple-request-binding-%E7%AE%80%E5%8D%95%E8%AF%B7%E6%B1%82%E7%BB%91%E5%AE%9A">Simple Request Binding (ç®€å•è¯·æ±‚ç»‘å®š)</a><ul>
<li><a href="#binding-annotations-%E7%BB%91%E5%AE%9A%E6%B3%A8%E8%A7%A3">Binding Annotations (ç»‘å®šæ³¨è§£)</a></li>
<li><a href="#stream-support-stream-%E6%94%AF%E6%8C%81">Stream Support (Stream æ”¯æŒ)</a></li>
<li><a href="#binding-from-multiple-query-values-%E4%BD%BF%E7%94%A8%E5%A4%9A%E4%B8%AA%E8%AF%B7%E6%B1%82%E5%80%BC%E8%BF%9B%E8%A1%8C%E7%BB%91%E5%AE%9A">Binding from Multiple Query values (ä½¿ç”¨å¤šä¸ªè¯·æ±‚å€¼è¿›è¡Œç»‘å®š)</a></li>
<li><a href="#binding-from-multiple-bindable-values-%E4%BB%8E%E5%A4%9A%E4%B8%AA%E5%8F%AF%E7%BB%91%E5%AE%9A%E5%80%BC%E4%B8%AD%E8%BF%9B%E8%A1%8C%E7%BB%91%E5%AE%9A">Binding from Multiple Bindable values (ä»å¤šä¸ªå¯ç»‘å®šå€¼ä¸­è¿›è¡Œç»‘å®š)</a></li>
<li><a href="#bindable-types-%E5%8F%AF%E7%BB%91%E5%AE%9A%E7%B1%BB%E5%9E%8B">Bindable Types (å¯ç»‘å®šç±»å‹)</a></li>
<li><a href="#type-based-binding-parameters-%E5%9F%BA%E4%BA%8E%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8F%82%E6%95%B0%E7%BB%91%E5%AE%9A">Type-Based Binding Parameters (åŸºäºç±»å‹çš„å‚æ•°ç»‘å®š)</a></li>
<li><a href="#variable-resolution-%E5%8F%98%E9%87%8F%E8%A7%A3%E6%9E%90">Variable resolution (å˜é‡è§£æ)</a></li>
</ul>
</li>
<li><a href="#custom-argument-binding-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8F%82%E6%95%B0%E7%BB%91%E5%AE%9A">Custom Argument Binding (è‡ªå®šä¹‰å‚æ•°ç»‘å®š)</a><ul>
<li><a href="#annotatedrequestargumentbinder-%E6%B3%A8%E8%A7%A3%E4%BF%AE%E9%A5%B0%E7%9A%84%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E7%BB%91%E5%AE%9A">AnnotatedRequestArgumentBinder (æ³¨è§£ä¿®é¥°çš„è¯·æ±‚å‚æ•°ç»‘å®š)</a></li>
<li><a href="#typedrequestargumentbinder-%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E7%B1%BB%E5%9E%8B%E7%BB%91%E5%AE%9A">TypedRequestArgumentBinder (è¯·æ±‚å‚æ•°ç±»å‹ç»‘å®š)</a></li>
</ul>
</li>
<li><a href="#host-resolution-host-%E8%A7%A3%E6%9E%90">Host Resolution (Host è§£æ)</a></li>
<li><a href="#locale-resolution-%E6%9C%AC%E5%9C%B0%E5%8C%96%E8%A7%A3%E6%9E%90">Locale Resolution (æœ¬åœ°åŒ–è§£æ)</a></li>
<li><a href="#client-ip-address-%E5%AE%A2%E6%88%B7%E7%AB%AF-ip-%E5%9C%B0%E5%9D%80">Client IP Address (å®¢æˆ·ç«¯ IP åœ°å€)</a></li>
<li><a href="#the-httprequest-and-httpresponse-httprequest-%E5%92%8C-httpresponse">The HttpRequest and HttpResponse (HttpRequest å’Œ HttpResponse)</a></li>
<li><a href="#response-status-%E5%93%8D%E5%BA%94%E7%8A%B6%E6%80%81">Response Status (å“åº”çŠ¶æ€)</a></li>
<li><a href="#response-content-type-%E5%93%8D%E5%BA%94%E7%9A%84-content-type">Response Content-Type (å“åº”çš„ Content-Type)</a></li>
<li><a href="#accepted-request-content-type-%E5%8F%AF%E6%8E%A5%E5%8F%97%E7%9A%84%E8%AF%B7%E6%B1%82-content-type">Accepted Request Content-Type (å¯æ¥å—çš„è¯·æ±‚ Content-Type)</a><ul>
<li><a href="#customing-processed-content-types-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%A4%84%E7%90%86%E7%9A%84-content-type">Customing Processed Content Types (è‡ªå®šä¹‰å¤„ç†çš„ Content-Type)</a></li>
</ul>
</li>
<li><a href="#reactive-http-request-processing-%E5%93%8D%E5%BA%94%E5%BC%8F-http-%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86">Reactive HTTP Request Processing (å“åº”å¼ HTTP è¯·æ±‚å¤„ç†)</a><ul>
<li><a href="#using-the-body-annotation-%E4%BD%BF%E7%94%A8-body-%E6%B3%A8%E8%A7%A3">Using the <code>@Body</code> Annotation (ä½¿ç”¨ <code>@Body</code> æ³¨è§£)</a></li>
<li><a href="#reactive-responses-%E5%93%8D%E5%BA%94%E5%BC%8F%E5%93%8D%E5%BA%94">Reactive Responses (å“åº”å¼å“åº”)</a></li>
</ul>
</li>
<li><a href="#json-binding-with-jackson-%E4%BD%BF%E7%94%A8-jackson-%E8%BF%9B%E8%A1%8C-json-%E7%BB%91%E5%AE%9A">JSON Binding with Jackson (ä½¿ç”¨ Jackson è¿›è¡Œ JSON ç»‘å®š)</a><ul>
<li><a href="#binding-using-reactive-frameworks-%E4%BD%BF%E7%94%A8%E5%93%8D%E5%BA%94%E5%BC%8F%E6%A1%86%E6%9E%B6%E8%BF%9B%E8%A1%8C%E7%BB%91%E5%AE%9A">Binding using Reactive Frameworks (ä½¿ç”¨å“åº”å¼æ¡†æ¶è¿›è¡Œç»‘å®š)</a></li>
<li><a href="#binding-using-completablefuture-%E4%BD%BF%E7%94%A8-completablefuture-%E8%BF%9B%E8%A1%8C%E7%BB%91%E5%AE%9A">Binding Using CompletableFuture (ä½¿ç”¨ CompletableFuture è¿›è¡Œç»‘å®š)</a></li>
<li><a href="#binding-using-pojos-%E4%BD%BF%E7%94%A8-pojo-%E8%BF%9B%E8%A1%8C%E7%BB%91%E5%AE%9A">Binding using POJOs (ä½¿ç”¨ POJO è¿›è¡Œç»‘å®š)</a></li>
<li><a href="#jackson-configuration-jackson-%E9%85%8D%E7%BD%AE">Jackson Configuration (Jackson é…ç½®)</a><ul>
<li><a href="#features-%E7%89%B9%E6%80%A7">Features (ç‰¹æ€§)</a></li>
<li><a href="#further-customing-jsonfactory-%E6%9B%B4%E6%B7%B1%E5%85%A5%E8%87%AA%E5%AE%9A%E4%B9%89-jsonfactory-">Further customing <code>JsonFactory</code> (æ›´æ·±å…¥è‡ªå®šä¹‰ <code>JsonFactory</code> )</a></li>
<li><a href="#support-for-jsonview-jsonview-%E7%9A%84%E6%94%AF%E6%8C%81">Support for <code>@JsonView</code> (<code>@JsonView</code> çš„æ”¯æŒ)</a></li>
<li><a href="#beans-beans">Beans (Beans)</a></li>
<li><a href="#service-loader-service-%E5%8A%A0%E8%BD%BD%E5%99%A8">Service Loader (Service åŠ è½½å™¨)</a></li>
<li><a href="#number-precision-%E6%95%B0%E5%80%BC%E7%B2%BE%E7%A1%AE%E6%80%A7">Number Precision (æ•°å€¼ç²¾ç¡®æ€§)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#data-validation-%E6%95%B0%E6%8D%AE%E6%A0%A1%E9%AA%8C">Data Validation (æ•°æ®æ ¡éªŒ)</a></li>
<li><a href="#serving-static-resources-%E6%8F%90%E4%BE%9B%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90">Serving Static Resources (æä¾›é™æ€èµ„æº)</a></li>
<li><a href="#error-handling-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86">Error Handling (é”™è¯¯å¤„ç†)</a><ul>
<li><a href="#status-handlers-%E7%8A%B6%E6%80%81%E5%A4%84%E7%90%86%E5%99%A8">Status Handlers (çŠ¶æ€å¤„ç†å™¨)</a></li>
<li><a href="#local-error-handling-%E6%9C%AC%E5%9C%B0%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86">Local Error Handling (æœ¬åœ°å¼‚å¸¸å¤„ç†)</a></li>
<li><a href="#global-error-handling-%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86">Global Error Handling (å…¨å±€å¼‚å¸¸å¤„ç†)</a></li>
<li><a href="#exceptionhandler-%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E5%99%A8">ExceptionHandler (å¼‚å¸¸å¤„ç†å™¨)</a></li>
<li><a href="#built-in-exception-handlers-%E5%86%85%E7%BD%AE%E7%9A%84%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E5%99%A8">Built-In Exception Handlers (å†…ç½®çš„å¼‚å¸¸å¤„ç†å™¨)</a><ul>
<li><a href="#custom-exception-handler-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E5%99%A8">Custom Exception Handler (è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†å™¨)</a></li>
</ul>
</li>
<li><a href="#error-formatting-%E9%94%99%E8%AF%AF%E6%A0%BC%E5%BC%8F">Error Formatting (é”™è¯¯æ ¼å¼)</a></li>
</ul>
</li>
<li><a href="#api-versioning-api-%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6">API Versioning (API ç‰ˆæœ¬æ§åˆ¶)</a><ul>
<li><a href="#default-version-%E9%BB%98%E8%AE%A4%E7%89%88%E6%9C%AC">Default Version (é»˜è®¤ç‰ˆæœ¬)</a></li>
<li><a href="#versioning-client-requests-%E7%89%88%E6%9C%AC%E5%8C%96%E7%9A%84%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AF%B7%E6%B1%82">Versioning Client Requests (ç‰ˆæœ¬åŒ–çš„å®¢æˆ·ç«¯è¯·æ±‚)</a></li>
</ul>
</li>
<li><a href="#handling-form-data-%E5%A4%84%E7%90%86%E8%A1%A8%E5%8D%95%E6%95%B0%E6%8D%AE">Handling Form Data (å¤„ç†è¡¨å•æ•°æ®)</a></li>
<li><a href="#writing-response-data-%E7%BC%96%E5%86%99%E5%93%8D%E5%BA%94%E6%95%B0%E6%8D%AE">Writing Response Data (ç¼–å†™å“åº”æ•°æ®)</a><ul>
<li><a href="#performing-blocking-io-%E8%BF%90%E8%A1%8C%E9%98%BB%E5%A1%9E-io">Performing Blocking I&#x2F;O (è¿è¡Œé˜»å¡ I&#x2F;O)</a><ul>
<li><a href="#writable-%E5%8F%AF%E5%86%99%E7%9A%84">Writable (å¯å†™çš„)</a></li>
<li><a href="#inputstream-%E8%BE%93%E5%85%A5%E6%B5%81">InputStream (è¾“å…¥æµ)</a></li>
<li><a href="#404-responses-404-%E5%93%8D%E5%BA%94">404 Responses (404 å“åº”)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#file-uploads-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0">File Uploads (æ–‡ä»¶ä¸Šä¼ )</a><ul>
<li><a href="#route-arguments-%E8%B7%AF%E7%94%B1%E5%8F%82%E6%95%B0">Route Arguments (è·¯ç”±å‚æ•°)</a><ul>
<li><a href="#chunk-data-types-%E5%9D%97%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B">Chunk Data Types (å—æ•°æ®ç±»å‹)</a></li>
<li><a href="#whole-data-types-%E5%AE%8C%E6%95%B4%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B">Whole Data Types (å®Œæ•´æ•°æ®ç±»å‹)</a></li>
</ul>
</li>
<li><a href="#multiple-uploads-%E5%A4%9A%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0">Multiple Uploads (å¤šæ–‡ä»¶ä¸Šä¼ )</a><ul>
<li><a href="#different-names-%E4%B8%8D%E5%90%8C%E7%9A%84%E5%90%8D%E5%AD%97">Different Names (ä¸åŒçš„åå­—)</a></li>
<li><a href="#same-name-%E7%9B%B8%E5%90%8C%E7%9A%84%E5%90%8D%E5%AD%97">Same name (ç›¸åŒçš„åå­—)</a></li>
</ul>
</li>
<li><a href="#whole-body-binding-%E5%AE%8C%E6%95%B4-body-%E7%BB%91%E5%AE%9A">Whole Body Binding (å®Œæ•´ Body ç»‘å®š)</a></li>
</ul>
</li>
<li><a href="#file-transfers-%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93">File Transfers (æ–‡ä»¶ä¼ è¾“)</a><ul>
<li><a href="#sending-file-objects-%E5%8F%91%E9%80%81%E6%96%87%E4%BB%B6%E5%AF%B9%E8%B1%A1">Sending File Objects (å‘é€æ–‡ä»¶å¯¹è±¡)</a></li>
<li><a href="#sending-an-inputstream-%E5%8F%91%E9%80%81%E4%B8%80%E4%B8%AA-inputstream">Sending an InputStream (å‘é€ä¸€ä¸ª InputStream)</a></li>
<li><a href="#cache-configuration-%E7%BC%93%E5%AD%98%E9%85%8D%E7%BD%AE">Cache Configuration (ç¼“å­˜é…ç½®)</a></li>
</ul>
</li>
<li><a href="#http-filters-http-%E8%BF%87%E6%BB%A4%E5%99%A8">HTTP Filters (HTTP è¿‡æ»¤å™¨)</a><ul>
<li><a href="#writing-a-filter-%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AA%E8%BF%87%E6%BB%A4%E5%99%A8">Writing a Filter (ç¼–å†™ä¸€ä¸ªè¿‡æ»¤å™¨)</a></li>
</ul>
</li>
<li><a href="#http-sessions-http-%E4%BC%9A%E8%AF%9D">HTTP Sessions (HTTP ä¼šè¯)</a><ul>
<li><a href="#enabling-sessions-%E5%BC%80%E5%90%AF%E4%BC%9A%E8%AF%9D">Enabling Sessions (å¼€å¯ä¼šè¯)</a><ul>
<li><a href="#redis-sessions-redis-%E4%BC%9A%E8%AF%9D">Redis Sessions (Redis ä¼šè¯)</a></li>
</ul>
</li>
<li><a href="#configuring-session-resolution-%E9%85%8D%E7%BD%AE%E4%BC%9A%E8%AF%9D%E8%A7%A3%E6%9E%90">Configuring Session Resolution (é…ç½®ä¼šè¯è§£æ)</a></li>
<li><a href="#working-with-sessions-%E4%BD%BF%E7%94%A8%E4%BC%9A%E8%AF%9D">Working with Sessions (ä½¿ç”¨ä¼šè¯)</a></li>
<li><a href="#session-clients-%E4%BC%9A%E8%AF%9D%E5%AE%A2%E6%88%B7%E7%AB%AF">Session Clients (ä¼šè¯å®¢æˆ·ç«¯)</a></li>
<li><a href="#using-sessionvalue-%E4%BD%BF%E7%94%A8-sessionvalue-%E6%B3%A8%E8%A7%A3">Using <code>@SessionValue</code> (ä½¿ç”¨ <code>@SessionValue</code> æ³¨è§£)</a></li>
<li><a href="#session-events-%E4%BC%9A%E8%AF%9D%E4%BA%8B%E4%BB%B6">Session Events (ä¼šè¯äº‹ä»¶)</a></li>
</ul>
</li>
<li><a href="#server-sent-events-server-%E5%8F%91%E9%80%81%E4%BA%8B%E4%BB%B6">Server Sent Events (Server å‘é€äº‹ä»¶)</a></li>
<li><a href="#websocket-support-websocket-%E6%94%AF%E6%8C%81">WebSocket Support (WebSocket æ”¯æŒ)</a><ul>
<li><a href="#using-serverwebsocket%E4%BD%BF%E7%94%A8-serverwebsocket-%E6%B3%A8%E8%A7%A3">Using <code>@ServerWebSocket</code>(ä½¿ç”¨ <code>@ServerWebSocket</code> æ³¨è§£)</a><ul>
<li><a href="#the-onclose-method-onclose-%E6%96%B9%E6%B3%95">The <code>@OnClose</code> Method (<code>@OnClose</code> æ–¹æ³•)</a></li>
<li><a href="#the-onmessage-method-onmessage-%E6%96%B9%E6%B3%95">The <code>@OnMessage</code> Method (<code>@OnMessage</code> æ–¹æ³•)</a></li>
<li><a href="#the-onerror-method-onerror-%E6%96%B9%E6%B3%95">The <code>@OnError</code> Method (<code>@OnError</code> æ–¹æ³•)</a></li>
<li><a href="#non-blocking-message-handling-%E9%9D%9E%E9%98%BB%E5%A1%9E%E5%BC%8F%E4%BF%A1%E6%81%AF%E5%A4%84%E7%90%86">Non-Blocking Message Handling (éé˜»å¡å¼ä¿¡æ¯å¤„ç†)</a></li>
<li><a href="#serverwebsocket-and-scopes-serverwebsocket-%E5%92%8C%E4%BD%9C%E7%94%A8%E5%9F%9F"><code>@ServerWebSocket</code> and Scopes (<code>@ServerWebSocket</code> å’Œä½œç”¨åŸŸ)</a></li>
<li><a href="#sharing-sessions-with-the-http-session-%E5%92%8C-http-session-%E5%85%B1%E4%BA%AB-session">Sharing Sessions with the HTTP Session (å’Œ HTTP session å…±äº« session)</a></li>
<li><a href="#using-the-cli-%E4%BD%BF%E7%94%A8-cli">Using the CLI (ä½¿ç”¨ CLI)</a></li>
<li><a href="#connection-timeouts-%E8%BF%9E%E6%8E%A5%E8%B6%85%E6%97%B6">Connection Timeouts (è¿æ¥è¶…æ—¶)</a></li>
</ul>
</li>
<li><a href="#using-clientwebsocket-%E4%BD%BF%E7%94%A8-clientwebsocket">Using <code>@ClientWebSocket</code> (ä½¿ç”¨ <code>@ClientWebSocket</code>)</a><ul>
<li><a href="#using-the-cli-%E4%BD%BF%E7%94%A8-cli-1">Using the CLI (ä½¿ç”¨ CLI)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#http2-support-http2-%E6%94%AF%E6%8C%81">HTTP&#x2F;2 Support (HTTP&#x2F;2 æ”¯æŒ)</a><ul>
<li><a href="#configuring-the-server-for-http2-%E4%B8%BA-http2-%E9%85%8D%E7%BD%AE-server">Configuring the Server for HTTP&#x2F;2 (ä¸º HTTP&#x2F;2 é…ç½® Server)</a></li>
<li><a href="#http2-server-push-support-http2-server-%E6%8E%A8%E9%80%81%E6%94%AF%E6%8C%81">HTTP&#x2F;2 Server Push Support (HTTP&#x2F;2 Server æ¨é€æ”¯æŒ)</a></li>
</ul>
</li>
<li><a href="#server-events-server-%E4%BA%8B%E4%BB%B6">Server Events (Server äº‹ä»¶)</a></li>
<li><a href="#configuring-the-http-server-%E9%85%8D%E7%BD%AE-http-server">Configuring the HTTP Server (é…ç½® HTTP Server)</a><ul>
<li><a href="#using-native-transports-%E4%BD%BF%E7%94%A8%E5%8E%9F%E7%94%9F%E4%BC%A0%E8%BE%93">Using Native Transports (ä½¿ç”¨åŸç”Ÿä¼ è¾“)</a></li>
<li><a href="#configuring-server-thread-pools-%E9%85%8D%E7%BD%AE-server-%E7%BA%BF%E7%A8%8B%E6%B1%A0">Configuring Server Thread Pools (é…ç½® Server çº¿ç¨‹æ± )</a><ul>
<li><a href="#blocking-operations-%E9%98%BB%E5%A1%9E%E5%BC%8F%E6%93%8D%E4%BD%9C">Blocking Operations (é˜»å¡å¼æ“ä½œ)</a></li>
</ul>
</li>
<li><a href="#configuring-the-netty-pipeline-%E9%85%8D%E7%BD%AE-netty-%E7%AE%A1%E9%81%93">Configuring the Netty Pipeline (é…ç½® Netty ç®¡é“)</a></li>
<li><a href="#configuring-cors-%E9%85%8D%E7%BD%AE%E8%B7%A8%E5%9F%9F%E8%AF%B7%E6%B1%82">Configuring CORS (é…ç½®è·¨åŸŸè¯·æ±‚)</a><ul>
<li><a href="#allowed-origins-%E5%85%81%E8%AE%B8%E7%9A%84%E6%BA%90">Allowed Origins (å…è®¸çš„æº)</a></li>
<li><a href="#allowed-methods-%E5%85%81%E8%AE%B8%E7%9A%84%E6%96%B9%E6%B3%95">Allowed Methods (å…è®¸çš„æ–¹æ³•)</a></li>
<li><a href="#allowed-headers-%E5%85%81%E8%AE%B8%E7%9A%84%E8%AF%B7%E6%B1%82%E5%A4%B4">Allowed Headers (å…è®¸çš„è¯·æ±‚å¤´)</a></li>
<li><a href="#exposed-headers-%E6%9A%B4%E9%9C%B2%E7%9A%84%E8%AF%B7%E6%B1%82%E5%A4%B4">Exposed Headers (æš´éœ²çš„è¯·æ±‚å¤´)</a></li>
<li><a href="#allow-credentials-%E5%85%81%E8%AE%B8-credentials">Allow Credentials (å…è®¸ Credentials)</a></li>
<li><a href="#max-age-%E6%9C%80%E5%A4%A7-age">Max age (æœ€å¤§ age)</a></li>
<li><a href="#multiple-header-values-%E5%A4%9A%E4%B8%AA-header-%E5%80%BC">Multiple Header Values (å¤šä¸ª Header å€¼)</a></li>
</ul>
</li>
<li><a href="#securing-the-server-with-https-%E4%BD%BF%E7%94%A8-https-%E4%BF%9D%E6%8A%A4-server">Securing the Server with HTTPS (ä½¿ç”¨ HTTPS ä¿æŠ¤ Server)</a><ul>
<li><a href="#using-a-valid-x509-certificate-%E4%BD%BF%E7%94%A8%E4%B8%80%E4%B8%AA%E6%9C%89%E6%95%88%E7%9A%84-x509-%E8%AF%81%E4%B9%A6">Using a valid x509 certificate (ä½¿ç”¨ä¸€ä¸ªæœ‰æ•ˆçš„ x509 è¯ä¹¦)</a></li>
</ul>
</li>
<li><a href="#using-java-keystore-%E4%BD%BF%E7%94%A8-java-keystore-jks">Using Java Keystore (ä½¿ç”¨ Java Keystore (JKS))</a><ul>
<li><a href="#refreshingreloading-https-certificates-%E5%88%B7%E6%96%B0%E9%87%8D%E8%BD%BD-https-%E8%AF%81%E4%B9%A6">Refreshing&#x2F;Reloading HTTPS Certificates (åˆ·æ–°&#x2F;é‡è½½ HTTPS è¯ä¹¦)</a></li>
</ul>
</li>
<li><a href="#enabling-http-and-https-%E5%90%8C%E6%97%B6%E5%BC%80%E5%90%AF-http-%E5%92%8C-https">Enabling HTTP and HTTPS (åŒæ—¶å¼€å¯ HTTP å’Œ HTTPS)</a></li>
<li><a href="#enabling-access-logger-%E5%BC%80%E5%90%AF%E8%AE%BF%E9%97%AE%E6%97%A5%E5%BF%97">Enabling Access Logger (å¼€å¯è®¿é—®æ—¥å¿—)</a><ul>
<li><a href="#filtering-access-logs-%E8%BF%87%E6%BB%A4%E8%AE%BF%E9%97%AE%E6%97%A5%E5%BF%97">Filtering access logs (è¿‡æ»¤è®¿é—®æ—¥å¿—)</a></li>
<li><a href="#logback-configuration-logback-%E9%85%8D%E7%BD%AE">Logback Configuration (Logback é…ç½®)</a></li>
<li><a href="#log-format-%E6%97%A5%E5%BF%97%E6%A0%BC%E5%BC%8F">Log Format (æ—¥å¿—æ ¼å¼)</a></li>
</ul>
</li>
<li><a href="#starting-secondary-servers-%E5%BC%80%E5%90%AF%E4%BA%8C%E7%BA%A7%E6%9C%8D%E5%8A%A1">Starting Secondary Servers (å¼€å¯äºŒçº§æœåŠ¡)</a></li>
</ul>
</li>
<li><a href="#server-side-view-rendering-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E8%A7%86%E5%9B%BE%E6%B8%B2%E6%9F%93">Server Side View Rendering (æœåŠ¡å™¨ç«¯è§†å›¾æ¸²æŸ“)</a></li>
<li><a href="#openapi--swagger-support-openapi--swagger-%E6%94%AF%E6%8C%81">OpenAPI &#x2F; Swagger Support (OpenAPI &#x2F; Swagger æ”¯æŒ)</a></li>
<li><a href="#graphql-support-graphql-%E6%94%AF%E6%8C%81">GraphQL Support (GraphQL æ”¯æŒ)</a></li>
</ul>
</li>
</ul>
<!-- /TOC -->

<h1 id="The-HTTP-Server"><a href="#The-HTTP-Server" class="headerlink" title="The HTTP Server"></a>The HTTP Server</h1><p><strong>å£°æ˜</strong>:</p>
<ul>
<li>æœ¬æ–‡ç”±æœ¬äººç¿»è¯‘è‡ª<a class="link"   target="_blank" rel="noopener" href="https://docs.micronaut.io/latest/guide" >å®˜æ–¹æ–‡æ¡£<i class="fas fa-external-link-alt"></i></a></li>
<li>éƒ¨åˆ†å†…å®¹å¯èƒ½ä¼šæœ‰ä¿®æ”¹æˆ–åˆ å‡, ä¸€åˆ‡ä»¥å®˜æ–¹æ–‡æ¡£ä¸ºå‡†.</li>
<li>æœ¬æ–‡ç¿»è¯‘æ—¶ Micronaut ç‰ˆæœ¬ä¸º 3.4.2</li>
</ul>
<p>å¦‚æœä½¿ç”¨ <code>create-app</code> å‘½ä»¤åˆ›å»ºé¡¹ç›®, é‚£ä¹ˆé»˜è®¤åŒ…å« <code>http-server</code> ä¾èµ–</p>
<p>Micronaut åŒ…å«äº†åŸºäº Netty çš„éé˜»å¡ HTTP Server å’Œ Client API</p>
<p>Micronaut ä¸­ HTTP Server çš„è®¾è®¡æ˜¯ä¸ºäº†åœ¨å¾®æœåŠ¡ä¹‹é—´äº¤æ¢ä¿¡æ¯è€Œä¼˜åŒ–çš„, ç‰¹åˆ«æ˜¯ä½¿ç”¨ JSON</p>
<p>Micronaut ä¸æ˜¯ä¸ºäº†æˆä¸ºä¸€ä¸ªå®Œå…¨çš„æœåŠ¡ç«¯ MVC æ¡†æ¶</p>
<p>HTTP Server çš„ç›®æ ‡æ˜¯å°½å¯èƒ½å®¹æ˜“åœ°æš´éœ²ä¾› HTTP å®¢æˆ·ç«¯ä½¿ç”¨çš„ API, ä¸ç®¡å®ƒä»¬æ˜¯ç”¨ä»€ä¹ˆè¯­è¨€å†™çš„</p>
<p>è¦ä½¿ç”¨ HTTP Server ä½ éœ€è¦åœ¨æ„å»ºä¸­æ·»åŠ  <code>http-server-netty</code> ä¾èµ–:</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation(<span class="string">&quot;io.micronaut:micronaut-http-server-netty&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="Running-the-Embedded-Server-è¿è¡Œå†…åµŒçš„-Server"><a href="#Running-the-Embedded-Server-è¿è¡Œå†…åµŒçš„-Server" class="headerlink" title="Running the Embedded Server (è¿è¡Œå†…åµŒçš„ Server)"></a>Running the Embedded Server (è¿è¡Œå†…åµŒçš„ Server)</h2><p>ä¸ºäº†è¿è¡Œ Server, åˆ›å»ºä¸€ä¸ªæœ‰ <code>static void main</code> æ–¹æ³•çš„ <code>Application</code> ç±»:</p>
<p>Example - Micronaut Application Class:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.runtime.Micronaut</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">void</span> main(String... args) &#123;</span><br><span class="line">        Micronaut.run Application</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¦åœ¨å•å…ƒæµ‹è¯•ä¸­è¿è¡Œåº”ç”¨ç¨‹åº, ä½¿ç”¨ <code>EmbeddedServer</code> æ¥å£:</p>
<p>Example - Micronaut Test Case:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.http.HttpRequest</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.client.HttpClient</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.client.annotation.Client</span><br><span class="line"><span class="keyword">import</span> io.micronaut.runtime.server.EmbeddedServer</span><br><span class="line"><span class="keyword">import</span> io.micronaut.test.extensions.spock.annotation.MicronautTest</span><br><span class="line"><span class="keyword">import</span> spock.lang.Specification</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jakarta.inject.Inject</span><br><span class="line"></span><br><span class="line"><span class="meta">@MicronautTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HelloControllerSpec</span> <span class="keyword">extends</span> <span class="title class_">Specification</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="meta">@AutoCleanup</span></span><br><span class="line">    EmbeddedServer embeddedServer   <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="meta">@Client</span>(<span class="string">&quot;/&quot;</span>)</span><br><span class="line">    HttpClient client               <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line">    <span class="type">void</span> <span class="string">&#x27;test hello world response&#x27;</span>() &#123;</span><br><span class="line">        <span class="symbol">expect:</span></span><br><span class="line">            client.toBlocking()     <span class="comment">// 3</span></span><br><span class="line">                  .retrieve(HttpRequest.GET(<span class="string">&#x27;/hello&#x27;</span>)) == <span class="string">&#x27;Hello World&#x27;</span> <span class="comment">// 4</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>1</code> : The <code>EmbeddedServer</code> is run and the Spock <code>@AutoCleanup</code> annotation ensures the server is stopped after the specification completes</p>
<p><code>2</code> : The <code>EmbeddedServer</code> interface provides the <code>URL</code> of the server under test which runs on a random port</p>
<p><code>3</code> : The test uses the Micronaut HTTP client to make the call</p>
<p><code>4</code> : The <code>retrieve</code> method returns the response of the controller as a <code>String</code></p>
<p>å¦‚æœæ²¡æœ‰æ˜ç¡®çš„ç«¯å£é…ç½®, é‚£ä¹ˆç«¯å£å·é»˜è®¤ä¸º <code>8080</code></p>
<p>å¦‚æœæ˜¯åœ¨ <code>test</code> ç¯å¢ƒä¸‹è¿è¡Œåº”ç”¨, ç«¯å£å·å°†ä¼šæ˜¯éšæœºçš„</p>
<p>å½“åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä»æµ‹è¯•ç±»çš„ä¸Šä¸‹æ–‡å¯åŠ¨æ—¶, <code>test</code> ç¯å¢ƒå°†ä¼šè‡ªåŠ¨æ·»åŠ </p>
<h2 id="Running-Server-on-a-Specific-Port-åœ¨æŒ‡å®šç«¯å£ä¸Šè¿è¡Œ-Server"><a href="#Running-Server-on-a-Specific-Port-åœ¨æŒ‡å®šç«¯å£ä¸Šè¿è¡Œ-Server" class="headerlink" title="Running Server on a Specific Port (åœ¨æŒ‡å®šç«¯å£ä¸Šè¿è¡Œ Server)"></a>Running Server on a Specific Port (åœ¨æŒ‡å®šç«¯å£ä¸Šè¿è¡Œ Server)</h2><p>é»˜è®¤æƒ…å†µä¸‹, Server è¿è¡Œåœ¨ <code>8080</code> ç«¯å£</p>
<p>é€šè¿‡å¦‚ä¸‹é…ç½®æŒ‡å®šè¿è¡Œçš„ç«¯å£å·:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">server:</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">8086</span></span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡æ¥é…ç½®: <code>MICRONAUT_SERVER_PORT=8086</code></p>
<p>é…ç½®è¿è¡Œåœ¨éšæœºç«¯å£:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">server:</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">-1</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœå¤šä¸ª Server åŒæ—¶å¯åŠ¨åœ¨åŒä¸€ä¸ªç«¯å£, è®¾ç½®ä¸€ä¸ªæ˜ç¡®çš„ç«¯å£å¯èƒ½å¯¼è‡´æµ‹è¯•å¤±è´¥, ä¸ºäº†é˜²æ­¢è¿™æ ·, åœ¨ <code>test</code> ç¯å¢ƒé…ç½®å£°æ˜ä¸€ä¸ªéšæœºç«¯å£</p>
<h2 id="HTTP-Routing-HTTP-è·¯ç”±"><a href="#HTTP-Routing-HTTP-è·¯ç”±" class="headerlink" title="HTTP Routing (HTTP è·¯ç”±)"></a>HTTP Routing (HTTP è·¯ç”±)</h2><h3 id="URI-Paths-URI-è·¯å¾„"><a href="#URI-Paths-URI-è·¯å¾„" class="headerlink" title="URI Paths (URI è·¯å¾„)"></a>URI Paths (URI è·¯å¾„)</h3><blockquote>
<p>The value of the @Controller annotation is a RFC-6570 URI template, so you can embed URI variables within the path using the syntax defined by the URI template specification.</p>
</blockquote>
<p><code>@Controller</code> æ³¨è§£çš„å€¼æ˜¯ä¸€ä¸ª <code>RFC-6570 URI template</code>, æ‰€ä»¥ä½ å¯ä»¥ä½¿ç”¨ <code>URI template</code> è§„èŒƒå®šä¹‰çš„è¯­æ³•æ¥å†…åµŒ URI å˜é‡åˆ°è·¯å¾„ä¸­</p>
<p>è®¸å¤šå…¶ä»–çš„æ¡†æ¶, åŒ…æ‹¬ Spring, å®ç°äº† <code>URI template</code> è§„èŒƒ</p>
<p>å®é™…çš„å®ç°æ˜¯ç”± <code>UriMatchTemplate</code> ç±»å¤„ç†çš„, è¯¥ç±»æ‰©å±•äº† <code>UriTemplate</code></p>
<p>ä½ å¯ä»¥åœ¨åº”ç”¨ä¸­ä½¿ç”¨è¿™ä¸ªç±»æ¥æ„å»º URI, ä¾‹å¦‚:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">given:</span></span><br><span class="line">UriMatchTemplate template = UriMatchTemplate.of(<span class="string">&quot;/hello/&#123;name&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="attr">expect:</span></span><br><span class="line">template.match(<span class="string">&quot;/hello/John&quot;</span>).isPresent()           <span class="comment">// 1</span></span><br><span class="line">template.expand([<span class="string">&quot;name&quot;</span>: <span class="string">&quot;John&quot;</span>]) == <span class="string">&quot;/hello/John&quot;</span>  <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>

<p><code>1</code> : Use the <code>match</code> method to match a path</p>
<p><code>2</code> : Use the <code>expand</code> method to expand a template into a URI</p>
<p>å¯ä»¥ä½¿ç”¨ <code>UriTemplate</code> ç±»æ¥æ„å»ºè·¯å¾„, ç”¨æ¥åŒ…å«åˆ°å“åº”ä¸­</p>
<h3 id="URI-Path-Variables-URI-è·¯å¾„å˜é‡"><a href="#URI-Path-Variables-URI-è·¯å¾„å˜é‡" class="headerlink" title="URI Path Variables (URI è·¯å¾„å˜é‡)"></a>URI Path Variables (URI è·¯å¾„å˜é‡)</h3><p>URI å˜é‡å¯ä»¥é€šè¿‡æ–¹æ³•å‚æ•°æ¥å¼•ç”¨</p>
<p>Example - URI Variables:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Controller</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Get</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.PathVariable</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">&#x27;/issues&#x27;</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">IssuesController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Get</span>(<span class="string">&#x27;/&#123;number&#125;&#x27;</span>)   <span class="comment">// a URI variables embedded in the URI named `number`</span></span><br><span class="line">    String issue(<span class="meta">@PathVariable</span> Integer number) &#123;    <span class="comment">// The method argument can optionally be annotated with @PathVariable</span></span><br><span class="line">        <span class="string">&quot;Issue # $number !&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Example - Testing URI Variables:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.context.ApplicationContext</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.client.HttpClient</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.client.exceptions.HttpClientResponseException</span><br><span class="line"><span class="keyword">import</span> io.micronaut.runtime.server.EmbeddedServer</span><br><span class="line"><span class="keyword">import</span> spock.lang.AutoCleanup</span><br><span class="line"><span class="keyword">import</span> spock.lang.Shared</span><br><span class="line"><span class="keyword">import</span> spock.lang.Specification</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">IssuesControllerTest</span> <span class="keyword">extends</span> <span class="title class_">Specification</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Shared</span></span><br><span class="line">    <span class="meta">@AutoCleanup</span> <span class="comment">// The server is cleaned up after the tests finish</span></span><br><span class="line">    EmbeddedServer embeddedServer = ApplicationContext.run(EmbeddedServer) <span class="comment">// The embedded server is started</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Shared</span></span><br><span class="line">    <span class="meta">@AutoCleanup</span> <span class="comment">// The client is cleaned up after the test finish</span></span><br><span class="line">    HttpClient client = HttpClient.create(embeddedServer.URL) <span class="comment">// The HTTP client is started</span></span><br><span class="line"></span><br><span class="line">    <span class="type">void</span> <span class="string">&quot;test issue&quot;</span>() &#123;</span><br><span class="line">        <span class="symbol">when:</span></span><br><span class="line">        String body = client.toBlocking().retrieve(<span class="string">&quot;/issues/12&quot;</span>) <span class="comment">// The tests send a request to the URI `/issues/12`</span></span><br><span class="line"></span><br><span class="line">        <span class="symbol">then:</span></span><br><span class="line">        body != <span class="literal">null</span></span><br><span class="line">        body == <span class="string">&quot;Issue # 12!&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">void</span> <span class="string">&quot;/issues/&#123;number&#125; with an invalid Integer number responds 400&quot;</span>() &#123;</span><br><span class="line">        <span class="symbol">when:</span></span><br><span class="line">        client.toBlocking().exchange(<span class="string">&quot;/issues/hello&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="symbol">then:</span></span><br><span class="line">        <span class="keyword">def</span> e = thrown(HttpClientResponseException)</span><br><span class="line">        e.status.code == <span class="number">400</span> <span class="comment">// Another test asserts a 400 response is returned when an invalid number is sent in the URL</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">void</span> <span class="string">&quot;/issues/&#123;number&#125; without number responds 404&quot;</span>() &#123;</span><br><span class="line">        <span class="symbol">when:</span></span><br><span class="line">        client.toBlocking().exchange(<span class="string">&quot;/issues/&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="symbol">then:</span></span><br><span class="line">        <span class="keyword">def</span> e = thrown(HttpClientResponseException)</span><br><span class="line">        e.status.code == <span class="number">404</span> <span class="comment">// The variables being present is required for the route to be executed</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ URI template ä¾‹å­ä¸­çš„ <code>number</code> å˜é‡æ˜¯å¿…é€‰çš„</p>
<p>å¯ä»¥ä½¿ç”¨å¦‚ä¸‹è¯­æ³•æŒ‡å®šå¯é€‰çš„ URI template: <code>/issues&#123;/number&#125;</code>, å¹¶ä½¿ç”¨ <code>@Nullable</code> æ³¨è§£ä¿®é¥° <code>number</code> æ–¹æ³•å‚æ•°</p>
<p>Table - URI Template Matching:</p>
<table>
<thead>
<tr>
<th align="left">Template</th>
<th align="left">Description</th>
<th align="left">Matching URI</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>/books/&#123;id&#125;</code></td>
<td align="left">Simple match</td>
<td align="left"><code>/books/1</code></td>
</tr>
<tr>
<td align="left"><code>/books/&#123;id:2&#125;</code></td>
<td align="left">A variable of two characters max</td>
<td align="left"><code>/books/10</code></td>
</tr>
<tr>
<td align="left"><code>/books&#123;/id&#125;</code></td>
<td align="left">An optional URI variable</td>
<td align="left"><code>/books/10</code> or <code>/books</code></td>
</tr>
<tr>
<td align="left"><code>/book&#123;/id:[a-zA-Z]+&#125;</code></td>
<td align="left">An optional URI variable with regex</td>
<td align="left"><code>/books/foo</code></td>
</tr>
<tr>
<td align="left"><code>/books&#123;?max,offset&#125;</code></td>
<td align="left">Optional query parameters</td>
<td align="left"><code>/books?max=10&amp;offset=10</code></td>
</tr>
<tr>
<td align="left"><code>/books&#123;/path:.*&#125;&#123;.ext&#125;</code></td>
<td align="left">Regex path match with extension</td>
<td align="left"><code>/books/foo/bar.xml</code></td>
</tr>
</tbody></table>
<h3 id="URI-Reserved-Character-Matching-URI-ä¿ç•™å­—ç¬¦åŒ¹é…"><a href="#URI-Reserved-Character-Matching-URI-ä¿ç•™å­—ç¬¦åŒ¹é…" class="headerlink" title="URI Reserved Character Matching (URI ä¿ç•™å­—ç¬¦åŒ¹é…)"></a>URI Reserved Character Matching (URI ä¿ç•™å­—ç¬¦åŒ¹é…)</h3><p>é»˜è®¤æƒ…å†µä¸‹, <code>RFC-6570 URI template</code> è§„èŒƒå®šä¹‰çš„ URI å˜é‡ä¸èƒ½åŒ…å«ä¿ç•™å­—ç¬¦, ä¾‹å¦‚ <code>/</code>, <code>?</code>ç­‰</p>
<blockquote>
<p>you can use reserved expansion or matching using the + operator.</p>
</blockquote>
<p>ä½ å¯ä»¥ä½¿ç”¨ä¿ç•™å±•å¼€æˆ–ä½¿ç”¨æ“ä½œç¬¦åŒ¹é…</p>
<p>ä¾‹å¦‚ URI (<code>/books/&#123;+path&#125;</code>) åŒæ—¶åŒ¹é… <code>/books/foo</code> å’Œ <code>/books/foo/bar</code>, å› ä¸º <code>+</code> è¡¨æ˜å˜é‡ <code>path</code> åº”è¯¥åŒ…æ‹¬ä¿ç•™å­—ç¬¦</p>
<h3 id="Routing-Annotations-è·¯ç”±æ³¨è§£"><a href="#Routing-Annotations-è·¯ç”±æ³¨è§£" class="headerlink" title="Routing Annotations (è·¯ç”±æ³¨è§£)"></a>Routing Annotations (è·¯ç”±æ³¨è§£)</h3><p>Table - HTTP Routing Annotations:</p>
<table>
<thead>
<tr>
<th align="left">Annotation</th>
<th align="left">HTTP Method</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>@Delete</code></td>
<td align="left">DELETE</td>
</tr>
<tr>
<td align="left"><code>@Get</code></td>
<td align="left">GET</td>
</tr>
<tr>
<td align="left"><code>@Head</code></td>
<td align="left">HEAD</td>
</tr>
<tr>
<td align="left"><code>@Options</code></td>
<td align="left">OPTIONS</td>
</tr>
<tr>
<td align="left"><code>@Patch</code></td>
<td align="left">PATCH</td>
</tr>
<tr>
<td align="left"><code>@Put</code></td>
<td align="left">PUT</td>
</tr>
<tr>
<td align="left"><code>@Post</code></td>
<td align="left">POST</td>
</tr>
<tr>
<td align="left"><code>@Trace</code></td>
<td align="left">TRACE</td>
</tr>
</tbody></table>
<blockquote>
<p>All the method annotations default to <code>/</code></p>
</blockquote>
<p>æ‰€æœ‰çš„æ–¹æ³•æ³¨è§£é»˜è®¤ä¸º <code>/</code></p>
<h3 id="Multiple-URIs-å¤šä¸ª-URI"><a href="#Multiple-URIs-å¤šä¸ª-URI" class="headerlink" title="Multiple URIs (å¤šä¸ª URI)"></a>Multiple URIs (å¤šä¸ª URI)</h3><p>æ¯ä¸ªè·¯ç”±æ³¨è§£éƒ½æ”¯æŒå¤šä¸ª URI template</p>
<p>å¯¹äºæ¯ä¸ª template, ä¼šåˆ›å»ºä¸€ä¸ªè·¯ç”±</p>
<p>è¿™ä¸ªç‰¹æ€§å¯¹äºè¦ä¿®æ”¹ API çš„è·¯å¾„éå¸¸æœ‰ç”¨, è¿™å¯ä»¥ä¿æŒå·²æœ‰è·¯å¾„ä½œä¸ºå‘åå…¼å®¹</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Controller</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Get</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">&quot;/hello&quot;</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BackwardCompatibleController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Get</span>(uris = [<span class="string">&quot;/&#123;name&#125;&quot;</span>, <span class="string">&quot;/person/&#123;name&#125;&quot;</span>])</span><br><span class="line">    String hello(String name) &#123;</span><br><span class="line">        <span class="string">&quot;Hello, $name&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Route validation is more complicated with multiple templates. If a variable that would normally be required does not exist in all templates, that variable is considered optional since it may not exist for every execution of the method.</p>
</blockquote>
<p>åœ¨å¤šä¸ª template çš„æƒ…å†µä¸‹è·¯ç”±æ ¡éªŒä¼šæ›´åŠ å¤æ‚. å¦‚æœä¸€ä¸ªå˜é‡é€šå¸¸åº”è¯¥æ˜¯å¿…é€‰çš„ä½†æ˜¯åˆä¸å­˜åœ¨äºæ‰€æœ‰çš„ template ä¸­, é‚£è¿™ä¸ªå˜é‡è¢«è®¤ä¸ºæ˜¯å¯é€‰çš„, å› ä¸ºå®ƒå¯èƒ½ä¸æ˜¯åœ¨æ¯æ¬¡æ‰§è¡Œæ–¹æ³•æ—¶éƒ½å­˜åœ¨</p>
<h3 id="Building-Routes-Programmatically-ç¼–ç¨‹å¼åœ°æ„å»ºè·¯ç”±"><a href="#Building-Routes-Programmatically-ç¼–ç¨‹å¼åœ°æ„å»ºè·¯ç”±" class="headerlink" title="Building Routes Programmatically (ç¼–ç¨‹å¼åœ°æ„å»ºè·¯ç”±)"></a>Building Routes Programmatically (ç¼–ç¨‹å¼åœ°æ„å»ºè·¯ç”±)</h3><p>å¦‚æœä½ ä¸å–œæ¬¢ä½¿ç”¨æ³¨è§£, è€Œæ˜¯å–œæ¬¢åœ¨ä»£ç ä¸­å£°æ˜æ‰€æœ‰è·¯ç”±, é‚£ä¹ˆä¸ç”¨æ‹…å¿ƒ, Micronaut æœ‰ä¸€ä¸ªçµæ´»çš„ <code>RouteBuilder</code> API å¯ä»¥è½»æ¾åœ°é€šè¿‡ç¼–ç¨‹å®šä¹‰è·¯ç”±</p>
<p>ç»§æ‰¿ <code>DefaultRouteBuilder</code> å¹¶æ³¨å…¥è¦è¿›è¡Œè·¯ç”±çš„ Controller åˆ°æ–¹æ³•ä¸­, ç„¶åå®šä¹‰è·¯ç”±:</p>
<p>Example - URI Variables:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.context.ExecutionHandleLocator</span><br><span class="line"><span class="keyword">import</span> io.micronaut.core.convert.ConversionService</span><br><span class="line"><span class="keyword">import</span> io.micronaut.web.router.GroovyRouteBuilder</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jakarta.inject.Inject</span><br><span class="line"><span class="keyword">import</span> jakarta.inject.Singleton</span><br><span class="line"></span><br><span class="line"><span class="meta">@Singleton</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyRoutes</span> <span class="keyword">extends</span> <span class="title class_">GroovyRouteBuilder</span> &#123;     <span class="comment">// è·¯ç”±å®šä¹‰å¿…é¡»æ˜¯ DefaultRouteBuilder çš„å­ç±»</span></span><br><span class="line"></span><br><span class="line">    MyRoutes(ExecutionHandleLocator executionHandleLocator,</span><br><span class="line">             UriNamingStrategy uriNamingStrategy,</span><br><span class="line">             ConversionService conversionService) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(executionHandleLocator, uriNamingStrategy, conversionService)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span>     <span class="comment">// ä½¿ç”¨ @Inject æ³¨è§£æ³¨å…¥ Controller åˆ°æ–¹æ³•å‚æ•°ä¸­</span></span><br><span class="line">    <span class="type">void</span> issuesRoutes(IssuesController issuesController) &#123;</span><br><span class="line">        GET(<span class="string">&quot;/issues/show/&#123;number&#125;&quot;</span>, issuesController.&amp;issue)      <span class="comment">// å¿…é¡»ä½¿ç”¨å…¨è·¯å¾„, å› ä¸ºåœ¨è¿™é‡Œå¹¶ä¸çŸ¥é“ @Controller æ³¨è§£ä¸­å®šä¹‰çš„å€¼</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸å¹¸çš„æ˜¯, å› ä¸ºç±»å‹æ“¦é™¤, ä¸€ä¸ª Java æ–¹æ³• lambda å¼•ç”¨ä¸èƒ½å’Œ API ä¸€èµ·ä½¿ç”¨, æ‰€ä»¥åœ¨ Java ä¸­è¿™ä¸ªä¾‹å­æ˜¯è¿™æ ·çš„: <code>GET(&quot;/issues/show/&#123;number&#125;&quot;, issuesController, &quot;issue&quot;, Integer.class);</code></p>
<p>åœ¨ Groovy ä¸­æœ‰ä¸€ä¸ª <code>GroovyRouteBuilder</code> ç±»å¯ä»¥è¢«ç»§æ‰¿, å¹¶å…è®¸ä¼ é€’ Groovy æ–¹æ³•åº”ç”¨</p>
<h3 id="Route-Compile-Time-Validation-è·¯ç”±ç¼–è¯‘æ—¶æ ¡éªŒ"><a href="#Route-Compile-Time-Validation-è·¯ç”±ç¼–è¯‘æ—¶æ ¡éªŒ" class="headerlink" title="Route Compile-Time Validation (è·¯ç”±ç¼–è¯‘æ—¶æ ¡éªŒ)"></a>Route Compile-Time Validation (è·¯ç”±ç¼–è¯‘æ—¶æ ¡éªŒ)</h3><p>Micronaut æ”¯æŒä½¿ç”¨æ ¡éªŒåº“åœ¨ç¼–è¯‘æ—¶æ ¡éªŒè·¯ç”±å‚æ•°</p>
<p>é¦–å…ˆ, åœ¨ä½ çš„æ„å»ºä¸­æ·»åŠ  <code>validation</code> ä¾èµ–:</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// build.gradle</span></span><br><span class="line">annotationProccessor <span class="string">&quot;io.micronaut:micronaut-validation&quot;</span>    <span class="comment">// Java Only</span></span><br><span class="line">kapt <span class="string">&quot;io.micronaut:micronaut-validation&quot;</span>                    <span class="comment">// Kotlin Only</span></span><br><span class="line">implementation <span class="string">&quot;io.micronaut:micronaut-validation&quot;</span></span><br></pre></td></tr></table></figure>

<p>æœ‰äº†æ­£ç¡®çš„ä¾èµ–åœ¨ classpath ä¸Š, è·¯ç”±å‚æ•°å°†ä¼šåœ¨ç¼–è¯‘æ—¶è¢«è‡ªåŠ¨æ ¡éªŒ</p>
<p>åœ¨å¦‚ä¸‹æƒ…å†µä¸­, ç¼–è¯‘å°†ä¼šå¤±è´¥:</p>
<ul>
<li>URI template ä¸­åŒ…å«äº†ä¸€ä¸ªå¯é€‰çš„å˜é‡, ä½†æ˜¯æ–¹æ³•å‚æ•°æ²¡æœ‰ä½¿ç”¨ <code>@Nullable</code> æ³¨è§£ä¿®é¥°æˆ–è€…ä½¿ç”¨ <code>java.util.Optional</code> åŒ…è£…</li>
<li>URI template åŒ…å«ä¸€ä¸ªæ–¹æ³•ä¸­æ²¡æœ‰å¯¹åº”å‚æ•°çš„å˜é‡</li>
</ul>
<h3 id="Routing-non-standard-HTTP-methods-è·¯ç”±éæ ‡å‡†-HTTP-æ–¹æ³•"><a href="#Routing-non-standard-HTTP-methods-è·¯ç”±éæ ‡å‡†-HTTP-æ–¹æ³•" class="headerlink" title="Routing non-standard HTTP methods (è·¯ç”±éæ ‡å‡† HTTP æ–¹æ³•)"></a>Routing non-standard HTTP methods (è·¯ç”±éæ ‡å‡† HTTP æ–¹æ³•)</h3><p><code>@CustomHttpMethod</code> æ³¨è§£æ”¯æŒéæ ‡å‡† HTTP æ–¹æ³•, å¹¶å¯ä½¿ç”¨äº Client æˆ– Server</p>
<p>ä¾‹å¦‚, <code>RFC-4918 Webadv</code> è§„èŒƒè¦æ±‚é¢å¤–çš„æ–¹æ³•, å¦‚ <code>REPORT</code> æˆ– <code>LOCK</code>:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CustomHttpMethod</span>(method = <span class="string">&quot;LOCK&quot;</span>, value = <span class="string">&quot;/&#123;name&#125;&quot;</span>)</span><br><span class="line">String lock(String name)</span><br></pre></td></tr></table></figure>

<p><code>@CustomHttpMethod</code> æ³¨è§£å¯ä»¥ä½¿ç”¨åœ¨ä»»ä½•åŸºç¡€æ–¹æ³•æ³¨è§£å¯ä»¥ä½¿ç”¨çš„åœ°æ–¹, åŒ…æ‹¬ Controller å’Œå£°æ˜å¼ HTTP å®¢æˆ·ç«¯</p>
<h2 id="Simple-Request-Binding-ç®€å•è¯·æ±‚ç»‘å®š"><a href="#Simple-Request-Binding-ç®€å•è¯·æ±‚ç»‘å®š" class="headerlink" title="Simple Request Binding (ç®€å•è¯·æ±‚ç»‘å®š)"></a>Simple Request Binding (ç®€å•è¯·æ±‚ç»‘å®š)</h2><h3 id="Binding-Annotations-ç»‘å®šæ³¨è§£"><a href="#Binding-Annotations-ç»‘å®šæ³¨è§£" class="headerlink" title="Binding Annotations (ç»‘å®šæ³¨è§£)"></a>Binding Annotations (ç»‘å®šæ³¨è§£)</h3><blockquote>
<p>All binding annotations support customization of the name of the variable being bound from with their name member.</p>
</blockquote>
<p>æ‰€æœ‰çš„ç»‘å®šæ³¨è§£éƒ½æ”¯æŒå°†è¢«ç»‘å®šçš„å˜é‡ä½¿ç”¨å®ƒä»¬çš„ <code>name</code> æˆå‘˜å±æ€§æ¥è¿›è¡Œåç§°è‡ªå®šä¹‰</p>
<p>Table - Parameter Binding Annotations:</p>
<table>
<thead>
<tr>
<th align="left">Annotation</th>
<th align="left">Description</th>
<th align="left">Example</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>@Body</code></td>
<td align="left">Binds from the body of the request</td>
<td align="left"><code>@Body</code> String body</td>
</tr>
<tr>
<td align="left"><code>@CookieValue</code></td>
<td align="left">Binds a parameter from a cookie</td>
<td align="left"><code>@CookieValue</code> String myCookie</td>
</tr>
<tr>
<td align="left"><code>@Header</code></td>
<td align="left">Binds a parameter from an HTTP header</td>
<td align="left"><code>@Header</code> String requestId</td>
</tr>
<tr>
<td align="left"><code>@QueryValue</code></td>
<td align="left">Binds from a request query parameter</td>
<td align="left"><code>@QueryValue</code> String myParam</td>
</tr>
<tr>
<td align="left"><code>@Part</code></td>
<td align="left">Binds from a part of a multiple request</td>
<td align="left"><code>@Part</code> CompletedFileUpload file</td>
</tr>
<tr>
<td align="left"><code>@RequestAttribute</code></td>
<td align="left">Binds from an attribute of the request. Attributes are typically created in filters</td>
<td align="left"><code>@RequestAttribute</code> String myAttribute</td>
</tr>
<tr>
<td align="left"><code>@PathVariable</code></td>
<td align="left">Binds from the path of the request</td>
<td align="left"><code>@PathVariable</code> String id</td>
</tr>
<tr>
<td align="left"><code>@RequestBean</code></td>
<td align="left">Binds any Bindable value to single Bean object</td>
<td align="left"><code>@RequestBean</code> MyBean bean</td>
</tr>
</tbody></table>
<p>åœ¨ä¸€ä¸ªç»‘å®šæ³¨è§£ä¸­æ²¡æœ‰æŒ‡å®šä¸€ä¸ª <code>value</code> æ—¶, å°†ä¼šä½¿ç”¨æ–¹æ³•å‚æ•°åç§°:</p>
<p>Example - ä¸‹é¢ä¾‹å­ä¸­ä¸¤ä¸ªå‚æ•°ç»‘å®šéƒ½æ˜¯ä¸€æ ·çš„æ•ˆæœ:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Get</span>(<span class="string">&quot;/cookieName&quot;</span>)</span><br><span class="line">String cookieName(<span class="meta">@CookieValue</span>(<span class="string">&quot;myCookie&quot;</span>) String myCookie) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Get</span>(<span class="string">&quot;/cookieInferred&quot;</span>)</span><br><span class="line">String cookieInferred(<span class="meta">@CookieValue</span> String myCookie)</span><br></pre></td></tr></table></figure>

<p>ç”±äºè¿å­—ç¬¦ä¸å¯ä»¥ä½¿ç”¨åœ¨å˜é‡åç§°ä¸­, æ‰€ä»¥æœ‰å¿…è¦åœ¨æ³¨è§£ä¸­è®¾ç½®åç§°:</p>
<p>Example - The following definitions are equivalent:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Get</span>(<span class="string">&quot;/headerName&quot;</span>)</span><br><span class="line">String headerName(<span class="meta">@Header</span>(<span class="string">&quot;Content-Type&quot;</span>) String contentType) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Get</span>(<span class="string">&quot;/headerInferred&quot;</span>)</span><br><span class="line">String headerInferred(<span class="meta">@Header</span> String contentType)</span><br></pre></td></tr></table></figure>

<h3 id="Stream-Support-Stream-æ”¯æŒ"><a href="#Stream-Support-Stream-æ”¯æŒ" class="headerlink" title="Stream Support (Stream æ”¯æŒ)"></a>Stream Support (Stream æ”¯æŒ)</h3><p>Micronaut è¿˜æ”¯æŒç»‘å®š body åˆ°ä¸€ä¸ª <code>InputStream</code> ä¸­</p>
<p>å¦‚æœæ–¹æ³•æ˜¯è¯»å–è¿™ä¸ª Stream, é‚£ä¹ˆè¿™ä¸ªæ–¹æ³•çš„æ‰§è¡Œè¦å¸è½½(offloaded)åˆ°å¦ä¸€ä¸ªçº¿ç¨‹æ± ä¸­, é¿å…é˜»å¡ event loop</p>
<p>Example - Performing Blocking I&#x2F;O With InputStream:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Post</span>(value = <span class="string">&quot;/read&quot;</span>, processes = MediaType.TEXT_PLAIN)</span><br><span class="line"><span class="meta">@ExecuteOn</span>(TaskExecutors.IO)    <span class="comment">// 1</span></span><br><span class="line">String read(<span class="meta">@Body</span> InputStream inputStream) <span class="keyword">throws</span> IOException &#123;     <span class="comment">// 2</span></span><br><span class="line">    IOUtils.readText(<span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(inputStream)))        <span class="comment">// 3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>1</code> : The controller method is executed on the IO thread pool</p>
<p><code>2</code> : The body is passed to the method as an input stream</p>
<p><code>3</code> : The stream is read</p>
<h3 id="Binding-from-Multiple-Query-values-ä½¿ç”¨å¤šä¸ªè¯·æ±‚å€¼è¿›è¡Œç»‘å®š"><a href="#Binding-from-Multiple-Query-values-ä½¿ç”¨å¤šä¸ªè¯·æ±‚å€¼è¿›è¡Œç»‘å®š" class="headerlink" title="Binding from Multiple Query values (ä½¿ç”¨å¤šä¸ªè¯·æ±‚å€¼è¿›è¡Œç»‘å®š)"></a>Binding from Multiple Query values (ä½¿ç”¨å¤šä¸ªè¯·æ±‚å€¼è¿›è¡Œç»‘å®š)</h3><p>ä¸å…¶ä»è¯·æ±‚çš„å•ä¸ªéƒ¨åˆ†ç»‘å®š, ä¸å¦‚å°†æ‰€æœ‰æŸ¥è¯¢å€¼(ä¾‹å¦‚)ç»‘å®šåˆ° POJO</p>
<p>å¯ä»¥é€šè¿‡åœ¨ URI template ä¸­ä½¿ç”¨åˆ†è§£æ“ä½œç¬¦ <code>?pojo*</code> æ¥å®ç°</p>
<p>Example - Binding Request parameters to POJO:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.http.HttpStatus</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Controller</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Get</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Nullable</span><br><span class="line"><span class="keyword">import</span> javax.validation.Valid</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">&quot;/api&quot;</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookmarkController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Get</span>(<span class="string">&quot;/bookmarks/list&#123;?paginationCommand*&#125;&quot;</span>)</span><br><span class="line">    HttpStatus list(<span class="meta">@Valid</span> <span class="meta">@Nullable</span> PaginationCommond paginationCommand) &#123;</span><br><span class="line">        HttpStatus.OK</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Binding-from-Multiple-Bindable-values-ä»å¤šä¸ªå¯ç»‘å®šå€¼ä¸­è¿›è¡Œç»‘å®š"><a href="#Binding-from-Multiple-Bindable-values-ä»å¤šä¸ªå¯ç»‘å®šå€¼ä¸­è¿›è¡Œç»‘å®š" class="headerlink" title="Binding from Multiple Bindable values (ä»å¤šä¸ªå¯ç»‘å®šå€¼ä¸­è¿›è¡Œç»‘å®š)"></a>Binding from Multiple Bindable values (ä»å¤šä¸ªå¯ç»‘å®šå€¼ä¸­è¿›è¡Œç»‘å®š)</h3><p>é™¤äº†ä»…ä»…ç»‘å®šæŸ¥è¯¢å€¼, è¿˜å¯ä»¥ç»‘å®šä»»ä½• å¯ç»‘å®šå€¼ åˆ°ä¸€ä¸ª POJO ä¸­(ä¾‹å¦‚, ç»‘å®š <code>HttpRequest</code>,<code>@PathVariable</code>,<code>@QueryValue</code>,<code>@Header</code> åˆ°ä¸€ä¸ª POJO ä¸­)</p>
<p>è¿™å¯ä»¥é€šè¿‡ä½¿ç”¨ <code>@RequestBean</code> æ³¨è§£å’Œä¸€ä¸ªè‡ªå®šä¹‰çš„ æ‹¥æœ‰å¯ç»‘å®šæ³¨è§£çš„å­—æ®µçš„ æˆ– å­—æ®µå¯é€šè¿‡ç±»å‹(ä¾‹å¦‚, <code>HttpRequest</code>,<code>BasicAuth</code>,<code>Authentication</code>)è¿›è¡Œç»‘å®šçš„ Bean ç±»æ¥å®ç°</p>
<p>Example - Binding Bindable values to POJO:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span>(<span class="string">&quot;/api&quot;</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MovieTicketController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Get</span>(<span class="string">&quot;/movie/ticket/&#123;movieId&#125;&#123;?minPrice,maxPrice&#125;&quot;</span>)</span><br><span class="line">    HttpStatus list(<span class="meta">@Valid</span> <span class="meta">@RequestBean</span> MovieTicketBean bean) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Bean definition</span></span><br><span class="line"><span class="meta">@Introspected</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MovieTicketBean</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> HttpRequest&lt;?&gt; httpRequest</span><br><span class="line"></span><br><span class="line">    @PathVariable</span><br><span class="line">    String movieId</span><br><span class="line"></span><br><span class="line">    @Nullable</span><br><span class="line">    @QueryValue</span><br><span class="line">    @PositiveOrZero</span><br><span class="line">    Double minPrice</span><br><span class="line"></span><br><span class="line">    @Nullable</span><br><span class="line">    @QueryValue</span><br><span class="line">    @PositiveOrZero</span><br><span class="line">    Double maxPrice</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Bean ç±»å¿…é¡»ä½¿ç”¨ <code>@Introspected</code> æ³¨è§£è¿›è¡Œä¿®é¥°</p>
<p>Bean å¯ä»¥æ˜¯å¦‚ä¸‹ä¹‹ä¸€:</p>
<ul>
<li>æ‹¥æœ‰ setter&#x2F;getter æ–¹æ³•çš„å¯å˜ç±»</li>
<li>æ‹¥æœ‰ getter æ–¹æ³•å’Œä¸€ä¸ªåŒ…å«æ‰€æœ‰å­—æ®µå…¥å‚çš„æ„é€ æ–¹æ³•(æˆ–è€… <code>@Creator</code> æ³¨è§£ä¿®é¥°çš„æ„é€ æ–¹æ³•å’Œé™æ€æ–¹æ³•). æ„é€ æ–¹æ³•çš„å…¥å‚å¿…é¡»ä¸å­—æ®µåç§°åŒ¹é…, ä»¥ä½¿å¯¹è±¡å¯ä»¥ä¸é€šè¿‡åå°„è¿›è¡Œå®ä¾‹åŒ–</li>
</ul>
<p>å› ä¸º Java æ²¡æœ‰åŒ…å«å‚æ•°åç§°åœ¨å­—èŠ‚ç ä¸­, ä½ åœ¨ä½¿ç”¨ä¸€ä¸ªæ¥è‡ªå…¶ä»– Jar æ–‡ä»¶ä¸­çš„ä¸å¯å˜ Bean ç±»æ—¶å¿…é¡»ä½¿ç”¨ <code>-parameters</code> å‚æ•°æ¥ç¼–è¯‘ä»£ç . å¦ä¸€ä¸ªé€‰é¡¹æ˜¯åœ¨ä½ çš„æºä»£ç ä¸­ç»§æ‰¿è¿™ä¸ª Bean ç±»</p>
<h3 id="Bindable-Types-å¯ç»‘å®šç±»å‹"><a href="#Bindable-Types-å¯ç»‘å®šç±»å‹" class="headerlink" title="Bindable Types (å¯ç»‘å®šç±»å‹)"></a>Bindable Types (å¯ç»‘å®šç±»å‹)</h3><p>é€šå¸¸, ä»»ä½•å¯ä»¥é€šè¿‡ <code>ConversionService API</code> ä»å­—ç¬¦ä¸²è¡¨ç¤ºè½¬æ¢ä¸º Java ç±»å‹çš„ç±»éƒ½å¯ä»¥è¿›è¡Œç»‘å®š</p>
<p>è¿™åŒ…å«äº†å¤§å¤šæ•°å¸¸ç”¨ Java ç±»å‹</p>
<p>å¯ä»¥é€šè¿‡æ·»åŠ ä½¿ç”¨ <code>@Singleton</code> æ³¨è§£ä¿®é¥°çš„ <code>TypeConverter</code> æ¥å£å®ç° Bean æ¥æ³¨å†Œé¢å¤–çš„ç±»å‹è½¬æ¢é€»è¾‘</p>
<p>Null å€¼å¤„ç†éœ€è¦ç‰¹åˆ«æ³¨æ„:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Get</span>(<span class="string">&quot;/headerInferred&quot;</span>)</span><br><span class="line">String headerInferred(<span class="meta">@Header</span> String contentType) &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œä¾‹å­ä¸­,  å¦‚æœ HTTP è¯·æ±‚çš„è¯·æ±‚å¤´ä¸­æ²¡æœ‰åŒ…å« <code>Content-Type</code>, æ‰€ä»¥è¿™ä¸ªè·¯ç”±è¢«è®¤ä¸ºæ˜¯æ— æ•ˆçš„, å› æ­¤å°†ä¼šè¿”å› HTTP 400 <code>BAD REQUEST</code></p>
<p>ç®€å•åœ°è¯´, <code>contentTyp</code> æ˜¯å¿…ä¼ çš„</p>
<p>ä¸ºäº†ä½¿ <code>Content-Type</code> è¯·æ±‚å¤´æ˜¯å¯é€‰çš„, å¯ä»¥ä½¿ç”¨ <code>@Nullable</code> æ³¨è§£æ¥è¿›è¡Œå£°æ˜:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Get</span>(<span class="string">&quot;/headerInferred&quot;</span>)</span><br><span class="line">String headerInferred(<span class="meta">@Nullable</span> <span class="meta">@Header</span> String contentType) &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>é™¤æ­¤ä¹‹å¤–, ä»»ä½•æ»¡è¶³ <code>RFC-1123</code> è§„èŒƒçš„ <code>DateTime</code> éƒ½å¯ä»¥ç»‘å®šåˆ°ä¸€ä¸ªå…¥å‚ä¸Š. å¯ä»¥ä½¿ç”¨ <code>@Format</code> æ³¨è§£æ¥æŒ‡å®šè‡ªå®šä¹‰çš„æ—¶é—´æ ¼å¼:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Get</span>(<span class="string">&quot;/date&quot;</span>)</span><br><span class="line">String date(<span class="meta">@Header</span> ZonedDateTime date) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Get</span>(<span class="string">&quot;/dateFormat&quot;</span>)</span><br><span class="line">String dateFormat(<span class="meta">@Format</span>(<span class="string">&quot;dd/MM/yyyy hh:mm:ss a z&quot;</span>) <span class="meta">@Header</span> ZonedDateTime date) &#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Type-Based-Binding-Parameters-åŸºäºç±»å‹çš„å‚æ•°ç»‘å®š"><a href="#Type-Based-Binding-Parameters-åŸºäºç±»å‹çš„å‚æ•°ç»‘å®š" class="headerlink" title="Type-Based Binding Parameters (åŸºäºç±»å‹çš„å‚æ•°ç»‘å®š)"></a>Type-Based Binding Parameters (åŸºäºç±»å‹çš„å‚æ•°ç»‘å®š)</h3><p>æœ‰äº›å‚æ•°åªè€ƒè™‘å®ƒä»¬çš„ç±»å‹è€Œä¸æ˜¯å®ƒä»¬çš„æ³¨è§£</p>
<table>
<thead>
<tr>
<th align="left">Type</th>
<th align="left">Description</th>
<th align="left">Example</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>BasicAuth</code></td>
<td align="left">Allows binding of basic authorization credentials</td>
<td align="left"><code>BasicAuth basicAuth</code></td>
</tr>
</tbody></table>
<h3 id="Variable-resolution-å˜é‡è§£æ"><a href="#Variable-resolution-å˜é‡è§£æ" class="headerlink" title="Variable resolution (å˜é‡è§£æ)"></a>Variable resolution (å˜é‡è§£æ)</h3><p>Micronaut å°è¯•é€šè¿‡å¦‚ä¸‹é¡ºåºæ¥å¡«å……æ–¹æ³•å‚æ•°:</p>
<ol>
<li>URI å˜é‡, ä¾‹å¦‚ <code>/&#123;id&#125;</code></li>
<li>å¦‚æœè¯·æ±‚æ˜¯ä¸€ä¸ª <code>GET</code> è¯·æ±‚, ä»è¯·æ±‚å‚æ•°ä¸­è·å–, ä¾‹å¦‚ <code>?foo=bar</code></li>
<li>å¦‚æœæœ‰ä¸€ä¸ª <code>@Body</code> æ³¨è§£å¹¶ä¸”è¯·æ±‚å…è®¸è¿™ä¸ª body, é‚£ä¹ˆç»‘å®šè¿™ä¸ª body åˆ° <code>@Body</code> æ³¨è§£ä¿®é¥°çš„å‚æ•°ä¸Š</li>
<li>å¦‚æœè¯·æ±‚å¯ä»¥æœ‰ body ä½†æ˜¯æ²¡æœ‰ä½¿ç”¨ <code>@Body</code> æ³¨è§£ä¿®é¥°å‚æ•°, é‚£ä¹ˆå°±å°è¯•è§£æ body(JSON æˆ– form data), å°†æ–¹æ³•å‚æ•°ç»‘å®šåˆ° body</li>
<li>æœ€å, å¦‚æœæ–¹æ³•å‚æ•°æ— æ³•è¢«å¡«å……, é‚£ä¹ˆå°±è¿”å› <code>400 BAD REQUEST</code></li>
</ol>
<h2 id="Custom-Argument-Binding-è‡ªå®šä¹‰å‚æ•°ç»‘å®š"><a href="#Custom-Argument-Binding-è‡ªå®šä¹‰å‚æ•°ç»‘å®š" class="headerlink" title="Custom Argument Binding (è‡ªå®šä¹‰å‚æ•°ç»‘å®š)"></a>Custom Argument Binding (è‡ªå®šä¹‰å‚æ•°ç»‘å®š)</h2><blockquote>
<p>Micronaut uses an ArgumentBinderRegistry to look up ArgumentBinder beans capable of binding to the arguments in controller methods.</p>
</blockquote>
<p>Micronaut ä½¿ç”¨ä¸€ä¸ª <code>ArgumentBinderRegistry</code> æ¥æŸ¥æ‰¾èƒ½å¤Ÿç»‘å®šåˆ° Controller æ–¹æ³•ä¸­çš„å‚æ•°çš„ <code>ArgumentBinder</code> Bean</p>
<blockquote>
<p>The default implementation looks for an annotation on the argument that is meta-annotated with @Bindable.</p>
</blockquote>
<p>é»˜è®¤çš„å®ç°æ˜¯å…ˆå¯»æ‰¾ä¿®é¥°å‚æ•°çš„ ä½¿ç”¨äº†<code>@Bindable</code>æ³¨è§£ä¿®é¥°çš„ æ³¨è§£</p>
<blockquote>
<p>If one exists the argument binder registry searches for an argument binder that supports that annotation.</p>
</blockquote>
<p>å¦‚æœæ‰¾åˆ°ä¸€ä¸ªä½¿ç”¨äº† <code>@Bindable</code> æ³¨è§£ä¿®é¥°çš„æ³¨è§£, é‚£ä¹ˆ <code>argument binder registry</code> å°†ä¼šå¯»æ‰¾ä¸€ä¸ªæ”¯æŒè¿™ä¸ªæ³¨è§£çš„ <code>argument binder</code></p>
<blockquote>
<p>If no fitting annotation is found Micronaut tries to find an argument binder that supports the argument type.</p>
</blockquote>
<p>å¦‚æœæ²¡æœ‰æ‰¾åˆ°ä½¿ç”¨ <code>@Bindable</code> æ³¨è§£ä¿®é¥°çš„æ³¨è§£, é‚£ä¹ˆ Micronaut å°†ä¼šå°è¯•å¯»æ‰¾ä¸€ä¸ªæ”¯æŒå‚æ•°ç±»å‹çš„ <code>argument binder</code></p>
<blockquote>
<p>An argument binder returns a ArgumentBinder.BindingResult.</p>
</blockquote>
<p>ä¸€ä¸ª <code>argument binder</code> è¿”å›ä¸€ä¸ª <code>ArgumentBinder.BindingResult</code></p>
<blockquote>
<p>The binding result gives Micronaut more information than just the value.</p>
</blockquote>
<p>è¿™ä¸ª <code>BindingResult</code> ç»™ Micronaut æä¾›äº†æ›´å¤šçš„ä¿¡æ¯è€Œä¸ä»…ä»…æ˜¯å€¼</p>
<blockquote>
<p>Binding results are either satisfied or unsatisfied, and either empty or not empty.</p>
</blockquote>
<p><code>BindingResult</code> ä¸æ˜¯ satisfied å°±æ˜¯ unsatisfied çš„, ä¸æ˜¯ empty å°±æ˜¯ not empty çš„</p>
<blockquote>
<p>If an argument binder returns an unsatisfied result, the binder may be called again at different times in request processing.</p>
</blockquote>
<p>å¦‚æœä¸€ä¸ª <code>argument binder</code> è¿”å›ä¸€ä¸ª unsatisfied ç»“æœ, è¿™ä¸ª binder å¯èƒ½ä¼šåœ¨å¤„ç†è¯·æ±‚çš„ä¸åŒæ—¶å€™è¢«å†æ¬¡è°ƒç”¨</p>
<blockquote>
<p>Argument binders are initially called before the body is read and before any filters are executed.</p>
</blockquote>
<p><code>argument binders</code> åœ¨ body è¢«è¯»å–å’Œåœ¨ä»»ä½• filter è¢«æ‰§è¡Œä¹‹å‰è¢«åˆå§‹åŒ–è°ƒç”¨</p>
<blockquote>
<p>If a binder relies on any of that data and it is not present, return a ArgumentBinder.BindingResult#UNSATISFIED result.</p>
</blockquote>
<p>å¦‚æœä¸€ä¸ª binder ä¾èµ–äºå…¶ä¸­çš„ä»»ä½•æ•°æ®, è€Œè¯¥æ•°æ®ä¸å­˜åœ¨, åˆ™è¿”å›ä¸€ä¸ª <code>ArgumentBinder.BindingResult#UNSATISFIED</code></p>
<blockquote>
<p>Returning an ArgumentBinder.BindingResult#EMPTY or satisfied result will be the final result and the binder will not be called again for that request.</p>
</blockquote>
<p>è¿”å›ä¸€ä¸ª <code>ArgumentBinder.BindingResult#EMPTY</code> æˆ–è€… satisfied result å°†æ˜¯æœ€ç»ˆçš„ result, åœ¨è¿™ä¸ªè¯·æ±‚ä¸­ binder ä¸ä¼šå†æ¬¡è¢«è°ƒç”¨</p>
<blockquote>
<p>At the end of processing if the result is still ArgumentBinder.BindingResult#UNSATISFIED, it is considered ArgumentBinder.BindingResult#EMPTY.</p>
</blockquote>
<p>åœ¨å¤„ç†çš„æœ€åå¦‚æœç»“æœä»ç„¶æ˜¯ <code>ArgumentBinder.BindingResult#UNSATISFIED</code>, è¿™è¢«è®¤ä¸ºæ˜¯ <code>ArgumentBinder.BindingResult#EMPTY</code></p>
<h3 id="AnnotatedRequestArgumentBinder-æ³¨è§£ä¿®é¥°çš„è¯·æ±‚å‚æ•°ç»‘å®š"><a href="#AnnotatedRequestArgumentBinder-æ³¨è§£ä¿®é¥°çš„è¯·æ±‚å‚æ•°ç»‘å®š" class="headerlink" title="AnnotatedRequestArgumentBinder (æ³¨è§£ä¿®é¥°çš„è¯·æ±‚å‚æ•°ç»‘å®š)"></a>AnnotatedRequestArgumentBinder (æ³¨è§£ä¿®é¥°çš„è¯·æ±‚å‚æ•°ç»‘å®š)</h3><blockquote>
<p>Argument binders that bind based on the presence of an annotation must implement AnnotatedRequestArgumentBinder, and can be used by creating an annotation that is annotated with Bindable.</p>
</blockquote>
<p>åŸºäºæ³¨è§£æ˜¯å¦å­˜åœ¨è¿›è¡Œç»‘å®šçš„ <code>argument binder</code> å¿…é¡»å®ç° <code>AnnotatedRequestArgumentBinder</code>, å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªè¢« <code>@Bindable</code> æ³¨è§£ä¿®é¥°çš„æ³¨è§£æ¥å®ç°</p>
<p>Example - An example of a binding annotation:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> groovy.transform.CompileStatic</span><br><span class="line"><span class="keyword">import</span> io.micronaut.context.annotation.AliasFor</span><br><span class="line"><span class="keyword">import</span> io.micronaut.core.bind.annotation.Bindable</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.annotation.ElementType.ANNOTATION_TYPE</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.annotation.ElementType.FIELD</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.annotation.ElementType.PARAMETER</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.annotation.RetentionPolicy.RUNTIME</span><br><span class="line"></span><br><span class="line"><span class="meta">@CompileStatic</span></span><br><span class="line"><span class="meta">@Target</span>([FIELD, PARAMETER, ANNOTATION_TYPE])</span><br><span class="line"><span class="meta">@Retention</span>(RUNTIME)</span><br><span class="line"><span class="meta">@Bindable</span> <span class="comment">// The bingding annotation must itself be annotated as Bindable</span></span><br><span class="line"><span class="meta">@interface</span> ShoppingCart &#123;</span><br><span class="line">    <span class="meta">@AliasFor</span>(annotation = Bindable, member = <span class="string">&quot;value&quot;</span>)</span><br><span class="line">    String value() <span class="keyword">default</span> <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Example - Example of annotated data binding:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> groovy.transform.CompileStatic</span><br><span class="line"><span class="keyword">import</span> io.micronaut.core.convert.ArgumentConversionContext</span><br><span class="line"><span class="keyword">import</span> io.micronaut.core.convert.ConversionService</span><br><span class="line"><span class="keyword">import</span> io.micronaut.core.type.Argument</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.HttpRequest</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.bind.binders.AnnotatedRequestArgumentBinder</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.cookie.Cookie</span><br><span class="line"><span class="keyword">import</span> io.micronaut.jackson.serialize.JacksonObjectSerializer</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jakarta.inject.Singleton</span><br><span class="line"></span><br><span class="line"><span class="meta">@CompileStatic</span></span><br><span class="line"><span class="meta">@Singleton</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ShoppingCartRequestArgumentBinder</span></span><br><span class="line">        <span class="keyword">implements</span> <span class="title class_">AnnotatedRequestArgumentBinder</span>&lt;ShoppingCart, Object&gt; &#123; <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ConversionService&lt;?&gt; conversionService</span><br><span class="line">    private final JacksonObjectSerializer objectSerializer</span><br><span class="line"></span><br><span class="line">    ShoppingCartRequestArgumentBinder(</span><br><span class="line">            ConversionService&lt;?&gt; conversionService,</span><br><span class="line">            JacksonObjectSerializer objectSerializer) &#123;</span><br><span class="line">        this.conversionService = conversionService</span><br><span class="line">        this.objectSerializer = objectSerializer</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    Class&lt;ShoppingCart&gt; getAnnotationType() &#123;</span><br><span class="line">        ShoppingCart</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    BindingResult&lt;Object&gt; bind(</span><br><span class="line">            ArgumentConversionContext&lt;Object&gt; context,</span><br><span class="line">            HttpRequest&lt;?&gt; source) &#123; <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line">        String parameterName = context.annotationMetadata</span><br><span class="line">                .stringValue(ShoppingCart)</span><br><span class="line">                .orElse(context.argument.name)</span><br><span class="line"></span><br><span class="line">        Cookie cookie = source.cookies.get(<span class="string">&quot;shoppingCart&quot;</span>)</span><br><span class="line">        if (!cookie) &#123;</span><br><span class="line">            return BindingResult.EMPTY</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Optional&lt;Map&lt;String, Object&gt;&gt; cookieValue = objectSerializer.deserialize(</span><br><span class="line">                cookie.value.bytes,</span><br><span class="line">                Argument.mapOf(String, Object))</span><br><span class="line"></span><br><span class="line">        return (BindingResult) &#123; -&gt;</span><br><span class="line">            cookieValue.flatMap(&#123;value -&gt;</span><br><span class="line">                conversionService.convert(value.get(parameterName), context)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>1</code> : The custom argument binder must implement <code>AnnotatedRequestArgumentBinder</code>, including both the annotation type to trigger binder and the type of the argument expected</p>
<p><code>2</code> : Ovrride the <code>bind</code> method with the custom argument binding logic</p>
<p>Example - A controller operation with this annotated binding:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Get</span>(<span class="string">&quot;/annotated&quot;</span>)</span><br><span class="line">HttpResponse&lt;String&gt; checkSession(<span class="meta">@ShoppingCart</span> Long sessionId) &#123;&#125; <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>

<p><code>1</code> : The parameter is bound with the binder associated with <code>@ShoppingCart</code>. This takes precedence over a type-based binder, if applicable</p>
<h3 id="TypedRequestArgumentBinder-è¯·æ±‚å‚æ•°ç±»å‹ç»‘å®š"><a href="#TypedRequestArgumentBinder-è¯·æ±‚å‚æ•°ç±»å‹ç»‘å®š" class="headerlink" title="TypedRequestArgumentBinder (è¯·æ±‚å‚æ•°ç±»å‹ç»‘å®š)"></a>TypedRequestArgumentBinder (è¯·æ±‚å‚æ•°ç±»å‹ç»‘å®š)</h3><blockquote>
<p>Argument binders that bind based on the type of the argument must implement TypedRequestArgumentBinder.</p>
</blockquote>
<p>åŸºäºå‚æ•°ç±»å‹è¿›è¡Œç»‘å®šçš„ <code>argument binder</code> å¿…é¡»å®ç° <code>TypedRequestArgumentBinder</code></p>
<p>Example - The POJO:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.core.annotation.Introspected</span><br><span class="line"></span><br><span class="line"><span class="meta">@Introspected</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ShoppingCart</span> &#123;</span><br><span class="line">    String sessionId</span><br><span class="line">    Integer total</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Example - The argument binder:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.core.convert.ArgumentConversionContext</span><br><span class="line"><span class="keyword">import</span> io.micronaut.core.type.Argument</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.HttpRequest</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.bind.binders.TypedRequestArgumentBinder</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.cookie.Cookie</span><br><span class="line"><span class="keyword">import</span> io.micronaut.jackson.serialize.JacksonObjectSerializer</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jakarta.inject.Singleton</span><br><span class="line"></span><br><span class="line"><span class="meta">@Singleton</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ShoppingCartRequestArgumentBinder</span> <span class="keyword">implements</span> <span class="title class_">TypedRequestArgumentBinder</span>&lt;ShoppingCart&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JacksonObjectSerializer objectSerializer</span><br><span class="line"></span><br><span class="line">    ShoppingCartRequestArgumentBinder(JacksonObjectSerializer objectSerializer) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.objectSerializer = objectSerializer</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    BindingResult&lt;ShoppingCart&gt; bind(ArgumentConversionContext&lt;ShoppingCart&gt; context,</span><br><span class="line">                                     HttpRequest&lt;?&gt; source) &#123; <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">        Cookie cookie = source.cookies.get(<span class="string">&quot;shoppingCart&quot;</span>)</span><br><span class="line">        if (!cookie) &#123;</span><br><span class="line">            return BindingResult.EMPTY</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return () -&gt; objectSerializer.deserialize( <span class="comment">//</span></span><br><span class="line">                cookie.value.bytes,</span><br><span class="line">                ShoppingCart)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    Argument&lt;ShoppingCart&gt; argumentType() &#123;</span><br><span class="line">        Argument.of(ShoppingCart) <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Example - Usage:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Get</span>(<span class="string">&quot;/typed&quot;</span>)</span><br><span class="line">HttpResponse&lt;Map&lt;String, Object&gt;&gt; loadCart(ShoppingCart shoppingCart) &#123; <span class="comment">//</span></span><br><span class="line">    HttpResponse.ok(</span><br><span class="line">            <span class="symbol">sessionId:</span> shoppingCart.sessionId,</span><br><span class="line">            <span class="symbol">total:</span> shoppingCart.total)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Host-Resolution-Host-è§£æ"><a href="#Host-Resolution-Host-è§£æ" class="headerlink" title="Host Resolution (Host è§£æ)"></a>Host Resolution (Host è§£æ)</h2><p>Micronaut æä¾›äº†ä¸€ä¸ª <code>HttpHostResolver</code> æ¥å£å®ç°æ¥è§£æå½“å‰ Server çš„ host åç§°</p>
<p>è¿™ä¸ªé»˜è®¤å®ç°é€šè¿‡å¦‚ä¸‹åœ°æ–¹æŒ‰é¡ºåºæ¥å¯»æ‰¾ host ä¿¡æ¯:</p>
<ol>
<li>æä¾›çš„é…ç½®</li>
<li><code>Forwarded</code> header</li>
<li><code>X-Forwarded-</code> headers. å¦‚æœ <code>X-Forwarded-Host</code> header æ²¡æœ‰æä¾›, å¦å¤–çš„ <code>X-Forwarded</code> headers è¢«å¿½ç•¥</li>
<li><code>Host</code> header</li>
<li>åœ¨è¯·æ±‚çš„ URI ä¸Šçš„å±æ€§</li>
<li>åœ¨å†…åµŒçš„ server URI ä¸Šçš„å±æ€§</li>
</ol>
<blockquote>
<p>The behavior of which headers to pull the relevant data can be changed with the following configuration</p>
</blockquote>
<p>ä» Header ä¸­è·å–ç›¸å…³æ•°æ®çš„è¡Œä¸ºå¯ä»¥é€šè¿‡å¦‚ä¸‹é…ç½®è¿›è¡Œæ›´æ”¹:</p>
<p>Table - Configuration Properties for <code>HostResolutionConfiguration</code>:</p>
<table>
<thead>
<tr>
<th align="left">Property</th>
<th align="left">Type</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>micronaut.server.host-resolution</code></td>
<td align="left"><code>HttpServerConfiguration$HostResolutionConfiguration</code></td>
<td align="left">The host resolution configuration</td>
</tr>
<tr>
<td align="left"><code>micronaut.server.host-resolution.host-header</code></td>
<td align="left"><code>java.lang.String</code></td>
<td align="left">The header name that stores the host</td>
</tr>
<tr>
<td align="left"><code>micronaut.server.host-resolution.protocol-header</code></td>
<td align="left"><code>java.lang.String</code></td>
<td align="left">The header name that stores the protocol</td>
</tr>
<tr>
<td align="left"><code>micronaut.server.host-resolution.port-header</code></td>
<td align="left"><code>java.lang.String</code></td>
<td align="left">The header name that stores the port</td>
</tr>
<tr>
<td align="left"><code>micronaut.server.host-resolution.port-in-host</code></td>
<td align="left"><code>boolean</code></td>
<td align="left">True if the host header supports a port</td>
</tr>
<tr>
<td align="left"><code>micronaut.server.host-resolution.allowed-hosts</code></td>
<td align="left"><code>java.util.List</code></td>
<td align="left">The list of allowed host regex patterns. Any resolved</td>
</tr>
</tbody></table>
<blockquote>
<p>The above configuration also supports an allowed host list.</p>
</blockquote>
<p>ä¸Šé¢çš„é…ç½®ä¸­è¿˜æä¾›äº†ä¸€ä¸ªæ”¾è¡Œ host åˆ—è¡¨</p>
<blockquote>
<p>Configuring this list ensures any resolved host matches one of the supplied regular expression patterns.</p>
</blockquote>
<p>é…ç½®è¿™ä¸ªåˆ—è¡¨ç¡®ä¿ä»»ä½•è¢«è§£æçš„ host åŒ¹é…ä¸Šæä¾›çš„æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„ä¸€ä¸ª</p>
<blockquote>
<p>That is useful to prevent host cache poisoning attacks and is recommended to be configured.</p>
</blockquote>
<p>è¿™åœ¨é˜²æ­¢ host ç¼“å­˜ <code>poisoning attacks</code> æ˜¯å¾ˆæœ‰ç”¨çš„, å»ºè®®è¿›è¡Œè¿™ä¸ªé…ç½®</p>
<h2 id="Locale-Resolution-æœ¬åœ°åŒ–è§£æ"><a href="#Locale-Resolution-æœ¬åœ°åŒ–è§£æ" class="headerlink" title="Locale Resolution (æœ¬åœ°åŒ–è§£æ)"></a>Locale Resolution (æœ¬åœ°åŒ–è§£æ)</h2><p>Micronaut æ”¯æŒå¤šç§ç­–ç•¥æ¥åœ¨ä¸€ä¸ªè¯·æ±‚ä¸­è§£æ locales</p>
<p>å¯ä»¥åœ¨è¯·æ±‚ä¸Šä½¿ç”¨ <code>getLocale--</code> æ–¹æ³•, ä½†æ˜¯è¿™åªæ”¯æŒè§£æ <code>Accept-Language</code> header</p>
<p>åœ¨å…¶ä»–åœºæ™¯ä¸­, locale å¯èƒ½å­˜åœ¨äº cookie, userâ€™s session, æˆ–è€…è¢«è®¾ç½®ä¸ºä¸€ä¸ªå›ºå®šå€¼</p>
<p><code>HttpLocaleResolver</code> å¯ä»¥ç”¨æ¥æŒ‡æ˜å½“å‰çš„ locale</p>
<p>ä¸éœ€è¦ç›´æ¥ä½¿ç”¨ <code>LocaleResolver</code> API</p>
<p>ç®€å•åœ°åœ¨ Controller æ–¹æ³•ä¸­å®šä¹‰ä¸€ä¸ªç±»å‹ä¸º <code>java.util.Locale</code> çš„å‚æ•°, è¿™ä¸ªå‚æ•°å°†ä¼šè‡ªåŠ¨è¢«è§£æå¹¶æ³¨å…¥</p>
<p>Example - æ§åˆ¶æ€æ ·è§£æ locale çš„é…ç½®é€‰é¡¹- Configuration Properties for <code>HttpLocaleResolutionConfigurationProperties</code>:</p>
<table>
<thead>
<tr>
<th align="left">Property</th>
<th align="left">Type</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>micronaut.server.locale-resolution</code></td>
<td align="left"><code>HttpServerConfiguration$HttpLocaleResolutionConfigurationProperties</code></td>
<td align="left">The locale resolution configuration; locale è§£æé…ç½®</td>
</tr>
<tr>
<td align="left"><code>micronaut.server.locale-resolution.fixed</code></td>
<td align="left"><code>java.util.Locale</code></td>
<td align="left">Set the language tag for the locale. Supports BCP 47 language tags (e.g. â€œen-USâ€) and ISO standard (e.g â€œen_USâ€); ä¸º locale è®¾ç½®è¯­è¨€æ ‡ç­¾. æ”¯æŒ BCP 47 è¯­è¨€æ ‡ç­¾(ä¾‹å¦‚, â€œen-USâ€) å’Œ ISO æ ‡å‡†(ä¾‹å¦‚, â€œen_USâ€)</td>
</tr>
<tr>
<td align="left"><code>micronaut.server.locale-resolution.session-attribute</code></td>
<td align="left"><code>java.lang.String</code></td>
<td align="left">Sets the key in the session to look for the locale; è®¾ç½®åœ¨ session ä¸­å¯»æ‰¾ locale çš„ key å€¼</td>
</tr>
<tr>
<td align="left"><code>micronaut.server.locale-resolution.cookie-name</code></td>
<td align="left"><code>java.lang.String</code></td>
<td align="left">Sets the name of the cookie that is used to store the locale; è®¾ç½®ä¿å­˜ locale çš„ Cookie çš„åç§°</td>
</tr>
<tr>
<td align="left"><code>micronaut.server.locale-resolution.header</code></td>
<td align="left"><code>boolean</code></td>
<td align="left">Set to true if the locale should be resolved from the Accept-Language header. Default value (true); è®¾ç½®ä¸º true åˆ™ locale åº”è¯¥ä» Accept-Language header ä¸­è§£æ, é»˜è®¤ä¸º true</td>
</tr>
<tr>
<td align="left"><code>micronaut.server.locale-resolution.default-locale</code></td>
<td align="left"><code>java.util.Locale</code></td>
<td align="left">Sets the locale that will be used if the locale cannot be resolved through any means. Defaults to the system default; è®¾ç½®é»˜è®¤çš„ locale, é»˜è®¤ä¸ºç³»ç»Ÿé»˜è®¤å€¼</td>
</tr>
</tbody></table>
<blockquote>
<p>If multiple methods are configured, the fixed locale takes precedence, followed by session&#x2F;cookie, then header.</p>
</blockquote>
<p>å¦‚æœæœ‰é…ç½®äº†å¤šä¸ªæ–¹æ³•, åˆ™é‚£ä¸ªå›ºå®šå€¼ä¼˜å…ˆçº§æœ€é«˜, æŒ‰ session&#x2F;cookie, header çš„é¡ºåº</p>
<h2 id="Client-IP-Address-å®¢æˆ·ç«¯-IP-åœ°å€"><a href="#Client-IP-Address-å®¢æˆ·ç«¯-IP-åœ°å€" class="headerlink" title="Client IP Address (å®¢æˆ·ç«¯ IP åœ°å€)"></a>Client IP Address (å®¢æˆ·ç«¯ IP åœ°å€)</h2><p>Micronaut æä¾›äº†ä¸€ä¸ª <code>HttpClientAddressResolver</code> å®ç°æ¥è§£æä¸€ä¸ª HTTP è¯·æ±‚çš„èµ·å§‹ IP åœ°å€</p>
<p>é»˜è®¤å®ç°åœ¨å¦‚ä¸‹åœ°æ–¹ä¸­æŒ‰é¡ºåºè§£æå®¢æˆ·ç«¯åœ°å€:</p>
<ol>
<li>é…ç½®çš„ header</li>
<li><code>Forwarded</code> header</li>
<li><code>X-Forwarded-For</code> header</li>
<li>è¯·æ±‚ä¸Šé¢çš„è¿œç¨‹åœ°å€</li>
</ol>
<p>ç¬¬ä¸€ä¸ªä¼˜å…ˆçº§ header åç§°å¯ä»¥ä½¿ç”¨ <code>micronaut-server.client-address-header</code> æ¥é…ç½®</p>
<h2 id="The-HttpRequest-and-HttpResponse-HttpRequest-å’Œ-HttpResponse"><a href="#The-HttpRequest-and-HttpResponse-HttpRequest-å’Œ-HttpResponse" class="headerlink" title="The HttpRequest and HttpResponse (HttpRequest å’Œ HttpResponse)"></a>The HttpRequest and HttpResponse (HttpRequest å’Œ HttpResponse)</h2><p>å¦‚æœä½ éœ€è¦å¯¹è¯·æ±‚å¤„ç†æœ‰æ›´å¤šçš„æ§åˆ¶, ä½ å¯ä»¥ç¼–å†™ä¸€ä¸ªæ–¹æ³•æ¥å—ä¸€ä¸ªå®Œæ•´çš„ <code>HttpRequest</code></p>
<p>äº‹å®ä¸Š, æœ‰ä¸€äº›é«˜çº§æ¥å£å¯ä»¥ç»‘å®šåˆ° Controller æ–¹æ³•å‚æ•°ä¸Š:</p>
<p>Table - Bindable Micronaut Interfaces:</p>
<table>
<thead>
<tr>
<th align="left">Interface</th>
<th align="left">Description</th>
<th align="left">Example</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>HttpRequest</code></td>
<td align="left">The full HttpRequest</td>
<td align="left"><code>String hello(HttpRequest request)</code></td>
</tr>
<tr>
<td align="left"><code>HttpHeaders</code></td>
<td align="left">All HTTP headers present in the request</td>
<td align="left"><code>String hello(HttpHeaders headers)</code></td>
</tr>
<tr>
<td align="left"><code>HttpParameters</code></td>
<td align="left">All HTTP parameters (either from URI variables or request parameters) present in the request</td>
<td align="left"><code>String hello(HttpParameters params)</code></td>
</tr>
<tr>
<td align="left"><code>Cookies</code></td>
<td align="left">All Cookies present in the request</td>
<td align="left"><code>String hello(Cookies cookies)</code></td>
</tr>
</tbody></table>
<p>å¦‚æœéœ€è¦è¯·æ±‚çš„ body, <code>HttpRequest</code> åº”è¯¥ä½¿ç”¨ä¸€ä¸ªå…·ä½“çš„æ³›å‹æ¥è¿›è¡Œå®šä¹‰, ä¾‹å¦‚ <code>HttpRequest&lt;MyClass&gt; request</code>. å¦åˆ™, è¯·æ±‚çš„ body å¯èƒ½æ˜¯ä¸å¯ç”¨çš„</p>
<p>é™¤æ­¤ä¹‹å¤–, ä¸ºäº†å®Œå…¨æ§åˆ¶è¾“å‡ºçš„ HTTP å“åº”, ä½ å¯ä»¥ä½¿ç”¨ <code>HttpResponse</code> çš„é™æ€å·¥å‚æ–¹æ³•æ¥è¿”å›ä¸€ä¸ª <code>MutableHttpResponse</code></p>
<p>Example - Request and Response:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.http.HttpRequest</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.HttpResponse</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Controller</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Get</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.context.ServerRequestContext</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">&quot;/request&quot;</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MessageController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Get</span>(<span class="string">&quot;/hello&quot;</span>) </span><br><span class="line">    HttpResponse&lt;String&gt; hello(HttpRequest&lt;?&gt; request) &#123;</span><br><span class="line">        String name = request.parameters</span><br><span class="line">                             .getFirst(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">                             .orElse(<span class="string">&quot;Nobody&quot;</span>)</span><br><span class="line"></span><br><span class="line">        HttpResponse.ok(<span class="string">&quot;Hello $name !&quot;</span>)</span><br><span class="line">                    .header(<span class="string">&quot;X-My-Header&quot;</span>, <span class="string">&quot;Foo&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿˜å¯ä»¥ä»ä¸€ä¸ªé™æ€ä¸Šä¸‹æ–‡ <code>ServerRequestContext</code> ä¸­è·å– <code>HttpRequest</code>:</p>
<p>Example - Using the ServerRequestContext:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.http.HttpRequest</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.HttpResponse</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Controller</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Get</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.context.ServerRequestContext</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">&quot;/request&quot;</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MessageController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Get</span>(<span class="string">&quot;/hello-static&quot;</span>) <span class="comment">// </span></span><br><span class="line">    HttpResponse&lt;String&gt; helloStatic() &#123;</span><br><span class="line">        HttpRequest&lt;?&gt; request = ServerRequestContext.currentRequest()</span><br><span class="line">                                                     .orElseThrow(() -&gt; new RuntimeException(<span class="string">&quot;No request present&quot;</span>))</span><br><span class="line">        String name = request.parameters</span><br><span class="line">                             .getFirst(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">                             .orElse(<span class="string">&quot;Nobody&quot;</span>)</span><br><span class="line"></span><br><span class="line">        HttpResponse.ok(<span class="string">&quot;Hello $name !&quot;</span>)</span><br><span class="line">                    .header(<span class="string">&quot;X-My-Header&quot;</span>, <span class="string">&quot;Foo&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Micronaut æ¡†æ¶ä½¿ç”¨ <code>Project Reactor</code> ä½œä¸ºé»˜è®¤çš„å“åº”å¼æµå®ç°</p>
<p>Example - Using the Project Reactor context:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.http.HttpRequest</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.HttpResponse</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Controller</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Get</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.context.ServerRequestContext</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">&quot;/request&quot;</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MessageController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Get</span>(<span class="string">&quot;/hello-reactor&quot;</span>)</span><br><span class="line">    Mono&lt;HttpResponse&lt;String&gt;&gt; helloReactor() &#123;</span><br><span class="line">        Mono.deferContextual(ctx -&gt; &#123; <span class="comment">// </span></span><br><span class="line">            HttpRequest&lt;?&gt; request = ctx.get(ServerRequestContext.KEY) <span class="comment">// </span></span><br><span class="line">            String name = request.parameters</span><br><span class="line">                    .getFirst(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">                    .orElse(<span class="string">&quot;Nobody&quot;</span>)</span><br><span class="line"></span><br><span class="line">            Mono.just(HttpResponse.ok(<span class="string">&quot;Hello &quot;</span> + name + <span class="string">&quot;!!&quot;</span>)</span><br><span class="line">                    .header(<span class="string">&quot;X-My-Header&quot;</span>, <span class="string">&quot;Foo&quot;</span>))</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Response-Status-å“åº”çŠ¶æ€"><a href="#Response-Status-å“åº”çŠ¶æ€" class="headerlink" title="Response Status (å“åº”çŠ¶æ€)"></a>Response Status (å“åº”çŠ¶æ€)</h2><p>Micronaut Controller é»˜è®¤ä½¿ç”¨ <code>200</code> HTTP çŠ¶æ€è¿›è¡Œå“åº”</p>
<p>å¦‚æœ Controller æ–¹æ³•è¿”å›ä¸€ä¸ª <code>HttpResponse</code>, ä½¿ç”¨ <code>status()</code> æ–¹æ³•æ¥é…ç½®å“åº”çš„çŠ¶æ€ç :</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Get</span>(value = <span class="string">&#x27;/http-response&#x27;</span>, produces = MediaType.TEXT_PLAIN)</span><br><span class="line">HttpResponse httpResponse() &#123;</span><br><span class="line">    HttpResponse.status(HttpStatus.CREATED).body(<span class="string">&quot;success&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿˜å¯ä»¥ä½¿ç”¨ <code>@Status</code> æ³¨è§£:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Status</span>(HttpStatus.CREATED)</span><br><span class="line"><span class="meta">@Get</span>(produces = MediaType.TEXT_PLAIN)</span><br><span class="line">String index() &#123; <span class="string">&quot;success&quot;</span> &#125;</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ä½¿ç”¨ä¸€ä¸ª <code>HttpStatus</code> ä½œä¸ºæ–¹æ³•è¿”å›å€¼:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Get</span>(<span class="string">&quot;/http-status&quot;</span>)</span><br><span class="line">HttpStatus httpStatus() &#123;</span><br><span class="line">    HttpStatus.CREATED</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Response-Content-Type-å“åº”çš„-Content-Type"><a href="#Response-Content-Type-å“åº”çš„-Content-Type" class="headerlink" title="Response Content-Type (å“åº”çš„ Content-Type)"></a>Response Content-Type (å“åº”çš„ Content-Type)</h2><p>Micronaut çš„ Controller çš„è¡Œä¸ºé»˜è®¤è¿”å› <code>applicatin/json</code> çš„ <code>Content-Type</code></p>
<p>å¯ä»¥ä½¿ç”¨ <code>@Produces</code> æ³¨è§£æŒ‡å®šè¿”å›çš„ <code>Content-Type</code>: <code>@Produces(MediaType.TEXT_HTML)</code></p>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨ HTTP æ–¹æ³•æ³¨è§£çš„ <code>produces</code> æˆå‘˜å±æ€§æ¥æŒ‡å®šè¿”å›çš„ <code>Context-Type</code>: <code>@Get(value = &#39;/xml&#39;, produces = MediaType.TEXT_XML)</code></p>
<h2 id="Accepted-Request-Content-Type-å¯æ¥å—çš„è¯·æ±‚-Content-Type"><a href="#Accepted-Request-Content-Type-å¯æ¥å—çš„è¯·æ±‚-Content-Type" class="headerlink" title="Accepted Request Content-Type (å¯æ¥å—çš„è¯·æ±‚ Content-Type)"></a>Accepted Request Content-Type (å¯æ¥å—çš„è¯·æ±‚ Content-Type)</h2><p>Micronaut çš„ Controller çš„è¡Œä¸ºé»˜è®¤æ¶ˆè´¹ <code>application/json</code> çš„ <code>Content-Type</code></p>
<p>å¯ä»¥ä½¿ç”¨ <code>@Consumes</code> æ³¨è§£æˆ–è€… HTTP æ–¹æ³•æ³¨è§£çš„ <code>consumes</code> æˆå‘˜å±æ€§æ¥æŒ‡å®šè¦æ¶ˆè´¹çš„ <code>Content-Type</code></p>
<p><code>@Consumes([MediaType.APPLICATION_FORM_URLENCODED, MediaType.APPLICATION_JSON])</code></p>
<p><code>@Post(value = &quot;/member&quot;, consumes = MediaType.TEXT_PLAIN)</code></p>
<h3 id="Customing-Processed-Content-Types-è‡ªå®šä¹‰å¤„ç†çš„-Content-Type"><a href="#Customing-Processed-Content-Types-è‡ªå®šä¹‰å¤„ç†çš„-Content-Type" class="headerlink" title="Customing Processed Content Types (è‡ªå®šä¹‰å¤„ç†çš„ Content-Type)"></a>Customing Processed Content Types (è‡ªå®šä¹‰å¤„ç†çš„ Content-Type)</h3><p>æ™®é€šçš„ JSON è§£æåªæœ‰åœ¨ Content-Type æ˜¯ <code>application/json</code> çš„æ—¶å€™æ‰ä¼šå‘ç”Ÿ</p>
<p>å…¶ä»– <code>MediaTypeCodec</code> ç±»ä¹Ÿæ˜¯ä¸€æ ·çš„è¡Œä¸º, å®ƒä»¬æœ‰é¢„å®šä¹‰å¥½çš„å¯ä»¥å¤„ç†çš„ Content-Type</p>
<p>ä¸ºäº†æ‰©å±•ç»™å®š codec å¯ä»¥å¤„ç†çš„åª’ä½“ç±»å‹åˆ—è¡¨, æä¾›å­˜å‚¨åœ¨ <code>CodecConfiguration</code> çš„é…ç½®:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">codec:</span></span><br><span class="line">        <span class="attr">json:</span></span><br><span class="line">            <span class="attr">additionalTypes:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">text/javascript</span></span><br></pre></td></tr></table></figure>

<p>å½“å‰æ”¯æŒçš„é…ç½®å‰ç¼€æ˜¯ <code>json</code>,<code>json-stream</code>,<code>text-stream</code></p>
<h2 id="Reactive-HTTP-Request-Processing-å“åº”å¼-HTTP-è¯·æ±‚å¤„ç†"><a href="#Reactive-HTTP-Request-Processing-å“åº”å¼-HTTP-è¯·æ±‚å¤„ç†" class="headerlink" title="Reactive HTTP Request Processing (å“åº”å¼ HTTP è¯·æ±‚å¤„ç†)"></a>Reactive HTTP Request Processing (å“åº”å¼ HTTP è¯·æ±‚å¤„ç†)</h2><p>Micronaut å»ºç«‹åœ¨ Netty ä¸Š, Netty è¢«è®¾è®¡ä¸ºå›´ç»•ä¸€ä¸ª Event loop æ¨¡å‹å’Œéé˜»å¡ I&#x2F;O</p>
<p>Micronaut åœ¨ä¸è¯·æ±‚çº¿ç¨‹(ä¸€ä¸ª Event Loop çº¿ç¨‹)ç›¸åŒçš„çº¿ç¨‹ä¸­æ‰§è¡Œ <code>@Controller</code> Bean ä¸­å®šä¹‰çš„ä»£ç </p>
<p>å¦‚æœä½ æ‰§è¡Œä»»ä½•é˜»å¡ I&#x2F;O æ“ä½œ(ä¾‹å¦‚å’Œ Hibernate&#x2F;JPA&#x2F;JDBC äº¤äº’), è¿™å°±éå¸¸é‡è¦äº†, ä½ å¯ä»¥å°†è¿™äº›æ“ä½œå¸è½½åˆ°ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æ± , è¿™ä¸ªçº¿ç¨‹æ± ä¸ä¼šé˜»å¡ Event loop</p>
<p>æ¯”å¦‚ä¸‹é¢çš„é…ç½®ä¸­é…ç½®äº†ä¸€ä¸ªå›ºå®š 75 ä¸ªçº¿ç¨‹çš„ I&#x2F;O çº¿ç¨‹æ± (ç±»ä¼¼ä¼ ç»Ÿé˜»å¡ Server, ä¾‹å¦‚ Tomcat å°†è¿™ä¸ªçº¿ç¨‹æ± ç”¨åœ¨ thread-pre-request æ¨¡å‹ä¸­):</p>
<p>Example - Configuring the IO thread pool:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="symbol">executors:</span></span><br><span class="line">        <span class="symbol">io:</span></span><br><span class="line">            <span class="symbol">type:</span> fixed</span><br><span class="line">            <span class="symbol">nThreads:</span> <span class="number">75</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ <code>@Controller</code> Bean ä¸­æœ‰å¤šä¸ªæ–¹å¼ä½¿ç”¨è¿™ä¸ªçº¿ç¨‹æ± , æœ€ç®€å•çš„æ–¹å¼æ˜¯ä½¿ç”¨ <code>@ExecuteOn</code> æ³¨è§£</p>
<p><code>@ExecuteOn</code> æ³¨è§£å¯ä»¥å£°æ˜åœ¨ç±»çº§åˆ«å’Œæ–¹æ³•çº§åˆ«, ç”¨æ¥æŒ‡æ˜ Controller çš„æ–¹æ³•è¦è¿è¡Œåœ¨å“ªä¸ªé…ç½®çš„çº¿ç¨‹æ± ä¸Šé¢:</p>
<p>Example - Using <code>@ExecuteOn</code></p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.docs.http.server.reactive.PersonService</span><br><span class="line"><span class="keyword">import</span> io.micronaut.docs.ioc.beans.Person</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Controller</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Get</span><br><span class="line"><span class="keyword">import</span> io.micronaut.scheduling.TaskExecutors</span><br><span class="line"><span class="keyword">import</span> io.micronaut.scheduling.annotation.ExecuteOn</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">&quot;/executeOn/people&quot;</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PersonController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PersonService personService</span><br><span class="line"></span><br><span class="line">    PersonController(PersonService personService) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.personService = personService</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Get</span>(<span class="string">&quot;/&#123;name&#125;&quot;</span>)</span><br><span class="line">    <span class="meta">@ExecuteOn</span>(TaskExecutors.IO)    <span class="comment">// The @ExecuteOn annotation is used to execute the operation on the I/O thread pool</span></span><br><span class="line">    Person byName(String name) &#123;</span><br><span class="line">        personService.findByName(name)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>@ExecuteOn</code> æ³¨è§£çš„å€¼å¯ä»¥æ˜¯ä»»ä½•å®šä¹‰åœ¨ <code>micronaut.executors</code> ä¸‹å‘½åçš„ executor</p>
<p>ä¸€èˆ¬è€Œè¨€, å¯¹äºæ•°æ®åº“æ“ä½œ, ä½ å¸Œæœ›é…ç½®ä¸€ä¸ªä¸æ•°æ®åº“è¿æ¥æ± ä¸­æŒ‡å®šçš„æœ€å¤§è¿æ¥æ•°ç›¸åŒ¹é…çš„çº¿ç¨‹æ± </p>
<p>é™¤äº†ä½¿ç”¨ <code>@ExecuteOn</code> æ³¨è§£çš„, å¦ä¸€ä¸ªé€‰é¡¹æ˜¯ä½¿ç”¨ä½ é€‰æ‹©çš„å“åº”å¼åº“æä¾›çš„åŠŸèƒ½</p>
<p>å“åº”å¼å®ç°ä¾‹å¦‚ <code>Project Reactor</code> æˆ– <code>RxJava</code> æä¾›äº†ä¸€ä¸ª <code>subscribeOn</code> æ–¹æ³•æ¥è®©ä½ å¯ä»¥ä¿®æ”¹ä½¿ç”¨å“ªä¸ªçº¿ç¨‹æ¥æ‰§è¡Œç”¨æˆ·ä»£ç :</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.docs.ioc.beans.Person</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Controller</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Get</span><br><span class="line"><span class="keyword">import</span> io.micronaut.scheduling.TaskExecutors</span><br><span class="line"><span class="keyword">import</span> jakarta.inject.Named</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono</span><br><span class="line"><span class="keyword">import</span> reactor.core.scheduler.Scheduler</span><br><span class="line"><span class="keyword">import</span> reactor.core.scheduler.Schedulers</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">&quot;/subscribeOn/people&quot;</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PersonController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Scheduler scheduler</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PersonService personService</span><br><span class="line"></span><br><span class="line">    PersonController(</span><br><span class="line">        <span class="meta">@Named</span>(TaskExecutors.IO) ExecutorService executorService,   <span class="comment">// The configured I/O executor service is injected</span></span><br><span class="line">        PersonService personService</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.scheduler = Schedulers.fromExecutorService(executorService)</span><br><span class="line">        <span class="variable language_">this</span>.personService = personService</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Get</span>(<span class="string">&quot;/&#123;name&#125;&quot;</span>)</span><br><span class="line">    Mono&lt;Person&gt; byName(String name) &#123;</span><br><span class="line">        <span class="keyword">return</span> Mono.fromCallable(&#123;-&gt; personService.findByName(name)&#125;)   <span class="comment">// The Mono::fromCallable method wraps the blocking operation</span></span><br><span class="line">                   .subscribeOn(scheduler)  <span class="comment">// The Project Reactor subscribeOn method schedules the operation on the I/O thread poll</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Using-the-Body-Annotation-ä½¿ç”¨-Body-æ³¨è§£"><a href="#Using-the-Body-Annotation-ä½¿ç”¨-Body-æ³¨è§£" class="headerlink" title="Using the @Body Annotation (ä½¿ç”¨ @Body æ³¨è§£)"></a>Using the <code>@Body</code> Annotation (ä½¿ç”¨ <code>@Body</code> æ³¨è§£)</h3><p>ä¸ºäº†è§£æè¯·æ±‚ body, é¦–å…ˆç”¨ <code>@Body</code> æ³¨è§£å‘ Micronaut æŒ‡ç¤ºå“ªä¸ªå‚æ•°æ¥æ¥æ”¶æ•°æ®</p>
<p>Example - Using the <code>@Body</code> annotation:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.http.HttpResponse</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.MediaType</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Body</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Controller</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Post</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Size</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">&quot;/receive&quot;</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MessageController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Post</span>(value = <span class="string">&quot;/echo&quot;</span>, consumes = MediaType.TEXT_PLAIN) <span class="comment">// 1</span></span><br><span class="line">    String echo(<span class="meta">@Size</span>(max = <span class="number">1024</span>) <span class="meta">@Body</span> String text) &#123;      <span class="comment">// 2</span></span><br><span class="line">        text</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>1</code> : <code>@Post</code> æ³¨è§£å’Œ <code>text/plain</code> ç±»å‹çš„ <code>MediaType</code> ä¸€èµ·ä½¿ç”¨ (é»˜è®¤æ˜¯ <code>applicatoin/json</code>)</p>
<p><code>2</code> : <code>@Body</code> æ³¨è§£å’Œ <code>javax.validation.constraints.Size</code> ä¸€èµ·ä½¿ç”¨, <code>@Size</code> æ³¨è§£é™åˆ¶äº† body çš„æœ€å¤§å¤§å°ä¸º 1KB, è¿™ä¸ªçº¦æŸä¸ä¼šé™åˆ¶ Server çš„ read&#x2F;buffered æ•°æ®çš„å¤§å°</p>
<blockquote>
<p>Note that reading the request body is done in a non-blocking manner in that the request contents are read as the data becomes available and accumulated into the String passed to the method.</p>
</blockquote>
<p>è¦æ³¨æ„, è¯»å–è¯·æ±‚ body æ˜¯ä»¥éé˜»å¡æ–¹å¼å®Œæˆçš„, å› ä¸ºè¯·æ±‚å†…å®¹æ˜¯åœ¨æ•°æ®å¯ç”¨å¹¶ç´¯è®¡åˆ° ä¼ é€’ç»™æ–¹æ³•çš„å­—ç¬¦ä¸² ä¸­æ—¶è¯»å–çš„</p>
<p>åœ¨ <code>application.yml</code> ä¸­è®¾ç½®çš„ <code>micronaut.server.maxRequestSize</code> é™åˆ¶äº† Server read&#x2F;buffered çš„æ•°æ®å¤§å°, é»˜è®¤æœ€å¤§è¯·æ±‚å¤§å°æ˜¯ 10MB, <code>@Size</code> ä¸æ˜¯è¿™ä¸ªè¿™é…ç½®çš„ä»£æ›¿</p>
<blockquote>
<p>Regardless of the limit, for a large amount of data accumulating the data into a String in-memory may lead to memory strain on the server.</p>
</blockquote>
<p>ä¸ç®¡é™åˆ¶å¦‚ä½•, å¯¹äºå¤§é‡æ•°æ®, å°†æ•°æ®ç´¯è®¡åˆ°å†…å­˜ä¸­çš„å­—ç¬¦ä¸²å¯èƒ½ä¼šå¯¼è‡´ Server å†…å­˜ç´§å¼ </p>
<p>ä¸€ä¸ªæ›´å¥½åšæ³•æ˜¯åŒ…å«ä¸€ä¸ª Reactive åº“åˆ°ä½ çš„é¡¹ç›®ä¸­, ä¾‹å¦‚ Reactor, RxJava, Akka, è¿™äº›åº“æ”¯æŒå“åº”å¼æµå®ç°, å¹¶åœ¨æ•°æ®å¯ç”¨æ—¶å°†å…¶æµåŒ–</p>
<p>Example - Using Reactive Streams to Read the request body:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.http.HttpResponse</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.MediaType</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Body</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Controller</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Post</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Size</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.reactivestrams.Publisher</span><br><span class="line"><span class="keyword">import</span> io.micronaut.core.async.annotation.SingleResult</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Flux</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">&quot;/receive&quot;</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MessageController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Post</span>(value = <span class="string">&quot;/echo-publisher&quot;</span>, consumes = MediaType.TEXT_PLAIN)   <span class="comment">// 1</span></span><br><span class="line">    <span class="meta">@SingleResult</span></span><br><span class="line">    Publisher&lt;HttpResponse&lt;String&gt;&gt; echoFlow(<span class="meta">@Body</span> Publisher&lt;String&gt; text) &#123;    <span class="comment">// 2</span></span><br><span class="line">        <span class="keyword">return</span> Flux.from(text)</span><br><span class="line">                   .collect(    <span class="comment">// 3</span></span><br><span class="line">                       &#123; x -&gt; <span class="keyword">new</span> StringBuffer() &#125;,</span><br><span class="line">                       &#123; StringBuffer sb, String s -&gt; sb.append(s) &#125;</span><br><span class="line">                   )</span><br><span class="line">                   .map(</span><br><span class="line">                       &#123; buffer -&gt; HttpResponse.ok(buffer.toString()) &#125;</span><br><span class="line">                   )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>1</code> : In this case the method is altered to receive and return an <code>Publisher</code> type</p>
<p><code>2</code> : This example uses <code>Project Reactor</code> and returns a single item. Because of that the response type is annotated also with <code>SingleResult</code>. Micronaut only emits the response once the operation completes without blocking</p>
<p><code>3</code> : The <code>collect</code> method is used to accumulate the date in this simulated example, but it could for example write the data to a logging service, database, etc. chunk by chunk</p>
<blockquote>
<p>Body arguments of types that do not require conversion cause Micronaut to skip decoding of the request.</p>
</blockquote>
<p>ä¸éœ€è¦è½¬æ¢çš„ Body å‚æ•°ç±»å‹ä¼šå¯¼è‡´ Micronaut è·³è¿‡å¯¹è¯·æ±‚çš„è§£ç </p>
<h3 id="Reactive-Responses-å“åº”å¼å“åº”"><a href="#Reactive-Responses-å“åº”å¼å“åº”" class="headerlink" title="Reactive Responses (å“åº”å¼å“åº”)"></a>Reactive Responses (å“åº”å¼å“åº”)</h3><blockquote>
<p>Micronaut supports returning common reactive types such as Mono (or Single Maybe Observable types from RxJava), an instance of Publisher or CompletableFuture from any controller method.</p>
</blockquote>
<p>Micronaut æ”¯æŒè¿”å›æ™®é€šå“åº”å¼ç±»å‹, ä¾‹å¦‚ <code>Mono</code> (æˆ–è€… RxJava ä¸­çš„ <code>Single</code>,<code>Maybe</code>,<code>Observable</code>), Controller æ–¹æ³•è¿”å›çš„ä¸€ä¸ª <code>Publisher</code> æˆ– <code>CompletableFuture</code> å®ä¾‹</p>
<p>è¦ä½¿ç”¨ Project Reactor çš„ <code>Flux</code> æˆ– <code>Mono</code>, è¦æ·»åŠ  Micronaut Reactor ä¾èµ–åˆ°é¡¹ç›®ä¸­, æ¥æ·»åŠ å¿…è¦çš„è½¬æ¢å™¨</p>
<p>è¦ä½¿ç”¨ RxJava çš„ <code>Flowable</code>,<code>Single</code>,<code>Maybe</code>, è¦æ·»åŠ  Micronaut RxJava ä¾èµ–åˆ°é¡¹ç›®ä¸­, æ¥æ·»åŠ å¿…è¦çš„è½¬æ¢å™¨</p>
<blockquote>
<p>The argument designated as the body of the request using the Body annotation can also be a reactive type or a CompletableFuture</p>
</blockquote>
<p>ä½¿ç”¨ <code>@Body</code> æ³¨è§£æŒ‡å®šä¸ºè¯·æ±‚ body çš„å‚æ•°ä¹Ÿå¯ä»¥æ˜¯å“åº”å¼ç±»å‹æˆ–ä¸€ä¸ª <code>CompletableFuture</code></p>
<blockquote>
<p>When returning a reactive type, Micronaut subscribes to the returned reactive type on the same thread as the request (a Netty Event Loop thread).</p>
</blockquote>
<p>å½“è¿”å›ä¸€ä¸ªå“åº”å¼ç±»å‹æ—¶, Micronaut åœ¨ä¸è¯·æ±‚ç›¸åŒçš„çº¿ç¨‹(ä¸€ä¸ª Netty Event Loop çº¿ç¨‹)ä¸Šè®¢é˜…è¿”å›çš„å“åº”ç±»å‹</p>
<blockquote>
<p>It is therefore important that if you perform any blocking operations, you offload those operations to an appropriately configured thread pool, for example using the Project Reactor or RxJava subscribeOn(..) facility or @ExecuteOn.</p>
</blockquote>
<p>å› æ­¤, é‡è¦çš„æ˜¯, å¦‚æœä½ æ‰§è¡Œä»»ä½•é˜»å¡æ“ä½œ, è¯·å°†è¿™äº›æ“ä½œå¸è½½åˆ°é€‚å½“é…ç½®çš„çº¿ç¨‹æ± , ä¾‹å¦‚ä½¿ç”¨ Project Reactor æˆ– RxJava <code>subscribeOn(..)</code> å·¥å…·, æˆ–è€… <code>@ExecuteOn</code></p>
<p>Table - ä¸€äº›å¸¸ç”¨è¿”å›ç±»å‹å’Œå®ƒä»¬çš„å¤„ç† - Micronaut Response Types:</p>
<table>
<thead>
<tr>
<th align="left">Type</th>
<th align="left">Description</th>
<th align="left">Example Signature</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>Publisher</code></td>
<td align="left">Any type that implements the <code>Publisher</code> interface</td>
<td align="left"><code>Publisher&lt;String&gt; hello()</code></td>
</tr>
<tr>
<td align="left"><code>CompletableFuture</code></td>
<td align="left">A Java <code>CompletableFuture</code> instance</td>
<td align="left"><code>CompletableFuture&lt;String&gt; hello()</code></td>
</tr>
<tr>
<td align="left"><code>HttpResponse</code></td>
<td align="left">An <code>HttpResponse</code> and optional response body</td>
<td align="left"><code>HttpResponse&lt;Publisher&lt;String&gt;&gt; hello()</code></td>
</tr>
<tr>
<td align="left"><code>CharSequence</code></td>
<td align="left">Any implementation of <code>CharSequence</code></td>
<td align="left"><code>String hello()</code></td>
</tr>
<tr>
<td align="left"><code>T</code></td>
<td align="left">Any simple POJO type</td>
<td align="left"><code>Book show()</code></td>
</tr>
</tbody></table>
<h2 id="JSON-Binding-with-Jackson-ä½¿ç”¨-Jackson-è¿›è¡Œ-JSON-ç»‘å®š"><a href="#JSON-Binding-with-Jackson-ä½¿ç”¨-Jackson-è¿›è¡Œ-JSON-ç»‘å®š" class="headerlink" title="JSON Binding with Jackson (ä½¿ç”¨ Jackson è¿›è¡Œ JSON ç»‘å®š)"></a>JSON Binding with Jackson (ä½¿ç”¨ Jackson è¿›è¡Œ JSON ç»‘å®š)</h2><blockquote>
<p>In fact, the defaults in the Controller annotation specify that the controllers in Micronaut consume and produce JSON by default.</p>
</blockquote>
<p>å®é™…ä¸Š, <code>@Controller</code> æ³¨è§£ä¸­é»˜è®¤æŒ‡å®š Micronaut ä¸­çš„ Controller é»˜è®¤æ¶ˆè´¹å’Œç”Ÿæˆ JSON</p>
<blockquote>
<p>To do so in a non-blocking manner, Micronaut builds on the Jackson Asynchronous JSON parsing API and Netty, such that the reading of incoming JSON is done in a non-blocking manner.</p>
</blockquote>
<p>ä¸ºäº†ä»¥éé˜»å¡çš„æ–¹å¼æ‰§è¡Œæ­¤æ“ä½œ, Micronaut æ„å»ºåœ¨ Jackson å¼‚æ­¥ JSON è§£æ APIå’Œ Netty ä¹‹ä¸Š, ä»¥ä¾¿ä»¥éé˜»å¡çš„æ–¹å¼è¯»å–ä¼ å…¥çš„ JSON</p>
<h3 id="Binding-using-Reactive-Frameworks-ä½¿ç”¨å“åº”å¼æ¡†æ¶è¿›è¡Œç»‘å®š"><a href="#Binding-using-Reactive-Frameworks-ä½¿ç”¨å“åº”å¼æ¡†æ¶è¿›è¡Œç»‘å®š" class="headerlink" title="Binding using Reactive Frameworks (ä½¿ç”¨å“åº”å¼æ¡†æ¶è¿›è¡Œç»‘å®š)"></a>Binding using Reactive Frameworks (ä½¿ç”¨å“åº”å¼æ¡†æ¶è¿›è¡Œç»‘å®š)</h3><p>ä»å¼€å‘äººå‘˜çš„è§’åº¦æ¥çœ‹, ä½ é€šå¸¸å¯ä»¥ä»…ä»…ä½¿ç”¨ POJO å’Œå¯é€‰åœ°ä½¿ç”¨ä¸€ä¸ªå“åº”å¼æ¡†æ¶, ä¾‹å¦‚ RxJava å’Œ Project Reactor</p>
<p>Example - A Controller that reads and saves incoming POJO in a non-blocking way from JSON - Using Reactive Streams to Read the JSON:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span>(<span class="string">&quot;/people&quot;</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PersonController</span> &#123;</span><br><span class="line"></span><br><span class="line">    Map&lt;String, Person&gt; inMemoryDatastore = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;()</span><br><span class="line"></span><br><span class="line">    Publisher&lt;HttpResponse&lt;Person&gt;&gt; save(<span class="meta">@Body</span> Publisher&lt;Person&gt; person) &#123;  <span class="comment">// 1</span></span><br><span class="line">        Mono.from(person)</span><br><span class="line">            .map(</span><br><span class="line">                &#123; p -&gt;</span><br><span class="line">                    inMemoryDatastore.put(p.getFirstName)   <span class="comment">// 2</span></span><br><span class="line">                    HttpResponse.created(p)                 <span class="comment">// 3</span></span><br><span class="line">                &#125;</span><br><span class="line">            )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>1</code> : The method receives a <code>Publisher</code> which emits the POJO once the JSON has been read</p>
<p><code>2</code> : The <code>map</code> method stores the instance in a <code>Map</code></p>
<p><code>3</code> : An <code>HttpResponse</code> is returned</p>
<h3 id="Binding-Using-CompletableFuture-ä½¿ç”¨-CompletableFuture-è¿›è¡Œç»‘å®š"><a href="#Binding-Using-CompletableFuture-ä½¿ç”¨-CompletableFuture-è¿›è¡Œç»‘å®š" class="headerlink" title="Binding Using CompletableFuture (ä½¿ç”¨ CompletableFuture è¿›è¡Œç»‘å®š)"></a>Binding Using CompletableFuture (ä½¿ç”¨ CompletableFuture è¿›è¡Œç»‘å®š)</h3><p>ä¸Šé¢çš„ä¾‹å­å¯ä»¥ä½¿ç”¨ <code>CompletableFuture</code> API æ¥æ”¹å†™:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span>(<span class="string">&quot;/people&quot;</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PersonController</span> &#123;</span><br><span class="line"></span><br><span class="line">    Map&lt;String, Person&gt; inMemoryDatastore = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;()</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Post</span>(<span class="string">&quot;/saveFuture&quot;</span>)</span><br><span class="line">    CompletableFuture&lt;HttpRespnose&lt;Person&gt;&gt; save(<span class="meta">@Body</span> CompletableFuture&lt;Person&gt; person) &#123;</span><br><span class="line">        person.thenApply(</span><br><span class="line">            &#123; p -&gt;</span><br><span class="line">                inMemoryDatastore.put(p.getFirstName(), p)</span><br><span class="line">                HttpResponse.created(p)</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Binding-using-POJOs-ä½¿ç”¨-POJO-è¿›è¡Œç»‘å®š"><a href="#Binding-using-POJOs-ä½¿ç”¨-POJO-è¿›è¡Œç»‘å®š" class="headerlink" title="Binding using POJOs (ä½¿ç”¨ POJO è¿›è¡Œç»‘å®š)"></a>Binding using POJOs (ä½¿ç”¨ POJO è¿›è¡Œç»‘å®š)</h3><p>Example - Binding JSON POJOs:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span>(<span class="string">&quot;/people&quot;</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PersonController</span> &#123;</span><br><span class="line"></span><br><span class="line">    Map&lt;String, Person&gt; inMemoryDatastore = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;()</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Post</span></span><br><span class="line">    HttpResponse&lt;Person&gt; save(<span class="meta">@Body</span> Person person) &#123;</span><br><span class="line">        inMemoryDatastore.put(person.getFirstName(), person)</span><br><span class="line">        HttpResponse.created(person)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Micronaut only executes your method once the data has been read in a non-blocking manner.</p>
</blockquote>
<p>Micronaut ä»…åœ¨ä»¥éé˜»å¡æ–¹å¼è¯»å–æ•°æ®åæ‰æ‰§è¡Œä½ çš„æ–¹æ³•</p>
<p>Jackson ç”Ÿæˆçš„è¾“å‡ºå¯ä»¥é€šè¿‡å¤šç§æ–¹å¼è¿›è¡Œå®šåˆ¶, ä»å®šä¹‰ Jackson æ¨¡å—åˆ°ä½¿ç”¨ Jackson æ³¨é‡Š</p>
<h3 id="Jackson-Configuration-Jackson-é…ç½®"><a href="#Jackson-Configuration-Jackson-é…ç½®" class="headerlink" title="Jackson Configuration (Jackson é…ç½®)"></a>Jackson Configuration (Jackson é…ç½®)</h3><p>å¯ä»¥é€šè¿‡é…ç½® <code>JacksonConfiguration</code> ç±»æ¥é…ç½® Jackson <code>ObjectMapper</code></p>
<p>æ‰€æœ‰çš„ Jackson é…ç½® key éƒ½æ˜¯ä»¥ <code>jackson</code> å¼€å¤´:</p>
<table>
<thead>
<tr>
<th align="left">Name</th>
<th align="left">Type</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">dataFormat</td>
<td align="left">String</td>
<td align="left">The data format</td>
</tr>
<tr>
<td align="left">locale</td>
<td align="left">String</td>
<td align="left">Uses <code>Locale.forLanguageTag</code>. Example: en-US</td>
</tr>
<tr>
<td align="left">timeZone</td>
<td align="left">String</td>
<td align="left">Uses <code>TimeZone.getTimeZone</code>. Example: <code>PST</code></td>
</tr>
<tr>
<td align="left">serializationInclusion</td>
<td align="left">String</td>
<td align="left">One of <code>JsonInclude.Include</code>. Example: ALWAYS</td>
</tr>
<tr>
<td align="left">propertyNamingStrategy</td>
<td align="left">String</td>
<td align="left">Name of an instance of <code>PropertyNamingStrategy</code>. Example: <code>SNAKE_CASE</code></td>
</tr>
<tr>
<td align="left">defaultTyping</td>
<td align="left">String</td>
<td align="left">The global for polymorphic(å¤šæ€) type handling from enum <code>ObjectMapper.DefaultTypeing</code>. Example: NON_FINAL</td>
</tr>
</tbody></table>
<p>Example:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jackson:</span></span><br><span class="line">    <span class="attr">serializationInclusion:</span> <span class="string">ALWAYS</span></span><br></pre></td></tr></table></figure>

<h4 id="Features-ç‰¹æ€§"><a href="#Features-ç‰¹æ€§" class="headerlink" title="Features (ç‰¹æ€§)"></a>Features (ç‰¹æ€§)</h4><p>æ‰€æœ‰çš„ç‰¹æ€§éƒ½å¯ä»¥é€šè¿‡é…ç½®å®ƒä»¬çš„åç§°ä½œä¸º key, ä¸€ä¸ª boolean å€¼ä½œä¸º value æ¥æŒ‡æ˜æ˜¯å¦å¼€å¯è¿™ä¸ªç‰¹æ€§:</p>
<table>
<thead>
<tr>
<th align="left">Name</th>
<th align="left">Type</th>
<th align="left">Meaning</th>
</tr>
</thead>
<tbody><tr>
<td align="left">serialization</td>
<td align="left">Map</td>
<td align="left"><code>SerializationFeature</code></td>
</tr>
<tr>
<td align="left">deserialization</td>
<td align="left">Map</td>
<td align="left"><code>DeserializationFeature</code></td>
</tr>
<tr>
<td align="left">mapper</td>
<td align="left">Map</td>
<td align="left"><code>MapperFeature</code></td>
</tr>
<tr>
<td align="left">parser</td>
<td align="left">Map</td>
<td align="left"><code>JsonParser.Feature</code></td>
</tr>
<tr>
<td align="left">generator</td>
<td align="left">Map</td>
<td align="left"><code>JsonGenerator.Feature</code></td>
</tr>
<tr>
<td align="left">factory</td>
<td align="left">Map</td>
<td align="left"><code>JsonFactory.Feature</code></td>
</tr>
</tbody></table>
<p>Example:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jackson:</span></span><br><span class="line">    <span class="attr">serialization:</span></span><br><span class="line">        <span class="attr">indentOutput:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">writeDatesAsTimestamps:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">deserialization:</span></span><br><span class="line">        <span class="attr">useBigIntegerForInts:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">failOnUnknownProperties:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<h4 id="Further-customing-JsonFactory-æ›´æ·±å…¥è‡ªå®šä¹‰-JsonFactory"><a href="#Further-customing-JsonFactory-æ›´æ·±å…¥è‡ªå®šä¹‰-JsonFactory" class="headerlink" title="Further customing JsonFactory (æ›´æ·±å…¥è‡ªå®šä¹‰ JsonFactory )"></a>Further customing <code>JsonFactory</code> (æ›´æ·±å…¥è‡ªå®šä¹‰ <code>JsonFactory</code> )</h4><p>ä½¿ç”¨è‡ªå®šä¹‰çš„ <code>JsonFactory</code> Bean, é€šè¿‡æä¾›ä¸€ä¸ª <code>BeanCreatedEventListener&lt;JsonFactory&gt;</code> æ¥åœ¨å¯åŠ¨æ—¶é…ç½®é»˜è®¤çš„ Bean</p>
<h4 id="Support-for-JsonView-JsonView-çš„æ”¯æŒ"><a href="#Support-for-JsonView-JsonView-çš„æ”¯æŒ" class="headerlink" title="Support for @JsonView (@JsonView çš„æ”¯æŒ)"></a>Support for <code>@JsonView</code> (<code>@JsonView</code> çš„æ”¯æŒ)</h4><p>å¦‚æœåœ¨ <code>application.yml</code> ä¸­é…ç½®äº† <code>jackson.json-view.enabled</code> ä¸º <code>true</code></p>
<p>é‚£ä¹ˆå¯ä»¥åœ¨ Controller æ–¹æ³•ä¸Šä½¿ç”¨ <code>@JsonView</code> æ³¨è§£</p>
<p>Jackson çš„ <code>@JsonView</code> æ³¨è§£è®©ä½ å¯ä»¥åœ¨æ¯ä¸ªå“åº”ä¸Šæ§åˆ¶å“ªäº›å±æ€§è¦è¿›è¡Œæš´éœ²</p>
<h4 id="Beans-Beans"><a href="#Beans-Beans" class="headerlink" title="Beans (Beans)"></a>Beans (Beans)</h4><p>é™¤äº†é€šè¿‡é…ç½®çš„æ–¹å¼, è¿˜å¯ä»¥é€šè¿‡æ³¨å†Œ Bean çš„æ–¹å¼æ¥è‡ªå®šä¹‰ Jackson</p>
<p>æ‰€æœ‰ç»§æ‰¿å¦‚ä¸‹å…¶ä¸­ä¸€ä¸ªç±»çš„ Bean éƒ½è¢«æ³¨å†Œåˆ° <code>object mapper</code> ä¸­:</p>
<ul>
<li><code>Module</code></li>
<li><code>JsonDeserializer</code></li>
<li><code>JsonSerializer</code></li>
<li><code>KeyDeserializer</code></li>
<li><code>BeanDeserializerModifier</code></li>
<li><code>BeanSerializerModifier</code></li>
</ul>
<h4 id="Service-Loader-Service-åŠ è½½å™¨"><a href="#Service-Loader-Service-åŠ è½½å™¨" class="headerlink" title="Service Loader (Service åŠ è½½å™¨)"></a>Service Loader (Service åŠ è½½å™¨)</h4><p>ä»»ä½•é€šè¿‡ service loader åŠ è½½çš„ module éƒ½ä¼šè¢«æ·»åŠ åˆ°é»˜è®¤ object mapper</p>
<h4 id="Number-Precision-æ•°å€¼ç²¾ç¡®æ€§"><a href="#Number-Precision-æ•°å€¼ç²¾ç¡®æ€§" class="headerlink" title="Number Precision (æ•°å€¼ç²¾ç¡®æ€§)"></a>Number Precision (æ•°å€¼ç²¾ç¡®æ€§)</h4><p>åœ¨ JSON è§£ææ—¶, æ¡†æ¶å¯èƒ½ä¼šè½¬æ¢ä»»ä½•è¾“å…¥çš„æ•°æ®åˆ°ä¸€ä¸ªä¸­é—´å¯¹è±¡æ¨¡å‹ä¸­</p>
<p>é»˜è®¤æƒ…å†µä¸‹, è¿™ä¸ªæ¨¡å‹ä½¿ç”¨ <code>BigInteger</code>,<code>long</code>,<code>double</code> æ¥è¡¨ç¤ºæ•°å€¼</p>
<p>ä¾‹å¦‚, å³ä½¿ååºåˆ—åŒ–çš„ç›®æ ‡ç±»å‹ä½¿ç”¨äº† <code>BigDecimal</code>, ä¹Ÿå¯èƒ½ä¼šæˆªæ–­æ— æ³•ä½¿ç”¨ <code>double</code> è¡¨ç¤ºçš„å…·æœ‰è®¸å¤šå°æ•°ä½çš„æ•°å­—</p>
<blockquote>
<p>Metadata on the number of trailing zeroes (BigDecimal.precision()), e.g. the difference between 0.12 and 0.120, is also discarded</p>
</blockquote>
<p>å…³äºå°¾éƒ¨çš„0çš„å…ƒæ•°æ®(<code>BigDecimal.precision()</code>), ä¾‹å¦‚ <code>0.12</code> å’Œ <code>0.120</code> ä¹‹é—´çš„åŒºåˆ«ä¹Ÿè¢«ä¸¢å¼ƒ</p>
<p>å¦‚æœä½ éœ€è¦å®Œæ•´ç²¾ç¡®çš„æ•°å€¼ç±»å‹, ä½¿ç”¨å¦‚ä¸‹é…ç½®:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jackson:</span></span><br><span class="line">    <span class="attr">deserialization:</span></span><br><span class="line">        <span class="attr">useBigIntegerForInts:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">useBigDecimalForFloats:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h2 id="Data-Validation-æ•°æ®æ ¡éªŒ"><a href="#Data-Validation-æ•°æ®æ ¡éªŒ" class="headerlink" title="Data Validation (æ•°æ®æ ¡éªŒ)"></a>Data Validation (æ•°æ®æ ¡éªŒ)</h2><p>Micronaut é€šè¿‡ <code>micronaut-validation</code> ä¾èµ–å¯¹ <code>javax.validation</code> æ³¨è§£æä¾›æœ¬åœ°æ”¯æŒ</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation(<span class="string">&quot;io.micronaut:micronaut-validation&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…é€šè¿‡ <code>micronaut-hibernate-validator</code> ä¾èµ–æä¾›å®Œæ•´çš„ JSR 380 å®ç°:</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation(<span class="string">&quot;io.micronaut.beanvalidation:micronaut-hibernate-validator&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>javax.validation</code> æ³¨è§£æ ¡éªŒå‚æ•°å¹¶åœ¨ç±»çº§åˆ«ä¸Šä½¿ç”¨ <code>Validated</code> æ³¨è§£:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.http.HttpResponse</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Controller</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Get</span><br><span class="line"><span class="keyword">import</span> io.micronaut.validation.Validated</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotBlank</span><br><span class="line"></span><br><span class="line"><span class="meta">@Validated</span>  <span class="comment">// Annotate controller with Validated</span></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">&quot;/email&quot;</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EmailController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Get</span>(<span class="string">&quot;/send&quot;</span>)</span><br><span class="line">    HttpResponse send(<span class="meta">@NotBlank</span> String recipient,</span><br><span class="line">                      <span class="meta">@NotBlank</span> String subject) &#123;</span><br><span class="line">                          HttpResponse.ok(<span class="attr">msg:</span> <span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">                      &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœå‘ç”Ÿæ ¡éªŒå¼‚å¸¸æŠ›å‡ºäº†ä¸€ä¸ª <code>javax.validation.ConstraintViolationException</code> å¼‚å¸¸, é»˜è®¤ä½¿ç”¨å†…ç½®çš„ <code>io.micronaut.validation.exception.ConstraintExceptionHandler</code> æ¥å¤„ç†è¿™ä¸ªå¼‚å¸¸</p>
<p>å¦‚æœè¦ä½¿ç”¨ä½ è‡ªå·±çš„ <code>ExceptionHandler</code> æ¥å¤„ç†é™åˆ¶å¼‚å¸¸(constraint exception), ä½¿ç”¨ <code>@Replaces(ConstraintExceptionHandler.class)</code> å¸¦æ›¿æ¢é»˜è®¤çš„å¼‚å¸¸å¤„ç†å™¨</p>
<p>å¦‚æœåœ¨ Controller æ–¹æ³•ä¸­ä½¿ç”¨ POJO æ¥æ¥æ”¶å‚æ•°, é‚£ä¹ˆåƒè¿™æ ·è¿›è¡Œæ ¡éªŒ:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.core.annotation.Introspected</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotBlank</span><br><span class="line"></span><br><span class="line"><span class="meta">@Introspected</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Email</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank</span>   <span class="comment">// å¯ä»¥åœ¨ä½ çš„ POJO ä¸­ä½¿ç”¨ javax.validation æ³¨è§£</span></span><br><span class="line">    String subject</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank</span>   <span class="comment">// å¯ä»¥åœ¨ä½ çš„ POJO ä¸­ä½¿ç”¨ javax.validation æ³¨è§£</span></span><br><span class="line">    String recipient</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨ä½ çš„ Controller ä¸Šä½¿ç”¨ <code>@Validated</code> æ³¨è§£, åœ¨ç»‘å®šçš„ POJO ä¸Šä½¿ç”¨ <code>@Valid</code> æ³¨è§£:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.http.HttpResponse</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Body</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Controller</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Post</span><br><span class="line"><span class="keyword">import</span> io.micronaut.validation.Validated</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.Valid</span><br><span class="line"></span><br><span class="line"><span class="meta">@Validated</span> <span class="comment">// Annotate the controller with @Validated</span></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">&quot;/email&quot;</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EmailController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Post</span>(<span class="string">&quot;/send&quot;</span>)</span><br><span class="line">    HttpResponse send(<span class="meta">@Body</span> <span class="meta">@Valid</span> Email email) &#123; <span class="comment">// Annotate the POJO to validate with @Valid</span></span><br><span class="line">        HttpResponse.ok(<span class="attr">msg:</span> <span class="string">&quot;OK&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Bean æ³¨å…¥æ”¯æŒé€šè¿‡ Hibernate Validator configuration ä½¿ç”¨è‡ªå®šä¹‰é™åˆ¶(constraints)</p>
<h2 id="Serving-Static-Resources-æä¾›é™æ€èµ„æº"><a href="#Serving-Static-Resources-æä¾›é™æ€èµ„æº" class="headerlink" title="Serving Static Resources (æä¾›é™æ€èµ„æº)"></a>Serving Static Resources (æä¾›é™æ€èµ„æº)</h2><p>é™æ€èµ„æºè§£ææ˜¯é»˜è®¤å¼€å¯çš„. Micronaut æ”¯æŒä» classpath æˆ– æ–‡ä»¶ç³»ç»Ÿ ä¸­è§£æèµ„æº</p>
<p>Table - Configuration Properties for <code>StaticResourceConfiguration</code>:</p>
<table>
<thead>
<tr>
<th align="left">Property</th>
<th align="left">Type</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>micronaut.router.static-resources.*.enabled</code></td>
<td align="left"><code>boolean</code></td>
<td align="left">Sets whether this specific mapping is enabled. Default value <code>true</code></td>
</tr>
<tr>
<td align="left"><code>micronaut.router.static-resources.*.paths</code></td>
<td align="left"><code>java.util.List</code></td>
<td align="left">A list of paths either starting with <code>classpath:</code> or <code>file:</code>. You can serve files from anywhere on disk or the classpath. ä¾‹å¦‚ <code>src/main/resources/public</code> å¯¹åº” <code>classpath:public</code></td>
</tr>
<tr>
<td align="left"><code>micronaut.router.static-resources.*.mapping</code></td>
<td align="left"><code>java.lang.String</code></td>
<td align="left">The path resources should be served from. Uses ant path matching. Default value <code>/**</code></td>
</tr>
</tbody></table>
<h2 id="Error-Handling-é”™è¯¯å¤„ç†"><a href="#Error-Handling-é”™è¯¯å¤„ç†" class="headerlink" title="Error Handling (é”™è¯¯å¤„ç†)"></a>Error Handling (é”™è¯¯å¤„ç†)</h2><h3 id="Status-Handlers-çŠ¶æ€å¤„ç†å™¨"><a href="#Status-Handlers-çŠ¶æ€å¤„ç†å™¨" class="headerlink" title="Status Handlers (çŠ¶æ€å¤„ç†å™¨)"></a>Status Handlers (çŠ¶æ€å¤„ç†å™¨)</h3><p><code>@Error</code> æ³¨è§£æ”¯æŒå®šä¹‰ä¸€ä¸ªå¼‚å¸¸ç±»æˆ–ä¸€ä¸ª HTTP çŠ¶æ€</p>
<p>ä½¿ç”¨æ³¨è§£ <code>@Error</code> ä¿®é¥°çš„æ–¹æ³•å¿…é¡»å®šä¹‰åœ¨ä¸€ä¸ªä½¿ç”¨ <code>@Controller</code> æ³¨è§£ä¿®é¥°çš„ç±»ä¸­</p>
<p><code>@Error</code> æ³¨è§£è¿˜æ”¯æŒæŒ‡å®š global æˆ– local, é»˜è®¤æ˜¯ local</p>
<blockquote>
<p>Local error handlers only respond to exceptions thrown as a result of the route being matched to another method in the same controller.</p>
</blockquote>
<p>æœ¬åœ°å¼‚å¸¸å¤„ç†å™¨åªèƒ½å¤„ç†åŒä¸€ä¸ª Controller ä¸­å¦å¤–ä¸€ä¸ªåŒ¹é…è·¯ç”±ç»“æœçš„æ–¹æ³•</p>
<p>å…¨å±€å¼‚å¸¸å¤„ç†å™¨å¯ä»¥å“åº”æ‰€æœ‰æŠ›å‡ºçš„å¼‚å¸¸</p>
<p>åœ¨è§£æå“ªä¸ªå¤„ç†å™¨è¿›è¡Œå¤„ç†æ—¶, ä¼˜å…ˆä½¿ç”¨æœ¬åœ°å¼‚å¸¸å¤„ç†å™¨æ¥å¤„ç†å¼‚å¸¸</p>
<p>åœ¨å®šä¹‰ä¸€ä¸ªå¼‚å¸¸çš„å¼‚å¸¸å¤„ç†å™¨æ—¶, ä½ å¯ä»¥å®šä¹‰å¼‚å¸¸å®ä¾‹ä½œä¸ºæ–¹æ³•çš„å‚æ•°è¿›è¡Œä¼ å…¥, ç„¶åå¯ä»¥åˆ é™¤æ‰æ³¨è§£ä¸­çš„å¼‚å¸¸å±æ€§</p>
<h3 id="Local-Error-Handling-æœ¬åœ°å¼‚å¸¸å¤„ç†"><a href="#Local-Error-Handling-æœ¬åœ°å¼‚å¸¸å¤„ç†" class="headerlink" title="Local Error Handling (æœ¬åœ°å¼‚å¸¸å¤„ç†)"></a>Local Error Handling (æœ¬åœ°å¼‚å¸¸å¤„ç†)</h3><p>Example - Local exception handler:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Error</span></span><br><span class="line">HttpResponse&lt;JsonError&gt; jsonError(HttpRequest request, JsonParseException e) &#123;</span><br><span class="line">    JsonError error = <span class="keyword">new</span> JsonError(<span class="string">&quot;Invalid JSON: $e.message&quot;</span>).link(Link.SELF, Link.of(request.uri))</span><br><span class="line"></span><br><span class="line">    HttpResponse.&lt;JsonError&gt;status(HttpStatus.BAD_REQUEST, <span class="string">&quot;Fix Your JSON&quot;</span>).body(error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Example - Local status handler:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Error</span>(status = HttpStatus.NOT_FOUND)</span><br><span class="line">HttpResponse&lt;JsonError&gt; notFound(HttpRequest request) &#123;</span><br><span class="line">    JsonError error = <span class="keyword">new</span> JsonError(<span class="string">&quot;Person Not Found&quot;</span>)</span><br><span class="line">    .link(Link.SELF, Link.of(request.uri))</span><br><span class="line"></span><br><span class="line">    HttpResponse.&lt;JsonError&gt;notFound().body(error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Global-Error-Handling-å…¨å±€å¼‚å¸¸å¤„ç†"><a href="#Global-Error-Handling-å…¨å±€å¼‚å¸¸å¤„ç†" class="headerlink" title="Global Error Handling (å…¨å±€å¼‚å¸¸å¤„ç†)"></a>Global Error Handling (å…¨å±€å¼‚å¸¸å¤„ç†)</h3><p>Example - Global error handler:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Error</span>(global = <span class="literal">true</span>)</span><br><span class="line">HttpResponse&lt;JsonError&gt; error(HttpRequest request, Throwable e) &#123;</span><br><span class="line">    JsonError error = <span class="keyword">new</span> JsonError(<span class="string">&quot;Bad Things Happend: $e.message&quot;</span>).link(Link.SELF, Link.of(request.uri))</span><br><span class="line"></span><br><span class="line">    HttpResponse.&lt;JsonError&gt;serverError().body(error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Example - Global status handler:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Error</span>(status = HttpStatus.NOT_FOUND)</span><br><span class="line">HttpResponse&lt;JsonError&gt; notFound(HttpRequest request) &#123;</span><br><span class="line">    JsonError error = <span class="keyword">new</span> JsonError(<span class="string">&quot;Person Not Found&quot;</span>).link(Link.SELF, Link.of(request.uri))</span><br><span class="line">    HttpResponse.&lt;JsonError&gt;notFound().body(error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ExceptionHandler-å¼‚å¸¸å¤„ç†å™¨"><a href="#ExceptionHandler-å¼‚å¸¸å¤„ç†å™¨" class="headerlink" title="ExceptionHandler (å¼‚å¸¸å¤„ç†å™¨)"></a>ExceptionHandler (å¼‚å¸¸å¤„ç†å™¨)</h3><p>æˆ–è€…, ä½ å¯ä»¥å®ç°ä¸€ä¸ª <code>ExceptionHandler</code>, ä¸€ä¸ªç”¨äºå¤„ç†åœ¨æ‰§è¡Œ HTTP è¯·æ±‚æœŸé—´å‘ç”Ÿçš„å¼‚å¸¸çš„é€šç”¨é’©å­</p>
<h3 id="Built-In-Exception-Handlers-å†…ç½®çš„å¼‚å¸¸å¤„ç†å™¨"><a href="#Built-In-Exception-Handlers-å†…ç½®çš„å¼‚å¸¸å¤„ç†å™¨" class="headerlink" title="Built-In Exception Handlers (å†…ç½®çš„å¼‚å¸¸å¤„ç†å™¨)"></a>Built-In Exception Handlers (å†…ç½®çš„å¼‚å¸¸å¤„ç†å™¨)</h3><p>Micronaut å†…ç½®äº†è¿™äº›å¼‚å¸¸å¤„ç†å™¨:</p>
<table>
<thead>
<tr>
<th align="left">Exception</th>
<th align="left">Handler</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>javax.validation.ConstraintViolationException</code></td>
<td align="left"><code>ConstraintExceptionHandler</code></td>
</tr>
<tr>
<td align="left"><code>ContentLengthExceededException</code></td>
<td align="left"><code>ContentLengthExceededHandler</code></td>
</tr>
<tr>
<td align="left"><code>ConversionErroException</code></td>
<td align="left"><code>ConversionErrorHandler</code></td>
</tr>
<tr>
<td align="left"><code>DuplicateRoute</code></td>
<td align="left"><code>DuplicateRouteHandler</code></td>
</tr>
<tr>
<td align="left"><code>HttpStatusException</code></td>
<td align="left"><code>httpStatusHandler</code></td>
</tr>
<tr>
<td align="left"><code>com.fasterxml.jackson.core.JsonProcessingException</code></td>
<td align="left"><code>JsonExceptionHandler</code></td>
</tr>
<tr>
<td align="left"><code>java.net.URISyntaxException</code></td>
<td align="left"><code>URISyntaxHandler</code></td>
</tr>
<tr>
<td align="left"><code>UnsatisfiedArgumentException</code></td>
<td align="left"><code>UnsatisfiedArgumentHandler</code></td>
</tr>
<tr>
<td align="left"><code>UnsatisfiedRouteException</code></td>
<td align="left"><code>UnsatisfiedRouteHandler</code></td>
</tr>
<tr>
<td align="left"><code>org.grails.datasource.mapping.validation.ValidationException</code></td>
<td align="left"><code>ValidationExceptionHandler</code></td>
</tr>
</tbody></table>
<h4 id="Custom-Exception-Handler-è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†å™¨"><a href="#Custom-Exception-Handler-è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†å™¨" class="headerlink" title="Custom Exception Handler (è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†å™¨)"></a>Custom Exception Handler (è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†å™¨)</h4><p>å‡è®¾ä½ æŠ›å‡ºä¸€ä¸ªè‡ªå®šä¹‰å¼‚å¸¸: <code>class OutOfStockException extends RuntimeException &#123;&#125;</code></p>
<p>è¦åšåˆ°å½“æŠ›å‡ºè¿™ä¸ª <code>OutOfStockException</code> æ—¶å“åº” 400, å¯ä»¥æ³¨å†Œä¸€ä¸ª <code>ExceptionHandler</code>:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Produces</span></span><br><span class="line"><span class="meta">@Singleton</span></span><br><span class="line"><span class="meta">@Requires</span>(classes = [OutOfStockException, ExceptionHandler])</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OutOfStockExceptionHandler</span> <span class="keyword">implements</span> <span class="title class_">ExceptionHandler</span>&lt;OutOfStockException, HttpResponse&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ErrorResponseProcessor&lt;?&gt; errorResponseProcessor</span><br><span class="line"></span><br><span class="line">    OutOfStockExceptionHandler(ErrorResponseProcessor&lt;?&gt; errorResponseProcessor) &#123;</span><br><span class="line">        this.errorResponseProcessor = errorResponseProcessor</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    HttpResponse handle(HttpRequest request, OutOfStockException e) &#123;</span><br><span class="line">        errorResponseProcessor.processResponse(ErrorContext.builder(request)</span><br><span class="line">        .cause(e)</span><br><span class="line">        .errorMessage(<span class="string">&quot;No Stock available&quot;</span>)</span><br><span class="line">        .build(), HttpResponse.badRequest())</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Error-Formatting-é”™è¯¯æ ¼å¼"><a href="#Error-Formatting-é”™è¯¯æ ¼å¼" class="headerlink" title="Error Formatting (é”™è¯¯æ ¼å¼)"></a>Error Formatting (é”™è¯¯æ ¼å¼)</h3><p>Micronaut é€šè¿‡ç±»å‹ä¸º <code>ErrorResponseProcessor</code> ç±»å‹çš„ Bean æ¥æä¾›é”™è¯¯å“åº”ä½“</p>
<p>é»˜è®¤çš„å“åº”ä½“æ˜¯ <code>vnd.error</code>, å¯ä»¥é€šè¿‡å®ç° <code>ErrorResponseProcessor</code> æ¥æ§åˆ¶å“åº”</p>
<blockquote>
<p>If customization of the response other than items related to the errors is desired, the exception handler that is handling the exception needs to be overridden.</p>
</blockquote>
<p>å¦‚æœéœ€è¦è‡ªå®šä¹‰å“åº”è€Œä¸æ˜¯éœ€è¦ä¸é”™è¯¯ç›¸å…³çš„é¡¹ç›®, åˆ™éœ€è¦è¦†ç›–å¤„ç†å¼‚å¸¸çš„å¼‚å¸¸å¤„ç†å™¨</p>
<h2 id="API-Versioning-API-ç‰ˆæœ¬æ§åˆ¶"><a href="#API-Versioning-API-ç‰ˆæœ¬æ§åˆ¶" class="headerlink" title="API Versioning (API ç‰ˆæœ¬æ§åˆ¶)"></a>API Versioning (API ç‰ˆæœ¬æ§åˆ¶)</h2><p>Micronaut é€šè¿‡ä¸“ç”¨çš„ <code>@Version</code> æ³¨è§£æ¥æ”¯æŒ API ç‰ˆæœ¬æ§åˆ¶</p>
<p>Example - Versioning an API:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.core.version.annotation.Version</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Controller</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Get</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">&quot;/versioned&quot;</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VersionedController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Version</span>(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">    <span class="meta">@Get</span>(<span class="string">&quot;/hello&quot;</span>)</span><br><span class="line">    String helloV1() &#123;</span><br><span class="line">        <span class="string">&quot;helloV1&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Version</span>(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">    <span class="meta">@Get</span>(<span class="string">&quot;/hello&quot;</span>)</span><br><span class="line">    String helloV2() &#123;</span><br><span class="line">        <span class="string">&quot;helloV2&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨ <code>application.yml</code> ä¸­é€šè¿‡è®¾ç½® <code>micronaut.router.versioning.enabled</code> ä¸º <code>true</code> æ¥å¼€å¯ç‰ˆæœ¬æ§åˆ¶:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">router:</span></span><br><span class="line">        <span class="attr">versioning:</span></span><br><span class="line">            <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>é»˜è®¤æƒ…å†µä¸‹ Micronaut åŸºäºä¸¤ç§ç­–ç•¥æ¥è§£æç‰ˆæœ¬å€¼:</p>
<ul>
<li>åŸºäºä¸€ä¸ªåç§°ä¸º <code>X-API-VERSION</code> çš„ HTTP header</li>
<li>åŸºäºä¸€ä¸ªåç§°ä¸º <code>api-version</code> çš„è¯·æ±‚å‚æ•°</li>
</ul>
<p>å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼å¯¹è¿™ä¸ªç­–ç•¥è¿›è¡Œé…ç½®:</p>
<p>Example - Configuring Versioning:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">router:</span></span><br><span class="line">        <span class="attr">versioning:</span></span><br><span class="line">            <span class="attr">enabled:</span> <span class="literal">true</span>                   <span class="string">//</span> <span class="string">Enables</span> <span class="string">versioning</span></span><br><span class="line">            <span class="attr">parameter:</span></span><br><span class="line">                <span class="attr">enabled:</span> <span class="literal">false</span>              <span class="string">//</span> <span class="string">Enables</span> <span class="string">or</span> <span class="string">disables</span> <span class="string">parameter-based</span> <span class="string">versioning</span></span><br><span class="line">                <span class="attr">names:</span> <span class="string">&#x27;v,api-version&#x27;</span>      <span class="string">//</span> <span class="string">Specify</span> <span class="string">the</span> <span class="string">parameter</span> <span class="string">names</span> <span class="string">as</span> <span class="string">a</span> <span class="string">comma-separated</span> <span class="string">list</span></span><br><span class="line">            <span class="attr">header:</span></span><br><span class="line">                <span class="attr">enabled:</span> <span class="literal">true</span>               <span class="string">//</span> <span class="string">Enables</span> <span class="string">or</span> <span class="string">disables</span> <span class="string">header-based</span> <span class="string">versioning</span></span><br><span class="line">                <span class="attr">names:</span>                      <span class="string">//</span> <span class="string">Specify</span> <span class="string">the</span> <span class="string">header</span> <span class="string">names</span> <span class="string">as</span> <span class="string">a</span> <span class="string">list</span></span><br><span class="line">                    <span class="bullet">-</span> <span class="string">&#x27;X-API-VERSION&#x27;</span></span><br><span class="line">                    <span class="bullet">-</span> <span class="string">&#x27;Accept-Version&#x27;</span></span><br></pre></td></tr></table></figure>

<p>è¿˜å¯ä»¥é€šè¿‡å®ç° <code>RequestVersionResolver</code> æ¥å£æ¥æ¥æ”¶ä¸€ä¸ª <code>HttpRequest</code>, å®ç°ä»»ä½•æƒ³è¦çš„ç­–ç•¥</p>
<h3 id="Default-Version-é»˜è®¤ç‰ˆæœ¬"><a href="#Default-Version-é»˜è®¤ç‰ˆæœ¬" class="headerlink" title="Default Version (é»˜è®¤ç‰ˆæœ¬)"></a>Default Version (é»˜è®¤ç‰ˆæœ¬)</h3><p>å¯ä»¥é€šè¿‡é…ç½®æ¥æä¾›ä¸€ä¸ªé»˜è®¤ç‰ˆæœ¬:</p>
<p>Example - Configuring Default Version:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">router:</span></span><br><span class="line">        <span class="attr">versioning:</span></span><br><span class="line">            <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">default-version:</span> <span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ»¡è¶³ä»¥ä¸‹çš„æ¡ä»¶, é‚£ä¹ˆä¸€ä¸ªè·¯ç”±å°±æ˜¯ä¸åŒ¹é…çš„:</p>
<ul>
<li>é…ç½®äº†é»˜è®¤çš„ç‰ˆæœ¬</li>
<li>è¯·æ±‚ä¸­æ²¡æœ‰ç‰ˆæœ¬å€¼</li>
<li>è·¯ç”±å®šä¹‰äº†ä¸€ä¸ªç‰ˆæœ¬</li>
<li>è·¯ç”±ç‰ˆæœ¬æ²¡æœ‰åŒ¹é…é»˜è®¤çš„ç‰ˆæœ¬</li>
</ul>
<p>å¦‚æœä¼ å…¥çš„è¯·æ±‚æŒ‡å®šäº†ä¸€ä¸ªç‰ˆæœ¬, é‚£ä¹ˆé»˜è®¤çš„ç‰ˆæœ¬å°±ä¸ç”Ÿæ•ˆ</p>
<h3 id="Versioning-Client-Requests-ç‰ˆæœ¬åŒ–çš„å®¢æˆ·ç«¯è¯·æ±‚"><a href="#Versioning-Client-Requests-ç‰ˆæœ¬åŒ–çš„å®¢æˆ·ç«¯è¯·æ±‚" class="headerlink" title="Versioning Client Requests (ç‰ˆæœ¬åŒ–çš„å®¢æˆ·ç«¯è¯·æ±‚)"></a>Versioning Client Requests (ç‰ˆæœ¬åŒ–çš„å®¢æˆ·ç«¯è¯·æ±‚)</h3><p>Micronaut çš„å“åº”å¼ HTTP å®¢æˆ·ç«¯è¿˜æ”¯æŒé€šè¿‡ <code>@Version</code> æ³¨è§£å¯¹å¤–å‘è¯·æ±‚è¿›è¡Œè‡ªåŠ¨ç‰ˆæœ¬æ§åˆ¶</p>
<p>é»˜è®¤æƒ…å†µä¸‹ ,å¦‚æœä½ ä½¿ç”¨ <code>@Version</code> æ³¨è§£ä¿®é¥°ä¸€ä¸ªå®¢æˆ·ç«¯æ¥å£, é‚£ <code>@Version</code> æ³¨è§£ä¸Šçš„å€¼å°†ä¼šè¢«åŒ…å«åˆ° <code>X-API-VERSION</code> è¯·æ±‚å¤´ä¸­</p>
<p>Example:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.core.version.annotation.Version</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Get</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.client.annotation.Client</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono</span><br><span class="line"></span><br><span class="line"><span class="meta">@Client</span>(<span class="string">&quot;/hello&quot;</span>)</span><br><span class="line"><span class="meta">@Version</span>(<span class="string">&quot;1&quot;</span>)           <span class="comment">// 1</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">HelloClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Get</span>(<span class="string">&quot;/greeting/&#123;name&#125;&quot;</span>)</span><br><span class="line">    String sayHello(String name)</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Version</span>(<span class="string">&quot;2&quot;</span>)       <span class="comment">// 2</span></span><br><span class="line">    <span class="meta">@Get</span>(<span class="string">&quot;/greeting/&#123;name&#125;&quot;</span>)</span><br><span class="line">    Mono&lt;String&gt; sayHelloTwo(String name)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>1</code> : The <code>@Version</code> annotation can be used at the type level to specify the version to use for all methods</p>
<p><code>2</code> : When defined at the method level it is used only for that method</p>
<p>ç‰ˆæœ¬æ€æ ·åœ¨æ¯ä¸ªè¯·æ±‚ä¸­å‘é€çš„é»˜è®¤è¡Œä¸ºå¯ä»¥é€šè¿‡ <code>DefaultClientVersioningConfiguration</code> è¿›è¡Œé…ç½®:</p>
<p>Table - Configuration Properties for <code>DefaultClientVersioningConfiguration</code>:</p>
<table>
<thead>
<tr>
<th align="left">Property</th>
<th align="left">Type</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>micronaut.http.client.versioning.default.headers</code></td>
<td align="left"><code>java.util.List</code></td>
<td align="left">The list of request header names</td>
</tr>
<tr>
<td align="left"><code>micronaut.http.client.versioning.default.parameters</code></td>
<td align="left"><code>java.util.list</code></td>
<td align="left">The list of request query parameter names</td>
</tr>
</tbody></table>
<p>ä¾‹å¦‚, è¦ä½¿ç”¨ <code>Accept-Version</code> ä½œä¸ºè¯·æ±‚å¤´åç§°:</p>
<p>Example - Configuring Client Versioning:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">        <span class="attr">client:</span></span><br><span class="line">            <span class="attr">versioning:</span></span><br><span class="line">                <span class="attr">default:</span></span><br><span class="line">                    <span class="attr">headers:</span></span><br><span class="line">                        <span class="bullet">-</span> <span class="string">&#x27;Accept-Version&#x27;</span></span><br><span class="line">                        <span class="bullet">-</span> <span class="string">&#x27;X-API-VERSION&#x27;</span></span><br></pre></td></tr></table></figure>

<p><code>default</code> key å…³è”åˆ°é»˜è®¤çš„é…ç½®</p>
<p>å¯ä»¥æŒ‡å®š ç‰¹å®šå®¢æˆ·ç«¯ çš„é…ç½®, é€šè¿‡ä½¿ç”¨ä¼ é€’ç»™ <code>@Client</code> æ³¨è§£çš„å€¼(é€šå¸¸æ˜¯ service ID):</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">        <span class="attr">client:</span></span><br><span class="line">            <span class="attr">versioning:</span></span><br><span class="line">                <span class="attr">greeting-service:</span></span><br><span class="line">                    <span class="attr">headers:</span></span><br><span class="line">                        <span class="bullet">-</span> <span class="string">&#x27;Accept-Version&#x27;</span></span><br><span class="line">                        <span class="bullet">-</span> <span class="string">&#x27;X-API-VERSION&#x27;</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä¾‹å­ä½¿ç”¨ <code>greeting-service</code> æ¥ä½œä¸º key åç§°, è¿™ä¸ªåç§°å¯ä»¥ç”¨æ¥é…ç½®ä¸€ä¸ªä½¿ç”¨ <code>@Client(&#39;greeting-service&#39;)</code> ä¿®é¥°çš„å®¢æˆ·ç«¯</p>
<h2 id="Handling-Form-Data-å¤„ç†è¡¨å•æ•°æ®"><a href="#Handling-Form-Data-å¤„ç†è¡¨å•æ•°æ®" class="headerlink" title="Handling Form Data (å¤„ç†è¡¨å•æ•°æ®)"></a>Handling Form Data (å¤„ç†è¡¨å•æ•°æ®)</h2><p>ä¸ºäº†ä½¿è¡¨å•æ•°æ®å’Œ JSON ä¹‹é—´çš„è‡ªå®šä¹‰æ•°æ®ç»‘å®šæ¨¡å‹ä¿æŒä¸€è‡´, Micronaut ä½¿ç”¨ Jackson æ¥å®ç°æ¥è‡ªè¡¨å•æäº¤çš„ç»‘å®šæ•°æ®</p>
<p>è¿™ä¸ªåšæ³•çš„å¥½å¤„æ˜¯åŒæ ·çš„ç”¨äºè‡ªå®šä¹‰ JSON ç»‘å®šçš„ Jackson æ³¨è§£ä¹Ÿå¯ä»¥ç”¨äºè¡¨å•æäº¤</p>
<p>å®é™…ä¸Š, è¿™æ„å‘³ç€è¦ç»‘å®šå¸¸è§„è¡¨å•æ•°æ®, å¯¹å…ˆå‰ JSON ç»‘å®šä»£ç çš„çš„å”¯ä¸€æ›´æ”¹æ˜¯æ›´æ–°æ‰€ä½¿ç”¨çš„ <code>MediaType</code></p>
<p>Example - Binding Form Data to POJOs:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Post</span>(consumes = <span class="string">&#x27;application/form-data&#x27;</span>)</span><br><span class="line">HttpResponse&lt;Person&gt; save(<span class="meta">@Body</span> Person person) &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†é¿å… æœåŠ¡æ‹’ç» æ”»å‡», åœ¨ç»‘å®šæœŸé—´åˆ›å»ºçš„é›†åˆç±»å‹æ•°æ®å’Œæ•°ç»„ç±»å‹æ•°æ®åº”è¯¥è¢«é™åˆ¶, é€šè¿‡åœ¨ <code>application.yml</code> ä¸­é…ç½® <code>jackson.arraySizeThreshold</code></p>
<p>Example - ç»‘å®šåˆ°æ–¹æ³•çš„å•ä¸ªå‚æ•°ä¸Š; è¿˜æ”¯æŒä½¿ç”¨ <code>Optional</code> åŒ…è£…å‚æ•°:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Post</span>(consumes = <span class="string">&#x27;application/form-data&#x27;</span>)</span><br><span class="line">HttpResponse&lt;Person&gt; save(String firstName,</span><br><span class="line">                          String lastName,</span><br><span class="line">                          Optional&lt;Integer&gt; age) &#123;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Writing-Response-Data-ç¼–å†™å“åº”æ•°æ®"><a href="#Writing-Response-Data-ç¼–å†™å“åº”æ•°æ®" class="headerlink" title="Writing Response Data (ç¼–å†™å“åº”æ•°æ®)"></a>Writing Response Data (ç¼–å†™å“åº”æ•°æ®)</h2><blockquote>
<p>Micronautâ€™s HTTP server supports writing chunks of response data by returning a Publisher that emits objects that can be encoded to the HTTP response.</p>
</blockquote>
<p>Micronaut çš„ HTTP server é€šè¿‡è¿”å›ä¸€ä¸ª å‘å¸ƒè€…(Publisher) æ¥æ”¯æŒå†™å…¥å“åº”æ•°æ®å—, è¯¥ å‘å¸ƒè€…(Publisher) è¾“å‡ºå¯ä»¥ç¼–ç ä¸º HTTP å“åº”çš„å¯¹è±¡</p>
<p>ä¸‹è¡¨æ€»ç»“äº†è¿”å›ç±»å‹ç­¾åç¤ºä¾‹ä¸ server ä¸ºäº†å¤„ç†å®ƒä»¬è€Œè¡¨ç°å‡ºæ¥çš„è¡Œä¸º:</p>
<table>
<thead>
<tr>
<th align="left">Return Type</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>Publisher&lt;String&gt;</code></td>
<td align="left">A <code>Publisher</code> that emits each chunk of content as a String</td>
</tr>
<tr>
<td align="left"><code>Flux&lt;byte[]&gt;</code></td>
<td align="left">A <code>Flux</code> that emits each chunk of content as a <code>byte[]</code> without blocking</td>
</tr>
<tr>
<td align="left"><code>Flux&lt;ByteBuf&gt;</code></td>
<td align="left">A Reactor <code>Flux</code> that emits each chunk as a Netty <code>ByteBuf</code></td>
</tr>
<tr>
<td align="left"><code>Flux&lt;Book&gt;</code></td>
<td align="left">When emitting a POJO, each emitted object is encoded as JSON by default without blocking</td>
</tr>
<tr>
<td align="left"><code>Flowable&lt;byte[]&gt;</code></td>
<td align="left">A <code>Flux</code> that emits each chunk of content as a <code>byte[]</code> without blocking</td>
</tr>
<tr>
<td align="left"><code>Flowable&lt;ByteBuf&gt;</code></td>
<td align="left">A Reactor <code>Flux</code> that emits each chunk as a Netty <code>ByteBuf</code></td>
</tr>
<tr>
<td align="left"><code>Flowable&lt;Book&gt;</code></td>
<td align="left">When emitting a POJO, each emitted object is encoded as JSON by default without blocking</td>
</tr>
</tbody></table>
<p>å½“è¿”å›ä¸€ä¸ªå“åº”å¼ç±»å‹æ—¶, server ä½¿ç”¨å€¼ä¸º <code>chunked</code> çš„ <code>Transfer-Encoding</code> å¹¶ä¿æŒå†™å…¥æ•°æ®, ç›´åˆ° <code>Publisher</code> çš„ <code>onComplete</code> æ–¹æ³•è¢«è°ƒç”¨ä¸ºæ­¢</p>
<p>server ä» <code>Publisher</code> ä¸­è¯·æ±‚ä¸€ä¸ª item, è¿›è¡Œå†™å…¥(write), ç„¶åå†è¯·æ±‚ä¸‹ä¸€ä¸ª item, ä»¥æ­¤æ¥æ§åˆ¶èƒŒå‹(back pressure)</p>
<blockquote>
<p>It is up to the implementation of the Publisher to schedule any blocking I&#x2F;O work that may be done as a result of subscribing to the publisher.</p>
</blockquote>
<p>ç”± <code>Publisher</code> çš„å®ç°æ¥è°ƒåº¦æ‰€æœ‰é˜»å¡ I&#x2F;O å·¥ä½œ, è¿™äº›é˜»å¡å·¥ä½œå¯èƒ½ä½œä¸ºä¸€ä¸ªè®¢é˜… <code>Publisher</code> çš„ç»“æœæ¥å®Œæˆ</p>
<h3 id="Performing-Blocking-I-x2F-O-è¿è¡Œé˜»å¡-I-x2F-O"><a href="#Performing-Blocking-I-x2F-O-è¿è¡Œé˜»å¡-I-x2F-O" class="headerlink" title="Performing Blocking I&#x2F;O (è¿è¡Œé˜»å¡ I&#x2F;O)"></a>Performing Blocking I&#x2F;O (è¿è¡Œé˜»å¡ I&#x2F;O)</h3><p>åœ¨ä¸€äº›æƒ…å†µä¸‹, ä½ å¯èƒ½å¸Œæœ›é›†æˆä¸€ä¸ªä¸æ”¯æŒ non-blocking I&#x2F;O çš„åº“</p>
<h4 id="Writable-å¯å†™çš„"><a href="#Writable-å¯å†™çš„" class="headerlink" title="Writable (å¯å†™çš„)"></a>Writable (å¯å†™çš„)</h4><p>åœ¨è¿™ä¸ªåœºæ™¯ä¸‹, ä½ å¯ä»¥åœ¨ä»»ä½• Controller æ–¹æ³•ä¸­è¿”å›ä¸€ä¸ª <code>io.micronaut.core.io.Writable</code> å¯¹è±¡</p>
<p><code>Writable</code> æ¥å£æœ‰å¤šä¸ªç­¾åæ¥å…è®¸å†™å…¥æ•°æ®åˆ°ä¼ ç»Ÿçš„é˜»å¡æµ, ä¾‹å¦‚ <code>Writer</code> å’Œ <code>OutputStream</code></p>
<p>å½“è¿”å›ä¸€ä¸ª <code>Writable</code> æ—¶, é˜»å¡çš„ I&#x2F;O æ“ä½œè¢«è½¬ç§»åˆ° I&#x2F;O çº¿ç¨‹æ± ä¸­, æ‰€ä»¥ Netty çš„ event loop ä¸ä¼šè¢«é˜»å¡</p>
<p>Example - Performing Blocking I&#x2F;O With Writable:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> groovy.text.SimpleTemplateEngine</span><br><span class="line"><span class="keyword">import</span> groovy.text.Template</span><br><span class="line"><span class="keyword">import</span> io.micronaut.core.io.Writable</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.MediaType</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Controller</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Get</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.server.exceptions.HttpServerException</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">&quot;/template&quot;</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TemplateController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SimpleTemplateEngine templateEngine = <span class="keyword">new</span> SimpleTemplateEngine()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Template template = initTemplate()</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Get</span>(value = <span class="string">&#x27;/welcome&#x27;</span>, produces = MediaType.TEXT_PLAIN)</span><br><span class="line">    Writable render() &#123;     <span class="comment">// 2</span></span><br><span class="line">        &#123;</span><br><span class="line">            writer -&gt;</span><br><span class="line">            template.make(<span class="attr">firstName:</span> <span class="string">&quot;Fred&quot;</span>, <span class="attr">lastName:</span> <span class="string">&quot;Flintstone&quot;</span>)        <span class="comment">// 3</span></span><br><span class="line">                    .writeTo(writer)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Template initTemplate() &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> templateEngine.createTemplate(<span class="string">&#x27;Dear $firstname $lastname. Nice to meet you.&#x27;</span>)</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> HttpServerException(<span class="string">&#x27;Cannot create template&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>2</code> : The Controller method returns a <code>Writable</code></p>
<p><code>3</code> : The returned function receives a <code>Writer</code> and calls <code>writeTo</code> on the template</p>
<h4 id="InputStream-è¾“å…¥æµ"><a href="#InputStream-è¾“å…¥æµ" class="headerlink" title="InputStream (è¾“å…¥æµ)"></a>InputStream (è¾“å…¥æµ)</h4><p>å¦ä¸€ä¸ªé€‰é¡¹æ˜¯è¿”å›ä¸€ä¸ªè¾“å…¥æµ. è¿™åœ¨è®¸å¤šå’Œå…¶ä»–æš´éœ²ä¸€ä¸ªæµçš„ API äº¤äº’çš„åœºæ™¯ä¸‹æ˜¯å¾ˆæœ‰ç”¨çš„</p>
<p>Example - Performing Blocking I&#x2F;O With InputStream:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Get</span>(value = <span class="string">&#x27;/write&#x27;</span>, produces = MediaType.TEXT_PLAIN)</span><br><span class="line">InputStream write() &#123;</span><br><span class="line">    <span class="type">byte</span>[] bytes = <span class="string">&quot;test&quot;</span>.getBytes(StandardCharsets.UTF_8)</span><br><span class="line">    <span class="keyword">new</span> ByteArrayInputStream(bytes) <span class="comment">// The input stream is returned and its contents will be the response body</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>The reading of the stream will be offloaded to the IO thread pool if the controller method is executed on the event loop.</p>
</blockquote>
<p>å¦‚æœ Controller æ–¹æ³•æ˜¯æ‰§è¡Œåœ¨ event loop ä¸Šæ—¶, æµçš„è¯»å–åº”è¯¥å¸è½½åˆ° IO çº¿ç¨‹æ± ä¸­</p>
<h4 id="404-Responses-404-å“åº”"><a href="#404-Responses-404-å“åº”" class="headerlink" title="404 Responses (404 å“åº”)"></a>404 Responses (404 å“åº”)</h4><p>åœ¨æŒä¹…å±‚æ‰¾ä¸åˆ°ä¸€ä¸ªé¡¹ç›®æˆ–ç±»ä¼¼çš„åœºæ™¯æ—¶, è¿”å›ä¸€ä¸ª 404 å“åº”:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span>(<span class="string">&quot;/books&quot;</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BooksController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Get</span>(<span class="string">&quot;/stock/&#123;isbn&#125;&quot;</span>)</span><br><span class="line">    Map stock(String isbn) &#123;</span><br><span class="line">        <span class="literal">null</span> <span class="comment">// Returning null triggers a 404(Not Found) response</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Get</span>(<span class="string">&quot;/maybestock/&#123;isbn&#125;&quot;</span>)</span><br><span class="line">    Mono&lt;Map&gt; maybestock(String isbn) &#123;</span><br><span class="line">        Mono.empty() <span class="comment">// Returning an empty Mono triggers a 404(Not Found) response</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Responding with an empty Publisher or Flux results in an empty array being returned if the content type is JSON.</p>
</blockquote>
<p>å¦‚æœ Content-Type ä¸º JSON, ä½¿ç”¨ç©ºçš„ <code>Publisher</code> æˆ– <code>Flux</code> è¿›è¡Œå“åº”ä¼šå¯¼è‡´è¿”å›ä¸€ä¸ªç©ºçš„æ•°ç»„</p>
<h2 id="File-Uploads-æ–‡ä»¶ä¸Šä¼ "><a href="#File-Uploads-æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="File Uploads (æ–‡ä»¶ä¸Šä¼ )"></a>File Uploads (æ–‡ä»¶ä¸Šä¼ )</h2><p>æ–‡ä»¶ä¸Šä¼ å¤„ç†åœ¨ Micronaut ä¸­æœ‰ç‰¹æ®Šçš„å¤„ç†</p>
<blockquote>
<p>Support is provided for streaming of uploads in a non-blocking manner through streaming uploads or completed uploads.</p>
</blockquote>
<p>é€šè¿‡æµå¼ä¸Šä¼ æˆ–å·²å®Œæˆçš„ä¸Šä¼ , ä»¥éé˜»å¡çš„æ–¹å¼æä¾›å¯¹ä¸Šä¼ çš„æµå¼æ”¯æŒ</p>
<p>ä¸ºäº†ä»ä¸€ä¸ª multipart request æ¥æ”¶æ•°æ®, è®¾ç½®æ–¹æ³•æ³¨è§£çš„ <code>consumes</code> å‚æ•°ä¸º <code>MULTIPART_FORM_DATA</code>:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Post</span>(consumes = MediaType.MULTIPART_FORM_DATA)</span><br><span class="line">HttpResponse upload() &#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Route-Arguments-è·¯ç”±å‚æ•°"><a href="#Route-Arguments-è·¯ç”±å‚æ•°" class="headerlink" title="Route Arguments (è·¯ç”±å‚æ•°)"></a>Route Arguments (è·¯ç”±å‚æ•°)</h3><p>æ–¹æ³•å‚æ•°ç±»å‹å†³å®šäº†æ€æ ·æ¥æ”¶ä¸€ä¸ªæ–‡ä»¶</p>
<blockquote>
<p>Data can be received a chunk at a time or when an upload is completed.</p>
</blockquote>
<p>å¯ä»¥ä¸€æ¬¡æ¥æ”¶ä¸€ä¸ªæ•°æ®å—, ä¹Ÿå¯ä»¥åœ¨ä¸Šä¼ å®Œæˆæ—¶æ¥æ”¶æ•°æ®</p>
<p>å¦‚æœè·¯ç”±å‚æ•°åç§°ä¸èƒ½æˆ–è€…ä¸åº”è¯¥ä¸è¯·æ±‚ä¸­çš„ part åç§°åŒ¹é…çš„è¯, æ·»åŠ  <code>@Part</code> æ³¨è§£åˆ°å‚æ•°ä¸­å¹¶æŒ‡å®šè¯·æ±‚ä¸­æƒ³è¦çš„åç§°</p>
<h4 id="Chunk-Data-Types-å—æ•°æ®ç±»å‹"><a href="#Chunk-Data-Types-å—æ•°æ®ç±»å‹" class="headerlink" title="Chunk Data Types (å—æ•°æ®ç±»å‹)"></a>Chunk Data Types (å—æ•°æ®ç±»å‹)</h4><blockquote>
<p>PartData represents a chunk of data received in a multipart request.</p>
</blockquote>
<p><code>PartData</code> ä»£è¡¨ç€ multipart request ä¸­æ¥æ”¶åˆ°çš„æ•°æ®å—</p>
<p><code>PartData</code> æ¥å£æ–¹æ³•è½¬æ¢æ•°æ®ä¸ºä¸€ä¸ª <code>byte[]</code>,<code>InputStream</code>,<code>ByteBuffer</code></p>
<p>åªèƒ½ä» <code>PartData</code> ä¸­è·å–æ•°æ®ä¸€æ¬¡. åº•å±‚ buffer å·²ç»è¢«é‡Šæ”¾äº†, å¯¼è‡´ä¹‹åçš„è·å–å¤±è´¥</p>
<blockquote>
<p>Route arguments of type Publisher are treated as intended to receive a single file, and each chunk of the received file will be sent downstream.</p>
</blockquote>
<p><code>Publisher</code> ç±»å‹çš„è·¯ç”±å‚æ•°è¢«è§†ä¸ºæ—¨åœ¨æ¥æ”¶å•ä¸ªæ–‡ä»¶, å¹¶ä¸”æ¥æ”¶åˆ°çš„æ–‡ä»¶çš„æ¯ä¸ªå—éƒ½å°†è¢«å‘é€åˆ°ä¸‹æ¸¸</p>
<p>å¦‚æœæ³›å‹ç±»å‹ä¸æ˜¯ <code>PartData</code>, å°†å°è¯•ä½¿ç”¨ Micronaut è½¬æ¢æœåŠ¡è¿›è¡Œè½¬æ¢</p>
<p>é»˜è®¤æ”¯æŒè½¬æ¢ä¸º <code>String</code> å’Œ <code>byte[]</code></p>
<p>å¦‚æœä½ éœ€è¦å…³äºä¸€ä¸ªä¸Šä¼ çš„æ–‡ä»¶çš„å…ƒæ•°æ®ä¿¡æ¯, å¯ä»¥ä½¿ç”¨ <code>StreamingFileUpload</code> ç±», è¿™ä¸ªç±»ç»§æ‰¿äº† <code>Publisher</code>, æ‹¥æœ‰å…³äºæ–‡ä»¶çš„ä¿¡æ¯, ä¾‹å¦‚ <code>content type</code> å’Œæ–‡ä»¶åç§°</p>
<p>Example - Streaming file upload:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.http.HttpResponse</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Controller</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Post</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.multipart.StreamFileUpload</span><br><span class="line"><span class="keyword">import</span> org.reactivestreams.Publisher</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> io.micronaut.http.HttpStatus.CONFLICT</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> io.micronaut.http.MediaType.MULTIPART_FORM_DATA</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> io.micronaut.http.MediaType.TEXT_PLAIN</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">&quot;/upload&quot;</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UploadController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Post</span>(value = <span class="string">&quot;/&quot;</span>, consumes = MULTIPART_FORM_DATA, produces = TEXT_PLAIN)       <span class="comment">// 1</span></span><br><span class="line">    Mono&lt;HttpResponse&lt;String&gt;&gt; upload(StreamingFileUpload file) &#123;       <span class="comment">// 2</span></span><br><span class="line">        File tempFile = File.createTempFile(file.filename, <span class="string">&quot;temp&quot;</span>)</span><br><span class="line">        Publisher&lt;Boolean&gt; uploadPublisher = file.transferTo(tempFile)      <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line">        Mono.from(uploadPublisher)      <span class="comment">// 4</span></span><br><span class="line">            .map(&#123; success -&gt;</span><br><span class="line">                <span class="keyword">if</span> (success) &#123;</span><br><span class="line">                    HttpResponse.ok(<span class="string">&quot;Uploaded&quot;</span>)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    HttpResponse.&lt;String&gt;status(CONFLICT).body(<span class="string">&quot;Upload Failed&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>1</code> : The method consumes <code>MULTIPART_FORM_DATA</code></p>
<p><code>2</code> : The method parameters match from attribute names. In this case <code>file</code> will match for example an <code>&lt;input type=&quot;file&quot; name=&quot;file&quot;&gt;</code></p>
<p><code>3</code> : The <code>StreamingFileUpload.transferTo(File)</code> method transfers the file to the server. The method returns a <code>Publisher</code></p>
<p><code>4</code> : The returned <code>Mono</code> subscribes to the <code>Publisher</code> and outputs a response once the the uplaod is complete, without blocking</p>
<p>è¿˜å¯ä»¥ä¼ é€’ä¸€ä¸ª outupt stream åˆ° <code>transferTo</code> æ–¹æ³•</p>
<blockquote>
<p>The reading of the file or stream will be offloaded to the IO thread pool to prevent the possibility of blocking the event loop</p>
</blockquote>
<p>æ–‡ä»¶æˆ–æµçš„è¯»å–å°†ä¼šå¸è½½åˆ° IO çº¿ç¨‹æ± , é¿å…å¯èƒ½çš„å¯¹ event loop çš„é˜»å¡</p>
<p>Example - Streaming file upload:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Post</span>(value = <span class="string">&quot;/&quot;</span>, consumes = MULTIPART_FORM_DATA, produces = TEXT_PLAIN)</span><br><span class="line">    Mono&lt;HttpResponse&lt;String&gt;&gt; upload(StreamingFileUpload file) &#123;</span><br><span class="line">        OutputStream outputStream = <span class="keyword">new</span> ByteArrayOutputStream()     <span class="comment">// 3</span></span><br><span class="line">        </span><br><span class="line">        Publisher&lt;Boolean&gt; uploadPublisher = file.transferTo(outputStream)      <span class="comment">// 4</span></span><br><span class="line"></span><br><span class="line">        Mono.from(uploadPublisher)</span><br><span class="line">            .map(&#123; success -&gt;</span><br><span class="line">                <span class="keyword">if</span> (success) &#123;</span><br><span class="line">                    HttpResponse.ok(<span class="string">&quot;Uploaded&quot;</span>)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    HttpResponse.&lt;String&gt;status(CONFLICT).body(<span class="string">&quot;Upload Failed&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><code>3</code> : A stream is created to output the data to. In real world scenarios this would come from some other source</p>
<p><code>4</code> : The <code>StreamingFileUpload.transferTo(OutputStream)</code> method transfer the file to the server. The method returns a <code>Publisher</code></p>
<h4 id="Whole-Data-Types-å®Œæ•´æ•°æ®ç±»å‹"><a href="#Whole-Data-Types-å®Œæ•´æ•°æ®ç±»å‹" class="headerlink" title="Whole Data Types (å®Œæ•´æ•°æ®ç±»å‹)"></a>Whole Data Types (å®Œæ•´æ•°æ®ç±»å‹)</h4><p>ä¸æ˜¯ <code>Publisher</code> ç±»å‹çš„è·¯ç”±å‚æ•°å¯¼è‡´è·¯ç”±æ‰§è¡Œå»¶è¿Ÿåˆ°ä¸Šä¼ ç»“æŸ</p>
<p>å°†ä¼šå°è¯•å°†æ¥æ”¶åˆ°çš„æ•°æ®è½¬æ¢ä¸ºè¯·æ±‚çš„ç±»å‹</p>
<p>é»˜è®¤æ”¯æŒè½¬æ¢ä¸º <code>String</code>, <code>byte[]</code></p>
<p>é™¤æ­¤ä¹‹å¤–, å¦‚æœä¸€ä¸ªæ”¯æŒæ–‡ä»¶çš„ media type çš„ media type codec å·²ç»æ³¨å†Œ, é‚£ä¹ˆæ–‡ä»¶å¯ä»¥è½¬æ¢ä¸ºä¸€ä¸ª POJO</p>
<p>é»˜è®¤åŒ…å«äº†ä¸€ä¸ª media type codec, è¿™ä¸ª codec å…è®¸å°† JSON æ–‡ä»¶è½¬æ¢ä¸º POJO</p>
<p>Example - Receiving a byte array:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.http.HttpResponse</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Controller</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Post</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> io.micronaut.http.MediaType.MULTIPART_FORM_DATA</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> io.micronaut.http.MediaType.TEXT_PLAIN</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">&quot;/upload&quot;</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BytesUploadController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Post</span>(value = <span class="string">&quot;/bytes&quot;</span>, consumes = MULTIPART_FORM_DATA, produces = TEXT_PLAIN)</span><br><span class="line">    HttpResponse&lt;String&gt; uploadBytes(<span class="type">byte</span>[] file, String fileName) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            File tempFile = File.createTempFile(fileName, <span class="string">&quot;temp&quot;</span>)</span><br><span class="line">            Path path = Paths.get(tempFile.absolutePath)</span><br><span class="line">            Files.write(path, file)</span><br><span class="line">            HttpResponse.ok(<span class="string">&quot;Uploaded&quot;</span>)</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            HttpResponse.badRequest(<span class="string">&quot;Upload Failed&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ éœ€è¦çŸ¥é“ä¸€ä¸ªä¸Šä¼ çš„æ–‡ä»¶çš„å…ƒæ•°æ®ä¿¡æ¯, ä½¿ç”¨ <code>CompletedFileUpload</code> ç±»æ‹¥æœ‰æ–¹æ³•æ¥è·å–æ–‡ä»¶çš„æ•°æ®, æ–‡ä»¶çš„ä¿¡æ¯, ä¾‹å¦‚ content type å’Œæ–‡ä»¶å</p>
<p>Example - File upload with metadata:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Post</span>(value = <span class="string">&quot;/bytes&quot;</span>, consumes = MULTIPART_FORM_DATA, produces = TEXT_PLAIN)</span><br><span class="line">HttpResponse&lt;String&gt; uploadBytes(CompletedFileUpload file) &#123;        <span class="comment">// 2</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        File tempFile = File.createTempFile(file.filename, <span class="string">&quot;temp&quot;</span>)</span><br><span class="line">        Path path = Paths.get(tempFile.absolutePath)</span><br><span class="line">        Files.write(path, file.bytes)       <span class="comment">// 3</span></span><br><span class="line">        HttpResponse.ok(<span class="string">&quot;Uploaded&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        HttpResponse.badRequest(<span class="string">&quot;Upload Failed&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>2</code> : The method parameters match form attribute names. In this case the <code>file</code> will match for example an <code>&lt;input type=&quot;file&quot; name=&quot;file&quot;&gt;</code></p>
<p><code>3</code> : The <code>CompletedFileUpload</code> instance gives access to metadata about the upload as well as access to the file contents</p>
<p>å¦‚æœæ–‡ä»¶ä¸ä¼šè¢«è¯»å–, é‚£ä¹ˆæ–‡ä»¶å¯¹è±¡ä¸Šé¢çš„ <code>discard</code> æ–¹æ³•å¿…é¡»è¢«è°ƒç”¨, ä»¥é˜²æ­¢å†…å­˜æ³„éœ²</p>
<h3 id="Multiple-Uploads-å¤šæ–‡ä»¶ä¸Šä¼ "><a href="#Multiple-Uploads-å¤šæ–‡ä»¶ä¸Šä¼ " class="headerlink" title="Multiple Uploads (å¤šæ–‡ä»¶ä¸Šä¼ )"></a>Multiple Uploads (å¤šæ–‡ä»¶ä¸Šä¼ )</h3><h4 id="Different-Names-ä¸åŒçš„åå­—"><a href="#Different-Names-ä¸åŒçš„åå­—" class="headerlink" title="Different Names (ä¸åŒçš„åå­—)"></a>Different Names (ä¸åŒçš„åå­—)</h4><p>å¦‚æœä¸€ä¸ª multipart request æœ‰å¤šä¸ªå…·æœ‰ä¸åŒ part name çš„ä¸Šä¼ , åœ¨ä½ çš„è·¯ç”±ä¸Šåˆ›å»ºä¸€ä¸ªå‚æ•°æ¥æ¥æ”¶æ¯ä¸ª part: <code>HttpResponse upload(String title, String name)</code></p>
<p>åƒä¸Šé¢ä¾‹å­ä¸­å±•ç¤ºçš„, ä¸€ä¸ªè·¯ç”±æ–¹æ³•ç­¾åæœŸæœ›æ¥æ”¶ä¸¤ä¸ª part, ä¸€ä¸ªåå­—ä¸º <code>title</code>, å¦ä¸€ä¸ªåå­—ä¸º <code>name</code></p>
<h4 id="Same-name-ç›¸åŒçš„åå­—"><a href="#Same-name-ç›¸åŒçš„åå­—" class="headerlink" title="Same name (ç›¸åŒçš„åå­—)"></a>Same name (ç›¸åŒçš„åå­—)</h4><p>ä½¿ç”¨ç›¸åŒçš„ part name æ¥æ¥æ”¶å¤šä¸ª part, å‚æ•°ç±»å‹å¿…é¡»æ˜¯ <code>Publisher</code></p>
<p>å½“ä»¥ä¸‹æ–¹å¼ä¹‹ä¸€ä½¿ç”¨æ—¶, <code>Publisher</code> ä¼šä¸ºæ‰¾åˆ°çš„å…·æœ‰æŒ‡å®šåç§°çš„ part è¾“å‡ºä¸€ä¸ª item</p>
<p><code>Publisher</code> å¿…é¡»æ¥å—å¦‚ä¸‹ç±»å‹ä¹‹ä¸€:</p>
<ul>
<li><code>StreamingFileUpload</code></li>
<li><code>CompletedFileUpload</code></li>
<li><code>CompletedPart</code> for attributes</li>
<li>Any POJO, assuming a media codec that supports the content type exists</li>
<li>Another <code>Publiser</code> that accepts one of the chunked data types described above</li>
</ul>
<p>Example:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">HttpResponse upload(Publisher&lt;StreamingFileUpload&gt; files)</span><br><span class="line">HttpResponse upload(Publisher&lt;CompletedFileUpload&gt; files)</span><br><span class="line">HttpResponse upload(Publisher&lt;MyObject&gt; files)</span><br><span class="line">HttpResponse upload(Publisher&lt;Publisher&lt;PartData&gt;&gt; files)</span><br><span class="line">HttpResponse upload(Publisher&lt;CompletedPart&gt; attributes)</span><br></pre></td></tr></table></figure>

<h3 id="Whole-Body-Binding-å®Œæ•´-Body-ç»‘å®š"><a href="#Whole-Body-Binding-å®Œæ•´-Body-ç»‘å®š" class="headerlink" title="Whole Body Binding (å®Œæ•´ Body ç»‘å®š)"></a>Whole Body Binding (å®Œæ•´ Body ç»‘å®š)</h3><blockquote>
<p>When request part names arenâ€™t known ahead of time, or to read the entire body, a special type can be used to indicate the entire body is desired.</p>
</blockquote>
<p>å½“ä¸€ä¸ª request part çš„åå­—ä¸èƒ½æå‰çŸ¥é“æ—¶, æˆ–è€…éœ€è¦è¯»å–æ•´ä¸ª body, å°±éœ€è¦ä¸€ä¸ªå¯ä»¥ç”¨æ¥æŒ‡å‘æ•´ä¸ª body çš„ç‰¹æ®Šç±»å‹</p>
<p>å¦‚æœä¸€ä¸ªè·¯ç”±çš„å‚æ•°ç±»å‹ä¸º <code>MultipartBody</code> , åŒæ—¶ä½¿ç”¨ <code>@Body</code> æ³¨è§£, request çš„æ¯ä¸ª part éƒ½ä¼šé€šè¿‡è¿™ä¸ªå‚æ•°æ¥è¾“å‡º</p>
<p>ä¸€ä¸ª <code>MultipartBody</code> æ˜¯ä¸€ä¸ª<code>CompletedPart</code> çš„å®ä¾‹çš„ <code>Publisher</code></p>
<p>Example - Binding to the entire multipart body:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Body</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Controller</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Post</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.multipart.CompletedFileUpload</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.multipart.CompletedPart</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.server.multipart.MultipartBody</span><br><span class="line"><span class="keyword">import</span> org.reactivestreams.Subscriber</span><br><span class="line"><span class="keyword">import</span> org.reactivestreams.Subscription</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> io.micronaut.http.MediaType.MULTIPART_FORM_DATA</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> io.micronaut.http.MediaType.TEXT_PLAIN</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">&#x27;/upload&#x27;</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WholeBodyUploadController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Post</span>(value = <span class="string">&#x27;/whole-body&#x27;</span>, consumes = MULTIPART_FORM_DATA, produces = TEXT_PLAIN)</span><br><span class="line">    Mono&lt;String&gt; uploadBytes(<span class="meta">@Body</span> MultipartBody body) &#123;</span><br><span class="line">        Mono.&lt;String&gt;create(&#123; emitter -&gt;</span><br><span class="line">            body.subscribe(<span class="keyword">new</span> Subscriber&lt;CompletedPart&gt;()&#123;</span><br><span class="line">                <span class="keyword">private</span> Subscription s</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="type">void</span> onSubscribe(Subscription s) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.s = s</span><br><span class="line">                    s.request(<span class="number">1</span>)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="type">void</span> onNext(CompletedPart completedPart) &#123;</span><br><span class="line">                    String partName = completedPart.name</span><br><span class="line">                    <span class="keyword">if</span> (completedPart <span class="keyword">instanceof</span> CompletedFileUpload) &#123;</span><br><span class="line">                        String originalFileName = completedPart.filename</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="type">void</span> onError(Throwable t) &#123; emitter.error(t) &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="type">void</span> onComplete() &#123; emitter.success(<span class="string">&quot;Uploaded) &#125;</span></span><br><span class="line"><span class="string">            &#125;)</span></span><br><span class="line"><span class="string">        &#125;)</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="File-Transfers-æ–‡ä»¶ä¼ è¾“"><a href="#File-Transfers-æ–‡ä»¶ä¼ è¾“" class="headerlink" title="File Transfers (æ–‡ä»¶ä¼ è¾“)"></a>File Transfers (æ–‡ä»¶ä¼ è¾“)</h2><p>Micronaut æ”¯æŒé€šè¿‡å¤šç§æ–¹å¼ä¼ é€’æ–‡ä»¶ç»™å®¢æˆ·ç«¯</p>
<h3 id="Sending-File-Objects-å‘é€æ–‡ä»¶å¯¹è±¡"><a href="#Sending-File-Objects-å‘é€æ–‡ä»¶å¯¹è±¡" class="headerlink" title="Sending File Objects (å‘é€æ–‡ä»¶å¯¹è±¡)"></a>Sending File Objects (å‘é€æ–‡ä»¶å¯¹è±¡)</h3><p>å¯ä»¥åœ¨ Controller æ–¹æ³•ä¸­è¿”å›ä¸€ä¸ª <code>File</code> å¯¹è±¡, æ•°æ®å°†ä¼šè¿”å›ç»™å®¢æˆ·ç«¯</p>
<blockquote>
<p>The Content-Type header of file responses is calculated based on the name of the file.</p>
</blockquote>
<p>æ–‡ä»¶å“åº”çš„ Content-Type header æ˜¯æ ¹æ®æ–‡ä»¶åè®¡ç®—çš„</p>
<blockquote>
<p>To control either the media type of the file being sent, or to set the file to be downloaded (i.e. using the Content-Disposition header), instead construct a SystemFile with the file to use.</p>
</blockquote>
<p>è¦æ§åˆ¶æ­£åœ¨å‘é€çš„æ–‡ä»¶çš„ media type, æˆ–è®¾ç½®è¦ä¸‹è½½çš„æ–‡ä»¶(å³ä½¿ç”¨ <code>Content-Disposition</code> header), è¯·æ„é€ ä¸€ä¸ªå¸¦æœ‰è¦ä½¿ç”¨çš„æ–‡ä»¶çš„ <code>SystemFile</code></p>
<p>Example - Sending a SystemFile:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Get</span></span><br><span class="line"><span class="keyword">public</span> SystemFile download() &#123;</span><br><span class="line">    File file</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SystemFile(file).attach(<span class="string">&quot;myfile.txt&quot;</span>)</span><br><span class="line">    <span class="comment">// or new SystemFile(file, MediaType.TEXT_HTML_PLAIN)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Sending-an-InputStream-å‘é€ä¸€ä¸ª-InputStream"><a href="#Sending-an-InputStream-å‘é€ä¸€ä¸ª-InputStream" class="headerlink" title="Sending an InputStream (å‘é€ä¸€ä¸ª InputStream)"></a>Sending an InputStream (å‘é€ä¸€ä¸ª InputStream)</h3><p>åœ¨ä¸èƒ½å¼•ç”¨ä¸€ä¸ª <code>File</code> å¯¹è±¡çš„æƒ…å†µä¸‹, ä¾‹å¦‚ JAR æ–‡ä»¶ä¸­çš„èµ„æº, Micronaut æ”¯æŒä¼ è¾“ input streams</p>
<p>ä¸ºäº†åœ¨ Controller æ–¹æ³•ä¸­è¿”å›ä¸€ä¸ªæ•°æ®æµ, æ„é€ ä¸€ä¸ª <code>StreamedFile</code></p>
<p><code>StreamedFile</code> çš„æ„é€ æ–¹æ³•è¿˜æ”¯æŒæ¥å—ä¸€ä¸ª <code>java.net.URL</code></p>
<p>Example - Sending a StreamedFile:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Get</span></span><br><span class="line"><span class="keyword">public</span> StreamedFile download() &#123;</span><br><span class="line">    InputStream inputStream</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> StreamedFile(inputStream, MediaType.TEXT_PLAIN_TYPE)</span><br><span class="line">    <span class="comment">// An attach(String filename) method is also available to set the Content-Disposition</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœè¦ä¼ è¾“çš„æ–‡ä»¶æ²¡æœ‰ä¿®æ”¹è¿‡å¹¶ä¸”è¯·æ±‚åŒ…å«é€‚å½“çš„ header , server æ”¯æŒè¿”å› <code>304</code> (Not Modified) å“åº”</p>
<p>é™¤æ­¤, å¦‚æœå®¢æˆ·ç«¯å¯ä»¥æ¥å— encoded responses, Micronaut åœ¨åˆé€‚çš„æƒ…å†µä¸‹ encodes æ–‡ä»¶</p>
<p>Encoding å‘ç”Ÿåœ¨æ–‡ä»¶æ˜¯åŸºäºæ–‡æœ¬çš„å¹¶å¤§äº 1KB</p>
<p>è¦ encoded çš„æ•°æ®çš„é˜ˆå€¼æ˜¯å¯ä»¥é…ç½®</p>
<blockquote>
<p>To use a custom data source to send data through an input stream, construct a PipedInputStream and PipedOutputStream to write data from the output stream to the input. Make sure to do the work on a separate thread so the file can be returned immediately.</p>
</blockquote>
<p>è¦ä½¿ç”¨ä¸€ä¸ªè‡ªå®šä¹‰æ•°æ®æº(data source)æ¥ä»ä¸€ä¸ªè¾“å…¥æµä¸­å‘é€æ•°æ®, æ„é€ ä¸€ä¸ª <code>PipedInputStream</code> å’Œ <code>PipedOutputStream</code> æ¥ä»è¾“å‡ºæµå†™æ•°æ®åˆ°è¾“å…¥æµ. ç¡®ä¿åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­å®Œæˆè¿™ä¸ªå·¥ä½œ, ä»¥ä½¿æ–‡ä»¶å¯ä»¥é©¬ä¸Šè¢«è¿”å›</p>
<h3 id="Cache-Configuration-ç¼“å­˜é…ç½®"><a href="#Cache-Configuration-ç¼“å­˜é…ç½®" class="headerlink" title="Cache Configuration (ç¼“å­˜é…ç½®)"></a>Cache Configuration (ç¼“å­˜é…ç½®)</h3><p>é»˜è®¤åœ°, æ–‡ä»¶å“åº”åŒ…å«äº†ç¼“å­˜ headers</p>
<p>ä¸‹é¢çš„é€‰é¡¹è¡¨æ˜äº† <code>Cache-Control</code> header æ˜¯æ€æ ·æ„å»ºçš„</p>
<p>Table - Configuration Properties for <code>FileTypeHandlerConfiguration</code>:</p>
<table>
<thead>
<tr>
<th align="left">Property</th>
<th align="left">Type</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>netty.responses.file.cache-seconds</code></td>
<td align="left"><code>int</code></td>
<td align="left">Cache Seconds. Default value 60</td>
</tr>
</tbody></table>
<p>Table - Configuration Properties for <code>CacheControlConfiguration</code>:</p>
<table>
<thead>
<tr>
<th align="left">Property</th>
<th align="left">Type</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>netty.responses.file.cache-control</code></td>
<td align="left"><code>FileTypeHandlerConfiguration$CacheControlConfiguration</code></td>
<td align="left">Sets the cache control configuration</td>
</tr>
<tr>
<td align="left"><code>netty.responses.file.cache-control.public</code></td>
<td align="left"><code>boolean</code></td>
<td align="left">Sets whether the cache control is public. Default value false</td>
</tr>
</tbody></table>
<h2 id="HTTP-Filters-HTTP-è¿‡æ»¤å™¨"><a href="#HTTP-Filters-HTTP-è¿‡æ»¤å™¨" class="headerlink" title="HTTP Filters (HTTP è¿‡æ»¤å™¨)"></a>HTTP Filters (HTTP è¿‡æ»¤å™¨)</h2><p>Micronaut HTTP Server æ”¯æŒä»¥ä¸ Java åº”ç”¨ç¨‹åºä¸­çš„ Servlet è¿‡æ»¤å™¨ç›¸ä¼¼(ä½†å“åº”å¼)çš„æ–¹å¼å°†è¿‡æ»¤å™¨åº”ç”¨äº è¯·æ±‚&#x2F;å“åº” å¤„ç†</p>
<p>è¿‡æ»¤å™¨æ”¯æŒå¦‚ä¸‹åœºæ™¯:</p>
<ul>
<li>è£…é¥°ä¼ å…¥çš„ <code>HttpRequest</code></li>
<li>ä¿®æ”¹åˆ é™¤çš„ <code>HttpResponse</code></li>
<li>å®ç°æ¨ªåˆ‡å…³æ³¨ç‚¹(cross-cutting concerns), ä¾‹å¦‚å®‰å…¨(security), è¿½è¸ª(tracing)</li>
</ul>
<p>å¯¹äºä¸€ä¸ª server åº”ç”¨, å¯ä»¥å®ç° <code>HttpServerFilter</code> æ¥å£çš„ <code>doFilter</code> æ–¹æ³•</p>
<p><code>doFilter</code> æ–¹æ³•æ¥æ”¶ <code>HttpRequest</code> å’Œä¸€ä¸ª <code>ServerFilterChain</code> å®ä¾‹</p>
<blockquote>
<p>The <code>ServerFilterChain</code> interface contains a resolved chain of filters where the final entry in the chain is the matched route. The <code>ServerFilterChain.proceed(io.micronaut.http.HttpRequest)</code> method resumes processing of the request.</p>
</blockquote>
<p><code>ServerFilterChain</code> æ¥å£åŒ…å«ä¸€ä¸ªè¿‡æ»¤å™¨çš„è§£æé“¾, é“¾çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹æ˜¯åŒ¹é…çš„è·¯ç”±. <code>ServerFilterChain.proceed(io.micronaut.http.HttpRequest)</code> æ–¹æ³•æ¢å¤å¯¹è¯·æ±‚çš„å¤„ç†</p>
<p><code>proceed()</code> æ–¹æ³•è¿”å›ä¸€ä¸ªå“åº”å¼æµ <code>Publisher</code> æ¥è¾“å‡ºè¦è¿”å›ç»™å®¢æˆ·ç«¯çš„å“åº”</p>
<blockquote>
<p>Implementors of filters can subscribe to the <code>Publisher</code> and mutate the emitted <code>MutableHttpResponse</code> to modify the response prior to returning the response to the client.</p>
</blockquote>
<p>è¿‡æ»¤å™¨çš„å®ç°è€…å¯ä»¥è®¢é˜… <code>Publisher</code> å¹¶æ”¹å˜è¾“å‡ºçš„ <code>MutableHttpResponse</code> ä»¥åœ¨å°†å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ä¹‹å‰ä¿®æ”¹å“åº”</p>
<p>è¿‡æ»¤å™¨æ‰§è¡Œåœ¨ event loop ä¸­, æ‰€ä»¥é˜»å¡æ“ä½œå¿…é¡»å¸è½½åˆ°å¦å¤–ä¸€ä¸ªçº¿ç¨‹æ± ä¸­</p>
<h3 id="Writing-a-Filter-ç¼–å†™ä¸€ä¸ªè¿‡æ»¤å™¨"><a href="#Writing-a-Filter-ç¼–å†™ä¸€ä¸ªè¿‡æ»¤å™¨" class="headerlink" title="Writing a Filter (ç¼–å†™ä¸€ä¸ªè¿‡æ»¤å™¨)"></a>Writing a Filter (ç¼–å†™ä¸€ä¸ªè¿‡æ»¤å™¨)</h3><p>ä¸è¦åœ¨ä½ çš„è¿‡æ»¤å™¨ä¸­é˜»å¡åº•å±‚çš„ Netty event loop</p>
<p>ç›¸å, ä¸€æ—¦ä»»ä½• I&#x2F;O å®Œæˆ, è¿‡æ»¤å™¨å°±åº”è¯¥ç»§ç»­æ‰§è¡Œ</p>
<p>Example - A TraceService Example using Reactive Streams:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.http.HttpRequest</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jakarta.inject.Singleton</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Flux</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono</span><br><span class="line"><span class="keyword">import</span> reactor.core.scheduler.Schedulers</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Callable</span><br><span class="line"></span><br><span class="line"><span class="meta">@Singleton</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TraceService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOG = LoggerFactory.getLogger(TraceService.<span class="keyword">class</span>)</span><br><span class="line"></span><br><span class="line">    Flux&lt;Boolean&gt; trace(HttpRequest&lt;?&gt; request) &#123;</span><br><span class="line">        Mono.fromCallable(() -&gt; &#123;                               <span class="comment">// 1</span></span><br><span class="line">            LOG.debug(<span class="string">&#x27;Tracing request: &#123;&#125;&#x27;</span>, request.uri)</span><br><span class="line">            <span class="comment">// trace logic here, potentially performing I/O     // 2</span></span><br><span class="line">            return true</span><br><span class="line">        &#125;)</span><br><span class="line">        .flux()</span><br><span class="line">        .subscribeOn(Schedulers.boundedElastic())               <span class="comment">// 3</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>1</code> : The <code>Mono</code> type creates logic that executes potentially blocking operations to write the trace data from the request</p>
<p><code>2</code> : Since this is just an example, the logic does nothing yet</p>
<p><code>3</code> : The <code>Schedulers.boundedElastic</code> executes the logic</p>
<p>ç„¶åå°†è¿™ä¸ªå®ç°æ³¨å…¥åˆ°è¿‡æ»¤å™¨ä¸­</p>
<p>Example - HttpServerFilter:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.http.HttpRequest</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.MutableHttpResponse</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Filter</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.filter.HttpServerFilter</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.ServerFilterChain</span><br><span class="line"><span class="keyword">import</span> org.reactivestreams.Publisher</span><br><span class="line"></span><br><span class="line"><span class="meta">@Filter</span>(<span class="string">&#x27;/hello/*&#x27;</span>)     <span class="comment">// The Filter annotation defines the URI pattern(s) the filter matches</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TraceFilter</span> <span class="keyword">implements</span> <span class="title class_">HttpServerFilter</span> &#123;     <span class="comment">// The class implements the HttpServerFilter interface</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> TraceService traceService</span><br><span class="line"></span><br><span class="line">    TraceFilter(TraceService traceService) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.traceService = traceService</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    Publisher&lt;MutableHttpResponse&lt;?&gt;&gt; doFilter(HttpRequest&lt;?&gt; request,</span><br><span class="line">                                               ServerFilterChain chain) &#123;</span><br><span class="line">        traceService.trace(request)</span><br><span class="line">                    .switchMap(&#123;chain.proceed(request)&#125;)                    <span class="comment">// 2</span></span><br><span class="line">                    .doOnNext(&#123;it.headers.add(<span class="string">&quot;X-Trace-Enabled&quot;</span>, <span class="string">&quot;true&quot;</span>)&#125;)      <span class="comment">// 3</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>2</code> : If the call succeeds, the filter resumes request processing using <code>Project Reactor</code>â€˜s <code>switchMap</code> method, which invokes the <code>proceed</code> method of the <code>ServerFilterChain</code></p>
<p><code>3</code> : Finally, the <code>Project Reactor</code>â€˜s <code>doOnNext</code> method adds a <code>X-Trace-Enabled</code> header to the response</p>
<p>ä½ å¯ä»¥ä½¿ç”¨ä»»ä½•æ”¯æŒ Reactive streams è§„èŒƒçš„å“åº”å¼æ¡†æ¶</p>
<p><code>Filter</code> é€šè¿‡è®¾ç½® <code>patternStyle</code> æ¥ä½¿ç”¨ä¸åŒé£æ ¼çš„æ¨¡å¼(pattern)æ¥è¿›è¡Œè·¯å¾„åŒ¹é…</p>
<p>é»˜è®¤æƒ…å†µä¸‹, <code>Filter</code> ä½¿ç”¨ <a class="link"   target="_blank" rel="noopener" href="https://docs.micronaut.io/latest/api/io/micronaut/core/util/AntPathMatcher.html" >AntPathMatcher<i class="fas fa-external-link-alt"></i></a> è¿›è¡Œè·¯å¾„åŒ¹é…</p>
<p>å½“ä½¿ç”¨ Ant æ—¶, æ˜ å°„åŒ¹é…è·¯å¾„ä½¿ç”¨å¦‚ä¸‹è§„åˆ™:</p>
<ul>
<li><code>?</code> åŒ¹é…ä¸€ä¸ªå­—ç¬¦</li>
<li><code>*</code> åŒ¹é… 0 æˆ– å¤šä¸ª å­—ç¬¦</li>
<li><code>**</code> åŒ¹é…è·¯å¾„ä¸­çš„ 0 æˆ– å¤šä¸ª å­ç›®å½•</li>
</ul>
<p>Table - <code>@Filter</code> Annotation Path Matching:</p>
<table>
<thead>
<tr>
<th align="left">Pattern</th>
<th align="left">Example Matched Paths</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>/**</code></td>
<td align="left">any path</td>
</tr>
<tr>
<td align="left"><code>customer/j?y</code></td>
<td align="left">customer&#x2F;joy, customer&#x2F;jay</td>
</tr>
<tr>
<td align="left"><code>customer/*/id</code></td>
<td align="left">customer&#x2F;adam&#x2F;id, customer&#x2F;amy&#x2F;id</td>
</tr>
<tr>
<td align="left"><code>customer/**</code></td>
<td align="left">customer&#x2F;adam, customer&#x2F;adam&#x2F;id, customer&#x2F;adam&#x2F;name</td>
</tr>
<tr>
<td align="left"><code>customer/*/.html</code></td>
<td align="left">customer&#x2F;index.html, customer&#x2F;adam&#x2F;profile.html, customer&#x2F;adam&#x2F;job&#x2F;description.html</td>
</tr>
</tbody></table>
<p>å¦ä¸€ä¸ªé€‰æ‹©æ˜¯åŸºäºæ­£åˆ™è¡¨è¾¾å¼è¿›è¡ŒåŒ¹é…. è¦ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼, è®¾ç½® <code>patternStyle = FilterPatternStyle.REGEX</code></p>
<p><code>pattern</code> å±æ€§æ¥å—ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é…æä¾›çš„ URLs (ä½¿ç”¨ <code>Matcher#matches</code>)</p>
<p>æ›´æ¨èä½¿ç”¨ <code>FilterPatternStyle.ANT</code> æ¥è¿›è¡Œæ¨¡å¼åŒ¹é…, å› ä¸ºè¿™æ¯”ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ€§èƒ½æ›´å¥½. åªæœ‰åœ¨ä½¿ç”¨ Ant çš„ pattern æ— æ³•æ»¡è¶³éœ€æ±‚æ—¶æ‰ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼</p>
<p>ä» <code>chain.proceed</code> è¿”å›çš„ <code>Publisher</code> æ°¸è¿œä¸è¦è¾“å‡ºä¸€ä¸ª error</p>
<p>åœ¨ä¸Šæ¸¸è¿‡æ»¤å™¨è¾“å‡ºä¸€ä¸ª error æˆ–è€…è·¯ç”±æœ¬èº«æŠ›å‡ºå¼‚å¸¸çš„æƒ…å†µä¸‹, åº”è¯¥è¾“å‡º error responses è€Œä¸æ˜¯ exception</p>
<blockquote>
<p>In some cases it may be desirable to know the cause of the error response and for this purpose an attribute exists on the response if it was created as a result of an exception being emitted or thrown.</p>
</blockquote>
<p>åœ¨æŸäº›æƒ…å†µä¸‹, å¯èƒ½éœ€è¦çŸ¥é“å¯¼è‡´ error response çš„åŸå› , ä¸ºæ­¤, å¦‚æœå“åº”ç”±äºè¾“å‡ºæˆ–æŠ›å‡ºå¼‚å¸¸è€Œå»ºç«‹çš„, åˆ™åœ¨å“åº”ä¸­åŒ…å«ä¸€ä¸ªå±æ€§</p>
<blockquote>
<p>The original cause is stored as the attribute EXCEPTION.</p>
</blockquote>
<p>åŸå§‹çš„åŸå› ä½œä¸º <code>EXCEPTION</code> attribute ä¿å­˜</p>
<h2 id="HTTP-Sessions-HTTP-ä¼šè¯"><a href="#HTTP-Sessions-HTTP-ä¼šè¯" class="headerlink" title="HTTP Sessions (HTTP ä¼šè¯)"></a>HTTP Sessions (HTTP ä¼šè¯)</h2><p>Micronaut é»˜è®¤æ˜¯ä¸€ä¸ªæ— çŠ¶æ€çš„ HTTP server</p>
<p>æ ¹æ®ä½ çš„åº”ç”¨è¦æ±‚, ä½ å¯èƒ½éœ€è¦ HTTP Sessions çš„æ¦‚å¿µ</p>
<p>Micronaut åŒ…å«ä¸€ä¸ª <code>session</code> æ¨¡å—, ç°åœ¨æœ‰ä¸¤ä¸ªå®ç°:</p>
<ul>
<li>åŸºäºå†…å­˜çš„ sessions : å¦‚æœä½ è®¡åˆ’è¿è¡Œå¤šä¸ªå®ä¾‹, é‚£ä¹ˆä½ åº”è¯¥å°†å…¶ä¸ä¸€ä¸ª sticky çš„ session ä»£ç†ç»“åˆä½¿ç”¨</li>
<li>Redis sessions : ä½¿ç”¨ Redis æ¥å­˜å‚¨ sessions, ä½¿ç”¨éé˜»å¡ I&#x2F;O æ¥è¯»å†™ sessions åˆ° Redis</li>
</ul>
<h3 id="Enabling-Sessions-å¼€å¯ä¼šè¯"><a href="#Enabling-Sessions-å¼€å¯ä¼šè¯" class="headerlink" title="Enabling Sessions (å¼€å¯ä¼šè¯)"></a>Enabling Sessions (å¼€å¯ä¼šè¯)</h3><p>å¼€å¯åŸºäºå†…å­˜çš„ sessions, åªéœ€è¦æ·»åŠ  <code>session</code> ä¾èµ–:</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation(<span class="string">&quot;io.micronaut:micronaut-session&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="Redis-Sessions-Redis-ä¼šè¯"><a href="#Redis-Sessions-Redis-ä¼šè¯" class="headerlink" title="Redis Sessions (Redis ä¼šè¯)"></a>Redis Sessions (Redis ä¼šè¯)</h4><p>ä¸ºäº†å­˜å‚¨ <code>Session</code> åˆ° Redis ä¸­, ä½¿ç”¨ <code>Micronaut Redis</code> æ¨¡å—</p>
<p>æ·»åŠ  <code>redis-lettuce</code> ä¾èµ–åˆ°æ„å»ºä¸­:</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// build.gradle</span></span><br><span class="line"><span class="keyword">compile</span> <span class="string">&quot;io.micronaut:micronaut-session&quot;</span></span><br><span class="line"><span class="keyword">compile</span> <span class="string">&quot;io.micronaut.redis:micronaut-redis-lettuce&quot;</span></span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨ <code>application.yml</code> ä¸­é…ç½®å¼€å¯ Redis sessions:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">redis:</span></span><br><span class="line">    <span class="attr">uri:</span> <span class="string">redis://localhost:6379</span></span><br><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">session:</span></span><br><span class="line">        <span class="attr">http:</span></span><br><span class="line">            <span class="attr">redis:</span></span><br><span class="line">                <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h3 id="Configuring-Session-Resolution-é…ç½®ä¼šè¯è§£æ"><a href="#Configuring-Session-Resolution-é…ç½®ä¼šè¯è§£æ" class="headerlink" title="Configuring Session Resolution (é…ç½®ä¼šè¯è§£æ)"></a>Configuring Session Resolution (é…ç½®ä¼šè¯è§£æ)</h3><p>ä¼šè¯è§£æå¯ä»¥é€šè¿‡ <code>HttpSessionConfiguration</code> è¿›è¡Œé…ç½®</p>
<p>é»˜è®¤æƒ…å†µä¸‹, sessions ä½¿ç”¨ <code>HttpSessionFilter</code> æ¥è¿›è¡Œè§£æ</p>
<p><code>HttpSessionFilter</code> é€šè¿‡ HTTP header(<code>Authorization-Info</code> æˆ– <code>X-Auth-Token</code>) æˆ–è€…é€šè¿‡ä¸€ä¸ªåå­—ä¸º <code>SESSION</code> çš„ Cookie æ¥å¯»æ‰¾ session identifiers</p>
<p>å¯ä»¥åœ¨ <code>application.yml</code> é…ç½®æ–‡ä»¶ä¸­å…³é—­ header è§£ææˆ– cookie è§£æ:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">session:</span></span><br><span class="line">        <span class="attr">http:</span></span><br><span class="line">            <span class="attr">cookie:</span> <span class="literal">false</span></span><br><span class="line">            <span class="attr">header:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>è¿˜å¯ä»¥é…ç½® header å’Œ cookie çš„åå­—</p>
<h3 id="Working-with-Sessions-ä½¿ç”¨ä¼šè¯"><a href="#Working-with-Sessions-ä½¿ç”¨ä¼šè¯" class="headerlink" title="Working with Sessions (ä½¿ç”¨ä¼šè¯)"></a>Working with Sessions (ä½¿ç”¨ä¼šè¯)</h3><p>å¯ä»¥åœ¨ Controller æ–¹æ³•ä¸­é€šè¿‡ç±»å‹ä¸º <code>Session</code> çš„å‚æ•°è·å–ä¸€ä¸ª session:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.session.Session    </span><br><span class="line"></span><br><span class="line">    <span class="meta">@Post</span>(<span class="string">&quot;/cart/&#123;name&#125;&quot;</span>)</span><br><span class="line">    Cart addItem(Session session, <span class="meta">@NotBlank</span> String name) &#123;</span><br><span class="line">        Cart cart = session.get(<span class="string">&quot;cart&quot;</span>, Cart).orElseGet(&#123;</span><br><span class="line">            Cart newCart = <span class="keyword">new</span> Cart()</span><br><span class="line">            session.put(<span class="string">&quot;cart&quot;</span>, newCart)</span><br><span class="line">            newCart</span><br><span class="line">        &#125;)</span><br><span class="line">        cart.items &lt;&lt; name</span><br><span class="line">        cart</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­, <code>Session</code> è¢«å£°æ˜ä¸ºä¸€ä¸ªå¿…é€‰å‚æ•°, æ‰€ä»¥ä¸ºäº†æ‰§è¡Œ Controller çš„è¿™ä¸ªæ–¹æ³•, ä¸€ä¸ª <code>Session</code> å°†ä¼šè¢«åˆ›å»ºå¹¶ä¿å­˜åˆ° <code>SessionStore</code></p>
<p>å¦‚æœä½ ä¸æƒ³åˆ›å»ºéå¿…è¦çš„ <code>Session</code>, ä½¿ç”¨ <code>@Nullable</code> æ³¨è§£ä¿®é¥° <code>Session</code> å‚æ•°, ç„¶åæ²¡æœ‰å¿…è¦çš„è¯, å°±ä¸ä¼šåˆ›å»ºå¹¶ä¿å­˜ä¸€ä¸ª session</p>
<p>Example - Using <code>@Nullable</code> with Sessions:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Post</span>(<span class="string">&quot;/cart/clear&quot;</span>)</span><br><span class="line"><span class="type">void</span> clearCart(<span class="meta">@Nullable</span> Session session) &#123;</span><br><span class="line">    session?.remove(ATTR_CART)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Session-Clients-ä¼šè¯å®¢æˆ·ç«¯"><a href="#Session-Clients-ä¼šè¯å®¢æˆ·ç«¯" class="headerlink" title="Session Clients (ä¼šè¯å®¢æˆ·ç«¯)"></a>Session Clients (ä¼šè¯å®¢æˆ·ç«¯)</h3><p>å¦‚æœå®¢æˆ·ç«¯æ˜¯ web æµè§ˆå™¨, é‚£ä¹ˆåœ¨ cookies å¼€å¯çš„æƒ…å†µä¸‹ sessions æ˜¯æ­£å¸¸å·¥ä½œçš„</p>
<p>ä½†æ˜¯, å¯¹äºç¼–ç¨‹å¼çš„ HTTP å®¢æˆ·ç«¯, ä½ éœ€è¦åœ¨ HTTP è°ƒç”¨ä¹‹é—´ä¼ æ’­ session ID</p>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­, HTTP å®¢æˆ·ç«¯è¯·æ±‚äº† Controller ä¸­çš„ <code>addItem</code> æ–¹æ³•å, é»˜è®¤ä¼šæ¥å—åˆ°ä¸€ä¸ª <code>AUTHORIZATION_INFO</code> header:</p>
<p>Example - Retrieving the AUTHORIZATION_INFO header:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">when:</span> <span class="string">&quot;The shopping cart is retrieved&quot;</span></span><br><span class="line">HttpResponse&lt;Cart&gt; response = client.exchange(HttpRequest.GET(<span class="string">&#x27;/shopping/cart&#x27;</span>), Cart).blockFirst()</span><br><span class="line">Cart cart = response.body()</span><br><span class="line"></span><br><span class="line"><span class="attr">then:</span> <span class="string">&quot;The shopping cart is present as well as a session id header&quot;</span></span><br><span class="line">response.header(HttpHeaders.AUTHORIZATION_INFO) != <span class="literal">null</span>     <span class="comment">// The AUTHORIZATION_INFO header is present in the response</span></span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨æ¥ä¸‹æ¥çš„è¯·æ±‚ä¸­é‡ç”¨å·²å­˜åœ¨çš„ Session, é€šè¿‡ä¼ é€’è¿™ä¸ª <code>AUTHORIZATION_INFO</code></p>
<p>Example - Sending the AUTHORIZATION_INFO header:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">String sessionId = response.header(HttpHeaders.AUTHORIZATION_INFO)  <span class="comment">// ä»å“åº”ä¸­è·å– AUTHORIZATION_INFO</span></span><br><span class="line"></span><br><span class="line">response = client.exchange(HttpRequest.POST(<span class="string">&#x27;/shopping/cart/Apple&#x27;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">                                      .header(HttpHeaders.AUTHORIZATION_INFO, sessionId),       <span class="comment">// åœ¨å‘é€è¯·æ±‚æ—¶é™„åŠ ä¸Š AUTHORIZATION_INFO session</span></span><br><span class="line">                           Cart)</span><br><span class="line">                 .blockFirst()</span><br><span class="line">cart = response.body()</span><br></pre></td></tr></table></figure>

<h3 id="Using-SessionValue-ä½¿ç”¨-SessionValue-æ³¨è§£"><a href="#Using-SessionValue-ä½¿ç”¨-SessionValue-æ³¨è§£" class="headerlink" title="Using @SessionValue (ä½¿ç”¨ @SessionValue æ³¨è§£)"></a>Using <code>@SessionValue</code> (ä½¿ç”¨ <code>@SessionValue</code> æ³¨è§£)</h3><p>å¯ä»¥ä½¿ç”¨ <code>@SessionValue</code> æ³¨è§£ä»£æ›¿æ˜¾å¼åœ°å°† <code>Session</code> æ³¨å…¥åˆ° Controller çš„æ–¹æ³•å‚æ•°ä¸Š</p>
<p>Example - Using <code>@SessionValue</code>:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Get</span>(<span class="string">&#x27;/cart&#x27;</span>)</span><br><span class="line"><span class="meta">@SessionValue</span>(<span class="string">&#x27;cart&#x27;</span>)   <span class="comment">// 1</span></span><br><span class="line">Cart viewCart(<span class="meta">@SessionValue</span> <span class="meta">@Nullable</span> Cart cart) &#123;  <span class="comment">// 2</span></span><br><span class="line">    cart ?: <span class="keyword">new</span> Cart()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>1</code> : ä½œç”¨äºæ–¹æ³•ä¸Šçš„ <code>@SessionValue</code> ä¼šå°†æ–¹æ³•è¿”å›å€¼ä¿å­˜åˆ° <code>Session</code> ä¸­. æ³¨æ„, ä½œç”¨äºæ–¹æ³•ä¸Šæ—¶, å¿…é¡»æŒ‡å®š attribute çš„åç§°</p>
<p><code>2</code> : <code>@SessionValue</code> ä½œç”¨äº <code>@Nullable</code> ä¿®é¥°çš„å‚æ•°, è¿™ä¼šå¯¼è‡´ä»¥éé˜»å¡æ–¹å¼ä» <code>Session</code> ä¸­æŸ¥æ‰¾å€¼å¹¶åœ¨å­˜åœ¨æ—¶æä¾›è¿™ä¸ªå€¼. åœ¨è¿™ä¸ªä¾‹å­ä¸­, æ²¡æœ‰æŒ‡æ˜ <code>@SessionValue</code> çš„ value, æ‰€ä»¥ä¼šä½¿ç”¨å‚æ•°åç§°æ¥æŸ¥æ‰¾ attribute</p>
<h3 id="Session-Events-ä¼šè¯äº‹ä»¶"><a href="#Session-Events-ä¼šè¯äº‹ä»¶" class="headerlink" title="Session Events (ä¼šè¯äº‹ä»¶)"></a>Session Events (ä¼šè¯äº‹ä»¶)</h3><p>å¯ä»¥æ³¨å†Œ <code>ApplicationEventListener</code> Beans æ¥ç›‘å¬ <code>Session</code> ç›¸å…³çš„ ä½äº<code>io.micronaut.session.event</code>åŒ…çš„ äº‹ä»¶</p>
<p>Table - Session Events:</p>
<table>
<thead>
<tr>
<th align="left">Type</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>SessionCreatedEvent</code></td>
<td align="left">Fired when a <code>Session</code> is created</td>
</tr>
<tr>
<td align="left"><code>SessionDeletedEvent</code></td>
<td align="left">Fired when a <code>Session</code> is deleted</td>
</tr>
<tr>
<td align="left"><code>SessionExpiredEvent</code></td>
<td align="left">Fired when a <code>Session</code> expires</td>
</tr>
<tr>
<td align="left"><code>SessionDestroyedEvent</code></td>
<td align="left">Parent of both <code>SessionDeletedEvent</code> and <code>SessionExpiredEvent</code></td>
</tr>
</tbody></table>
<h2 id="Server-Sent-Events-Server-å‘é€äº‹ä»¶"><a href="#Server-Sent-Events-Server-å‘é€äº‹ä»¶" class="headerlink" title="Server Sent Events (Server å‘é€äº‹ä»¶)"></a>Server Sent Events (Server å‘é€äº‹ä»¶)</h2><p>Micronaut HTTP server æ”¯æŒä½¿ç”¨ <code>Event</code> API æ¥è¾“å‡º <code>Server Sent Events (SSE)</code></p>
<p>ä¸ºäº†ä» server è¾“å‡ºäº‹ä»¶, è¿”å›ä¸€ä¸ªè¾“å‡ºå¯¹è±¡ç±»å‹ä¸º <code>Event</code> çš„å“åº”å¼æµ <code>Publisher</code></p>
<p><code>Publisher</code> æœ¬èº«å¯ä»¥åœ¨ä¸€ä¸ªåå°ä»»åŠ¡ä¸­å‘é€äº‹ä»¶, ä¾‹å¦‚é€šè¿‡ä¸€ä¸ªäº‹ä»¶ç³»ç»Ÿ</p>
<p>ä¸ºäº†å‘é€äº‹ä»¶, ç¼–å†™ä¸€ä¸ªè¿”å› <code>Event</code> å®ä¾‹çš„ <code>Publisher</code> çš„ Controller, ä½¿ç”¨ä»»ä½•ä½ å–œæ¬¢çš„å“åº”å¼åº“</p>
<p>Example - Publishing Server Sent Events from a Controller:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.http.MediaType</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Controller</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.annotation.Get</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.sse.Event</span><br><span class="line"><span class="keyword">import</span> io.micronaut.scheduling.TaskExecutors</span><br><span class="line"><span class="keyword">import</span> io.micronaut.scheduling.annotation.ExecuteOn</span><br><span class="line"><span class="keyword">import</span> org.reactivestreams.Publisher</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Flux</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">&quot;/headlines&quot;</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HeadlineController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExecuteOn</span>(TaskExecutors.IO)</span><br><span class="line">    <span class="meta">@Get</span>(produces = MediaType.TEXT_EVENT_STREAM)</span><br><span class="line">    Publisher&lt;Event&lt;Headline&gt;&gt; index() &#123;    <span class="comment">// 1</span></span><br><span class="line">        String[] versions = [<span class="string">&quot;1.0&quot;</span>, <span class="string">&quot;2.0&quot;</span>]  <span class="comment">// 2</span></span><br><span class="line">        Flux.generate(                      <span class="comment">// 3</span></span><br><span class="line">            () -&gt; <span class="number">0</span>,</span><br><span class="line">            (i, emitter) -&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> (i &lt; versions.length) &#123;</span><br><span class="line">                    emitter.next(           <span class="comment">// 4</span></span><br><span class="line">                        Event.of(<span class="keyword">new</span> Headline(<span class="string">&quot;Micronaut $&#123;versions[i]&#125; Released&quot;</span>, <span class="string">&quot;Come and get it&quot;</span>))</span><br><span class="line">                    )</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    emitter.complete()      <span class="comment">// 5</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> i + <span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>1</code> : The controller method returns a <code>Publisher</code> of <code>Event</code></p>
<p><code>2</code> : A headline is emitted for each version of Micronaut</p>
<p><code>3</code> : The <code>Flux</code> typeâ€™s <code>generate</code> method generates a <code>Publisher</code>. The <code>generate</code> method accepts an initial value and a lambda that accepts the value and a <code>Emitter</code>. Note that this example executes on the same thread as the controller action, but you could use <code>subscribeOn</code> or map an existing â€œhotâ€ <code>Flux</code></p>
<p><code>4</code> : The <code>Emitter</code> interface <code>onNext</code> method emits objects of type <code>Event</code>. The <code>Event.of(ET)</code> factory method constructs the event.</p>
<p><code>5</code> : The <code>Emitter</code> interface <code>onComplete</code> method indicates when to finish sending server sent events</p>
<p>ä½ å¾ˆå¯èƒ½æƒ³è¦åœ¨ä¸€ä¸ªä¸åŒçš„ executor ä¸Šè°ƒåº¦ SSE äº‹ä»¶æµ, ä¸Šé¢çš„ä¾‹å­ä¸­ä½¿ç”¨äº† <code>@ExecutorOn</code> æ¥åœ¨ I&#x2F;O executor ä¸Šæ‰§è¡Œæµ</p>
<p>ä¸Šé¢çš„ä¾‹å­å‘å›ä¸€ä¸ªç±»å‹ä¸º <code>text/event-stream</code> çš„å“åº”, æ¯ä¸ª <code>Event</code> è¾“å‡ºè½¬æ¢ä¸º JSON çš„æ•°æ®:</p>
<p>Example - Server Sent Event Response Output:</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data: &#123;&quot;title&quot;: &quot;Micronaut 1.0 Released&quot;, &quot;description&quot;: &quot;Come and get it&quot;&#125;</span><br><span class="line">data: &#123;&quot;title&quot;: &quot;Micronaut 2.0 Released&quot;, &quot;description&quot;: &quot;Come and get it&quot;&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>You can use the methods of the Event interface to customize the Server Sent Event data sent back, including associating event ids, comments, retry timeout, etc.</p>
</blockquote>
<p>ä½ å¯ä»¥ä½¿ç”¨ <code>Event</code> æ¥å£çš„æ–¹æ³•æ¥è‡ªå®šä¹‰ Server Sent Event å‘å›çš„æ•°æ®, åŒ…æ‹¬å…³è”çš„äº‹ä»¶ id, comments, é‡è¯•æ—¶é—´ç­‰</p>
<h2 id="WebSocket-Support-WebSocket-æ”¯æŒ"><a href="#WebSocket-Support-WebSocket-æ”¯æŒ" class="headerlink" title="WebSocket Support (WebSocket æ”¯æŒ)"></a>WebSocket Support (WebSocket æ”¯æŒ)</h2><p>Micronaut ä¸“é—¨æ”¯æŒåˆ›å»º WebSocket å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨</p>
<p><code>io.micronaut.websocket.annotation</code> åŒ…ä¸­åŒ…å«äº†å®šä¹‰å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„æ³¨è§£</p>
<h3 id="Using-ServerWebSocket-ä½¿ç”¨-ServerWebSocket-æ³¨è§£"><a href="#Using-ServerWebSocket-ä½¿ç”¨-ServerWebSocket-æ³¨è§£" class="headerlink" title="Using @ServerWebSocket(ä½¿ç”¨ @ServerWebSocket æ³¨è§£)"></a>Using <code>@ServerWebSocket</code>(ä½¿ç”¨ <code>@ServerWebSocket</code> æ³¨è§£)</h3><p><code>@ServerWebSocket</code> æ³¨è§£å¯ä»¥åº”ç”¨åˆ°ä»»ä½•ç±»ä¸Š, è€Œä¸”åº”è¯¥æ˜ å°„åˆ°ä¸€ä¸ª WebSocket URI</p>
<p>Example - WebSocket Chat:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.websocket.WebSocketBroadcaster</span><br><span class="line"><span class="keyword">import</span> io.micronaut.websocket.WebSocketSession</span><br><span class="line"><span class="keyword">import</span> io.micronaut.websocket.annotation.onClose</span><br><span class="line"><span class="keyword">import</span> io.micronaut.websocket.annotation.OnMessage</span><br><span class="line"><span class="keyword">import</span> io.micronaut.websocket.annotation.OnOpen</span><br><span class="line"><span class="keyword">import</span> io.micronaut.websocket.annotation.ServerWebSocket</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.function.Predicate</span><br><span class="line"></span><br><span class="line"><span class="meta">@ServerWebSocket</span>(<span class="string">&quot;/chat/&#123;topic&#125;/&#123;username&#125;&quot;</span>)    <span class="comment">// 1</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChatServerWebSocket</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WebSocketBroadcaster broadcaster</span><br><span class="line"></span><br><span class="line">    ChatServerWebSocket(WebSocketBroadcaster broadcaster) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.broadcaster = broadcaster</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnOpen</span>     <span class="comment">// 2</span></span><br><span class="line">    <span class="type">void</span> onOpen(String topic, String username, WebSocketSession session) &#123;</span><br><span class="line">        String msg = <span class="string">&quot;[$username] Joined!&quot;</span></span><br><span class="line">        broadcaster.broadcastSync(msg, isValid(topic, session))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnMessage</span> <span class="comment">// 3</span></span><br><span class="line">    <span class="type">void</span> onMessage(String topic, String username, String message, WebSocketSession session) &#123;</span><br><span class="line">        String msg = <span class="string">&quot;[$username] $message&quot;</span></span><br><span class="line">        broadcaster.broadcastSync(msg, isValid(topic, session))     <span class="comment">// 4</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnClose</span> <span class="comment">// 5</span></span><br><span class="line">    <span class="type">void</span> onClose(String topic, String username, WebSocketSession session) &#123;</span><br><span class="line">        String msg = <span class="string">&quot;[$username] Disconnected!&quot;</span></span><br><span class="line">        broadcaster.broadcastSync(msg, isValid(topic, session))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Predicate&lt;WebSocketSession&gt; isValid(String topic, WebSocketSession session) &#123;</span><br><span class="line">        &#123; s -&gt; s != session &amp;&amp; topic.equalsIgnoreCase(s.uriVariables.get(<span class="string">&#x27;topic&#x27;</span>, String, <span class="literal">null</span>)) &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>1</code> : The <code>@ServerWebSocket</code> annotation defines the path the WebSocket is mapped under. The URI can be a URI template</p>
<p><code>2</code> : The <code>@OnOpen</code> annotation declares the method to invoke when the WebSocket is opened.</p>
<p><code>3</code> : The <code>@OnMessage</code> annotation declares the method to invoke when a message is received</p>
<p><code>4</code> : You can use a <code>WebSocketBroadcaster</code> to broadcast messages to every WebSocket session. You can filter which sessions to send to with a <code>Predicate</code>. Also, you could use the <code>WebSocketSession</code> instance to send a message to it with <code>WebSocketSession::send</code></p>
<p><code>5</code> : The <code>@OnClose</code> annotation declares the method to invoke when the WebSocket is closed</p>
<p>æŸ¥çœ‹ <a class="link"   target="_blank" rel="noopener" href="https://github.com/micronaut-projects/micronaut-examples/tree/master/websocket-chat" >Micronaut Example<i class="fas fa-external-link-alt"></i></a> äº†è§£æ›´è¯¦ç»†çš„ä¾‹å­</p>
<p>å¯¹äºç»‘å®š, æ¯ä¸ª WebSocket æ–¹æ³•çš„æ–¹æ³•å‚æ•°å¯ä»¥æ˜¯:</p>
<ul>
<li>ä¸€ä¸ªæ¥è‡ª URI template çš„å˜é‡ (åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­, <code>topic</code> å’Œ <code>name</code> æ˜¯ URI template å˜é‡)</li>
<li>ä¸€ä¸ª <code>WebSocketSession</code> å®ä¾‹</li>
</ul>
<h4 id="The-OnClose-Method-OnClose-æ–¹æ³•"><a href="#The-OnClose-Method-OnClose-æ–¹æ³•" class="headerlink" title="The @OnClose Method (@OnClose æ–¹æ³•)"></a>The <code>@OnClose</code> Method (<code>@OnClose</code> æ–¹æ³•)</h4><p><code>@OnClose</code> æ–¹æ³•å¯ä»¥å¯é€‰åœ°æ¥æ”¶ä¸€ä¸ª <code>CloseReason</code></p>
<p><code>@OnClose</code> æ–¹æ³•åœ¨ session å…³é—­ä¹‹å‰è¢«è°ƒç”¨</p>
<h4 id="The-OnMessage-Method-OnMessage-æ–¹æ³•"><a href="#The-OnMessage-Method-OnMessage-æ–¹æ³•" class="headerlink" title="The @OnMessage Method (@OnMessage æ–¹æ³•)"></a>The <code>@OnMessage</code> Method (<code>@OnMessage</code> æ–¹æ³•)</h4><p><code>@OnMessage</code> æ–¹æ³•å¯ä»¥ä¸º message body å®šä¹‰ä¸€ä¸ªå‚æ•°. è¿™ä¸ªå‚æ•°å¯ä»¥æ˜¯å¦‚ä¸‹è¿™äº›:</p>
<ul>
<li>ä¸€ä¸ª Netty çš„ <code>WebSocketFrame</code></li>
<li>ä»»ä½• Java åŸå§‹ç±»å‹æˆ–ç®€å•ç±»å‹ (ä¾‹å¦‚ <code>String</code>). äº‹å®ä¸Š, å¯ä»¥ä» <code>ByteBuf</code> è½¬æ¢çš„ä»»ä½•ç±»å‹éƒ½è¡Œ (å¯ä»¥æ³¨å†Œé¢å¤–çš„ <code>TypeConverter</code> Beans æ¥æ”¯æŒä¸€ä¸ªè‡ªå®šä¹‰ç±»å‹)</li>
<li>ä¸€ä¸ª <code>byte[]</code>, ä¸€ä¸ª <code>ByteBuf</code>, æˆ–è€…ä¸€ä¸ª Java NIO <code>ByteBuffer</code></li>
<li>ä¸€ä¸ª POJO, åœ¨è¿™ä¸ªåœºæ™¯, é»˜è®¤ä½¿ç”¨ <code>JsonMediaTypeCodec</code> è§£ç ä¸º JSON. ä½ å¯ä»¥æ³¨å†Œä¸€ä¸ªè‡ªå®šä¹‰çš„ codec, å¹¶ä½¿ç”¨ <code>@Consumes</code> æ³¨è§£æ¥å®šä¹‰ Handler çš„ content type</li>
<li>ä¸€ä¸ª <code>WebSocketPongMessage</code>. è¿™æ˜¯ä¸€ä¸ªç‰¹åˆ«çš„ä¾‹å­: æ–¹æ³•ä¸ä¼šæ¥æ”¶åŸå§‹ä¿¡æ¯, è€Œæ˜¯å¤„ç†ä½œä¸ºå¯¹å‘é€åˆ°å®¢æˆ·ç«¯çš„ ping çš„å›å¤è€Œåˆ°è¾¾çš„ WebSocket pong</li>
</ul>
<h4 id="The-OnError-Method-OnError-æ–¹æ³•"><a href="#The-OnError-Method-OnError-æ–¹æ³•" class="headerlink" title="The @OnError Method (@OnError æ–¹æ³•)"></a>The <code>@OnError</code> Method (<code>@OnError</code> æ–¹æ³•)</h4><p>ä¸€ä¸ªä½¿ç”¨ <code>@OnError</code> æ³¨è§£ä¿®é¥°çš„æ–¹æ³•å¯ä»¥ç”¨æ¥å®ç°è‡ªå®šä¹‰ error å¤„ç†</p>
<p><code>@OnError</code> æ–¹æ³•å¯ä»¥å®šä¹‰ä¸€ä¸ªå‚æ•°æ¥æ¥æ”¶è¦å¤„ç†çš„å¼‚å¸¸ç±»å‹</p>
<p>å¦‚æœæ²¡æœ‰ <code>@OnError</code> å¤„ç†æ–¹æ³•, ä¸”å‘ç”Ÿäº†ä¸€ä¸ªæ²¡æœ‰è¦†ç›–åˆ°çš„å¼‚å¸¸, WebSocket å°†ä¼šè‡ªåŠ¨å…³é—­</p>
<h4 id="Non-Blocking-Message-Handling-éé˜»å¡å¼ä¿¡æ¯å¤„ç†"><a href="#Non-Blocking-Message-Handling-éé˜»å¡å¼ä¿¡æ¯å¤„ç†" class="headerlink" title="Non-Blocking Message Handling (éé˜»å¡å¼ä¿¡æ¯å¤„ç†)"></a>Non-Blocking Message Handling (éé˜»å¡å¼ä¿¡æ¯å¤„ç†)</h4><p>ä¸Šé¢ä¾‹å­ä¸­ä½¿ç”¨çš„ <code>WebSocketBroadcaster</code> æ¥å£çš„ <code>broadcastSync</code> çš„æ–¹æ³•å°†ä¼šé˜»å¡çŸ¥é“ broadcast å®Œæˆ</p>
<p>ä¸€ä¸ªå­˜åœ¨äº <code>WebSocketSession</code> ç±»ä¼¼çš„ <code>sendSync</code> æ–¹æ³•é€šè¿‡é˜»å¡çš„æ–¹å¼å‘é€ä¸€ä¸ªæ¶ˆæ¯åˆ°å•ä¸ªæ¥å—è€…</p>
<p>å¯ä»¥é€šè¿‡å£°æ˜æ¯ä¸ª WebSocket å¤„ç†æ–¹æ³•è¿”å› <code>Publisher</code> æˆ– <code>Futuer</code> æ¥å®ç°éé˜»å¡ WebSocket server</p>
<p>Example - WebSocket Chat:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OnMessage</span></span><br><span class="line">Publisher&lt;Message&gt; onMessage(String topic,</span><br><span class="line">                             String username,</span><br><span class="line">                             Message message,</span><br><span class="line">                             WebSocketSession session) &#123;</span><br><span class="line">    String text = <span class="string">&quot;[$username] $message.text&quot;</span></span><br><span class="line">    Message message = <span class="keyword">new</span> Message(text)</span><br><span class="line">    broadcaster.broadcast(newMessage, isValid(topic, session))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä¾‹å­ä½¿ç”¨ <code>boradcaset</code> æ–¹æ³•, è¿™ä¸ªæ–¹æ³•åˆ›å»ºä¸€ä¸ª <code>Publisher</code> å®ä¾‹å¹¶è¿”å›å€¼ç»™ Micronaut</p>
<p>Micronaut åŸºäº <code>Publisher</code> æ¥å£æ¥å¼‚æ­¥åœ°å‘é€ä¿¡æ¯</p>
<p>ç›¸ä¼¼çš„æ–¹æ³• <code>send</code> é€šè¿‡ Micronaut è¿”å›å€¼å¼‚æ­¥åœ°å‘é€å•ä¸ªä¿¡æ¯</p>
<p>ä¸ºäº†åœ¨ Micronaut æ³¨è§£çš„å¤„ç†æ–¹æ³•ä¹‹å¤–å¼‚æ­¥åœ°å‘é€ä¿¡æ¯, å¯ä»¥ä½¿ç”¨åˆ†åˆ«ä½äº <code>WebSocketBroadcaster</code> å’Œ <code>WebSocketSession</code> çš„ <code>broadcastAsync</code> å’Œ <code>sendAsync</code> æ–¹æ³•</p>
<p>è¦è¿›è¡Œé˜»å¡å¼å‘é€, ä½¿ç”¨ <code>broadcasterSync</code> å’Œ <code>sendSync</code> æ–¹æ³•</p>
<h4 id="ServerWebSocket-and-Scopes-ServerWebSocket-å’Œä½œç”¨åŸŸ"><a href="#ServerWebSocket-and-Scopes-ServerWebSocket-å’Œä½œç”¨åŸŸ" class="headerlink" title="@ServerWebSocket and Scopes (@ServerWebSocket å’Œä½œç”¨åŸŸ)"></a><code>@ServerWebSocket</code> and Scopes (<code>@ServerWebSocket</code> å’Œä½œç”¨åŸŸ)</h4><p>é»˜è®¤åœ°, <code>@ServerWebSocket</code> å®ä¾‹åœ¨æ‰€æœ‰çš„ WebSocket è¿æ¥ä¸­å…±äº«</p>
<p>å› æ­¤éœ€è¦é¢å¤–å°å¿ƒåœ°åŒæ­¥æœ¬åœ°çŠ¶æ€æ¥é¿å…çº¿ç¨‹å®‰å…¨é—®é¢˜</p>
<p>å¦‚æœè¦æ¯ä¸ªè¿æ¥ä¸€ä¸ªå®ä¾‹, ä½¿ç”¨ <code>@Prototype</code> æ³¨è§£è¿›è¡Œä¿®é¥°. è¿™ä½¿å¾—ä½ å¯ä»¥ä» <code>@OnOpen</code> æ–¹æ³•ä¸­è·å– <code>WebSocketSession</code> å¹¶å°†è¿™ä¸ª session èµ‹å€¼åˆ° <code>@ServerWebSocket</code> å®ä¾‹çš„å­—æ®µä¸­</p>
<h4 id="Sharing-Sessions-with-the-HTTP-Session-å’Œ-HTTP-session-å…±äº«-session"><a href="#Sharing-Sessions-with-the-HTTP-Session-å’Œ-HTTP-session-å…±äº«-session" class="headerlink" title="Sharing Sessions with the HTTP Session (å’Œ HTTP session å…±äº« session)"></a>Sharing Sessions with the HTTP Session (å’Œ HTTP session å…±äº« session)</h4><blockquote>
<p>The WebSocketSession is by default backed by an in-memory map.</p>
</blockquote>
<p><code>WebSocketSession</code> é»˜è®¤ç”±å†…å­˜æ˜ å°„æ”¯æŒ</p>
<p>å¦‚æœä½ æ·»åŠ äº† <code>session</code> æ¨¡å—, ä½ å¯ä»¥åœ¨ HTTP server å’Œ WebSocket server ä¹‹é—´å…±äº« sessions</p>
<p>å½“ sessions é€šè¿‡æŒä¹…åŒ–å­˜å‚¨æ¥å®ç°æ—¶ (ä¾‹å¦‚ Redis), åœ¨æ¯ä¸ªä¿¡æ¯è¢«å¤„ç†ä¹‹å, session ä¼šè¢«æ›´æ–°åˆ°æ”¯æŒå…¶çš„å­˜å‚¨ä¸Š</p>
<h4 id="Using-the-CLI-ä½¿ç”¨-CLI"><a href="#Using-the-CLI-ä½¿ç”¨-CLI" class="headerlink" title="Using the CLI (ä½¿ç”¨ CLI)"></a>Using the CLI (ä½¿ç”¨ CLI)</h4><p>å¦‚æœä½ ä½¿ç”¨ Application Type <code>Micronaut Application</code> æ¥åˆ›å»ºé¡¹ç›®, é‚£ä¹ˆå¯ä»¥ä½¿ç”¨ <code>create-websocket-server</code> å‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªä½¿ç”¨ <code>@ServerWebSocket</code> æ³¨è§£ä¿®é¥°çš„ç±»:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mn create-websocket-server MyChat</span><br><span class="line">| Rendered template WebSocketServer.java to destination src/main/java/example/MyChatServer.java</span><br></pre></td></tr></table></figure>

<h4 id="Connection-Timeouts-è¿æ¥è¶…æ—¶"><a href="#Connection-Timeouts-è¿æ¥è¶…æ—¶" class="headerlink" title="Connection Timeouts (è¿æ¥è¶…æ—¶)"></a>Connection Timeouts (è¿æ¥è¶…æ—¶)</h4><p>é»˜è®¤æƒ…å†µä¸‹, Micronaut åœ¨äº”åˆ†é’Ÿåä½¿æ²¡æœ‰ä»»ä½•æ´»åŠ¨çš„ç©ºé—²è¿æ¥è¶…æ—¶</p>
<p>æ­£å¸¸æƒ…å†µä¸‹è¿™ä¸ä¼šæ˜¯ä¸€ä¸ªé—®é¢˜, å› ä¸ºæµè§ˆå™¨ä¼šè‡ªåŠ¨é‡æ–°è¿æ¥ WebSocket sessions</p>
<p>ä½ å¯ä»¥é€šè¿‡è®¾ç½® <code>micronaut.server.idle-timeout</code> æ¥æ§åˆ¶è¿™ä¸ªè¡Œä¸º:</p>
<p>Example - Setting the Connection Timeout for the Server:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">server:</span></span><br><span class="line">        <span class="attr">idle-timeout:</span> <span class="string">30m</span> <span class="comment"># 30 åˆ†é’Ÿ</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœè®¾ç½®ä¸ºè´Ÿæ•°, åˆ™ä»£è¡¨ä¸ä¼šè¶…æ—¶</p>
<p>å¦‚æœä½¿ç”¨ Micronaut çš„ WebSocket å®¢æˆ·ç«¯, å¯ä»¥è¿™æ ·è®¾ç½®å®¢æˆ·ç«¯ä¸Šçš„è¶…æ—¶æ—¶é—´:</p>
<p>Example - Setting the Connection Timeout for the Client:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">        <span class="attr">client:</span></span><br><span class="line">            <span class="attr">read-idle-timeout:</span> <span class="string">30m</span> <span class="comment"># 30 åˆ†é’Ÿ</span></span><br></pre></td></tr></table></figure>

<h3 id="Using-ClientWebSocket-ä½¿ç”¨-ClientWebSocket"><a href="#Using-ClientWebSocket-ä½¿ç”¨-ClientWebSocket" class="headerlink" title="Using @ClientWebSocket (ä½¿ç”¨ @ClientWebSocket)"></a>Using <code>@ClientWebSocket</code> (ä½¿ç”¨ <code>@ClientWebSocket</code>)</h3><blockquote>
<p>The <code>@ClientWebSocket</code> annotation can be used with the <code>WebSocketClient</code> interface to define WebSocket clients.</p>
</blockquote>
<p>é€šè¿‡ <code>WebSocketClient</code> æ¥å£é…åˆ <code>@ClientWebSocket</code> æ³¨è§£æ¥å®šä¹‰ WebSocket å®¢æˆ·ç«¯</p>
<p>å¯ä»¥ä½¿ç”¨ <code>@Client</code> æ³¨è§£æ¥æ³¨å…¥ä¸€ä¸ª <code>WebSocketClient</code> å¼•ç”¨:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Inject</span></span><br><span class="line"><span class="meta">@Client</span>(<span class="string">&quot;http://localhost:8080&quot;</span>)</span><br><span class="line">WebSocketClient webSocketClient</span><br></pre></td></tr></table></figure>

<p>è¿™å¯ä»¥è®©ä½ çš„ WebSocket å®¢æˆ·ç«¯ä½¿ç”¨ç›¸åŒçš„æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ç‰¹æ€§</p>
<p>ä¸€æ—¦ä½ æœ‰äº†ä¸€ä¸ª <code>WebSocketClient</code> æ¥å£çš„å¼•ç”¨, ä½ å¯ä»¥ä½¿ç”¨ <code>connect</code> æ–¹æ³•æ¥è·å–ä¸€ä¸ªè¿æ¥çš„ bean å®ä¾‹, è¿™ä¸ª bean å®ä¾‹ä½¿ç”¨ <code>@ClientWebSocket</code> æ³¨è§£ä¿®é¥°</p>
<p>Example - WebSocket Chat:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.http.HttpRequest</span><br><span class="line"><span class="keyword">import</span> io.micronaut.websocket.WebSocketSession</span><br><span class="line"><span class="keyword">import</span> io.micronaut.websocket.annotation.ClientWebSocket</span><br><span class="line"><span class="keyword">import</span> io.micronaut.websocket.annotation.OnMessage</span><br><span class="line"><span class="keyword">import</span> io.micronaut.websocket.annotation.OnOpen</span><br><span class="line"><span class="keyword">import</span> org.reactivestreams.Publisher</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentLinkedQueue</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Future</span><br><span class="line"><span class="keyword">import</span> io.micronaut.core.async.annotation.SingleResult</span><br><span class="line"></span><br><span class="line"><span class="meta">@ClientWebSocket</span>(<span class="string">&quot;/chat/&#123;topic&#125;/&#123;username&#125;&quot;</span>)    <span class="comment">// 1</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">ChatClientWebSocket</span> <span class="keyword">implements</span> <span class="title class_">AutoCloseable</span> &#123;   <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> WebSocketSession session</span><br><span class="line">    <span class="keyword">private</span> HttpRequest request</span><br><span class="line">    <span class="keyword">private</span> String topic</span><br><span class="line">    <span class="keyword">private</span> String username</span><br><span class="line">    <span class="keyword">private</span> Collection&lt;String&gt; replies = <span class="keyword">new</span> ConcurrentLinkedQueue&lt;&gt;()</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnOpen</span></span><br><span class="line">    <span class="type">void</span> onOpen(String topic,</span><br><span class="line">                String username,</span><br><span class="line">                WebSocketSession session,</span><br><span class="line">                HttpRequest request) &#123;      <span class="comment">// 3</span></span><br><span class="line">        <span class="variable language_">this</span>.topic = topic</span><br><span class="line">        <span class="variable language_">this</span>.username = username</span><br><span class="line">        <span class="variable language_">this</span>.session = session</span><br><span class="line">        <span class="variable language_">this</span>.request = request</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    String getTopic() &#123; topic &#125;</span><br><span class="line">    String getUsername() &#123; username &#125;</span><br><span class="line">    Collection&lt;String&gt; getReplies() &#123; replies &#125;</span><br><span class="line">    WebSocketSession getSession() &#123; session &#125;</span><br><span class="line">    HttpRequest getRequest &#123; request &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnMessage</span></span><br><span class="line">    <span class="type">void</span> onMessage(String message) &#123; replies &lt;&lt; message&#125;    <span class="comment">// 4</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>1</code> : The class is abstract (more on that later) and is annotated with <code>@ClientWebSocket</code></p>
<p><code>2</code> : The client must implements <code>AutoCloseable</code> and you should ensure that the connection is closed at some point</p>
<p><code>3</code> : You can use the same annotations as on the server, in this case <code>@OnOpen</code> to obtain a reference to the underlying session</p>
<p><code>4</code> : <code>@OnMessage</code> annotation defines the method that receives responses from the server</p>
<p>ä½ è¿˜å¯ä»¥å®šä¹‰æŠ½è±¡æ–¹æ³•, è¿™äº›æ–¹æ³•ä»¥ <code>send</code> æˆ– <code>broadcast</code> å¼€å¤´, è¿™äº›æ–¹æ³•å°†ä¼šåœ¨ç¼–è¯‘æ—¶è‡ªåŠ¨è¢«å®ç°:</p>
<p>Example - WebSocket Send Methods:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">void</span> send(String message)</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡è¿”å› <code>void</code> æ¥å‘Šè¯‰ Micronaut è¿™ä¸ªæ–¹æ³•æ˜¯é˜»å¡å¼å‘é€çš„</p>
<p>åŒæ—¶, å¯ä»¥å®šä¹‰æ–¹æ³•è¿”å› <code>Future</code> æˆ– <code>Publisher</code>:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> reactor.core.publisher.Mono&lt;String&gt; send(String message)</span><br></pre></td></tr></table></figure>

<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> java.util.concurrent.Future&lt;String&gt; sendAsync(String message)</span><br></pre></td></tr></table></figure>

<p>ä¸€æ—¦ä½ å®šä¹‰äº†ä¸€ä¸ªå®¢æˆ·ç«¯ç±», ä½ å¯ä»¥è¿æ¥åˆ°å®¢æˆ·ç«¯ Socket, å¹¶å¼€å§‹å‘é€ä¿¡æ¯:</p>
<p>Example - Connecting a Client WebSocket:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ChatClientWebSocket chatClient = webSocketClient.connect(ChatClientWebSocket.<span class="keyword">class</span>, <span class="string">&quot;/chat/football/fred&quot;</span>)</span><br><span class="line">.blockFirst();</span><br><span class="line">chatClient.send(<span class="string">&quot;Hello World!&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="Using-the-CLI-ä½¿ç”¨-CLI-1"><a href="#Using-the-CLI-ä½¿ç”¨-CLI-1" class="headerlink" title="Using the CLI (ä½¿ç”¨ CLI)"></a>Using the CLI (ä½¿ç”¨ CLI)</h4><p>å¦‚æœä½ ä½¿ç”¨ Micronaut CLI æ¥åˆ›å»ºä½ çš„é¡¹ç›®, å¹¶ä¸”æ˜¯é»˜è®¤ (<code>service</code>) profile, ä½ å¯ä»¥ä½¿ç”¨ <code>create-websocket-client</code> å‘½ä»¤æ¥é€šè¿‡ <code>WebSocketClient</code> åˆ›å»ºä¸€ä¸ªæŠ½è±¡ç±»:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mn create-websocket-client MyChat</span><br><span class="line">| Rendered template WebSocketClient.java to destination src/main/java/example/MyChatClient.java</span><br></pre></td></tr></table></figure>

<h2 id="HTTP-x2F-2-Support-HTTP-x2F-2-æ”¯æŒ"><a href="#HTTP-x2F-2-Support-HTTP-x2F-2-æ”¯æŒ" class="headerlink" title="HTTP&#x2F;2 Support (HTTP&#x2F;2 æ”¯æŒ)"></a>HTTP&#x2F;2 Support (HTTP&#x2F;2 æ”¯æŒ)</h2><p>ä» Micronaut 2.x å¼€å§‹, Micronaut çš„åŸºäº Netty çš„ HTTP server å¯ä»¥é€šè¿‡é…ç½®æ¥æ”¯æŒ HTTP&#x2F;2</p>
<h3 id="Configuring-the-Server-for-HTTP-x2F-2-ä¸º-HTTP-x2F-2-é…ç½®-Server"><a href="#Configuring-the-Server-for-HTTP-x2F-2-ä¸º-HTTP-x2F-2-é…ç½®-Server" class="headerlink" title="Configuring the Server for HTTP&#x2F;2 (ä¸º HTTP&#x2F;2 é…ç½® Server)"></a>Configuring the Server for HTTP&#x2F;2 (ä¸º HTTP&#x2F;2 é…ç½® Server)</h3><p>ç¬¬ä¸€æ­¥æ˜¯é…ç½®æ”¯æŒçš„ HTTP ç‰ˆæœ¬</p>
<p>Example - Enabling HTTP&#x2F;2 Support:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">server:</span></span><br><span class="line">        <span class="attr">http-version:</span> <span class="number">2.0</span></span><br></pre></td></tr></table></figure>

<p>é€šè¿‡è¿™ä¸ªé…ç½®, Micronaut å¼€å¯äº†å¯¹ <code>h2c</code> (<a class="link"   target="_blank" rel="noopener" href="https://httpwg.org/specs/rfc7540.html#discover-http" >HTTP&#x2F;2 over cleartext<i class="fas fa-external-link-alt"></i></a>) åè®®çš„æ”¯æŒ, è¿™å¯¹äºå¼€å‘æ¥è¯´å¾ˆå¥½</p>
<p>å› ä¸ºæµè§ˆå™¨ä¸æ”¯æŒ <code>h2c</code> ä½†ä¸€èˆ¬æ¥è¯´æ”¯æŒ <a class="link"   target="_blank" rel="noopener" href="https://httpwg.org/specs/rfc7540.html#discover-https" >HTTP&#x2F;2 over TLS<i class="fas fa-external-link-alt"></i></a> (<code>h2</code> åè®®), æ¨èåœ¨ç”Ÿäº§ç¯å¢ƒå¼€å¯ HTTPS æ”¯æŒ</p>
<p>å¯¹äºå¼€å‘æ¥è¯´, å¯ä»¥è¿™æ ·è¿›è¡Œé…ç½®</p>
<p>Example - Enabling <code>h2</code> Protocol Support:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">server:</span></span><br><span class="line">        <span class="attr">http-version:</span> <span class="number">2.0</span></span><br><span class="line">        <span class="attr">ssl:</span></span><br><span class="line">            <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">buildSelfSigned:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>å¯¹äºç”Ÿäº§ç¯å¢ƒ, å‚è€ƒ <code>configuring HTTPS</code> ç« èŠ‚</p>
<p>å¦‚æœä½ çš„å¼€å‘ç¯å¢ƒä½¿ç”¨çš„æ˜¯ JDK8, æˆ–è®¸éœ€è¦æé«˜å¯¹ OpenSSL çš„æ”¯æŒ, å®šä¹‰ä»¥ä¸‹å¯¹ Netty Tomcat Native çš„æ”¯æŒ:</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">runtimeOnly(<span class="string">&quot;io.netty:netty-tcnative:2.0.46.Final&quot;</span>)</span><br><span class="line"></span><br><span class="line">runtimeOnly(<span class="string">&quot;io.netty:netty-tcnative-boringssl-static:2.0.46.Final&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>é™¤æ­¤ä¹‹å¤–è¿˜è¦é…ç½®ä¸€ä¸ªé€‚åˆçš„ä½ ç”µè„‘ç³»ç»Ÿæ¶æ„çš„æœ¬åœ°åº“ä¾èµ–:</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">runtimeOnly <span class="string">&quot;io.netty:netty-tcnative-boringssl-static:2.0.46.Final:$&#123;Os.isFamily(Os.FAMILY_MAC) ? (Os.isArch(&quot;</span>aarch64<span class="string">&quot;) ? &quot;</span>osx-aarch_64<span class="string">&quot; : &quot;</span>osx-x86_64<span class="string">&quot;) : &#x27;linux-x86_64&#x27;&#125;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="HTTP-x2F-2-Server-Push-Support-HTTP-x2F-2-Server-æ¨é€æ”¯æŒ"><a href="#HTTP-x2F-2-Server-Push-Support-HTTP-x2F-2-Server-æ¨é€æ”¯æŒ" class="headerlink" title="HTTP&#x2F;2 Server Push Support (HTTP&#x2F;2 Server æ¨é€æ”¯æŒ)"></a>HTTP&#x2F;2 Server Push Support (HTTP&#x2F;2 Server æ¨é€æ”¯æŒ)</h3><p>Micronaut 3.2 å¼€å§‹æ”¯æŒ server push</p>
<p>server push å…è®¸å•ä¸ªè¯·æ±‚è§¦å‘å¤šä¸ªå“åº”. æœ€å¸¸ä½¿ç”¨åœ¨åŸºäºæµè§ˆå™¨çš„èµ„æº (browser based resources)</p>
<p>ç›®æ ‡æ˜¯å‡å°‘å®¢æˆ·ç«¯çš„ç­‰å¾…æ—¶é—´, å› ä¸ºå®¢æˆ·ç«¯ä¸éœ€è¦å†æ‰‹åŠ¨è¯·æ±‚èµ„æº</p>
<p>ä¸€ä¸ªæ–°çš„æ¥å£ <code>PushCapableHttpRequest</code> è¢«åˆ›å»ºæ¥æ”¯æŒè¿™ä¸ªç‰¹æ€§</p>
<p>ç®€å•åœ°æ·»åŠ ä¸€ä¸ª <code>PushCapableHttpRequest</code> å‚æ•°åˆ° Controller çš„æ–¹æ³•ä¸Š, ç„¶åä½¿ç”¨ <code>PushCapableHttpRequest</code> ä¸Šçš„ API æ¥è§¦å‘é¢å¤–è¯·æ±‚</p>
<p><code>PushCapableHttpRequest</code> ç»§æ‰¿äº† <code>HttpRequest</code>, æ‰€ä»¥æ²¡æœ‰å¿…è¦åœ¨ Controller æ–¹æ³•å‚æ•°ä¸ŠåŒæ—¶åŒ…å«è¿™ä¸¤ç§ç±»å‹çš„å‚æ•°</p>
<p>åœ¨è§¦å‘é¢å¤–è¯·æ±‚å‰, è¦è°ƒç”¨ <code>isServerPushSupported()</code> æ–¹æ³•æ¥ç¡®ä¿è¿™ä¸ªç‰¹æ€§æ˜¯å¯ç”¨çš„</p>
<p>ä¸€æ—¦çŸ¥é“è¿™ä¸ªç‰¹æ€§æ˜¯å¯ç”¨çš„, ä½¿ç”¨ <code>serverPush(HttpRequest)</code> æ–¹æ³•æ¥è§¦å‘é¢å¤–è¯·æ±‚ (additional requests). ä¾‹å¦‚, <code>request.serverPush(HttpRequest.GET(&#39;/static/style.css&#39;))</code></p>
<h2 id="Server-Events-Server-äº‹ä»¶"><a href="#Server-Events-Server-äº‹ä»¶" class="headerlink" title="Server Events (Server äº‹ä»¶)"></a>Server Events (Server äº‹ä»¶)</h2><p>HTTP Server è¾“å‡ºä¸€ç³»åˆ—äº‹ä»¶, è¿™äº›äº‹ä»¶éƒ½å®šä¹‰åœ¨ <code>io.micronaut.runtime.server.event</code> åŒ…ä¸­, å¯ä»¥ä¸ºè¿™äº›äº‹ä»¶ç¼–å†™ç›‘å¬å™¨</p>
<p>Table - Server Events:</p>
<table>
<thead>
<tr>
<th align="left">Event</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>ServerStartupEvent</code></td>
<td align="left">Emitted when the server completes startup</td>
</tr>
<tr>
<td align="left"><code>ServerShutdownEvent</code></td>
<td align="left">Emitted when the server shuts down</td>
</tr>
<tr>
<td align="left"><code>ServerReadyEvent</code></td>
<td align="left">Emitted after all <code>ServerStartupEvent</code> listeners have been invoked and exposes the <code>EmbeddedServerInstance</code></td>
</tr>
<tr>
<td align="left"><code>ServerStoppedEvent</code></td>
<td align="left">Emitted after all <code>ServerShutdownEvent</code> listeners have been invoked and exposes the <code>EmbeddedServerInstance</code></td>
</tr>
</tbody></table>
<p>åœ¨ <code>ServerStartupEvent</code> ä¸­è¿›è¡Œé‡è¦çš„å·¥ä½œå°†ä¼šæ˜¾è‘—å¢åŠ å¯åŠ¨æ—¶é—´</p>
<p>Example - Listening for Server Startup Events - é€šè¿‡å®ç° <code>ApplicationEventListener</code> çš„æ–¹å¼è¿›è¡Œç›‘å¬:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.context.event.ApplicationEventListener</span><br><span class="line"></span><br><span class="line"><span class="meta">@Singleton</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StartupListener</span> <span class="keyword">implements</span> <span class="title class_">ApplicationEventListener</span>&lt;ServerStartupEvent&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">void</span> onApplicationEvent(ServerStartupEvent event) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Example - åœ¨ä»»æ„ Bean çš„æ–¹æ³•ä¸Šä½¿ç”¨ <code>@EventListener</code> æ³¨è§£ç›‘å¬ server å¯åŠ¨äº‹ä»¶:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.runtime.event.annotation.EventListener</span><br><span class="line"><span class="keyword">import</span> io.micronaut.runtime.server.event.ServerStartupEvent</span><br><span class="line"><span class="keyword">import</span> javax.inject.Singleton</span><br><span class="line"></span><br><span class="line"><span class="meta">@Singleton</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBean</span> &#123;</span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">void</span> onStartup(ServerStartupEvent event) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Configuring-the-HTTP-Server-é…ç½®-HTTP-Server"><a href="#Configuring-the-HTTP-Server-é…ç½®-HTTP-Server" class="headerlink" title="Configuring the HTTP Server (é…ç½® HTTP Server)"></a>Configuring the HTTP Server (é…ç½® HTTP Server)</h2><p>HTTP Server æœ‰å¾ˆå¤šçš„é…ç½®é€‰é¡¹</p>
<p>è¿™äº›é…ç½®é€‰é¡¹å®šä¹‰åœ¨ <code>NettyHttpServerConfiguration</code> é…ç½®ç±»ä¸­, è¿™ä¸ªç±»ç»§æ‰¿äº† <code>HttpServerConfiguration</code></p>
<p>Example - Configuring HTTP server settings:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">server:</span></span><br><span class="line">        <span class="attr">maxRequestSize:</span> <span class="string">1MB</span></span><br><span class="line">        <span class="attr">host:</span> <span class="string">localhost</span>             <span class="string">//</span> <span class="number">1</span></span><br><span class="line">        <span class="attr">netty:</span></span><br><span class="line">            <span class="attr">maxHeaderSize:</span> <span class="string">500KB</span>    <span class="string">//</span> <span class="number">2</span></span><br><span class="line">            <span class="attr">worker:</span></span><br><span class="line">                <span class="attr">threads:</span> <span class="number">8</span>          <span class="string">//</span> <span class="number">3</span></span><br><span class="line">            <span class="attr">childOptions:</span></span><br><span class="line">                <span class="attr">autoRead:</span> <span class="literal">true</span>      <span class="string">//</span> <span class="number">4</span></span><br></pre></td></tr></table></figure>

<p><code>1</code> : By default Micronaut binds to all network interfaces. Use <code>localhost</code> to bind only to loopback network interface</p>
<p><code>2</code> : Maximum size for headers</p>
<p><code>3</code> : Number of Netty worker threads</p>
<p><code>4</code> : Auto read requset body</p>
<p><a class="link"   target="_blank" rel="noopener" href="https://docs.micronaut.io/latest/api/io/micronaut/http/server/netty/configuration/NettyHttpServerConfiguration.html" >NettyHttpServerConfiguration<i class="fas fa-external-link-alt"></i></a></p>
<p>ä¸­çš„ getter æ–¹æ³•æŒ‡ç¤ºäº†é…ç½®å±æ€§</p>
<p>ä¾‹å¦‚, <code>getMaxHeaderSize()</code> æ–¹æ³• å¯¹åº” <code>micronaut.server.netty.max-header-size</code> Property</p>
<h3 id="Using-Native-Transports-ä½¿ç”¨åŸç”Ÿä¼ è¾“"><a href="#Using-Native-Transports-ä½¿ç”¨åŸç”Ÿä¼ è¾“" class="headerlink" title="Using Native Transports (ä½¿ç”¨åŸç”Ÿä¼ è¾“)"></a>Using Native Transports (ä½¿ç”¨åŸç”Ÿä¼ è¾“)</h3><blockquote>
<p>The native Netty transports add features specific to a particular platform, generate less garbage, and generally improve performance when compared to the NIO-based transport.</p>
</blockquote>
<p>åŸç”Ÿ Netty ä¼ è¾“ä¸ºç‰¹å®šå¹³å°æ·»åŠ ç‰¹å®šåŠŸèƒ½, ä¸åŸºäº NIO çš„ä¼ è¾“ç›¸æ¯”äº§ç”Ÿæ›´å°‘çš„åƒåœ¾, å¹¶ä¸”æ€»ä½“ä¸Šæé«˜äº†æ€§èƒ½</p>
<p>ä¸ºäº†å¼€å¯åŸç”Ÿä¼ è¾“, é¦–å…ˆéœ€è¦æ·»åŠ ä¾èµ–:</p>
<p>x86 å¹³å°çš„ MacOS: <code>runtimeOnly(&quot;io.netty:netty-transport-native-kqueue::osx-x86_64&quot;)</code></p>
<p>M1 å¹³å°çš„ MacOS: <code>runtimeOnly(&quot;io.netty:netty-transport-native-kqueue::osx-aarch_64&quot;)</code></p>
<p>x86 å¹³å°çš„ Linux: <code>runtimeOnly(&quot;io.netty:netty-transport-native-kqueue::linux-x86_64&quot;)</code></p>
<p>ARM64 å¹³å°çš„ Linux: <code>runtimeOnly(&quot;io.netty:netty-transport-native-kqueue::linux-aarch_64&quot;)</code></p>
<p>ç„¶åé…ç½®é»˜è®¤çš„ event loop group å€¾å‘äºåŸç”Ÿä¼ è¾“:</p>
<p>Example - Configuring The Default Event Loop to Prefer Native Transports:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">netty:</span></span><br><span class="line">        <span class="attr">event-loops:</span></span><br><span class="line">            <span class="attr">default:</span></span><br><span class="line">                <span class="attr">prefer-native-transport:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Netty enables simplistic sampling resource leak detection which reports there is a leak or not, at the cost of small overhead. You can disable it or enable more advanced detection by setting property netty.<code>resource-leak-detector-level</code> to one of: SIMPLE (default), DISABLED, PARANOID or ADVANCED</p>
</blockquote>
<p>Netty æ”¯æŒç®€å•çš„èµ„æºé‡‡æ ·æ³„éœ²æ£€æµ‹, å®ƒæŠ¥å‘Šæ˜¯å¦å­˜åœ¨æ³„éœ², å½“å¼€é”€å¾ˆå°. ä½ å¯ä»¥é€šè¿‡å°†å±æ€§ <code>netty.resource-leak-detector-level</code> è®¾ç½®ä¸ºä»¥ä¸‹ä¹‹ä¸€æ¥ç¦ç”¨å®ƒæˆ–å¯ç”¨æ›´é«˜çº§çš„æ£€æµ‹: <code>SIMPLE</code>(é»˜è®¤), <code>DISABLED</code>, <code>PARANOID</code>(åæ‰§), <code>ADVANCED</code>(é«˜çº§)</p>
<h3 id="Configuring-Server-Thread-Pools-é…ç½®-Server-çº¿ç¨‹æ± "><a href="#Configuring-Server-Thread-Pools-é…ç½®-Server-çº¿ç¨‹æ± " class="headerlink" title="Configuring Server Thread Pools (é…ç½® Server çº¿ç¨‹æ± )"></a>Configuring Server Thread Pools (é…ç½® Server çº¿ç¨‹æ± )</h3><p>HTTP Server æ˜¯æ„å»ºåœ¨ Netty ä¸Šçš„, Netty è¢«è®¾è®¡ä½œä¸ºä¸€ä¸ªä½¿ç”¨ event loop æ¨¡å‹çš„éé˜»å¡ I&#x2F;O å·¥å…·</p>
<p>Netty worker event loop ä½¿ç”¨åç§°ä¸º <code>default</code> çš„ event loop group. å¯ä»¥é€šè¿‡ <code>micronaut.netty.event-loops.default</code> å±æ€§æ¥è¿›è¡Œé…ç½®</p>
<blockquote>
<p>The event loop configuration under <code>micronaut.server.netty.worker</code> is only used if the <code>event-loop-group</code> is set to a name which doesnâ€™t correspond to any <code>micronaut.netty.event-loops</code> configuration.</p>
</blockquote>
<p>ä»…å½“ <code>event-loop-group</code> è®¾ç½®ä¸ºä¸€ä¸ªåç§°, è¿™ä¸ªåç§°ä¸ä»»ä½• <code>micronaut.netty.event-loops</code> é…ç½®éƒ½ä¸åŒ¹é…æ—¶, æ‰ä¼šä½¿ç”¨ <code>micronaut.server.netty.worker</code> ä¸‹çš„ event loop é…ç½®</p>
<blockquote>
<p>This behavior is deprecated and will be removed in a future version.</p>
</blockquote>
<p>è¿™ä¸ªè¡Œä¸ºå·²ç»æ˜¯è¿‡æ—¶çš„, å°†ä¼šåœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­ç§»é™¤</p>
<blockquote>
<p>Use <code>micronaut.netty.event-loops.*</code> for any event loop group configuration beyond setting the name through <code>event-loop-group</code>.</p>
</blockquote>
<p>ä¸ºæ‰€æœ‰ event loop group é…ç½®ä½¿ç”¨ <code>micronaut.netty.event-loops.*</code>, è€Œä¸æ˜¯é€šè¿‡ <code>event-loop-group</code> è®¾ç½®åç§°</p>
<blockquote>
<p>This does not apply to the parent event loop configuration (<code>micronaut.server.netty.parent</code>).</p>
</blockquote>
<p>è¿™ä¸é€‚ç”¨äºçˆ¶ event loop é…ç½® (<code>micronaut.server.netty.parent</code>)</p>
<p>Table - Configuration Properties for <code>Worker</code>:</p>
<table>
<thead>
<tr>
<th align="left">Property</th>
<th align="left">Type</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>micronaut.server.netty.worker</code></td>
<td align="left"><code>NettyHttpServerConfiguration$Worker</code></td>
<td align="left">Sets the worker event loop configuration</td>
</tr>
<tr>
<td align="left"><code>micronaut.server.netty.worker.event-loop-group</code></td>
<td align="left"><code>java.lang.Strng</code></td>
<td align="left">Sets the name to use</td>
</tr>
<tr>
<td align="left"><code>micronaut.server.netty.worker.threads</code></td>
<td align="left"><code>int</code></td>
<td align="left">Sets the number of threads for the event loop group</td>
</tr>
<tr>
<td align="left"><code>micronaut.server.netty.worker.io-ratio</code></td>
<td align="left"><code>java.lang.Integer</code></td>
<td align="left">Sets the I&#x2F;O ratio</td>
</tr>
<tr>
<td align="left"><code>micronaut.server.netty.worker.executor</code></td>
<td align="left"><code>java.lang.String</code></td>
<td align="left">Sets the name of the executor</td>
</tr>
<tr>
<td align="left"><code>micronaut.server.netty.worker.prefer-native-transport</code></td>
<td align="left"><code>boolean</code></td>
<td align="left">Set whether to prefer the native transport if available</td>
</tr>
<tr>
<td align="left"><code>micronaut.server.netty.worker.shutdown-quiet-period</code></td>
<td align="left"><code>java.time.Duration</code></td>
<td align="left">Set the shutdown quiet period</td>
</tr>
<tr>
<td align="left"><code>micronaut.server.netty.worker.shutdown-timeout</code></td>
<td align="left"><code>java.time.Duration</code></td>
<td align="left">Set the shutdown timeout (must be &gt;&#x3D; shutdownQuietPeriod)</td>
</tr>
</tbody></table>
<blockquote>
<p>The parent event loop can be configured with <code>micronaut.server.netty.parent</code> with the same configuration options.</p>
</blockquote>
<p>çˆ¶ event loop å¯ä»¥é€šè¿‡ç›¸åŒçš„é…ç½®é€‰é¡¹æ¥ä½¿ç”¨ <code>micronuat.server.netty.parent</code> è¿›è¡Œé…ç½®</p>
<p>Example - Using a different event loop for the server - server å¯ä»¥é…ç½®ä¸ºä½¿ç”¨ä¸€ä¸ªä¸åŒå‘½åçš„ worker event loop:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">server:</span></span><br><span class="line">        <span class="attr">netty:</span></span><br><span class="line">            <span class="attr">worker:</span></span><br><span class="line">                <span class="attr">event-loop-group:</span> <span class="string">other</span></span><br><span class="line">    <span class="attr">netty:</span></span><br><span class="line">        <span class="attr">event-loops:</span></span><br><span class="line">            <span class="attr">other:</span></span><br><span class="line">                <span class="attr">num-threads:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure>

<p>çº¿ç¨‹æ•°é‡çš„é»˜è®¤å€¼æ˜¯ç³»ç»Ÿå±æ€§ <code>io.netty.eventLoopThreads</code> çš„å€¼, å¦‚æœè¿™ä¸ªç³»ç»Ÿå±æ€§æ²¡æœ‰é…ç½®, åˆ™çº¿ç¨‹æ•°é‡ä¸ºå¯ç”¨å¤„ç†å™¨æ•°é‡çš„ä¸¤å€</p>
<p>Table - Configuration Properties for <a class="link"   target="_blank" rel="noopener" href="https://docs.micronaut.io/latest/api/io/micronaut/http/netty/channel/DefaultEventLoopGroupConfiguration.html" >DefaultEventLoopGroupConfiguration<i class="fas fa-external-link-alt"></i></a>:</p>
<p>Property | Type | Description<br><code>micronaut.netty.event-loops.*.num-threads</code> | <code>int</code> |<br><code>micronaut.netty.event-loops.*.io-ratio</code> | <code>java.lang.Integer</code> |<br><code>micronaut.netty.event-loops.*.prefer-native-transport</code> | <code>boolean</code> |<br><code>micronaut.netty.event-loops.*.executor</code> | <code>java.lang.String</code> |<br><code>micronaut.netty.event-loops.*.shutdown-quiet-period</code> | <code>java.time.Duration</code> |<br><code>micronaut.netty.event-loops.*.shutdown-timeout</code> | <code>java.time.Duration</code> |</p>
<h4 id="Blocking-Operations-é˜»å¡å¼æ“ä½œ"><a href="#Blocking-Operations-é˜»å¡å¼æ“ä½œ" class="headerlink" title="Blocking Operations (é˜»å¡å¼æ“ä½œ)"></a>Blocking Operations (é˜»å¡å¼æ“ä½œ)</h4><p>å½“å¤„ç†é˜»å¡å¼æ“ä½œ, Micronaut é»˜è®¤å°†è¿™ä¸ªæ“ä½œè½¬ç§»åˆ°ä¸€ä¸ªæ— è¾¹ç•Œçš„ç¼“å­˜çš„ I&#x2F;O çº¿ç¨‹æ± </p>
<p>ä½ å¯ä»¥ä½¿ç”¨åç§°ä¸º <code>io</code> çš„ <code>ExecutorConfiguration</code> é…ç½®è¿™ä¸ª I&#x2F;O çº¿ç¨‹æ± :</p>
<p>Example - Configuring the Server I&#x2F;O Thread Pool:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">executors:</span></span><br><span class="line">        <span class="attr">io:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">fixed</span></span><br><span class="line">            <span class="attr">nThreads:</span> <span class="number">75</span></span><br></pre></td></tr></table></figure>

<h3 id="Configuring-the-Netty-Pipeline-é…ç½®-Netty-ç®¡é“"><a href="#Configuring-the-Netty-Pipeline-é…ç½®-Netty-ç®¡é“" class="headerlink" title="Configuring the Netty Pipeline (é…ç½® Netty ç®¡é“)"></a>Configuring the Netty Pipeline (é…ç½® Netty ç®¡é“)</h3><p>å¯ä»¥é€šè¿‡ç¼–å†™ä¸€ä¸ª <code>Bean Event Listener</code> ç›‘å¬ <code>ChannelPipelineCustomizer</code> çš„åˆ›å»ºæ¥è‡ªå®šä¹‰ Netty pipeline</p>
<p>Netty HTTP server å’Œ client å®ç°äº†è¿™ä¸ªæ¥å£, å…è®¸ä½ è‡ªå®šä¹‰ Netty <code>ChannelPipeline</code> å¹¶æ·»åŠ é¢å¤–çš„å¤„ç†å™¨</p>
<p><code>ChannelPipelineCustomizer</code> æ¥å£ä¸º Micronaut æ³¨å†Œçš„å¤šä¸ªå¤„ç†å™¨çš„åç§°å®šä¹‰å¸¸é‡ (constants)</p>
<p>ä¸‹é¢çš„ä»£ç ç¤ºä¾‹å±•ç¤ºäº†æ³¨å†ŒåŒ…å«äº†é¢å¤– Netty å¤„ç†å™¨æ¥å¤„ç†è¯·æ±‚å“åº”æ—¥å¿—çš„ <code>Logbook</code> åº“</p>
<p>Example - Customizing the Netty pipeline for Logbook:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.context.annotation.Requires</span><br><span class="line"><span class="keyword">import</span> io.micronaut.context.event.BeanCreatedEvent</span><br><span class="line"><span class="keyword">import</span> io.micronaut.context.event.BeanCreatedEventListener</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.netty.channel.ChannelPipelineCustomizer</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelPipeline</span><br><span class="line"><span class="keyword">import</span> org.zalando.logbook.Logbook</span><br><span class="line"><span class="keyword">import</span> org.zalando.logbook.netty.LogbookClientHandler</span><br><span class="line"><span class="keyword">import</span> org.zalando.logbook.netty.LogbookServerHandler</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jakarta.inject.Singleton</span><br><span class="line"></span><br><span class="line"><span class="meta">@Requires</span>(beans = LogBook.<span class="keyword">class</span>)</span><br><span class="line"><span class="meta">@Singleton</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LogbookPipelineCustomizer</span> <span class="keyword">implements</span> <span class="title class_">BeanCreatedEventListener</span>&lt;ChannelPipelineCustomizer&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Logbook logbook</span><br><span class="line"></span><br><span class="line">    LogbookPipelineCustomizer(Logbook logbook) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.logbook = logbook</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    ChannelPipelineCustomizer onCreated(BeanCreatedEvent&lt;ChannelPipelineCustomizer&gt; event) &#123;</span><br><span class="line">        ChannelPipelineCustomizer customizer = event.bean</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (customizer.serverChannel) &#123;</span><br><span class="line">            customizer.doOnConnect( &#123; ChannelPipeline pipeline -&gt;</span><br><span class="line">                pipeline.addAfter(</span><br><span class="line">                        ChannelPipelineCustomizer.HANDLER_HTTP_SERVER_CODEC,</span><br><span class="line">                        <span class="string">&quot;logbook&quot;</span>,</span><br><span class="line">                        <span class="keyword">new</span> LogbookServerHandler(logbook)</span><br><span class="line">                )</span><br><span class="line">                <span class="keyword">return</span> pipeline</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            customizer.doOnConnect(&#123; ChannelPipeline pipeline -&gt;</span><br><span class="line">                pipeline.addAfter(</span><br><span class="line">                        ChannelPipelineCustomizer.HANDLER_HTTP_CLIENT_CODEC,</span><br><span class="line">                        <span class="string">&quot;logbook&quot;</span>,</span><br><span class="line">                        <span class="keyword">new</span> LogbookClientHandler(logbook)</span><br><span class="line">                )</span><br><span class="line">                <span class="keyword">return</span> pipeline</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> customizer</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Configuring-CORS-é…ç½®è·¨åŸŸè¯·æ±‚"><a href="#Configuring-CORS-é…ç½®è·¨åŸŸè¯·æ±‚" class="headerlink" title="Configuring CORS (é…ç½®è·¨åŸŸè¯·æ±‚)"></a>Configuring CORS (é…ç½®è·¨åŸŸè¯·æ±‚)</h3><p>Micronaut å¼€ç®±æ”¯æŒ CORS (Cross Origin Resource Sharing)</p>
<p>é»˜è®¤æƒ…å†µä¸‹, CORS è¯·æ±‚æ˜¯è¢«æ‹’ç»çš„</p>
<p>ä¸ºäº†å¼€å¯ CORS è¯·æ±‚, ä¿®æ”¹ä½ çš„é…ç½®:</p>
<p>Example - CORS Configuration:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">server:</span></span><br><span class="line">        <span class="attr">cors:</span></span><br><span class="line">            <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>By only enabling CORS processing, a â€œwide openâ€ strategy is adopted that allows requests from any origin.</p>
</blockquote>
<p>ä»…é€šè¿‡å¯ç”¨ CORS å¤„ç†, å°±é‡‡ç”¨äº†ä¸€ä¸ªå…è®¸æ¥è‡ªä»»ä½•æ¥æºçš„è¯·æ±‚çš„ â€œå¹¿æ³›å¼€å‘â€ ç­–ç•¥</p>
<p>ä¸ºäº†ä¿®æ”¹æ‰€æœ‰æ¥æºæˆ–ä¸€ä¸ªç‰¹å®šæ¥æºçš„è®¾ç½®, é€šè¿‡æä¾›ä¸€ä¸ªæˆ–å¤šä¸ª <code>configurations</code> æ¥æ”¹å˜é…ç½®</p>
<p>é€šè¿‡æä¾›ä»»ä½•é…ç½®, é»˜è®¤çš„ <code>wide open</code> é…ç½®å°±ä¸ä¼šè¢«é…ç½®</p>
<p>Example - CORS Configurations:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">server:</span></span><br><span class="line">        <span class="attr">cors:</span></span><br><span class="line">            <span class="attr">configurations:</span></span><br><span class="line">                <span class="attr">all:</span></span><br><span class="line">                    <span class="string">...</span></span><br><span class="line">                <span class="attr">web:</span></span><br><span class="line">                    <span class="string">...</span></span><br><span class="line">                <span class="attr">mobile:</span></span><br><span class="line">                    <span class="string">...</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­, æä¾›äº†ä¸‰ä¸ªé…ç½®</p>
<p>å®ƒä»¬çš„åå­— (all, web, mobile) å¹¶ä¸é‡è¦, ä¸”åœ¨ Micronaut å†…éƒ¨æ²¡æœ‰æ„ä¹‰</p>
<blockquote>
<p>They are there purely to be able to easily recognize the intended user of the configuration.</p>
</blockquote>
<p>å®ƒä»¬çš„å­˜åœ¨çº¯ç²¹æ˜¯ä¸ºäº†èƒ½å¤Ÿè½»æ¾è¯†åˆ«é…ç½®çš„é¢„æœŸç”¨æˆ·</p>
<p>åŒæ ·çš„é…ç½®å±æ€§å¯ä»¥åº”ç”¨äºæ¯ä¸ªé…ç½®, å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://docs.micronaut.io/latest/api/io/micronaut/http/server/cors/CorsOriginConfiguration.html" >CorsOriginConfiguration<i class="fas fa-external-link-alt"></i></a> è·å–å¯ä»¥å®šä¹‰çš„å±æ€§</p>
<blockquote>
<p>The values of each configuration supplied will default to the default values of the corresponding fields.</p>
</blockquote>
<p>æä¾›çš„æ¯ä¸ªé…ç½®çš„å€¼å°†é»˜è®¤ä¸º ç›¸åº”å­—æ®µçš„ é»˜è®¤å€¼</p>
<blockquote>
<p>When a CORS request is made, configurations are searched for allowed origins that match exactly or match the request origin through a regular expression.</p>
</blockquote>
<p>å½“å‘ç”Ÿä¸€ä¸ª CORS è¯·æ±‚æ—¶, å°†åœ¨é…ç½®ä¸­æœç´¢ä¸è¯·æ±‚æºå®Œå…¨åŒ¹é…æˆ–é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„å…è®¸æº</p>
<h4 id="Allowed-Origins-å…è®¸çš„æº"><a href="#Allowed-Origins-å…è®¸çš„æº" class="headerlink" title="Allowed Origins (å…è®¸çš„æº)"></a>Allowed Origins (å…è®¸çš„æº)</h4><p>åœ¨ä¸€ä¸ªç»™å®šçš„é…ç½®ä¸­å…è®¸ä»»ä½•æº, ä¸è¦åŒ…å« <code>allowedOrigins</code> key åˆ°ä½ çš„é…ç½®ä¸­</p>
<p>å¯¹äºå¤šä¸ªæœ‰æ•ˆçš„æº, è®¾ç½®é…ç½®çš„ <code>allowedOrigins</code> key ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨. æ¯ä¸ªå€¼å¯ä»¥æ˜¯ä¸€ä¸ªé™æ€å€¼ (<code>http://www.foo.com</code>) æˆ–è€…ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ (<code>^http(|s)://www\.google\.com$</code>)</p>
<p>æ­£åˆ™è¡¨è¾¾å¼å°†è¢«ä¼ é€’ç»™ <code>Pattern#compile</code> å¹¶ä½¿ç”¨ <code>Matcher#matches</code> æ¥å’Œè¯·æ±‚çš„æºè¿›è¡ŒåŒ¹é…</p>
<p>Example - CORS Configuration:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">server:</span></span><br><span class="line">        <span class="attr">cors:</span></span><br><span class="line">            <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">configurations:</span></span><br><span class="line">                <span class="attr">web:</span></span><br><span class="line">                    <span class="attr">allowedOrigins:</span></span><br><span class="line">                        <span class="bullet">-</span> <span class="string">http://foo.com</span></span><br><span class="line">                        <span class="bullet">-</span> <span class="string">^http(|s):\/\/www\.google\.com$</span></span><br></pre></td></tr></table></figure>

<h4 id="Allowed-Methods-å…è®¸çš„æ–¹æ³•"><a href="#Allowed-Methods-å…è®¸çš„æ–¹æ³•" class="headerlink" title="Allowed Methods (å…è®¸çš„æ–¹æ³•)"></a>Allowed Methods (å…è®¸çš„æ–¹æ³•)</h4><p>åœ¨ä¸€ä¸ªç»™å®šçš„é…ç½®ä¸­å…è®¸ä»»ä½•è¯·æ±‚æ–¹æ³•, ä¸è¦åŒ…å« <code>allowedMethods</code> key åˆ°ä½ çš„é…ç½®ä¸­</p>
<p>ä¸ºäº†å…è®¸å¤šä¸ªæ–¹æ³•, è®¾ç½®é…ç½®çš„ <code>allowedMethods</code> key ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨</p>
<p>Example - CORS Configuration:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">server:</span></span><br><span class="line">        <span class="attr">cors:</span></span><br><span class="line">            <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">configurations:</span></span><br><span class="line">                <span class="attr">web:</span></span><br><span class="line">                    <span class="attr">allowedMethods:</span></span><br><span class="line">                        <span class="bullet">-</span> <span class="string">POST</span></span><br><span class="line">                        <span class="bullet">-</span> <span class="string">PUT</span></span><br></pre></td></tr></table></figure>

<h4 id="Allowed-Headers-å…è®¸çš„è¯·æ±‚å¤´"><a href="#Allowed-Headers-å…è®¸çš„è¯·æ±‚å¤´" class="headerlink" title="Allowed Headers (å…è®¸çš„è¯·æ±‚å¤´)"></a>Allowed Headers (å…è®¸çš„è¯·æ±‚å¤´)</h4><p>åœ¨ä¸€ä¸ªç»™å®šçš„é…ç½®ä¸­å…è®¸ä»»ä½•è¯·æ±‚å¤´, ä¸è¦åŒ…å« <code>allowedHeaders</code> key åˆ°ä½ çš„é…ç½®ä¸­</p>
<p>ä¸ºäº†å…è®¸å¤šä¸ªè¯·æ±‚å¤´, è®¾ç½®é…ç½®çš„ <code>allowedHeaders</code> key ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨</p>
<p>Example - CORS Configuration:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">server:</span></span><br><span class="line">        <span class="attr">cors:</span></span><br><span class="line">            <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">configurations:</span></span><br><span class="line">                <span class="attr">web:</span></span><br><span class="line">                    <span class="attr">allowedHeaders:</span></span><br><span class="line">                        <span class="bullet">-</span> <span class="string">Content-Type</span></span><br><span class="line">                        <span class="bullet">-</span> <span class="string">Authorization</span></span><br></pre></td></tr></table></figure>

<h4 id="Exposed-Headers-æš´éœ²çš„è¯·æ±‚å¤´"><a href="#Exposed-Headers-æš´éœ²çš„è¯·æ±‚å¤´" class="headerlink" title="Exposed Headers (æš´éœ²çš„è¯·æ±‚å¤´)"></a>Exposed Headers (æš´éœ²çš„è¯·æ±‚å¤´)</h4><blockquote>
<p>To configure the headers that are sent in the response to a CORS request through the <code>Access-Control-Expose-Headers</code> header, include a list of strings for the <code>exposedHeaders</code> key in your configuration. None are exposed by default.</p>
</blockquote>
<p>å¦‚æœè¦é…ç½® åœ¨å¯¹ CORS è¯·æ±‚çš„å“åº”ä¸­ åŒ…å«åœ¨ <code>Access-Control-Expose-Headers</code> header çš„ header, åœ¨ä½ çš„é…ç½®ä¸­ä½¿ç”¨ <code>exposedHeaders</code> key æ¥åŒ…å«ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨. é»˜è®¤æ˜¯ä¸æš´éœ²ä»»ä½• headers</p>
<p>Example - CORS Configuration:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">server:</span></span><br><span class="line">        <span class="attr">cors:</span></span><br><span class="line">            <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">configurations:</span></span><br><span class="line">                <span class="attr">web:</span></span><br><span class="line">                    <span class="attr">exposedHeaders:</span></span><br><span class="line">                        <span class="bullet">-</span> <span class="string">Content-Type</span></span><br><span class="line">                        <span class="bullet">-</span> <span class="string">Authorization</span></span><br></pre></td></tr></table></figure>

<h4 id="Allow-Credentials-å…è®¸-Credentials"><a href="#Allow-Credentials-å…è®¸-Credentials" class="headerlink" title="Allow Credentials (å…è®¸ Credentials)"></a>Allow Credentials (å…è®¸ Credentials)</h4><p>Credentials : è¯ä¹¦</p>
<p>å¯¹äº CORS è¯·æ±‚, é»˜è®¤æ˜¯å…è®¸ Credentials çš„</p>
<p>é€šè¿‡è®¾ç½® <code>allowCredentials</code> ä¸º <code>false</code> æ¥ä¸å…è®¸:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">server:</span></span><br><span class="line">        <span class="attr">cors:</span></span><br><span class="line">            <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">configurations:</span></span><br><span class="line">                <span class="attr">web:</span></span><br><span class="line">                    <span class="attr">allowedCredentials:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<h4 id="Max-age-æœ€å¤§-age"><a href="#Max-age-æœ€å¤§-age" class="headerlink" title="Max age (æœ€å¤§ age)"></a>Max age (æœ€å¤§ age)</h4><p>å¯ä»¥ç¼“å­˜çš„é¢„æ£€çš„è¯·æ±‚é»˜è®¤æœ€å¤§ age ä¸º 30 åˆ†é’Ÿ</p>
<p>é€šè¿‡æŒ‡å®šç§’æ•°æ¥ä¿®æ”¹è¿™ä¸ªè¡Œä¸º:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">server:</span></span><br><span class="line">        <span class="attr">cors:</span></span><br><span class="line">            <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">configurations:</span></span><br><span class="line">                <span class="attr">web:</span></span><br><span class="line">                    <span class="attr">maxAge:</span> <span class="number">3600</span> <span class="comment"># 1 å°æ—¶</span></span><br></pre></td></tr></table></figure>

<h4 id="Multiple-Header-Values-å¤šä¸ª-Header-å€¼"><a href="#Multiple-Header-Values-å¤šä¸ª-Header-å€¼" class="headerlink" title="Multiple Header Values (å¤šä¸ª Header å€¼)"></a>Multiple Header Values (å¤šä¸ª Header å€¼)</h4><p>é»˜è®¤æƒ…å†µä¸‹, å½“ä¸€ä¸ª header æœ‰å¤šä¸ªå€¼æ—¶, å¤šä¸ª header ä¼šè¢«å‘é€, æ¯ä¸ª header æœ‰ä¸€ä¸ªå€¼</p>
<p>å¯ä»¥è®¾ç½®é…ç½®é€‰é¡¹ä¿®æ”¹è¿™ä¸ªè¡Œä¸ºæ¥å‘é€ä¸€ä¸ªä½¿ç”¨é€—å·åˆ†éš”çš„åˆ—è¡¨ä½œä¸ºå€¼çš„ header</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">server:</span></span><br><span class="line">        <span class="attr">cors:</span></span><br><span class="line">            <span class="attr">single-header:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h3 id="Securing-the-Server-with-HTTPS-ä½¿ç”¨-HTTPS-ä¿æŠ¤-Server"><a href="#Securing-the-Server-with-HTTPS-ä½¿ç”¨-HTTPS-ä¿æŠ¤-Server" class="headerlink" title="Securing the Server with HTTPS (ä½¿ç”¨ HTTPS ä¿æŠ¤ Server)"></a>Securing the Server with HTTPS (ä½¿ç”¨ HTTPS ä¿æŠ¤ Server)</h3><p>Micronaut æä¾›å¼€ç®±å³ç”¨çš„ HTTPS æ”¯æŒ</p>
<p>é»˜è®¤æƒ…å†µä¸‹, HTTPS æ²¡æœ‰å¼€å¯, æ‰€æœ‰æ¥å—çš„è¯·æ±‚éƒ½æ˜¯ä½¿ç”¨ HTTP</p>
<p>ä¸ºäº†å¼€å¯ HTTPS æ”¯æŒ, è¦ä¿®æ”¹ä½ çš„é…ç½®</p>
<p>Example - HTTPS Configuration:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">server:</span></span><br><span class="line">        <span class="attr">ssl:</span></span><br><span class="line">            <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">buildSelfSigned:</span> <span class="literal">true</span>   <span class="string">//</span> <span class="string">Micronaut</span> <span class="string">will</span> <span class="string">create</span> <span class="string">a</span> <span class="string">self-signed</span> <span class="string">certificate</span></span><br></pre></td></tr></table></figure>

<p>é»˜è®¤æƒ…å†µä¸‹, ä½¿ç”¨ HTTPS æ”¯æŒçš„ Micronaut åœ¨ç«¯å£ 8443 å¯åŠ¨, å¯ä»¥é€šè¿‡å±æ€§ <code>micronaut.server.ssl.port</code> æ¥ä¿®æ”¹è¿™ä¸ªç«¯å£å·</p>
<h4 id="Using-a-valid-x509-certificate-ä½¿ç”¨ä¸€ä¸ªæœ‰æ•ˆçš„-x509-è¯ä¹¦"><a href="#Using-a-valid-x509-certificate-ä½¿ç”¨ä¸€ä¸ªæœ‰æ•ˆçš„-x509-è¯ä¹¦" class="headerlink" title="Using a valid x509 certificate (ä½¿ç”¨ä¸€ä¸ªæœ‰æ•ˆçš„ x509 è¯ä¹¦)"></a>Using a valid x509 certificate (ä½¿ç”¨ä¸€ä¸ªæœ‰æ•ˆçš„ x509 è¯ä¹¦)</h4><p>å¯ä»¥é…ç½® Micronaut ä½¿ç”¨ä¸€ä¸ªå·²å­˜åœ¨çš„æœ‰æ•ˆ x509 è¯ä¹¦</p>
<p>ä¾‹å¦‚, é€šè¿‡ <a class="link"   target="_blank" rel="noopener" href="https://docs.micronaut.io/latest/guide/#io.micronaut.http.server.netty.configuration.NettyHttpServerConfiguration.Worker" >Letâ€™s Encrypt<i class="fas fa-external-link-alt"></i></a> åˆ›å»ºäº†ä¸€ä¸ªè¯ä¹¦. ä½ å°†ä¼šéœ€è¦ <code>server.crt</code> å’Œ <code>server.key</code> æ–‡ä»¶, ç„¶åå°†å®ƒä»¬è½¬æ¢ä¸ºä¸€ä¸ª PKCS #12 æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">openssl pkcs12 -<span class="built_in">export</span> \</span><br><span class="line">-<span class="keyword">in</span> server.crt \ <span class="comment"># 1</span></span><br><span class="line">-inkey server.key \ <span class="comment"># 2</span></span><br><span class="line">-out server.p12 \ <span class="comment"># 3</span></span><br><span class="line">-name someAlias \ <span class="comment"># 4</span></span><br><span class="line">-chain -CAfile ca.crt -caname root</span><br></pre></td></tr></table></figure>

<p><code>1</code> : The original <code>server.crt</code> file</p>
<p><code>2</code> : The original <code>server.key</code> file</p>
<p><code>3</code> : The <code>server.p12</code> file to create</p>
<p><code>4</code> : The alias for the certificate</p>
<p>åœ¨åˆ›å»º <code>server.p12</code> æ–‡ä»¶æ—¶, æœ‰å¿…è¦å®šä¹‰ä¸€ä¸ªå¯†ç , ç¨ååœ¨ Micronaut ä¸­ä½¿ç”¨è¯ä¹¦æ—¶å°†ä¼šéœ€è¦è¿™ä¸ªå¯†ç </p>
<p>ç„¶å, ä¿®æ”¹ä½ çš„é…ç½®:</p>
<p>Example - HTTPS Configuration:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">ssl:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">keyStore:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">classpath:server.p12</span>  <span class="comment"># 1</span></span><br><span class="line">            <span class="attr">password:</span> <span class="string">mypassword</span>        <span class="comment"># 2</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">PKCS12</span></span><br></pre></td></tr></table></figure>

<p><code>1</code> : The <code>p12</code> file. It can also be referenced as <code>file:/path/to/the/file</code></p>
<p><code>2</code> : The password defined during the export</p>
<p>é€šè¿‡è¿™ä¸ªé…ç½®, åœ¨ Micronaut å¯åŠ¨ä¹‹åå¹¶è®¿é—® <code>https://localhost:8443</code>, è¿˜æ˜¯å¯ä»¥çœ‹åˆ°æµè§ˆå™¨çš„ warning, ä½†æ˜¯å¦‚æœæˆ‘ä»¬æ£€æŸ¥è¯ä¹¦, æˆ‘ä»¬å¯ä»¥ç¡®è®¤æ˜¯æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„è¯ä¹¦</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ ä¸€ä¸ªåŸŸååˆ«ååˆ° <code>/etc/hosts</code> æ–‡ä»¶ä¸­æ¥æµ‹è¯•è¿™ä¸ªè¯ä¹¦å¯¹äºæµè§ˆå™¨æ˜¯æœ‰æ•ˆçš„:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/hosts</span><br><span class="line">...</span><br><span class="line">127.0.0.1 my-domain.org</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="Using-Java-Keystore-ä½¿ç”¨-Java-Keystore-JKS"><a href="#Using-Java-Keystore-ä½¿ç”¨-Java-Keystore-JKS" class="headerlink" title="Using Java Keystore (ä½¿ç”¨ Java Keystore (JKS))"></a>Using Java Keystore (ä½¿ç”¨ Java Keystore (JKS))</h3><p>ä¸æ¨èä½¿ç”¨è¿™ä¸ªç±»å‹çš„è¯ä¹¦, å› ä¸ºæ ¼å¼æ˜¯ä¸“æœ‰çš„</p>
<p>æ¨èä½¿ç”¨ PKCS12 æ ¼å¼</p>
<p>ä½†æ˜¯ Micronaut ä¹Ÿæ”¯æŒ JKS</p>
<p>ä¾‹å­çœç•¥</p>
<h4 id="Refreshing-x2F-Reloading-HTTPS-Certificates-åˆ·æ–°-x2F-é‡è½½-HTTPS-è¯ä¹¦"><a href="#Refreshing-x2F-Reloading-HTTPS-Certificates-åˆ·æ–°-x2F-é‡è½½-HTTPS-è¯ä¹¦" class="headerlink" title="Refreshing&#x2F;Reloading HTTPS Certificates (åˆ·æ–°&#x2F;é‡è½½ HTTPS è¯ä¹¦)"></a>Refreshing&#x2F;Reloading HTTPS Certificates (åˆ·æ–°&#x2F;é‡è½½ HTTPS è¯ä¹¦)</h4><p>åœ¨ HTTPS è¯ä¹¦è¿‡æœŸåä¿æŒè¯ä¹¦æœ€æ–°æ˜¯ä¸€ä¸ªæŒ‘æˆ˜</p>
<p>ä¸€ä¸ªå¥½çš„è§£å†³æ–¹æ¡ˆæ˜¯ <a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Automated_Certificate_Management_Environment" >Automated Certificate Management Environment<i class="fas fa-external-link-alt"></i></a> (ACME)</p>
<p><a class="link"   target="_blank" rel="noopener" href="https://micronaut-projects.github.io/micronaut-acme/latest/guide/index.html" >Micronaut ACME Module<i class="fas fa-external-link-alt"></i></a> æ”¯æŒè‡ªåŠ¨åˆ·æ–°æ¥è‡ªè¯ä¹¦é¢å‘æœºæ„çš„è¯ä¹¦</p>
<p>å¦‚æœä¸èƒ½ä½¿ç”¨è¯ä¹¦è®¤è¯æœºæ„, é‚£ä¹ˆä½ éœ€è¦ä»ç¡¬ç›˜ä¸­æ›´æ–°è¯ä¹¦, ç„¶åä½ è¦ ä½¿ç”¨ Micronaut æ”¯æŒçš„ åŒ…å«ä½ çš„ HTTPS é…ç½®å®šä¹‰çš„ keysçš„ <code>Application Events</code> æ¥è§¦å‘ä¸€ä¸ª <code>RefreshEvent</code></p>
<p>Micronaut å°†ä¼šä»ç¡¬ç›˜é‡æ–°åŠ è½½è¯ä¹¦å¹¶åº”ç”¨æ–°çš„é…ç½®åˆ° server ä¸­</p>
<p>ä½ è¿˜å¯ä»¥ä½¿ç”¨ <code>Refresh Management Endpoint</code>, ä½†è¿™åªåœ¨è¯ä¹¦çš„ç¡¬ç›˜ç‰©ç†åœ°å€æ”¹å˜çš„æ—¶å€™ä½¿ç”¨</p>
<p>å¦‚ä¸‹ä¾‹å­å°†ä¼šä»ç¡¬ç›˜ä¸Šé‡æ–°åŠ è½½ä¹‹å‰åˆ—å‡ºçš„ HTTPS é…ç½®, å¹¶å°†å…¶åº”ç”¨åˆ°è¿›æ¥çš„è¯·æ±‚</p>
<p>è¿™ä¸ªä»£ç åº”è¯¥è¿è¡Œåœ¨ä¸€ä¸ªè°ƒåº¦ä»»åŠ¡ä¸­, æ¥åœ¨è¯ä¹¦æ”¹å˜æ—¶æ‹‰å–è¯ä¹¦</p>
<p>Example - Manually Refreshing HTTPS configuration:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jakarta.inject.Inject</span><br><span class="line"><span class="keyword">import</span> io.micronaut.context.evetn.ApplicationEventPublisher</span><br><span class="line"><span class="keyword">import</span> io.micronaut.runtime.context.scope.refresh.RefreshEvent</span><br><span class="line"></span><br><span class="line"><span class="meta">@Inject</span> ApplicationEventPublisher&lt;RefreshEvent&gt; eventPublisher</span><br><span class="line"></span><br><span class="line">eventPublisher.publishEvent(<span class="keyword">new</span> RefreshEvent(</span><br><span class="line">    Collections.singletonMap(<span class="string">&quot;micronaut.ssl&quot;</span>, <span class="string">&quot;*&quot;</span>)</span><br><span class="line">))</span><br></pre></td></tr></table></figure>

<h3 id="Enabling-HTTP-and-HTTPS-åŒæ—¶å¼€å¯-HTTP-å’Œ-HTTPS"><a href="#Enabling-HTTP-and-HTTPS-åŒæ—¶å¼€å¯-HTTP-å’Œ-HTTPS" class="headerlink" title="Enabling HTTP and HTTPS (åŒæ—¶å¼€å¯ HTTP å’Œ HTTPS)"></a>Enabling HTTP and HTTPS (åŒæ—¶å¼€å¯ HTTP å’Œ HTTPS)</h3><p>Micronaut æ”¯æŒåŒæ—¶ç»‘å®š HTTP å’Œ HTTPS</p>
<p>è¦å¼€å¯å¤šåè®®æ”¯æŒ, ä¿®æ”¹ä½ çš„é…ç½®:</p>
<p>Example - Dual Protocol Configuration:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">server:</span></span><br><span class="line">        <span class="attr">ssl:</span></span><br><span class="line">            <span class="attr">enabled:</span> <span class="literal">true</span>               <span class="comment"># You must configure SSL for HTTPS to work</span></span><br><span class="line">            <span class="attr">build-self-singed:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">dual-protocol:</span> <span class="literal">true</span>             <span class="comment"># Enabling both HTTP and HTTPS is an opt-in feature - setting the `dualProtocol` flag enbales it. By default Micronaut only enables one</span></span><br></pre></td></tr></table></figure>

<p>è¿˜å¯ä»¥è‡ªåŠ¨å°†æ‰€æœ‰ HTTP è¯·æ±‚é‡å®šå‘åˆ° HTTPS</p>
<p>Example - Enable HTTP to HTTPS Redirects:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">server:</span></span><br><span class="line">        <span class="attr">ssl:</span></span><br><span class="line">            <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">build-self-singed:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">dual-protocol:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">http-to-https-redirect:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h3 id="Enabling-Access-Logger-å¼€å¯è®¿é—®æ—¥å¿—"><a href="#Enabling-Access-Logger-å¼€å¯è®¿é—®æ—¥å¿—" class="headerlink" title="Enabling Access Logger (å¼€å¯è®¿é—®æ—¥å¿—)"></a>Enabling Access Logger (å¼€å¯è®¿é—®æ—¥å¿—)</h3><p>å¯ä»¥ä¸º HTTP server å¼€å¯ä¸€ä¸ªè®¿é—®æ—¥å¿—å™¨ (access logger)</p>
<p>åœ¨ <code>application.yml</code> ä¸­å¼€å¯å’Œé…ç½® access logger:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">server:</span></span><br><span class="line">        <span class="attr">netty:</span></span><br><span class="line">            <span class="attr">access-logger:</span></span><br><span class="line">                <span class="attr">enabled:</span> <span class="literal">true</span>                   <span class="comment"># Enables the access logger</span></span><br><span class="line">                <span class="attr">logger-name:</span> <span class="string">my-access-logger</span>   <span class="comment"># A logger name, optional, default is `HTTP_ACCESS_LOGGER`</span></span><br><span class="line">                <span class="attr">log-format:</span> <span class="string">common</span>              <span class="comment"># A log format, optional, default is Common Log Format</span></span><br></pre></td></tr></table></figure>

<h4 id="Filtering-access-logs-è¿‡æ»¤è®¿é—®æ—¥å¿—"><a href="#Filtering-access-logs-è¿‡æ»¤è®¿é—®æ—¥å¿—" class="headerlink" title="Filtering access logs (è¿‡æ»¤è®¿é—®æ—¥å¿—)"></a>Filtering access logs (è¿‡æ»¤è®¿é—®æ—¥å¿—)</h4><p>å¦‚æœä½ ä¸æƒ³è¦è®°å½•è¯ä¹¦è·¯å¾„è®¿é—®æ—¥å¿—, ä½ å¯ä»¥åœ¨é…ç½®ä¸­å£°æ˜ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼è¿‡æ»¤å™¨:</p>
<p>Example - Filtering the access logs:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">micronaut:</span></span><br><span class="line">    <span class="attr">server:</span></span><br><span class="line">        <span class="attr">netty:</span></span><br><span class="line">            <span class="attr">access-logger:</span></span><br><span class="line">                <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">                <span class="attr">logger-name:</span> <span class="string">my-access-logger</span></span><br><span class="line">                <span class="attr">log-format:</span> <span class="string">common</span></span><br><span class="line">                <span class="attr">exclusions:</span></span><br><span class="line">                    <span class="bullet">-</span> <span class="string">/health</span></span><br><span class="line">                    <span class="bullet">-</span> <span class="string">/path/.+</span></span><br></pre></td></tr></table></figure>

<h4 id="Logback-Configuration-Logback-é…ç½®"><a href="#Logback-Configuration-Logback-é…ç½®" class="headerlink" title="Logback Configuration (Logback é…ç½®)"></a>Logback Configuration (Logback é…ç½®)</h4><p>é™¤äº†å¼€å¯ access logger, ä½ è¿˜å¿…é¡»ä¸º æŒ‡å®šçš„loggeråç§° æˆ– é»˜è®¤çš„loggeråç§° æ·»åŠ ä¸€ä¸ª logger</p>
<p>ä¾‹å¦‚åœ¨ LogBack ä¸­ä½¿ç”¨é»˜è®¤ loggeråç§°:</p>
<p>Example - Logback configuration:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">appender</span></span></span><br><span class="line"><span class="tag">    <span class="attr">name</span>=<span class="string">&quot;httpAccessLogAppender&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">append</span>&gt;</span>true<span class="tag">&lt;/<span class="name">append</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">file</span>&gt;</span>log/http-access.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            log/http-access-%d&#123;yyyy-MM-dd&#125;.log</span><br><span class="line">        <span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">            7</span><br><span class="line">        <span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>$msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">immediateFlush</span>&gt;</span>true<span class="tag">&lt;/<span class="name">immediateFlush</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;HTTP_ACCESS_LOGGER&quot;</span> <span class="attr">additivity</span>=<span class="string">&quot;false&quot;</span> <span class="attr">level</span>=<span class="string">&quot;info&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;httpAccessLogAppender&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="Log-Format-æ—¥å¿—æ ¼å¼"><a href="#Log-Format-æ—¥å¿—æ ¼å¼" class="headerlink" title="Log Format (æ—¥å¿—æ ¼å¼)"></a>Log Format (æ—¥å¿—æ ¼å¼)</h4><p>è¯­æ³•æ˜¯åŸºäº <a class="link"   target="_blank" rel="noopener" href="https://httpd.apache.org/docs/current/mod/mod_log_config.html" >Apache httpd log format<i class="fas fa-external-link-alt"></i></a> çš„</p>
<p>å¯ä»¥ä½¿ç”¨å¦‚ä¸‹é€šç”¨è¯­æ³•æ¨¡æ¿çš„åˆ«å:</p>
<ul>
<li><code>common</code>  : <a class="link"   target="_blank" rel="noopener" href="https://httpd.apache.org/docs/2.4/logs.html#common" >Common Log Format<i class="fas fa-external-link-alt"></i></a> (CLF) çš„ <code>%h %l %u %t &quot;%r&quot; %s %b</code></li>
<li><code>combined</code> : <a class="link"   target="_blank" rel="noopener" href="https://httpd.apache.org/docs/2.4/logs.html#combined" >Combined Log Format<i class="fas fa-external-link-alt"></i></a> çš„ <code>%h %l %u %t &quot;%r&quot; %s %b &quot;%&#123;Referer&#125;i&quot; &quot;%&#123;User-Agent&#125;i&quot;</code></li>
</ul>
<p>CLF ä¾‹å­: <code>127.0.0.1 - frank [10/Oct/2000:13:55:36 -0700] &quot;GET /apache_pb.gif HTTP/1.0&quot; 200 2326</code></p>
<p>Combined Log Format ä¾‹å­: <code>127.0.0.1 - frank [10/Oct/2000:13:55:36 -0700] &quot;GET /apache_pb.gif HTTP/1.0&quot; 200 2326 &quot;http://www.example.com/start.html&quot; &quot;Mozilla/4.08 [en] (Win98; I ;Nav)&quot;</code></p>
<h3 id="Starting-Secondary-Servers-å¼€å¯äºŒçº§æœåŠ¡"><a href="#Starting-Secondary-Servers-å¼€å¯äºŒçº§æœåŠ¡" class="headerlink" title="Starting Secondary Servers (å¼€å¯äºŒçº§æœåŠ¡)"></a>Starting Secondary Servers (å¼€å¯äºŒçº§æœåŠ¡)</h3><p>Micronaut æ”¯æŒä½¿ç”¨ <code>NettyEmbeddedServerFactory</code> æ¥å£ç¼–ç¨‹å¼åˆ›å»ºé¢å¤–çš„ Netty servers</p>
<p>è¿™åœ¨ä½ éœ€è¦é€šè¿‡ä¸åŒçš„ç«¯å£å¼€æ”¾ä¸åŒçš„ servers, å¹¶å…·æœ‰å¯èƒ½ä¸ç›¸åŒçš„é…ç½® (HTTPS, çº¿ç¨‹èµ„æºç­‰ç­‰)</p>
<p>ä¸‹é¢çš„ä¾‹å­ä¸­å±•ç¤ºäº†æ€æ ·å®šä¹‰ä¸€ä¸ª Factory Bean ä½¿ç”¨ä¸€ä¸ªç¼–ç¨‹å¼åˆ›å»ºçš„é…ç½®æ¥å¼€å¯ä¸€ä¸ªé¢å¤–çš„ server:</p>
<p>Example - Programmatically creating Secondary servers:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.micronaut.context.annotation.Bean</span><br><span class="line"><span class="keyword">import</span> io.micronaut.context.annotation.Context</span><br><span class="line"><span class="keyword">import</span> io.micronaut.context.annotation.Factory</span><br><span class="line"><span class="keyword">import</span> io.micronaut.context.annotation.Requires</span><br><span class="line"><span class="keyword">import</span> io.micronaut.context.env.Environment</span><br><span class="line"><span class="keyword">import</span> io.micronaut.core.util.StringUtils</span><br><span class="line"><span class="keyword">import</span> io.micronaut.discovery.ServiceInstanceList</span><br><span class="line"><span class="keyword">import</span> io.micronaut.discovery.StaticServiceInstanceList</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.server.netty.NettyEmbeddedServer</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.server.netty.NettyEmbeddedServerFactory</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.server.netty.configuration.NettyHttpServerConfiguration</span><br><span class="line"><span class="keyword">import</span> io.micronaut.http.ssl.ServerSslConfiguration</span><br><span class="line"><span class="keyword">import</span> jakarta.inject.Named</span><br><span class="line"></span><br><span class="line"><span class="meta">@Factory</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SecondaryNettyServer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> String SERVER_ID = <span class="string">&#x27;another&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Named</span>(SERVER_ID)</span><br><span class="line">    <span class="meta">@Context</span></span><br><span class="line">    <span class="meta">@Bean</span>(preDestory = <span class="string">&quot;stop&quot;</span>)  <span class="comment">// 2</span></span><br><span class="line">    <span class="meta">@Requires</span>(beans = Environment.<span class="keyword">class</span>)</span><br><span class="line">    NettyEmbeddedServer nettyEmbeddedServer(NettyEmbeddedServerFactory serverFactory) &#123;     <span class="comment">// 3</span></span><br><span class="line">        <span class="keyword">def</span> configuration = <span class="keyword">new</span> NettyHttpServerConfiguration()  <span class="comment">// 4</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> sslConfiguration = <span class="keyword">new</span> ServerSslConfiguration()     <span class="comment">// 5</span></span><br><span class="line">        sslConfiguration.setBuildSelfSigned(<span class="literal">true</span>)</span><br><span class="line">        sslConfiguration.enabled = <span class="literal">true</span></span><br><span class="line">        sslConfiguration.prot = <span class="number">-1</span> <span class="comment">// random port</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// configure server programmatically</span></span><br><span class="line">        <span class="keyword">final</span> NettyEmbeddedServer embeddedServer = serverFactory.build(configuration, sslConfiguration)     <span class="comment">// 6</span></span><br><span class="line">        embeddedServer.start()  <span class="comment">// 7</span></span><br><span class="line">        <span class="keyword">return</span> embeddedServer   <span class="comment">// 8</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>   <span class="comment">// 9</span></span><br><span class="line">    ServiceInstanceList serviceInstanceList(</span><br><span class="line">        <span class="meta">@Named</span>(SERVER_ID) NettyEmbeddedServer nettyEmbeddedServer</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> StaticServiceInstanceList(</span><br><span class="line">            SERVER_ID,</span><br><span class="line">            [ nettyEmbeddedServer.URI ]</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>2</code> : Define a <code>@Context</code> scoped bean using the server name and including <code>preDestroy=&quot;stop&quot;</code> to ensure the server is shutdown when the context is closed</p>
<p><code>3</code> : Ineject the <code>NettyEmbeddedServerFactory</code> into a Factory Bean</p>
<p><code>4</code> : Programmatically craete the <code>NettyHttpServerConfiguration</code></p>
<p><code>5</code> : Optionally create the <code>ServerSslConfiguration</code></p>
<p><code>6</code> : Use the <code>build</code> method to build the server instance</p>
<p><code>7</code> : Start the server with the <code>start</code> methdo</p>
<p><code>8</code> : Return the server instance as a managed bean</p>
<p><code>9</code> : Optionally define an instance of <code>ServiceInstanceList</code> if you wish to inject <code>HTTP Clients</code> by the server name</p>
<p>æœ‰äº†è¿™ä¸ªç±», å½“ <code>ApplicationContext</code> å¯åŠ¨æ—¶, server ä¹Ÿä¼šä½¿ç”¨é€‚å½“çš„é…ç½®å¯åŠ¨</p>
<p>å› ä¸ºåœ¨ç¬¬ <code>9</code> æ­¥ä¸­å®šä¹‰äº† <code>ServiceInstanceList</code>, ä½ å¯ä»¥åœ¨ä½ çš„æµ‹è¯•ä¸­æ³¨å…¥ä¸€ä¸ª client æ¥æµ‹è¯•è¿™ä¸ªäºŒçº§ server:</p>
<p>Example - Inject the server or client:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Client</span>(path = <span class="string">&quot;/&quot;</span>, id = SecondaryNettyServer.SERVER_ID)    <span class="comment">// 1</span></span><br><span class="line"><span class="meta">@Inject</span></span><br><span class="line">HttpClient httpClient</span><br><span class="line"></span><br><span class="line"><span class="meta">@Named</span>(SecondaryNettyServer.SERVER_ID)                      <span class="comment">// 2</span></span><br><span class="line">EmbeddedServer embeddedServer</span><br></pre></td></tr></table></figure>

<p><code>1</code> : Use the server name to inject a client by ID</p>
<p><code>2</code> : Use the <code>@Named</code> annotation as a qualifier to inject the embedded server instance</p>
<h2 id="Server-Side-View-Rendering-æœåŠ¡å™¨ç«¯è§†å›¾æ¸²æŸ“"><a href="#Server-Side-View-Rendering-æœåŠ¡å™¨ç«¯è§†å›¾æ¸²æŸ“" class="headerlink" title="Server Side View Rendering (æœåŠ¡å™¨ç«¯è§†å›¾æ¸²æŸ“)"></a>Server Side View Rendering (æœåŠ¡å™¨ç«¯è§†å›¾æ¸²æŸ“)</h2><p>å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://micronaut-projects.github.io/micronaut-views/latest/guide" >Micronaut Views<i class="fas fa-external-link-alt"></i></a> æ–‡æ¡£</p>
<h2 id="OpenAPI-x2F-Swagger-Support-OpenAPI-x2F-Swagger-æ”¯æŒ"><a href="#OpenAPI-x2F-Swagger-Support-OpenAPI-x2F-Swagger-æ”¯æŒ" class="headerlink" title="OpenAPI &#x2F; Swagger Support (OpenAPI &#x2F; Swagger æ”¯æŒ)"></a>OpenAPI &#x2F; Swagger Support (OpenAPI &#x2F; Swagger æ”¯æŒ)</h2><p>å‚è€ƒ<a class="link"   target="_blank" rel="noopener" href="https://micronaut-projects.github.io/micronaut-openapi/latest/guide/index.html" >æ–‡æ¡£<i class="fas fa-external-link-alt"></i></a></p>
<h2 id="GraphQL-Support-GraphQL-æ”¯æŒ"><a href="#GraphQL-Support-GraphQL-æ”¯æŒ" class="headerlink" title="GraphQL Support (GraphQL æ”¯æŒ)"></a>GraphQL Support (GraphQL æ”¯æŒ)</h2><p>å‚è€ƒ<a class="link"   target="_blank" rel="noopener" href="https://micronaut-projects.github.io/micronaut-graphql/latest/guide" >æ–‡æ¡£<i class="fas fa-external-link-alt"></i></a></p>

        </div>

        
            <div class="post-copyright-info">
                <div class="article-copyright-info-container">
    <ul>
        <li>æœ¬æ–‡æ ‡é¢˜ï¼šMicronaut ä¸­æ–‡æ–‡æ¡£ The HTTP Server</li>
        <li>æœ¬æ–‡ä½œè€…ï¼šæ—å¨ç¾½</li>
        <li>åˆ›å»ºæ—¶é—´ï¼š2022-04-29 09:43:17</li>
        <li>
            æœ¬æ–‡é“¾æ¥ï¼šhttps://linweiyu21.github.io/micronaut/micronaut-the-http-server/
        </li>
        <li>
            ç‰ˆæƒå£°æ˜ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
        </li>
    </ul>
</div>

            </div>
        

        
            <ul class="post-tags-box">
                
                    <li class="tag-item">
                        <a href="/tags/Micronaut/">#Micronaut</a>&nbsp;
                    </li>
                
                    <li class="tag-item">
                        <a href="/tags/Groovy/">#Groovy</a>&nbsp;
                    </li>
                
                    <li class="tag-item">
                        <a href="/tags/%E4%B8%AD%E6%96%87/">#ä¸­æ–‡</a>&nbsp;
                    </li>
                
            </ul>
        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/micronaut/micronaut-the-http-client/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Micronaut ä¸­æ–‡æ–‡æ¡£ The HTTP Client</span>
                                <span class="post-nav-item">ä¸Šä¸€ç¯‡</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/micronaut/micronaut-aspect-oriented-programming/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Micronaut ä¸­æ–‡æ–‡æ¡£ Aspect Oriented Programming</span>
                                <span class="post-nav-item">ä¸‹ä¸€ç¯‡</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
            <div class="comment-container">
                <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        <i class="fas fa-comments">&nbsp;è¯„è®º</i>
    </div>
    

        
            
    <div class="valine-container">
        <script data-pjax
                src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script>
        <div id="vcomments"></div>
        <script data-pjax>
            function loadValine() {
                new Valine({
                    el: '#vcomments',
                    appId: '8xWQ0WFbKUNN4h8ixIO12etk-gzGzoHsz',
                    appKey: '7cLjTvkIsF6aIuIVSd0um89m',
                    meta: ['nick', 'mail', 'link'],
                    avatar: 'wavatar',
                    enableQQ: true,
                    placeholder: 'è¯·å¼€å§‹ä½ çš„è¡¨æ¼”',
                    lang: 'zh-CN'.toLowerCase()
                });

                function getAuthor(language) {
                    switch (language) {
                        case 'en':
                            return 'Author';
                        case 'zh-CN':
                            return 'åšä¸»';
                        default:
                            return 'Master';
                    }
                }

                // Add "Author" identify
                const getValineDomTimer = setInterval(() => {
                    const vcards = document.querySelectorAll('#vcomments .vcards .vcard');
                    if (vcards.length > 0) {
                        let author = 'æ—å¨ç¾½';

                        if (author) {
                            for (let vcard of vcards) {
                                const vnick_dom = vcard.querySelector('.vhead .vnick');
                                const vnick = vnick_dom.innerHTML;
                                if (vnick === author) {
                                    vnick_dom.innerHTML = `${vnick} <span class="author">${getAuthor(KEEP.hexo_config.language)}</span>`
                                }
                            }
                        }
                        clearInterval(getValineDomTimer);
                    } else {
                        clearInterval(getValineDomTimer);
                    }
                }, 2000);
            }

            if ('true') {
                const loadValineTimeout = setTimeout(() => {
                    loadValine();
                    clearTimeout(loadValineTimeout);
                }, 1000);
            } else {
                window.addEventListener('DOMContentLoaded', loadValine);
            }
        </script>
    </div>



        
    
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
            2022&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">æ—å¨ç¾½</a>
        </div>
        
            <script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        è®¿é—®äººæ•°&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
                    <span id="busuanzi_container_site_pv">
                        æ€»è®¿é—®é‡&nbsp;<span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            ç”± <a target="_blank" href="https://hexo.io">Hexo</a> é©±åŠ¨&nbsp;|&nbsp;ä¸»é¢˜&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.5</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fas fa-comment"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#The-HTTP-Server"><span class="nav-number">1.</span> <span class="nav-text">The HTTP Server</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Running-the-Embedded-Server-%E8%BF%90%E8%A1%8C%E5%86%85%E5%B5%8C%E7%9A%84-Server"><span class="nav-number">1.1.</span> <span class="nav-text">Running the Embedded Server (è¿è¡Œå†…åµŒçš„ Server)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Running-Server-on-a-Specific-Port-%E5%9C%A8%E6%8C%87%E5%AE%9A%E7%AB%AF%E5%8F%A3%E4%B8%8A%E8%BF%90%E8%A1%8C-Server"><span class="nav-number">1.2.</span> <span class="nav-text">Running Server on a Specific Port (åœ¨æŒ‡å®šç«¯å£ä¸Šè¿è¡Œ Server)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HTTP-Routing-HTTP-%E8%B7%AF%E7%94%B1"><span class="nav-number">1.3.</span> <span class="nav-text">HTTP Routing (HTTP è·¯ç”±)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#URI-Paths-URI-%E8%B7%AF%E5%BE%84"><span class="nav-number">1.3.1.</span> <span class="nav-text">URI Paths (URI è·¯å¾„)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#URI-Path-Variables-URI-%E8%B7%AF%E5%BE%84%E5%8F%98%E9%87%8F"><span class="nav-number">1.3.2.</span> <span class="nav-text">URI Path Variables (URI è·¯å¾„å˜é‡)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#URI-Reserved-Character-Matching-URI-%E4%BF%9D%E7%95%99%E5%AD%97%E7%AC%A6%E5%8C%B9%E9%85%8D"><span class="nav-number">1.3.3.</span> <span class="nav-text">URI Reserved Character Matching (URI ä¿ç•™å­—ç¬¦åŒ¹é…)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Routing-Annotations-%E8%B7%AF%E7%94%B1%E6%B3%A8%E8%A7%A3"><span class="nav-number">1.3.4.</span> <span class="nav-text">Routing Annotations (è·¯ç”±æ³¨è§£)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Multiple-URIs-%E5%A4%9A%E4%B8%AA-URI"><span class="nav-number">1.3.5.</span> <span class="nav-text">Multiple URIs (å¤šä¸ª URI)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Building-Routes-Programmatically-%E7%BC%96%E7%A8%8B%E5%BC%8F%E5%9C%B0%E6%9E%84%E5%BB%BA%E8%B7%AF%E7%94%B1"><span class="nav-number">1.3.6.</span> <span class="nav-text">Building Routes Programmatically (ç¼–ç¨‹å¼åœ°æ„å»ºè·¯ç”±)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Route-Compile-Time-Validation-%E8%B7%AF%E7%94%B1%E7%BC%96%E8%AF%91%E6%97%B6%E6%A0%A1%E9%AA%8C"><span class="nav-number">1.3.7.</span> <span class="nav-text">Route Compile-Time Validation (è·¯ç”±ç¼–è¯‘æ—¶æ ¡éªŒ)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Routing-non-standard-HTTP-methods-%E8%B7%AF%E7%94%B1%E9%9D%9E%E6%A0%87%E5%87%86-HTTP-%E6%96%B9%E6%B3%95"><span class="nav-number">1.3.8.</span> <span class="nav-text">Routing non-standard HTTP methods (è·¯ç”±éæ ‡å‡† HTTP æ–¹æ³•)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Simple-Request-Binding-%E7%AE%80%E5%8D%95%E8%AF%B7%E6%B1%82%E7%BB%91%E5%AE%9A"><span class="nav-number">1.4.</span> <span class="nav-text">Simple Request Binding (ç®€å•è¯·æ±‚ç»‘å®š)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Binding-Annotations-%E7%BB%91%E5%AE%9A%E6%B3%A8%E8%A7%A3"><span class="nav-number">1.4.1.</span> <span class="nav-text">Binding Annotations (ç»‘å®šæ³¨è§£)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Stream-Support-Stream-%E6%94%AF%E6%8C%81"><span class="nav-number">1.4.2.</span> <span class="nav-text">Stream Support (Stream æ”¯æŒ)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Binding-from-Multiple-Query-values-%E4%BD%BF%E7%94%A8%E5%A4%9A%E4%B8%AA%E8%AF%B7%E6%B1%82%E5%80%BC%E8%BF%9B%E8%A1%8C%E7%BB%91%E5%AE%9A"><span class="nav-number">1.4.3.</span> <span class="nav-text">Binding from Multiple Query values (ä½¿ç”¨å¤šä¸ªè¯·æ±‚å€¼è¿›è¡Œç»‘å®š)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Binding-from-Multiple-Bindable-values-%E4%BB%8E%E5%A4%9A%E4%B8%AA%E5%8F%AF%E7%BB%91%E5%AE%9A%E5%80%BC%E4%B8%AD%E8%BF%9B%E8%A1%8C%E7%BB%91%E5%AE%9A"><span class="nav-number">1.4.4.</span> <span class="nav-text">Binding from Multiple Bindable values (ä»å¤šä¸ªå¯ç»‘å®šå€¼ä¸­è¿›è¡Œç»‘å®š)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Bindable-Types-%E5%8F%AF%E7%BB%91%E5%AE%9A%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.4.5.</span> <span class="nav-text">Bindable Types (å¯ç»‘å®šç±»å‹)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Type-Based-Binding-Parameters-%E5%9F%BA%E4%BA%8E%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8F%82%E6%95%B0%E7%BB%91%E5%AE%9A"><span class="nav-number">1.4.6.</span> <span class="nav-text">Type-Based Binding Parameters (åŸºäºç±»å‹çš„å‚æ•°ç»‘å®š)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Variable-resolution-%E5%8F%98%E9%87%8F%E8%A7%A3%E6%9E%90"><span class="nav-number">1.4.7.</span> <span class="nav-text">Variable resolution (å˜é‡è§£æ)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Custom-Argument-Binding-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8F%82%E6%95%B0%E7%BB%91%E5%AE%9A"><span class="nav-number">1.5.</span> <span class="nav-text">Custom Argument Binding (è‡ªå®šä¹‰å‚æ•°ç»‘å®š)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#AnnotatedRequestArgumentBinder-%E6%B3%A8%E8%A7%A3%E4%BF%AE%E9%A5%B0%E7%9A%84%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E7%BB%91%E5%AE%9A"><span class="nav-number">1.5.1.</span> <span class="nav-text">AnnotatedRequestArgumentBinder (æ³¨è§£ä¿®é¥°çš„è¯·æ±‚å‚æ•°ç»‘å®š)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TypedRequestArgumentBinder-%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E7%B1%BB%E5%9E%8B%E7%BB%91%E5%AE%9A"><span class="nav-number">1.5.2.</span> <span class="nav-text">TypedRequestArgumentBinder (è¯·æ±‚å‚æ•°ç±»å‹ç»‘å®š)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Host-Resolution-Host-%E8%A7%A3%E6%9E%90"><span class="nav-number">1.6.</span> <span class="nav-text">Host Resolution (Host è§£æ)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Locale-Resolution-%E6%9C%AC%E5%9C%B0%E5%8C%96%E8%A7%A3%E6%9E%90"><span class="nav-number">1.7.</span> <span class="nav-text">Locale Resolution (æœ¬åœ°åŒ–è§£æ)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Client-IP-Address-%E5%AE%A2%E6%88%B7%E7%AB%AF-IP-%E5%9C%B0%E5%9D%80"><span class="nav-number">1.8.</span> <span class="nav-text">Client IP Address (å®¢æˆ·ç«¯ IP åœ°å€)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#The-HttpRequest-and-HttpResponse-HttpRequest-%E5%92%8C-HttpResponse"><span class="nav-number">1.9.</span> <span class="nav-text">The HttpRequest and HttpResponse (HttpRequest å’Œ HttpResponse)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Response-Status-%E5%93%8D%E5%BA%94%E7%8A%B6%E6%80%81"><span class="nav-number">1.10.</span> <span class="nav-text">Response Status (å“åº”çŠ¶æ€)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Response-Content-Type-%E5%93%8D%E5%BA%94%E7%9A%84-Content-Type"><span class="nav-number">1.11.</span> <span class="nav-text">Response Content-Type (å“åº”çš„ Content-Type)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Accepted-Request-Content-Type-%E5%8F%AF%E6%8E%A5%E5%8F%97%E7%9A%84%E8%AF%B7%E6%B1%82-Content-Type"><span class="nav-number">1.12.</span> <span class="nav-text">Accepted Request Content-Type (å¯æ¥å—çš„è¯·æ±‚ Content-Type)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Customing-Processed-Content-Types-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%A4%84%E7%90%86%E7%9A%84-Content-Type"><span class="nav-number">1.12.1.</span> <span class="nav-text">Customing Processed Content Types (è‡ªå®šä¹‰å¤„ç†çš„ Content-Type)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Reactive-HTTP-Request-Processing-%E5%93%8D%E5%BA%94%E5%BC%8F-HTTP-%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86"><span class="nav-number">1.13.</span> <span class="nav-text">Reactive HTTP Request Processing (å“åº”å¼ HTTP è¯·æ±‚å¤„ç†)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-the-Body-Annotation-%E4%BD%BF%E7%94%A8-Body-%E6%B3%A8%E8%A7%A3"><span class="nav-number">1.13.1.</span> <span class="nav-text">Using the @Body Annotation (ä½¿ç”¨ @Body æ³¨è§£)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Reactive-Responses-%E5%93%8D%E5%BA%94%E5%BC%8F%E5%93%8D%E5%BA%94"><span class="nav-number">1.13.2.</span> <span class="nav-text">Reactive Responses (å“åº”å¼å“åº”)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JSON-Binding-with-Jackson-%E4%BD%BF%E7%94%A8-Jackson-%E8%BF%9B%E8%A1%8C-JSON-%E7%BB%91%E5%AE%9A"><span class="nav-number">1.14.</span> <span class="nav-text">JSON Binding with Jackson (ä½¿ç”¨ Jackson è¿›è¡Œ JSON ç»‘å®š)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Binding-using-Reactive-Frameworks-%E4%BD%BF%E7%94%A8%E5%93%8D%E5%BA%94%E5%BC%8F%E6%A1%86%E6%9E%B6%E8%BF%9B%E8%A1%8C%E7%BB%91%E5%AE%9A"><span class="nav-number">1.14.1.</span> <span class="nav-text">Binding using Reactive Frameworks (ä½¿ç”¨å“åº”å¼æ¡†æ¶è¿›è¡Œç»‘å®š)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Binding-Using-CompletableFuture-%E4%BD%BF%E7%94%A8-CompletableFuture-%E8%BF%9B%E8%A1%8C%E7%BB%91%E5%AE%9A"><span class="nav-number">1.14.2.</span> <span class="nav-text">Binding Using CompletableFuture (ä½¿ç”¨ CompletableFuture è¿›è¡Œç»‘å®š)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Binding-using-POJOs-%E4%BD%BF%E7%94%A8-POJO-%E8%BF%9B%E8%A1%8C%E7%BB%91%E5%AE%9A"><span class="nav-number">1.14.3.</span> <span class="nav-text">Binding using POJOs (ä½¿ç”¨ POJO è¿›è¡Œç»‘å®š)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Jackson-Configuration-Jackson-%E9%85%8D%E7%BD%AE"><span class="nav-number">1.14.4.</span> <span class="nav-text">Jackson Configuration (Jackson é…ç½®)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Features-%E7%89%B9%E6%80%A7"><span class="nav-number">1.14.4.1.</span> <span class="nav-text">Features (ç‰¹æ€§)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Further-customing-JsonFactory-%E6%9B%B4%E6%B7%B1%E5%85%A5%E8%87%AA%E5%AE%9A%E4%B9%89-JsonFactory"><span class="nav-number">1.14.4.2.</span> <span class="nav-text">Further customing JsonFactory (æ›´æ·±å…¥è‡ªå®šä¹‰ JsonFactory )</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Support-for-JsonView-JsonView-%E7%9A%84%E6%94%AF%E6%8C%81"><span class="nav-number">1.14.4.3.</span> <span class="nav-text">Support for @JsonView (@JsonView çš„æ”¯æŒ)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Beans-Beans"><span class="nav-number">1.14.4.4.</span> <span class="nav-text">Beans (Beans)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Service-Loader-Service-%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="nav-number">1.14.4.5.</span> <span class="nav-text">Service Loader (Service åŠ è½½å™¨)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Number-Precision-%E6%95%B0%E5%80%BC%E7%B2%BE%E7%A1%AE%E6%80%A7"><span class="nav-number">1.14.4.6.</span> <span class="nav-text">Number Precision (æ•°å€¼ç²¾ç¡®æ€§)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Data-Validation-%E6%95%B0%E6%8D%AE%E6%A0%A1%E9%AA%8C"><span class="nav-number">1.15.</span> <span class="nav-text">Data Validation (æ•°æ®æ ¡éªŒ)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Serving-Static-Resources-%E6%8F%90%E4%BE%9B%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90"><span class="nav-number">1.16.</span> <span class="nav-text">Serving Static Resources (æä¾›é™æ€èµ„æº)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Error-Handling-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="nav-number">1.17.</span> <span class="nav-text">Error Handling (é”™è¯¯å¤„ç†)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Status-Handlers-%E7%8A%B6%E6%80%81%E5%A4%84%E7%90%86%E5%99%A8"><span class="nav-number">1.17.1.</span> <span class="nav-text">Status Handlers (çŠ¶æ€å¤„ç†å™¨)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Local-Error-Handling-%E6%9C%AC%E5%9C%B0%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="nav-number">1.17.2.</span> <span class="nav-text">Local Error Handling (æœ¬åœ°å¼‚å¸¸å¤„ç†)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Global-Error-Handling-%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="nav-number">1.17.3.</span> <span class="nav-text">Global Error Handling (å…¨å±€å¼‚å¸¸å¤„ç†)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ExceptionHandler-%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E5%99%A8"><span class="nav-number">1.17.4.</span> <span class="nav-text">ExceptionHandler (å¼‚å¸¸å¤„ç†å™¨)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Built-In-Exception-Handlers-%E5%86%85%E7%BD%AE%E7%9A%84%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E5%99%A8"><span class="nav-number">1.17.5.</span> <span class="nav-text">Built-In Exception Handlers (å†…ç½®çš„å¼‚å¸¸å¤„ç†å™¨)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Custom-Exception-Handler-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E5%99%A8"><span class="nav-number">1.17.5.1.</span> <span class="nav-text">Custom Exception Handler (è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†å™¨)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Error-Formatting-%E9%94%99%E8%AF%AF%E6%A0%BC%E5%BC%8F"><span class="nav-number">1.17.6.</span> <span class="nav-text">Error Formatting (é”™è¯¯æ ¼å¼)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#API-Versioning-API-%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6"><span class="nav-number">1.18.</span> <span class="nav-text">API Versioning (API ç‰ˆæœ¬æ§åˆ¶)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Default-Version-%E9%BB%98%E8%AE%A4%E7%89%88%E6%9C%AC"><span class="nav-number">1.18.1.</span> <span class="nav-text">Default Version (é»˜è®¤ç‰ˆæœ¬)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Versioning-Client-Requests-%E7%89%88%E6%9C%AC%E5%8C%96%E7%9A%84%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AF%B7%E6%B1%82"><span class="nav-number">1.18.2.</span> <span class="nav-text">Versioning Client Requests (ç‰ˆæœ¬åŒ–çš„å®¢æˆ·ç«¯è¯·æ±‚)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Handling-Form-Data-%E5%A4%84%E7%90%86%E8%A1%A8%E5%8D%95%E6%95%B0%E6%8D%AE"><span class="nav-number">1.19.</span> <span class="nav-text">Handling Form Data (å¤„ç†è¡¨å•æ•°æ®)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Writing-Response-Data-%E7%BC%96%E5%86%99%E5%93%8D%E5%BA%94%E6%95%B0%E6%8D%AE"><span class="nav-number">1.20.</span> <span class="nav-text">Writing Response Data (ç¼–å†™å“åº”æ•°æ®)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Performing-Blocking-I-x2F-O-%E8%BF%90%E8%A1%8C%E9%98%BB%E5%A1%9E-I-x2F-O"><span class="nav-number">1.20.1.</span> <span class="nav-text">Performing Blocking I&#x2F;O (è¿è¡Œé˜»å¡ I&#x2F;O)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Writable-%E5%8F%AF%E5%86%99%E7%9A%84"><span class="nav-number">1.20.1.1.</span> <span class="nav-text">Writable (å¯å†™çš„)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#InputStream-%E8%BE%93%E5%85%A5%E6%B5%81"><span class="nav-number">1.20.1.2.</span> <span class="nav-text">InputStream (è¾“å…¥æµ)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#404-Responses-404-%E5%93%8D%E5%BA%94"><span class="nav-number">1.20.1.3.</span> <span class="nav-text">404 Responses (404 å“åº”)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#File-Uploads-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="nav-number">1.21.</span> <span class="nav-text">File Uploads (æ–‡ä»¶ä¸Šä¼ )</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Route-Arguments-%E8%B7%AF%E7%94%B1%E5%8F%82%E6%95%B0"><span class="nav-number">1.21.1.</span> <span class="nav-text">Route Arguments (è·¯ç”±å‚æ•°)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Chunk-Data-Types-%E5%9D%97%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.21.1.1.</span> <span class="nav-text">Chunk Data Types (å—æ•°æ®ç±»å‹)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Whole-Data-Types-%E5%AE%8C%E6%95%B4%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.21.1.2.</span> <span class="nav-text">Whole Data Types (å®Œæ•´æ•°æ®ç±»å‹)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Multiple-Uploads-%E5%A4%9A%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="nav-number">1.21.2.</span> <span class="nav-text">Multiple Uploads (å¤šæ–‡ä»¶ä¸Šä¼ )</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Different-Names-%E4%B8%8D%E5%90%8C%E7%9A%84%E5%90%8D%E5%AD%97"><span class="nav-number">1.21.2.1.</span> <span class="nav-text">Different Names (ä¸åŒçš„åå­—)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Same-name-%E7%9B%B8%E5%90%8C%E7%9A%84%E5%90%8D%E5%AD%97"><span class="nav-number">1.21.2.2.</span> <span class="nav-text">Same name (ç›¸åŒçš„åå­—)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Whole-Body-Binding-%E5%AE%8C%E6%95%B4-Body-%E7%BB%91%E5%AE%9A"><span class="nav-number">1.21.3.</span> <span class="nav-text">Whole Body Binding (å®Œæ•´ Body ç»‘å®š)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#File-Transfers-%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93"><span class="nav-number">1.22.</span> <span class="nav-text">File Transfers (æ–‡ä»¶ä¼ è¾“)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Sending-File-Objects-%E5%8F%91%E9%80%81%E6%96%87%E4%BB%B6%E5%AF%B9%E8%B1%A1"><span class="nav-number">1.22.1.</span> <span class="nav-text">Sending File Objects (å‘é€æ–‡ä»¶å¯¹è±¡)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Sending-an-InputStream-%E5%8F%91%E9%80%81%E4%B8%80%E4%B8%AA-InputStream"><span class="nav-number">1.22.2.</span> <span class="nav-text">Sending an InputStream (å‘é€ä¸€ä¸ª InputStream)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Cache-Configuration-%E7%BC%93%E5%AD%98%E9%85%8D%E7%BD%AE"><span class="nav-number">1.22.3.</span> <span class="nav-text">Cache Configuration (ç¼“å­˜é…ç½®)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HTTP-Filters-HTTP-%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="nav-number">1.23.</span> <span class="nav-text">HTTP Filters (HTTP è¿‡æ»¤å™¨)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Writing-a-Filter-%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AA%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="nav-number">1.23.1.</span> <span class="nav-text">Writing a Filter (ç¼–å†™ä¸€ä¸ªè¿‡æ»¤å™¨)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HTTP-Sessions-HTTP-%E4%BC%9A%E8%AF%9D"><span class="nav-number">1.24.</span> <span class="nav-text">HTTP Sessions (HTTP ä¼šè¯)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Enabling-Sessions-%E5%BC%80%E5%90%AF%E4%BC%9A%E8%AF%9D"><span class="nav-number">1.24.1.</span> <span class="nav-text">Enabling Sessions (å¼€å¯ä¼šè¯)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Redis-Sessions-Redis-%E4%BC%9A%E8%AF%9D"><span class="nav-number">1.24.1.1.</span> <span class="nav-text">Redis Sessions (Redis ä¼šè¯)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Configuring-Session-Resolution-%E9%85%8D%E7%BD%AE%E4%BC%9A%E8%AF%9D%E8%A7%A3%E6%9E%90"><span class="nav-number">1.24.2.</span> <span class="nav-text">Configuring Session Resolution (é…ç½®ä¼šè¯è§£æ)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Working-with-Sessions-%E4%BD%BF%E7%94%A8%E4%BC%9A%E8%AF%9D"><span class="nav-number">1.24.3.</span> <span class="nav-text">Working with Sessions (ä½¿ç”¨ä¼šè¯)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Session-Clients-%E4%BC%9A%E8%AF%9D%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="nav-number">1.24.4.</span> <span class="nav-text">Session Clients (ä¼šè¯å®¢æˆ·ç«¯)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-SessionValue-%E4%BD%BF%E7%94%A8-SessionValue-%E6%B3%A8%E8%A7%A3"><span class="nav-number">1.24.5.</span> <span class="nav-text">Using @SessionValue (ä½¿ç”¨ @SessionValue æ³¨è§£)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Session-Events-%E4%BC%9A%E8%AF%9D%E4%BA%8B%E4%BB%B6"><span class="nav-number">1.24.6.</span> <span class="nav-text">Session Events (ä¼šè¯äº‹ä»¶)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Server-Sent-Events-Server-%E5%8F%91%E9%80%81%E4%BA%8B%E4%BB%B6"><span class="nav-number">1.25.</span> <span class="nav-text">Server Sent Events (Server å‘é€äº‹ä»¶)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WebSocket-Support-WebSocket-%E6%94%AF%E6%8C%81"><span class="nav-number">1.26.</span> <span class="nav-text">WebSocket Support (WebSocket æ”¯æŒ)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-ServerWebSocket-%E4%BD%BF%E7%94%A8-ServerWebSocket-%E6%B3%A8%E8%A7%A3"><span class="nav-number">1.26.1.</span> <span class="nav-text">Using @ServerWebSocket(ä½¿ç”¨ @ServerWebSocket æ³¨è§£)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#The-OnClose-Method-OnClose-%E6%96%B9%E6%B3%95"><span class="nav-number">1.26.1.1.</span> <span class="nav-text">The @OnClose Method (@OnClose æ–¹æ³•)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#The-OnMessage-Method-OnMessage-%E6%96%B9%E6%B3%95"><span class="nav-number">1.26.1.2.</span> <span class="nav-text">The @OnMessage Method (@OnMessage æ–¹æ³•)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#The-OnError-Method-OnError-%E6%96%B9%E6%B3%95"><span class="nav-number">1.26.1.3.</span> <span class="nav-text">The @OnError Method (@OnError æ–¹æ³•)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Non-Blocking-Message-Handling-%E9%9D%9E%E9%98%BB%E5%A1%9E%E5%BC%8F%E4%BF%A1%E6%81%AF%E5%A4%84%E7%90%86"><span class="nav-number">1.26.1.4.</span> <span class="nav-text">Non-Blocking Message Handling (éé˜»å¡å¼ä¿¡æ¯å¤„ç†)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ServerWebSocket-and-Scopes-ServerWebSocket-%E5%92%8C%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="nav-number">1.26.1.5.</span> <span class="nav-text">@ServerWebSocket and Scopes (@ServerWebSocket å’Œä½œç”¨åŸŸ)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Sharing-Sessions-with-the-HTTP-Session-%E5%92%8C-HTTP-session-%E5%85%B1%E4%BA%AB-session"><span class="nav-number">1.26.1.6.</span> <span class="nav-text">Sharing Sessions with the HTTP Session (å’Œ HTTP session å…±äº« session)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Using-the-CLI-%E4%BD%BF%E7%94%A8-CLI"><span class="nav-number">1.26.1.7.</span> <span class="nav-text">Using the CLI (ä½¿ç”¨ CLI)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Connection-Timeouts-%E8%BF%9E%E6%8E%A5%E8%B6%85%E6%97%B6"><span class="nav-number">1.26.1.8.</span> <span class="nav-text">Connection Timeouts (è¿æ¥è¶…æ—¶)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-ClientWebSocket-%E4%BD%BF%E7%94%A8-ClientWebSocket"><span class="nav-number">1.26.2.</span> <span class="nav-text">Using @ClientWebSocket (ä½¿ç”¨ @ClientWebSocket)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Using-the-CLI-%E4%BD%BF%E7%94%A8-CLI-1"><span class="nav-number">1.26.2.1.</span> <span class="nav-text">Using the CLI (ä½¿ç”¨ CLI)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HTTP-x2F-2-Support-HTTP-x2F-2-%E6%94%AF%E6%8C%81"><span class="nav-number">1.27.</span> <span class="nav-text">HTTP&#x2F;2 Support (HTTP&#x2F;2 æ”¯æŒ)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Configuring-the-Server-for-HTTP-x2F-2-%E4%B8%BA-HTTP-x2F-2-%E9%85%8D%E7%BD%AE-Server"><span class="nav-number">1.27.1.</span> <span class="nav-text">Configuring the Server for HTTP&#x2F;2 (ä¸º HTTP&#x2F;2 é…ç½® Server)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTP-x2F-2-Server-Push-Support-HTTP-x2F-2-Server-%E6%8E%A8%E9%80%81%E6%94%AF%E6%8C%81"><span class="nav-number">1.27.2.</span> <span class="nav-text">HTTP&#x2F;2 Server Push Support (HTTP&#x2F;2 Server æ¨é€æ”¯æŒ)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Server-Events-Server-%E4%BA%8B%E4%BB%B6"><span class="nav-number">1.28.</span> <span class="nav-text">Server Events (Server äº‹ä»¶)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Configuring-the-HTTP-Server-%E9%85%8D%E7%BD%AE-HTTP-Server"><span class="nav-number">1.29.</span> <span class="nav-text">Configuring the HTTP Server (é…ç½® HTTP Server)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-Native-Transports-%E4%BD%BF%E7%94%A8%E5%8E%9F%E7%94%9F%E4%BC%A0%E8%BE%93"><span class="nav-number">1.29.1.</span> <span class="nav-text">Using Native Transports (ä½¿ç”¨åŸç”Ÿä¼ è¾“)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Configuring-Server-Thread-Pools-%E9%85%8D%E7%BD%AE-Server-%E7%BA%BF%E7%A8%8B%E6%B1%A0"><span class="nav-number">1.29.2.</span> <span class="nav-text">Configuring Server Thread Pools (é…ç½® Server çº¿ç¨‹æ± )</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Blocking-Operations-%E9%98%BB%E5%A1%9E%E5%BC%8F%E6%93%8D%E4%BD%9C"><span class="nav-number">1.29.2.1.</span> <span class="nav-text">Blocking Operations (é˜»å¡å¼æ“ä½œ)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Configuring-the-Netty-Pipeline-%E9%85%8D%E7%BD%AE-Netty-%E7%AE%A1%E9%81%93"><span class="nav-number">1.29.3.</span> <span class="nav-text">Configuring the Netty Pipeline (é…ç½® Netty ç®¡é“)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Configuring-CORS-%E9%85%8D%E7%BD%AE%E8%B7%A8%E5%9F%9F%E8%AF%B7%E6%B1%82"><span class="nav-number">1.29.4.</span> <span class="nav-text">Configuring CORS (é…ç½®è·¨åŸŸè¯·æ±‚)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Allowed-Origins-%E5%85%81%E8%AE%B8%E7%9A%84%E6%BA%90"><span class="nav-number">1.29.4.1.</span> <span class="nav-text">Allowed Origins (å…è®¸çš„æº)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Allowed-Methods-%E5%85%81%E8%AE%B8%E7%9A%84%E6%96%B9%E6%B3%95"><span class="nav-number">1.29.4.2.</span> <span class="nav-text">Allowed Methods (å…è®¸çš„æ–¹æ³•)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Allowed-Headers-%E5%85%81%E8%AE%B8%E7%9A%84%E8%AF%B7%E6%B1%82%E5%A4%B4"><span class="nav-number">1.29.4.3.</span> <span class="nav-text">Allowed Headers (å…è®¸çš„è¯·æ±‚å¤´)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exposed-Headers-%E6%9A%B4%E9%9C%B2%E7%9A%84%E8%AF%B7%E6%B1%82%E5%A4%B4"><span class="nav-number">1.29.4.4.</span> <span class="nav-text">Exposed Headers (æš´éœ²çš„è¯·æ±‚å¤´)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Allow-Credentials-%E5%85%81%E8%AE%B8-Credentials"><span class="nav-number">1.29.4.5.</span> <span class="nav-text">Allow Credentials (å…è®¸ Credentials)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Max-age-%E6%9C%80%E5%A4%A7-age"><span class="nav-number">1.29.4.6.</span> <span class="nav-text">Max age (æœ€å¤§ age)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Multiple-Header-Values-%E5%A4%9A%E4%B8%AA-Header-%E5%80%BC"><span class="nav-number">1.29.4.7.</span> <span class="nav-text">Multiple Header Values (å¤šä¸ª Header å€¼)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Securing-the-Server-with-HTTPS-%E4%BD%BF%E7%94%A8-HTTPS-%E4%BF%9D%E6%8A%A4-Server"><span class="nav-number">1.29.5.</span> <span class="nav-text">Securing the Server with HTTPS (ä½¿ç”¨ HTTPS ä¿æŠ¤ Server)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Using-a-valid-x509-certificate-%E4%BD%BF%E7%94%A8%E4%B8%80%E4%B8%AA%E6%9C%89%E6%95%88%E7%9A%84-x509-%E8%AF%81%E4%B9%A6"><span class="nav-number">1.29.5.1.</span> <span class="nav-text">Using a valid x509 certificate (ä½¿ç”¨ä¸€ä¸ªæœ‰æ•ˆçš„ x509 è¯ä¹¦)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-Java-Keystore-%E4%BD%BF%E7%94%A8-Java-Keystore-JKS"><span class="nav-number">1.29.6.</span> <span class="nav-text">Using Java Keystore (ä½¿ç”¨ Java Keystore (JKS))</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Refreshing-x2F-Reloading-HTTPS-Certificates-%E5%88%B7%E6%96%B0-x2F-%E9%87%8D%E8%BD%BD-HTTPS-%E8%AF%81%E4%B9%A6"><span class="nav-number">1.29.6.1.</span> <span class="nav-text">Refreshing&#x2F;Reloading HTTPS Certificates (åˆ·æ–°&#x2F;é‡è½½ HTTPS è¯ä¹¦)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Enabling-HTTP-and-HTTPS-%E5%90%8C%E6%97%B6%E5%BC%80%E5%90%AF-HTTP-%E5%92%8C-HTTPS"><span class="nav-number">1.29.7.</span> <span class="nav-text">Enabling HTTP and HTTPS (åŒæ—¶å¼€å¯ HTTP å’Œ HTTPS)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Enabling-Access-Logger-%E5%BC%80%E5%90%AF%E8%AE%BF%E9%97%AE%E6%97%A5%E5%BF%97"><span class="nav-number">1.29.8.</span> <span class="nav-text">Enabling Access Logger (å¼€å¯è®¿é—®æ—¥å¿—)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Filtering-access-logs-%E8%BF%87%E6%BB%A4%E8%AE%BF%E9%97%AE%E6%97%A5%E5%BF%97"><span class="nav-number">1.29.8.1.</span> <span class="nav-text">Filtering access logs (è¿‡æ»¤è®¿é—®æ—¥å¿—)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Logback-Configuration-Logback-%E9%85%8D%E7%BD%AE"><span class="nav-number">1.29.8.2.</span> <span class="nav-text">Logback Configuration (Logback é…ç½®)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Log-Format-%E6%97%A5%E5%BF%97%E6%A0%BC%E5%BC%8F"><span class="nav-number">1.29.8.3.</span> <span class="nav-text">Log Format (æ—¥å¿—æ ¼å¼)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Starting-Secondary-Servers-%E5%BC%80%E5%90%AF%E4%BA%8C%E7%BA%A7%E6%9C%8D%E5%8A%A1"><span class="nav-number">1.29.9.</span> <span class="nav-text">Starting Secondary Servers (å¼€å¯äºŒçº§æœåŠ¡)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Server-Side-View-Rendering-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E8%A7%86%E5%9B%BE%E6%B8%B2%E6%9F%93"><span class="nav-number">1.30.</span> <span class="nav-text">Server Side View Rendering (æœåŠ¡å™¨ç«¯è§†å›¾æ¸²æŸ“)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#OpenAPI-x2F-Swagger-Support-OpenAPI-x2F-Swagger-%E6%94%AF%E6%8C%81"><span class="nav-number">1.31.</span> <span class="nav-text">OpenAPI &#x2F; Swagger Support (OpenAPI &#x2F; Swagger æ”¯æŒ)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#GraphQL-Support-GraphQL-%E6%94%AF%E6%8C%81"><span class="nav-number">1.32.</span> <span class="nav-text">GraphQL Support (GraphQL æ”¯æŒ)</span></a></li></ol></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="æœç´¢..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>



<script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/dark-light-toggle.js"></script>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/local-search.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/code-copy.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/lazyload.js"></script>


<div class="post-scripts pjax">
    
        <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/left-side-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/libs/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/toc.js"></script>
    
</div>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/libs/pjax.min.js"></script>
<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>



</body>
</html>
