<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Micronaut,Groovy,Gradle,Java,æ–‡æ¡£,ä¸­æ–‡">
    <meta name="description" content="Micronaut Groovy Gradle Java æ–‡æ¡£ ä¸­æ–‡">
    <meta name="author" content="æ—å¨ç¾½">
    
    <title>
        
            Best practices for writing Dockerfiles |
        
        æ—å¨ç¾½çš„ç¬”è®°
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/logo.svg">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/css/font-awesome.min.css">
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"zh-CN","path":"search.json"};
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":true,"init_open":true},"style":{"primary_color":"rgb(153,153,0)","avatar":"/images/avatar.jpg","favicon":"/images/logo.svg","article_img_align":"left","left_side_width":"400px","content_max_width":"920px","hover":{"shadow":true,"scale":true},"first_screen":{"enable":true,"background_img":null,"description":"def containsğŸš€ = ['Micronaut', 'Groovy', 'Gradle', 'etc']"},"scroll":{"progress_bar":{"enable":true},"percent":{"enable":true}}},"local_search":{"enable":true,"preload":true},"code_copy":{"enable":true,"style":"mac"},"pjax":{"enable":true},"lazyload":{"enable":true},"version":"3.4.5"};
    KEEP.language_ago = {"second":"%s ç§’å‰","minute":"%s åˆ†é’Ÿå‰","hour":"%s å°æ—¶å‰","day":"%s å¤©å‰","week":"%s å‘¨å‰","month":"%s ä¸ªæœˆå‰","year":"%s å¹´å‰"};
  </script>
<meta name="generator" content="Hexo 6.1.0"></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fas fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                æ—å¨ç¾½çš„ç¬”è®°
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                é¦–é¡µ
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                åˆ†ç±»
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                æ ‡ç­¾
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                å½’æ¡£
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                å…³äº
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">é¦–é¡µ</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories">åˆ†ç±»</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags">æ ‡ç­¾</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">å½’æ¡£</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about">å…³äº</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

    <a target="_blank" rel="noopener" href="https://github.com/linweiyu21/" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80"
        viewBox="0 0 250 250" style="fill:#64CEAA; color:#fff; position: absolute; top: 0; border: 0; right: 0;"
        aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path
          d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
          fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path
          d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
          fill="currentColor" class="octo-body"></path>
      </svg></a>
    <style>
      .github-corner:hover .octo-arm {
        animation: octocat-wave 560ms ease-in-out
      }

      @keyframes octocat-wave {

        0%,
        100% {
          transform: rotate(0)
        }

        20%,
        60% {
          transform: rotate(-25deg)
        }

        40%,
        80% {
          transform: rotate(10deg)
        }
      }

      @media (max-width:500px) {
        .github-corner:hover .octo-arm {
          animation: none
        }

        .github-corner .octo-arm {
          animation: octocat-wave 560ms ease-in-out
        }
      }
    </style>
</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">Best practices for writing Dockerfiles</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/avatar.jpg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">æ—å¨ç¾½</span>
                        
                            <span class="author-label">Lv8</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;
        <span class="pc">2022-05-23 09:58:35</span>
        <span class="mobile">2022-05-23 09:58</span>
    </span>
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/Docker/">Docker</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/Docker/">Docker</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/Notes/">Notes</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <!-- TOC -->

<ul>
<li><a href="#general-guidelines-and-recommendations-%E4%B8%80%E8%88%AC%E5%87%86%E5%88%99%E5%92%8C%E5%BB%BA%E8%AE%AE">General guidelines and recommendations (ä¸€èˆ¬å‡†åˆ™å’Œå»ºè®®)</a><ul>
<li><a href="#create-ephemeral-containers-%E5%88%9B%E5%BB%BA%E4%B8%B4%E6%97%B6%E5%AE%B9%E5%99%A8">Create ephemeral containers (åˆ›å»ºä¸´æ—¶å®¹å™¨)</a></li>
<li><a href="#understand-build-context-%E7%90%86%E8%A7%A3%E6%9E%84%E5%BB%BA%E4%B8%8A%E4%B8%8B%E6%96%87">Understand build context (ç†è§£æ„å»ºä¸Šä¸‹æ–‡)</a></li>
<li><a href="#pipe-dockerfile-through-stdin-%E9%80%9A%E8%BF%87-stdin-%E7%AE%A1%E9%81%93%E5%8C%96-dockerfile">Pipe Dockerfile through <code>stdin</code> (é€šè¿‡ <code>stdin</code> ç®¡é“åŒ– Dockerfile)</a><ul>
<li><a href="#build-an-image-using-a-dockerfile-from-stdin-without-sending-build-context-%E4%BD%BF%E7%94%A8%E6%9D%A5%E8%87%AA-stdin-%E7%9A%84-dockerfile-%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F-%E4%B8%8D%E5%8F%91%E9%80%81%E6%9E%84%E5%BB%BA%E4%B8%8A%E4%B8%8B%E6%96%87">Build an image using a Dockerfile from stdin, without sending build context (ä½¿ç”¨æ¥è‡ª stdin çš„ Dockerfile æ„å»ºé•œåƒ, ä¸å‘é€æ„å»ºä¸Šä¸‹æ–‡)</a></li>
<li><a href="#build-from-a-local-build-context-using-a-dockerfile-from-stdin-%E4%BB%8E%E6%9C%AC%E5%9C%B0%E6%9E%84%E5%BB%BA%E4%B8%8A%E4%B8%8B%E6%96%87%E8%BF%9B%E8%A1%8C%E6%9E%84%E5%BB%BA-%E4%BD%BF%E7%94%A8%E6%9D%A5%E8%87%AA-stdin-%E7%9A%84-dockerfile">Build from a local build context, using a Dockerfile from stdin (ä»æœ¬åœ°æ„å»ºä¸Šä¸‹æ–‡è¿›è¡Œæ„å»º, ä½¿ç”¨æ¥è‡ª stdin çš„ Dockerfile)</a></li>
<li><a href="#build-from-a-remote-build-context-using-a-dockerfile-from-stdin-%E4%BD%BF%E7%94%A8%E6%9D%A5%E8%87%AA-stdin-%E7%9A%84-dockerfile-%E4%BB%8E%E4%B8%80%E4%B8%AA%E8%BF%9C%E7%A8%8B%E6%9E%84%E5%BB%BA%E4%B8%8A%E4%B8%8B%E6%96%87%E8%BF%9B%E8%A1%8C%E6%9E%84%E5%BB%BA">Build from a remote build context, using a Dockerfile from stdin (ä½¿ç”¨æ¥è‡ª stdin çš„ Dockerfile, ä»ä¸€ä¸ªè¿œç¨‹æ„å»ºä¸Šä¸‹æ–‡è¿›è¡Œæ„å»º)</a></li>
</ul>
</li>
<li><a href="#exclude-with-dockerignore-%E4%BD%BF%E7%94%A8-dockerignore-%E8%BF%9B%E8%A1%8C%E6%8E%92%E9%99%A4">Exclude with .dockerignore (ä½¿ç”¨ .dockerignore è¿›è¡Œæ’é™¤)</a></li>
<li><a href="#use-multi-stage-builds-%E4%BD%BF%E7%94%A8%E5%A4%9A%E9%98%B6%E6%AE%B5%E6%9E%84%E5%BB%BA">Use multi-stage builds (ä½¿ç”¨å¤šé˜¶æ®µæ„å»º)</a></li>
<li><a href="#dont-install-unnecessary-packages-%E4%B8%8D%E8%A6%81%E5%AE%89%E8%A3%85%E4%B8%8D%E5%BF%85%E8%A6%81%E7%9A%84%E5%8C%85">Donâ€™t install unnecessary packages (ä¸è¦å®‰è£…ä¸å¿…è¦çš„åŒ…)</a></li>
<li><a href="#decouple-applications-%E8%A7%A3%E8%80%A6%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F">Decouple applications (è§£è€¦åº”ç”¨ç¨‹åº)</a></li>
<li><a href="#minimize-the-number-of-layers-%E6%9C%80%E5%B0%8F%E5%8C%96%E5%B1%82%E7%9A%84%E6%95%B0%E9%87%8F">Minimize the number of layers (æœ€å°åŒ–å±‚çš„æ•°é‡)</a></li>
<li><a href="#sort-multi-line-arguments-%E6%8E%92%E5%BA%8F%E5%A4%9A%E8%A1%8C%E5%8F%82%E6%95%B0">Sort multi-line arguments (æ’åºå¤šè¡Œå‚æ•°)</a></li>
<li><a href="#leverage-build-cache-%E5%88%A9%E7%94%A8%E6%9E%84%E5%BB%BA%E7%BC%93%E5%AD%98">Leverage build cache (åˆ©ç”¨æ„å»ºç¼“å­˜)</a></li>
</ul>
</li>
<li><a href="#dockerfile-instructions-dockerfile-%E6%8C%87%E4%BB%A4">Dockerfile instructions (Dockerfile æŒ‡ä»¤)</a><ul>
<li><a href="#from-from-%E6%8C%87%E4%BB%A4">FROM (FROM æŒ‡ä»¤)</a></li>
<li><a href="#label-label-%E6%8C%87%E4%BB%A4">LABEL (LABEL æŒ‡ä»¤)</a></li>
<li><a href="#run-run-%E6%8C%87%E4%BB%A4">RUN (RUN æŒ‡ä»¤)</a><ul>
<li><a href="#apt-get">apt-get</a></li>
<li><a href="#using-pipes-%E4%BD%BF%E7%94%A8%E7%AE%A1%E9%81%93">Using pipes (ä½¿ç”¨ç®¡é“)</a></li>
</ul>
</li>
<li><a href="#cmd-cmd-%E6%8C%87%E4%BB%A4">CMD (CMD æŒ‡ä»¤)</a></li>
<li><a href="#expose-expose-%E6%8C%87%E4%BB%A4">EXPOSE (EXPOSE æŒ‡ä»¤)</a></li>
<li><a href="#env-env-%E6%8C%87%E4%BB%A4">ENV (ENV æŒ‡ä»¤)</a></li>
<li><a href="#add-or-copy-add-%E6%88%96-copy-%E6%8C%87%E4%BB%A4">ADD or COPY (ADD æˆ– COPY æŒ‡ä»¤)</a></li>
<li><a href="#entrypoint-entrypoint-%E6%8C%87%E4%BB%A4">ENTRYPOINT (ENTRYPOINT æŒ‡ä»¤)</a></li>
<li><a href="#volume-volume-%E6%8C%87%E4%BB%A4">VOLUME (VOLUME æŒ‡ä»¤)</a></li>
<li><a href="#user-user-%E6%8C%87%E4%BB%A4">USER (USER æŒ‡ä»¤)</a></li>
<li><a href="#workdir-workdir-%E6%8C%87%E4%BB%A4">WORKDIR (WORKDIR æŒ‡ä»¤)</a></li>
<li><a href="#onbuild-onbuild-%E6%8C%87%E4%BB%A4">ONBUILD (ONBUILD æŒ‡ä»¤)</a></li>
</ul>
</li>
<li><a href="#%E5%8F%82%E8%80%83">å‚è€ƒ</a></li>
</ul>
<!-- /TOC -->

<p>å½“è¿è¡Œä¸€ä¸ªé•œåƒå¹¶ç”Ÿæˆä¸€ä¸ªå®¹å™¨æ—¶, æ·»åŠ äº†ä¸€ä¸ªæ–°çš„å¯å†™ (writable) å±‚ (å®¹å™¨å±‚ (container layer)) åˆ°ä¸‹é¢çš„å±‚çš„æœ€ä¸Šé¢</p>
<p>æ‰€æœ‰å¯¹äºè¿è¡Œä¸­å®¹å™¨çš„ä¿®æ”¹, ä¾‹å¦‚å†™å…¥æ–°æ–‡ä»¶, ä¿®æ”¹å·²å­˜åœ¨çš„æ–‡ä»¶, åˆ é™¤æ–‡ä»¶, éƒ½æ˜¯å†™å…¥åˆ°è¿™ä¸ªå®¹å™¨å±‚</p>
<h2 id="General-guidelines-and-recommendations-ä¸€èˆ¬å‡†åˆ™å’Œå»ºè®®"><a href="#General-guidelines-and-recommendations-ä¸€èˆ¬å‡†åˆ™å’Œå»ºè®®" class="headerlink" title="General guidelines and recommendations (ä¸€èˆ¬å‡†åˆ™å’Œå»ºè®®)"></a>General guidelines and recommendations (ä¸€èˆ¬å‡†åˆ™å’Œå»ºè®®)</h2><h3 id="Create-ephemeral-containers-åˆ›å»ºä¸´æ—¶å®¹å™¨"><a href="#Create-ephemeral-containers-åˆ›å»ºä¸´æ—¶å®¹å™¨" class="headerlink" title="Create ephemeral containers (åˆ›å»ºä¸´æ—¶å®¹å™¨)"></a>Create ephemeral containers (åˆ›å»ºä¸´æ—¶å®¹å™¨)</h3><p>å°½é‡åˆ›å»º â€œçŸ­æš‚çš„&#96; å®¹å™¨</p>
<p>â€œçŸ­æš‚çš„â€ æ„å‘³ç€æ— çŠ¶æ€çš„, å¯ä»¥éšæ—¶åœæ­¢, å¯åŠ¨å’Œé‡å¯çš„å®¹å™¨</p>
<p>å°½é‡åˆ›å»ºè½»é‡çº§, æ— ä¾èµ–æˆ–æœ€å°ä¾èµ–çš„å®¹å™¨</p>
<h3 id="Understand-build-context-ç†è§£æ„å»ºä¸Šä¸‹æ–‡"><a href="#Understand-build-context-ç†è§£æ„å»ºä¸Šä¸‹æ–‡" class="headerlink" title="Understand build context (ç†è§£æ„å»ºä¸Šä¸‹æ–‡)"></a>Understand build context (ç†è§£æ„å»ºä¸Šä¸‹æ–‡)</h3><p>é»˜è®¤æƒ…å†µä¸‹, ä»¥æ‰§è¡Œ <code>docker build</code> å‘½ä»¤çš„å½“å‰å·¥ä½œç›®å½•ä½œä¸º<strong>æ„å»ºä¸Šä¸‹æ–‡</strong>, å¹¶ä½¿ç”¨å½“å‰å·¥ä½œç›®å½•ä¸­çš„ <code>Dockerfile</code></p>
<p>å¯ä»¥ä½¿ç”¨ <code>-f</code> æ ‡å¿—æ¥æŒ‡å®š <code>Dockerfile</code> çš„ä½ç½®. å°±ç®—æŒ‡å®šäº† <code>-f</code> æ ‡å¿—, é»˜è®¤æƒ…å†µä¸‹è¿˜æ˜¯å°†å½“å‰å·¥ä½œç›®å½•ä¸­çš„æ–‡ä»¶ç›®å½•åŠå…¶é€’å½’æ–‡ä»¶ç›®å½•å‘é€ç»™ Docker daemon ä½œä¸ºæ„å»ºä¸Šä¸‹æ–‡</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">./myproject</span><br><span class="line">â”œâ”€â”€ context</span><br><span class="line">â”‚Â Â  â””â”€â”€ hello</span><br><span class="line">â””â”€â”€ dockerfiles</span><br><span class="line">    â””â”€â”€ Dockerfile</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build --no-cache -t helloapp:v2 -f dockerfiles/Dockerfile context</span><br></pre></td></tr></table></figure>

<ul>
<li><code>-f dockerfiles/Dockerfile</code> - æŒ‡å®šäº† <code>Dockerfile</code> æ–‡ä»¶çš„ä½ç½®</li>
<li><code>context</code> - æŒ‡å®šäº†æ„å»ºä¸Šä¸‹æ–‡ (build context)</li>
</ul>
<h3 id="Pipe-Dockerfile-through-stdin-é€šè¿‡-stdin-ç®¡é“åŒ–-Dockerfile"><a href="#Pipe-Dockerfile-through-stdin-é€šè¿‡-stdin-ç®¡é“åŒ–-Dockerfile" class="headerlink" title="Pipe Dockerfile through stdin (é€šè¿‡ stdin ç®¡é“åŒ– Dockerfile)"></a>Pipe Dockerfile through <code>stdin</code> (é€šè¿‡ <code>stdin</code> ç®¡é“åŒ– Dockerfile)</h3><p>å¯ä»¥é€šè¿‡ <code>stdin</code> æ¥ä¼ é€’ <code>Dockerfile</code> ç»™ <code>docker build</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&#x27;FROM busybox\nRUN echo &quot;hello world&quot;&#x27;</span> | docker build -</span><br></pre></td></tr></table></figure>

<p><code>echo -e</code> å¯ç”¨åæ–œæ è½¬ä¹‰</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker build -&lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">FROM busybox</span></span><br><span class="line"><span class="string">RUN echo &quot;hello world&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<h4 id="Build-an-image-using-a-Dockerfile-from-stdin-without-sending-build-context-ä½¿ç”¨æ¥è‡ª-stdin-çš„-Dockerfile-æ„å»ºé•œåƒ-ä¸å‘é€æ„å»ºä¸Šä¸‹æ–‡"><a href="#Build-an-image-using-a-Dockerfile-from-stdin-without-sending-build-context-ä½¿ç”¨æ¥è‡ª-stdin-çš„-Dockerfile-æ„å»ºé•œåƒ-ä¸å‘é€æ„å»ºä¸Šä¸‹æ–‡" class="headerlink" title="Build an image using a Dockerfile from stdin, without sending build context (ä½¿ç”¨æ¥è‡ª stdin çš„ Dockerfile æ„å»ºé•œåƒ, ä¸å‘é€æ„å»ºä¸Šä¸‹æ–‡)"></a>Build an image using a Dockerfile from stdin, without sending build context (ä½¿ç”¨æ¥è‡ª stdin çš„ Dockerfile æ„å»ºé•œåƒ, ä¸å‘é€æ„å»ºä¸Šä¸‹æ–‡)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build [OPTIONS] -</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªè¯­æ³•ä½¿ç”¨æ¥è‡ª <code>stdin</code> çš„ <code>Dockerfile</code> æ„å»ºé•œåƒ, ä¸å‘é€é¢å¤–çš„æ–‡ä»¶ä½œä¸ºæ„å»ºä¸Šä¸‹æ–‡</p>
<p><code>-</code> ä»£æ›¿äº† <code>PATH</code> çš„ä½ç½®, å¹¶æŒ‡ç¤º Docker ä» <code>stdin</code> (åªåŒ…å«ä¸€ä¸ª <code>Dockerfile</code>) è€Œä¸æ˜¯ä»ä¸€ä¸ªç›®å½•ä¸­è¯»å–æ„å»ºä¸Šä¸‹æ–‡</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker build -t myimage:latest -&lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">FROM busybox</span></span><br><span class="line"><span class="string">RUN echo &quot;hello world&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä¾‹å­ä½¿ç”¨é€šè¿‡ <code>stdin</code> ä¼ é€’çš„ <code>Dockerfile</code> æ„å»ºé•œåƒ. æ²¡æœ‰æ–‡ä»¶ä½œä¸ºæ„å»ºä¸Šä¸‹æ–‡å‘é€ç»™ daemon</p>
<p>åœ¨ä½ çš„ <code>Dockerfile</code> ä¸éœ€è¦å¤åˆ¶æ–‡ä»¶åˆ°é•œåƒä¸­æ—¶å»æ‰æ„å»ºä¸Šä¸‹æ–‡éå¸¸æœ‰ç”¨, è¿™æ ·å¯ä»¥æé«˜æ„å»ºé€Ÿåº¦, å› ä¸ºæ²¡æœ‰æ–‡ä»¶éœ€è¦å‘é€ç»™ daemon</p>
<p>å¦‚æœä»¥ <code>stdin</code> ä¼ é€’ <code>Dockerfile</code> ä½†åˆä½¿ç”¨äº† <code>COPY</code>&#x2F;<code>ADD</code> æŒ‡ä»¤, æ„å»ºå°†ä¼šæŠ¥é”™</p>
<h4 id="Build-from-a-local-build-context-using-a-Dockerfile-from-stdin-ä»æœ¬åœ°æ„å»ºä¸Šä¸‹æ–‡è¿›è¡Œæ„å»º-ä½¿ç”¨æ¥è‡ª-stdin-çš„-Dockerfile"><a href="#Build-from-a-local-build-context-using-a-Dockerfile-from-stdin-ä»æœ¬åœ°æ„å»ºä¸Šä¸‹æ–‡è¿›è¡Œæ„å»º-ä½¿ç”¨æ¥è‡ª-stdin-çš„-Dockerfile" class="headerlink" title="Build from a local build context, using a Dockerfile from stdin (ä»æœ¬åœ°æ„å»ºä¸Šä¸‹æ–‡è¿›è¡Œæ„å»º, ä½¿ç”¨æ¥è‡ª stdin çš„ Dockerfile)"></a>Build from a local build context, using a Dockerfile from stdin (ä»æœ¬åœ°æ„å»ºä¸Šä¸‹æ–‡è¿›è¡Œæ„å»º, ä½¿ç”¨æ¥è‡ª stdin çš„ Dockerfile)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build [OPTIONS] -f- PATH</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªè¯­æ³•ä½¿ç”¨ä½ æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ–‡ä»¶æ¥æ„å»ºé•œåƒ, å½“ä½¿ç”¨æ¥è‡ª <code>stdin</code> çš„ <code>Dockerfile</code></p>
<p>è¿™ä¸ªè¯­æ³•ä½¿ç”¨ <code>-f</code> (æˆ– <code>--file</code>) é€‰é¡¹æ¥æŒ‡å®šä½¿ç”¨å“ªä¸ª <code>Dockerfile</code>, ä½¿ç”¨ <code>-</code> ä½œä¸ºæ–‡ä»¶åæ¥æŒ‡ç¤º Docker ä» <code>stdin</code> ä¸­è¯»å– <code>Dockerfile</code></p>
<p>Example:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># build an image using the current directory as context, and a Dockerfile passed through stdin</span></span><br><span class="line">docker build -t myimage:latest -f- . &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">FROM busybox</span></span><br><span class="line"><span class="string">COPY somefile.txt ./</span></span><br><span class="line"><span class="string">RUN cat /somefile.txt</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨å½“å‰ç›®å½•ä½œä¸ºä¸Šä¸‹æ–‡æ„å»ºé•œåƒ, å¹¶ä» <code>stdin</code> ä¼ é€’ <code>Dockerfile</code></p>
<h4 id="Build-from-a-remote-build-context-using-a-Dockerfile-from-stdin-ä½¿ç”¨æ¥è‡ª-stdin-çš„-Dockerfile-ä»ä¸€ä¸ªè¿œç¨‹æ„å»ºä¸Šä¸‹æ–‡è¿›è¡Œæ„å»º"><a href="#Build-from-a-remote-build-context-using-a-Dockerfile-from-stdin-ä½¿ç”¨æ¥è‡ª-stdin-çš„-Dockerfile-ä»ä¸€ä¸ªè¿œç¨‹æ„å»ºä¸Šä¸‹æ–‡è¿›è¡Œæ„å»º" class="headerlink" title="Build from a remote build context, using a Dockerfile from stdin (ä½¿ç”¨æ¥è‡ª stdin çš„ Dockerfile, ä»ä¸€ä¸ªè¿œç¨‹æ„å»ºä¸Šä¸‹æ–‡è¿›è¡Œæ„å»º)"></a>Build from a remote build context, using a Dockerfile from stdin (ä½¿ç”¨æ¥è‡ª stdin çš„ Dockerfile, ä»ä¸€ä¸ªè¿œç¨‹æ„å»ºä¸Šä¸‹æ–‡è¿›è¡Œæ„å»º)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build [OPTIONS] -f- PATH</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªè¯­æ³•ä½¿ç”¨è¿œç¨‹ <code>Git</code> ä»“åº“ä¸­çš„æ–‡ä»¶æ„å»ºé•œåƒ, è¯»å–æ¥è‡ª <code>stdin</code> çš„ <code>Dockerfile</code></p>
<p>è¿™ä¸ªè¯­æ³•ä½¿ç”¨ <code>-f</code> (æˆ– <code>--file</code>) é€‰é¡¹æ¥æŒ‡å®šä½¿ç”¨å“ªä¸ª <code>Dockerfile</code>, ä½¿ç”¨ <code>-</code> ä½œä¸ºæ–‡ä»¶åæ¥æŒ‡ç¤º Docker ä» <code>stdin</code> ä¸­è¯»å– <code>Dockerfile</code></p>
<p>è¿™ä¸ªè¯­æ³•åœ¨ä½ ä»ä¸€ä¸ªæ²¡æœ‰ <code>Dockerfile</code> çš„ä»“åº“ä¸­è¿›è¡Œæ„å»ºæ—¶å¾ˆæœ‰ç”¨, æˆ–è€…ä½ æƒ³è¦ä½¿ç”¨è‡ªå®šä¹‰çš„ <code>Dockerfile</code> è¿›è¡Œæ„å»ºè€Œä¸éœ€è¦ç»´æŠ¤è¿™ä¸ªä»“åº“çš„åˆ†æ”¯</p>
<p>Example:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker build -t myimage:latest -f- https://github.com/docker-library/hello-world.git &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">FROM busybox</span></span><br><span class="line"><span class="string">COPY hello.c ./</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ä¾‹å­ä½¿ç”¨æ¥è‡ª <code>stdin</code> çš„ <code>Dockerfile</code>, æ·»åŠ æ¥è‡ª â€œhello-worldâ€  Git ä»“åº“ä¸­çš„ <code>hello.c</code> æ–‡ä»¶åˆ°é•œåƒä¸­</p>
<p>åœ¨èƒŒå: å½“ä½¿ç”¨ä¸€ä¸ªè¿œç¨‹ Git ä»“åº“ä½œä¸ºä¸Šä¸‹æ–‡è¿›è¡Œé•œåƒæ„å»ºæ—¶, Docker åœ¨æœ¬åœ°æœºå™¨ä¸Šæ‰§è¡Œè¿™ä¸ªä»“åº“çš„ <code>git clone</code> å‘½ä»¤, å¹¶å°†è¿™äº›æ–‡ä»¶ä½œä¸ºæ„å»ºä¸Šä¸‹æ–‡å‘é€ç»™ daemon. æ‰€ä»¥è¿™ä¸ªåŠŸèƒ½è¦æ±‚ <code>git</code> è¦å®‰è£…åœ¨ä½ è¿è¡Œ <code>docker build</code> å‘½ä»¤çš„ä¸»æœºä¸Š</p>
<h3 id="Exclude-with-dockerignore-ä½¿ç”¨-dockerignore-è¿›è¡Œæ’é™¤"><a href="#Exclude-with-dockerignore-ä½¿ç”¨-dockerignore-è¿›è¡Œæ’é™¤" class="headerlink" title="Exclude with .dockerignore (ä½¿ç”¨ .dockerignore è¿›è¡Œæ’é™¤)"></a>Exclude with .dockerignore (ä½¿ç”¨ .dockerignore è¿›è¡Œæ’é™¤)</h3><p>ä½¿ç”¨ <code>.dockerignore</code> æ–‡ä»¶æ¥æ’é™¤æ‰ä¸æ˜¯å…³è”åˆ°æ„å»ºä¸­çš„æ–‡ä»¶</p>
<h3 id="Use-multi-stage-builds-ä½¿ç”¨å¤šé˜¶æ®µæ„å»º"><a href="#Use-multi-stage-builds-ä½¿ç”¨å¤šé˜¶æ®µæ„å»º" class="headerlink" title="Use multi-stage builds (ä½¿ç”¨å¤šé˜¶æ®µæ„å»º)"></a>Use multi-stage builds (ä½¿ç”¨å¤šé˜¶æ®µæ„å»º)</h3><p><a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/develop/develop-images/multistage-build/" >å¤šé˜¶æ®µæ„å»º<i class="fas fa-external-link-alt"></i></a> å‰§çƒˆåœ°å‡å°‘æœ€ç»ˆé•œåƒçš„å¤§å°è€Œä¸ç”¨æŒ£æ‰äºå‡å°‘ä¸­é—´å±‚å’Œæ–‡ä»¶æ•°é‡</p>
<p>å› ä¸ºé•œåƒåœ¨æ„å»ºè¿›ç¨‹çš„æœ€ç»ˆé˜¶æ®µè¢«æ„å»º, æ‰€ä»¥å¯ä»¥é€šè¿‡åˆ©ç”¨æ„å»ºç¼“å­˜æ¥æœ€å°åŒ–é•œåƒå±‚</p>
<p>å¦‚æœä½ çš„æ„å»ºåŒ…å«å¤šå±‚, å¯ä»¥å°†å®ƒä»¬ä»¥ æœ€å°‘ä¿®æ”¹(ç¡®ä¿é‡ç”¨äº†ç¼“å­˜) åˆ° æœ€å¸¸ä¿®æ”¹ çš„é¡ºåºè¿›è¡Œæ’åº:</p>
<ul>
<li>å®‰è£…æ„å»ºåº”ç”¨ç¨‹åºéœ€è¦çš„å·¥å…·</li>
<li>å®‰è£…æˆ–æ›´æ–°åº“ä¾èµ–</li>
<li>ç”Ÿæˆä½ çš„åº”ç”¨ç¨‹åº</li>
</ul>
<p>Example - ä¸€ä¸ª Go åº”ç”¨ç¨‹åºçš„ Dockerfile:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># syntax=docker/dockerfile:1</span></span><br><span class="line"><span class="keyword">FROM</span> golang:<span class="number">1.16</span>-alpine AS build</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸ºé¡¹ç›®å®‰è£…éœ€è¦çš„å·¥å…·</span></span><br><span class="line"><span class="comment"># è¿è¡Œ `docker build --no-cache .` æ¥æ›´æ–°ä¾èµ–</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apk add --no-cache git</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> go get github.com/golang/dep/cmd/dep</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ Gopkg.toml å’Œ Gopkg.lock åˆ—å‡ºé¡¹ç›®ä¾èµ–</span></span><br><span class="line"><span class="comment"># è¿™äº›å±‚åªæœ‰åœ¨ Gopkg æ–‡ä»¶æ›´æ–°æ—¶æ‰é‡æ–°æ„å»º</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> Gopkg.lock Gopkg.toml /go/src/project/</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /go/src/project/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…ä¾èµ–åº“</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> dep ensure -vendor-only</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤åˆ¶æ•´ä¸ªé¡¹ç›®å¹¶æ„å»º</span></span><br><span class="line"><span class="comment"># é¡¹ç›®ç›®å½•ä¸­çš„æ–‡ä»¶æ”¹å˜æ—¶ä¼šé‡æ–°æ„å»ºè¿™ä¸ªå±‚</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./go/src/project/</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> go build -o /bin/project</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™ä¼šç”Ÿæˆä¸€ä¸ªå•å±‚çš„é•œåƒ</span></span><br><span class="line"><span class="keyword">FROM</span> scratch</span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=build /bin/project /bin/project</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;/bin/project&quot;</span>]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;--help&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<h3 id="Donâ€™t-install-unnecessary-packages-ä¸è¦å®‰è£…ä¸å¿…è¦çš„åŒ…"><a href="#Donâ€™t-install-unnecessary-packages-ä¸è¦å®‰è£…ä¸å¿…è¦çš„åŒ…" class="headerlink" title="Donâ€™t install unnecessary packages (ä¸è¦å®‰è£…ä¸å¿…è¦çš„åŒ…)"></a>Donâ€™t install unnecessary packages (ä¸è¦å®‰è£…ä¸å¿…è¦çš„åŒ…)</h3><p>ä¸ºäº†å‡å°å¤æ‚åº¦, ä¾èµ–, æ–‡ä»¶å¤§å°å’Œæ„å»ºæ—¶é—´, é¿å…å®‰è£…é¢å¤–æˆ–ä¸å¿…è¦çš„åŒ…</p>
<h3 id="Decouple-applications-è§£è€¦åº”ç”¨ç¨‹åº"><a href="#Decouple-applications-è§£è€¦åº”ç”¨ç¨‹åº" class="headerlink" title="Decouple applications (è§£è€¦åº”ç”¨ç¨‹åº)"></a>Decouple applications (è§£è€¦åº”ç”¨ç¨‹åº)</h3><p>æ¯ä¸ªåº”ç”¨ç¨‹åºåº”è¯¥åªæœ‰ä¸€ä¸ªå…³æ³¨ç‚¹</p>
<p>è§£è€¦åº”ç”¨ç¨‹åºä¸ºå¤šä¸ªå®¹å™¨ä½¿å¾—æ¨ªå‘æ‰©å±•ä¸é‡ç”¨å®¹å™¨æ›´åŠ å®¹æ˜“</p>
<p>ä¾‹å¦‚, ä¸€ä¸ª web åº”ç”¨ç¨‹åºæ ˆå¯èƒ½åŒ…å«ä¸‰ä¸ªåˆ†å¼€çš„å®¹å™¨, æ¯ä¸ªå®¹å™¨éƒ½æœ‰è‡ªå·±å”¯ä¸€çš„é•œåƒ, ä»¥è§£è€¦çš„æ–¹å¼æ¥ç®¡ç† web åº”ç”¨ç¨‹åº, æ•°æ®åº“å’Œä¸€ä¸ªåŸºäºå†…å­˜çš„ç¼“å­˜</p>
<p>å°†æ¯ä¸ªå®¹å™¨é™åˆ¶ä¸ºä¸€ä¸ªè¿›ç¨‹æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç»éªŒæ³•åˆ™, ä½†è¿™å¹¶ä¸æ˜¯ç¡¬æ€§è§„å®š. ä¾‹å¦‚, ä¸æ­¢å®¹å™¨å¯ä»¥é€šè¿‡ init è¿›ç¨‹æ¥ç”Ÿæˆ, ä¸€äº›ç¨‹åºæœ¬èº«ä¹Ÿä¼šç”Ÿæˆè¿›ç¨‹. ä¾‹å¦‚, Celery å¯ä»¥äº§ç”Ÿå¤šä¸ªå·¥ä½œè¿›ç¨‹, è€Œ Apache å¯ä»¥ä¸ºæ¯ä¸ªè¯·æ±‚åˆ›å»ºä¸€ä¸ªè¿›ç¨‹</p>
<p>ä½¿ç”¨ä½ æœ€å¥½çš„åˆ¤æ–­åŠ›æ¥ä¿æŒå®¹å™¨å°½å¯èƒ½å¹²å‡€å’Œæ¨¡å—åŒ–</p>
<p>å¦‚æœå®¹å™¨å½¼æ­¤ä¾èµ–, ä½ å¯ä»¥ä½¿ç”¨ <a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/network/" >Docker å®¹å™¨ç½‘ç»œ<i class="fas fa-external-link-alt"></i></a> æ¥ç¡®ä¿è¿™äº›å®¹å™¨ä¹‹é—´å¯ä»¥é€šä¿¡</p>
<h3 id="Minimize-the-number-of-layers-æœ€å°åŒ–å±‚çš„æ•°é‡"><a href="#Minimize-the-number-of-layers-æœ€å°åŒ–å±‚çš„æ•°é‡" class="headerlink" title="Minimize the number of layers (æœ€å°åŒ–å±‚çš„æ•°é‡)"></a>Minimize the number of layers (æœ€å°åŒ–å±‚çš„æ•°é‡)</h3><p>åªæœ‰ <code>RUN</code>, <code>COPY</code>, <code>ADD</code> æŒ‡ä»¤ä¼šåˆ›å»ºå±‚. å…¶ä»–æŒ‡ä»¤åˆ›å»ºä¸´æ—¶ä¸­é—´é•œåƒ, ä¸ä¼šå¢åŠ æ„å»ºçš„å¤§å°</p>
<p>å½“å¯èƒ½çš„æ—¶å€™, ä½¿ç”¨ <a href="">å¤šé˜¶æ®µæ„å»º</a>, å¹¶ä¸”åªå¤åˆ¶ä½ éœ€è¦çš„æ„ä»¶åˆ°æœ€ç»ˆé•œåƒä¸­. è¿™ä½¿å¾—ä½ å°†å·¥å…·å’Œè°ƒè¯•ä¿¡æ¯åŒ…å«åˆ°ä¸­é—´æ„å»ºé˜¶æ®µè€Œä¸ä¼šå¢åŠ æœ€ç»ˆé•œåƒçš„å¤§å°</p>
<h3 id="Sort-multi-line-arguments-æ’åºå¤šè¡Œå‚æ•°"><a href="#Sort-multi-line-arguments-æ’åºå¤šè¡Œå‚æ•°" class="headerlink" title="Sort multi-line arguments (æ’åºå¤šè¡Œå‚æ•°)"></a>Sort multi-line arguments (æ’åºå¤šè¡Œå‚æ•°)</h3><p>åªè¦æœ‰å¯èƒ½, é€šè¿‡æŒ‰å­—æ¯æ•°å­—æ’åºå¤šè¡Œå‚æ•°æ¥ç®€åŒ–ä»¥åçš„æ›´æ”¹. è¿™æœ‰åŠ©äºé¿å…åŒ…çš„é‡å¤å¹¶ä¸ä½¿åˆ—è¡¨æ›´æ–°æ›´å®¹æ˜“. è¿™ä¹Ÿæœ‰åŠ©äº PR è¿›è¡Œé˜…è¯»å’Œå®¡æŸ¥. åœ¨ <code>\</code> æ·»åŠ ä¸€ä¸ªç©ºæ ¼ä¹Ÿä¼šæœ‰å¸®åŠ©</p>
<p>Example:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get install -y \</span></span><br><span class="line"><span class="language-bash">  bzr \</span></span><br><span class="line"><span class="language-bash">  cvs \</span></span><br><span class="line"><span class="language-bash">  git \</span></span><br><span class="line"><span class="language-bash">  mercurial \</span></span><br><span class="line"><span class="language-bash">  subversion \</span></span><br><span class="line"><span class="language-bash">  &amp;&amp; <span class="built_in">rm</span> -rf /var/lib/apt/lists/*</span></span><br></pre></td></tr></table></figure>

<h3 id="Leverage-build-cache-åˆ©ç”¨æ„å»ºç¼“å­˜"><a href="#Leverage-build-cache-åˆ©ç”¨æ„å»ºç¼“å­˜" class="headerlink" title="Leverage build cache (åˆ©ç”¨æ„å»ºç¼“å­˜)"></a>Leverage build cache (åˆ©ç”¨æ„å»ºç¼“å­˜)</h3><p>åœ¨ <code>docker build</code> å‘½ä»¤ä¸Šä½¿ç”¨ <code>--no-cache=true</code> é€‰é¡¹æ¥å…³é—­ç¼“å­˜</p>
<p>ä½¿ç”¨å¦‚ä¸‹è§„åˆ™æ¥åˆ¤æ–­æ˜¯å¦ä½¿ç”¨ç¼“å­˜:</p>
<ul>
<li>ä»å·²ç»å­˜åœ¨äºç¼“å­˜ä¸­çš„çˆ¶é•œåƒå¼€å§‹, å°†ä¸‹ä¸€æ¡æŒ‡ä»¤ä¸ä»è¯¥åŸºç¡€é•œåƒæ´¾ç”Ÿçš„æ‰€æœ‰å­é•œåƒè¿›è¡Œæ¯”è¾ƒ, ä»¥æŸ¥çœ‹å…¶ä¸­ä¸€ä¸ªæ˜¯å¦ä½¿ç”¨ç›¸åŒçš„æŒ‡ä»¤æ„å»ºçš„. å¦‚æœä¸æ˜¯, åˆ™ç¼“å­˜æ— æ•ˆ</li>
<li>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹, åªéœ€å°† Dockerfile ä¸­çš„æŒ‡ä»¤ä¸å…¶ä¸­ä¸€ä¸ªå­é•œåƒè¿›è¡Œæ¯”è¾ƒå°±è¶³å¤Ÿäº†. ä½†æ˜¯, æŸäº›æŒ‡ä»¤éœ€è¦æ›´å¤šçš„æ£€æŸ¥å’Œè§£é‡Š</li>
<li>å¯¹äº <code>ADD</code> å’Œ <code>COPY</code> æŒ‡ä»¤, æ£€æŸ¥é•œåƒä¸­çš„æ–‡ä»¶çš„å†…å®¹å¹¶ä¸ºæ¯ä¸ªæ–‡ä»¶è®¡ç®—æ ¡éªŒå’Œ. è¿™äº›æ ¡éªŒå’Œä¸­ä¸è€ƒè™‘æ–‡ä»¶çš„æœ€åä¿®æ”¹å’Œæœ€åèŒƒå›´æ—¶é—´. åœ¨æŸ¥æ‰¾ç¼“å­˜æœŸé—´, å°†æ£€éªŒå’Œä¸ç°æœ‰é•œåƒä¸­çš„æ ¡éªŒå’Œè¿›è¡Œæ¯”è¾ƒ. å¦‚æœæ–‡ä»¶ä¸­æœ‰ä»»ä½•æ›´æ”¹, ä¾‹å¦‚å†…å®¹å’Œå…ƒæ•°æ®, åˆ™ç¼“å­˜æ— æ•ˆ</li>
<li>é™¤äº† <code>ADD</code> å’Œ <code>COPY</code> æŒ‡ä»¤ä¹‹å¤–, ç¼“å­˜æ£€æŸ¥ä¸ä¼šæŸ¥çœ‹å®¹å™¨ä¸­çš„æ–‡ä»¶æ¥ç¡®å®šç¼“å­˜åŒ¹é…. ä¾‹å¦‚, åœ¨å¤„ç† <code>RUN apt-get -y update</code> å‘½ä»¤æ—¶, ä¸ä¼šæ£€æŸ¥å®¹å™¨ä¸­æ›´æ–°çš„æ–‡ä»¶ä»¥ç¡®å®šæ˜¯å¦å­˜åœ¨ç¼“å­˜å‘½ä¸­. åœ¨è¿™ç§æƒ…å†µä¸‹, åªæœ‰å‘½ä»¤å­—ç¬¦ä¸²æœ¬èº«ç”¨äºæŸ¥æ‰¾åŒ¹é…é¡¹</li>
</ul>
<p>ä¸€æ—¦ç¼“å­˜å¤±æ•ˆ, æ‰€æœ‰åç»­çš„ <code>Dockerfile</code> å‘½ä»¤éƒ½ä¼šç”Ÿæˆæ–°çš„é•œåƒå¹¶ä¸”ä¸ä¼šä½¿ç”¨ç¼“å­˜</p>
<h2 id="Dockerfile-instructions-Dockerfile-æŒ‡ä»¤"><a href="#Dockerfile-instructions-Dockerfile-æŒ‡ä»¤" class="headerlink" title="Dockerfile instructions (Dockerfile æŒ‡ä»¤)"></a>Dockerfile instructions (Dockerfile æŒ‡ä»¤)</h2><h3 id="FROM-FROM-æŒ‡ä»¤"><a href="#FROM-FROM-æŒ‡ä»¤" class="headerlink" title="FROM (FROM æŒ‡ä»¤)"></a>FROM (FROM æŒ‡ä»¤)</h3><p>å°½é‡ä½¿ç”¨æœ€æ–°çš„å®˜æ–¹é•œåƒä½œä¸ºä½ çš„é•œåƒçš„åŸºç¡€é•œåƒ</p>
<p>æ¨èä½¿ç”¨ <a class="link"   target="_blank" rel="noopener" href="https://hub.docker.com/_/alpine/" >Alpine<i class="fas fa-external-link-alt"></i></a> é•œåƒ, å› ä¸ºå®ƒå—åˆ°ä¸¥æ ¼æ§åˆ¶ä¸”ä½“ç§¯éå¸¸å° (å½“å‰å°äº 6 MB), åŒæ—¶ä»ç„¶æ˜¯ä¸€ä¸ªå®Œæ•´çš„ Linux å‘è¡Œç‰ˆ</p>
<h3 id="LABEL-LABEL-æŒ‡ä»¤"><a href="#LABEL-LABEL-æŒ‡ä»¤" class="headerlink" title="LABEL (LABEL æŒ‡ä»¤)"></a>LABEL (LABEL æŒ‡ä»¤)</h3><p>å¯ä»¥ä¸ºé•œåƒæ·»åŠ æ ‡ç­¾æ¥å¸®åŠ©é€šè¿‡é¡¹ç›®ç»„ç»‡é•œåƒ, è®°å½•æˆæƒä¿¡æ¯, å¸®åŠ©è‡ªåŠ¨åŒ–ç­‰ç­‰</p>
<p>å¯ä»¥æ·»åŠ å¤šä¸ª LABEL</p>
<p>åœ¨ Docker 1.10 å‰, æ¨èåªä½¿ç”¨ä¸€ä¸ª LABEL, è¿™æ˜¯ä¸ºäº†é˜²æ­¢æ¯ä¸ª LABEL ç”Ÿæˆä¸€ä¸ªé¢å¤–çš„å±‚</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Set one or more individual labels</span></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> com.example.version=<span class="string">&quot;0.0.1-beta&quot;</span></span></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> vendor1=<span class="string">&quot;ACME Incorporated&quot;</span></span></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> vendor2=ZENITH\ Incorporated</span></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> com.example.release-date=<span class="string">&quot;2015-02-12&quot;</span></span></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> com.example.version.is-production=<span class="string">&quot;&quot;</span></span></span><br></pre></td></tr></table></figure>

<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Set multiple labels on one line</span></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> com.example.version=<span class="string">&quot;0.0.1-beta&quot;</span> com.example.release-date=<span class="string">&quot;2015-02-12&quot;</span></span></span><br></pre></td></tr></table></figure>

<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Set multiple labels at once, using line-continuation characters to break long lines</span></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> vendor=ACME\ Incorporated \</span></span><br><span class="line"><span class="language-bash">      com.example.is-beta= \</span></span><br><span class="line"><span class="language-bash">      com.example.is-production=<span class="string">&quot;&quot;</span> \</span></span><br><span class="line"><span class="language-bash">      com.example.version=<span class="string">&quot;0.0.1-beta&quot;</span> \</span></span><br><span class="line"><span class="language-bash">      com.example.release-date=<span class="string">&quot;2015-02-12&quot;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="RUN-RUN-æŒ‡ä»¤"><a href="#RUN-RUN-æŒ‡ä»¤" class="headerlink" title="RUN (RUN æŒ‡ä»¤)"></a>RUN (RUN æŒ‡ä»¤)</h3><p>å°†é•¿æˆ–å¤æ‚çš„ <code>RUN</code> è¯­å¥æ‹†åˆ†ä¸ºç”¨åæ–œæ  <code>\</code> åˆ†éš”çš„å¤šè¡Œ, ä»¥ä½¿æ‚¨çš„ <code>Dockerfile</code> æ›´å…·å¯è¯»æ€§, å¯ç†è§£æ€§å’Œå¯ç»´æŠ¤æ€§</p>
<h4 id="apt-get"><a href="#apt-get" class="headerlink" title="apt-get"></a>apt-get</h4><p><code>RUN</code> æœ€å¸¸è§çš„ç”¨ä¾‹å¯èƒ½æ˜¯ <code>apt-get</code> çš„åº”ç”¨ç¨‹åº. å› ä¸ºç”¨å®ƒæ¥å®‰è£…è½¯ä»¶åŒ…ï¼Œæ‰€ä»¥ <code>RUN apt-get</code> å‘½ä»¤æœ‰å‡ ä¸ªéœ€è¦æ³¨æ„çš„é—®é¢˜</p>
<p>Example - æ€»æ˜¯åœ¨åŒä¸€ä¸ª <code>RUN</code> è¯­å¥ä¸­å°† <code>RUN apt-get update</code> å’Œ <code>apt-get install</code> ç»“åˆåœ¨ä¸€èµ·:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get upadte &amp;&amp; apt-get install -y \</span></span><br><span class="line"><span class="language-bash">    package-bar \</span></span><br><span class="line"><span class="language-bash">    package-baz \</span></span><br><span class="line"><span class="language-bash">    package-foo \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; <span class="built_in">rm</span> -rf /var/lib/apt/lists/*</span></span><br></pre></td></tr></table></figure>

<p><code>rm -rf /var/lib/apt/lists/*</code> å‘½ä»¤ç”¨æ¥æ¸…ç† apt ç¼“å­˜, å‡å°‘é•œåƒå¤§å°, å› ä¸º apt çš„ç¼“å­˜æ²¡æœ‰ä¿å­˜åœ¨ä¸€ä¸ªå±‚é‡Œé¢äº†</p>
<h4 id="Using-pipes-ä½¿ç”¨ç®¡é“"><a href="#Using-pipes-ä½¿ç”¨ç®¡é“" class="headerlink" title="Using pipes (ä½¿ç”¨ç®¡é“)"></a>Using pipes (ä½¿ç”¨ç®¡é“)</h4><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="language-bash"> wget -O - https://some.site | <span class="built_in">wc</span> -l &gt; /number</span></span><br></pre></td></tr></table></figure>

<p>Docker ä½¿ç”¨ <code>/bin/sh -c</code> ç¿»è¯‘å™¨æ¥æ‰§è¡Œè¿™äº›å‘½ä»¤, è¿™ä¸ªç¿»è¯‘å™¨åªä¼šè¯„ä¼°ç®¡é“ä¸­æœ€åä¸€ä¸ªæ“ä½œçš„é€€å‡ºç æ¥åˆ¤æ–­æ˜¯å¦æˆåŠŸ</p>
<p>ä¾‹å¦‚ä¸Šé¢çš„ä¾‹å­, å¦‚æœ <code>wc</code> å‘½ä»¤æˆåŠŸåˆ™è®¤ä¸ºæ„å»ºé˜¶æ®µæˆåŠŸå¹¶ç”Ÿæˆä¸€ä¸ªæ–°çš„é•œåƒ, å³ä½¿ <code>wget</code> å‘½ä»¤å¤±è´¥äº†</p>
<p>å¦‚æœä½ å¸Œæœ›å‘½ä»¤å› ä¸ºç®¡é“ä¸­çš„ä»»æ„é˜¶æ®µçš„é”™è¯¯è€Œå¤±è´¥, å‰ç½® <code>set -o pipefail &amp;&amp;</code> æ¥ç¡®ä¿æ„å¤–é”™è¯¯ä¸ä¼šå¯¼è‡´æ„å»ºæ— æ„ä¸­æˆåŠŸ:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">set</span> -o pipefail &amp;&amp; wget -O - https://some.site | <span class="built_in">wc</span> -l /number</span></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„: ä¸æ˜¯æ‰€æœ‰ shell éƒ½æ”¯æŒ <code>-o pipefail</code> é€‰é¡¹</p>
<p>è€ƒè™‘ä½¿ç”¨ <code>RUN</code> çš„ <code>exec</code> å½¢å¼æ¥æ˜ç¡®æŒ‡å®šä¸€ä¸ªæ”¯æŒ <code>pipefial</code> é€‰é¡¹çš„ shell:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="language-bash"> [<span class="string">&quot;/bin/bash&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;set -o pipefail &amp;&amp; wget -O - https://some.site | wc -l /number&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<h3 id="CMD-CMD-æŒ‡ä»¤"><a href="#CMD-CMD-æŒ‡ä»¤" class="headerlink" title="CMD (CMD æŒ‡ä»¤)"></a>CMD (CMD æŒ‡ä»¤)</h3><p><code>CMD</code> æŒ‡ä»¤åº”è¯¥ç”¨äºä½¿ç”¨ä»»ä½•å‚æ•°è¿è¡Œé•œåƒä¸­åŒ…å«çš„è½¯ä»¶</p>
<p><code>CMD</code> åº”è¯¥æ€»æ˜¯ä½¿ç”¨ <code>CMD [&quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot;...]</code> çš„å½¢å¼</p>
<p>å› æ­¤å¦‚æœé•œåƒæ˜¯ç”¨ä½œä¸€ä¸ªæœåŠ¡, ä¾‹å¦‚ Apache å’Œ Rails, å¯ä»¥åƒè¿™æ · <code>CMD [&quot;apache2&quot;, &quot;-DFOREGROUND&quot;]</code></p>
<p>äº‹å®ä¸Šï¼Œè¿™ç§å½¢å¼çš„æŒ‡ä»¤æ¨èç”¨äºä»»ä½•åŸºäºæœåŠ¡çš„é•œåƒ</p>
<p>åœ¨å¤§å¤šæƒ…å†µä¸‹, <code>CMD</code> åº”è¯¥ç»™å®šä¸€ä¸ªäº¤äº’å¼ shell, ä¾‹å¦‚ bash, python æˆ– perl</p>
<p>ä¾‹å¦‚, <code>CMD [&quot;perl&quot;, &quot;-de0&quot;]</code>, <code>CMD [&quot;python&quot;]</code>, <code>CMD [&quot;php&quot;, &quot;-a&quot;]</code></p>
<p>ä½¿ç”¨è¿™ç§å½¢å¼æ„å‘³ç€å½“ä½ æ‰§è¡Œ <code>docker run -ti python</code> æ—¶, ä½ ä¼šè¿›å…¥åˆ°ä¸€ä¸ªå¯ä½¿ç”¨çš„ shell ä¸­</p>
<p><code>CMD</code> åº”è¯¥æå°‘åœ°ä»¥ <code>CMD [&quot;param&quot;, &quot;param&quot;]</code> çš„æ–¹å¼ä¸ <code>ENTRYPOINT</code> ä¸€èµ·ä½¿ç”¨, é™¤éä½ å’Œä½ çš„é¢„æœŸç”¨æˆ·å·²ç»éå¸¸ç†Ÿæ‚‰ <code>ENTRYPOINT</code> çš„å·¥ä½œæ–¹å¼</p>
<h3 id="EXPOSE-EXPOSE-æŒ‡ä»¤"><a href="#EXPOSE-EXPOSE-æŒ‡ä»¤" class="headerlink" title="EXPOSE (EXPOSE æŒ‡ä»¤)"></a>EXPOSE (EXPOSE æŒ‡ä»¤)</h3><p><code>EXPOST</code> æŒ‡ä»¤æŒ‡æ˜å®¹å™¨åœ¨å“ªä¸ªç«¯å£ä¸Šç›‘å¬è¿æ¥</p>
<p>å› æ­¤, åº”è¯¥ä¸ºä½ çš„åº”ç”¨ç¨‹åºä½¿ç”¨é€šç”¨çš„ä¼ ç»Ÿçš„ç«¯å£</p>
<p>ä¾‹å¦‚, Apache web server åº”è¯¥ä½¿ç”¨ <code>EXPOSE 80</code>, MongoDB åº”è¯¥ä½¿ç”¨ <code>EXPOSE 27017</code></p>
<p>å¯¹äºå¤–éƒ¨è®¿é—®, ä½ çš„ç”¨æˆ·å¯ä»¥ä½¿ç”¨å¸¦æœ‰ä¸€ä¸ªæ ‡å¿—çš„ <code>docker run</code> å‘½ä»¤, è¿™ä¸ªæ ‡å¿—æŒ‡ç¤ºäº†æ€æ ·æ˜ å°„æŒ‡å®šç«¯å£åˆ°ä»–ä»¬é€‰æ‹©çš„ç«¯å£ä¸Š</p>
<p>å¯¹äºå®¹å™¨é“¾æ¥, Docker ä¸º ä» æ¥æ”¶å®¹å™¨ åˆ° æºå®¹å™¨çš„è·¯å¾„ æä¾›äº†ç¯å¢ƒå˜é‡ (ä¾‹å¦‚, <code>MYSQL_PORT_3306_TCP</code>)</p>
<h3 id="ENV-ENV-æŒ‡ä»¤"><a href="#ENV-ENV-æŒ‡ä»¤" class="headerlink" title="ENV (ENV æŒ‡ä»¤)"></a>ENV (ENV æŒ‡ä»¤)</h3><p>ä¸ºäº†è®©æ–°çš„è½¯ä»¶æ›´æ˜“äºä½¿ç”¨, ä½ å¯ä»¥ä½¿ç”¨ <code>ENV</code> æ¥ä¸ºä½ çš„å®¹å™¨ä¸­å®‰è£…çš„è½¯ä»¶æ›´æ–° <code>PATH</code> ç¯å¢ƒå˜é‡. ä¾‹å¦‚, <code>ENV PATH=/usr/local/nginx/bin:$PATH</code> ç¡®ä¿ <code>CMD [&quot;nginx&quot;]</code> æ­£å¸¸å·¥ä½œ</p>
<p><code>ENV</code> æŒ‡ä»¤è¿˜å¯ç”¨äºæä¾› ç‰¹å®šäºä½ æƒ³è¦å®¹å™¨åŒ–çš„æœåŠ¡ æ‰€éœ€çš„ ç¯å¢ƒå˜é‡, ä¾‹å¦‚ Postgres çš„ <code>PGDATA</code></p>
<p>æœ€å, <code>ENV</code> è¿˜å¯ä»¥ç”¨æ¥è®¾ç½®å¸¸ç”¨çš„ç‰ˆæœ¬å·, ä½¿ç‰ˆæœ¬å˜åŒ–æ›´å®¹æ˜“ç»´æŠ¤:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> PG_MAJOR=<span class="number">9.3</span></span><br><span class="line"><span class="keyword">ENV</span> PG_VERSION=<span class="number">9.3</span>.<span class="number">4</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> curl -SL https://example.com/postgres-<span class="variable">$PG_VERSION</span>.tar.xz | tar -xJC /usr/src/postgres &amp;&amp; ...</span></span><br><span class="line"><span class="keyword">ENV</span> PATH=/usr/local/postgres-$PG_MAJOR/bin:$PATH</span><br></pre></td></tr></table></figure>

<p>ç±»ä¼¼äºåœ¨ç¨‹åºä¸­çš„å¸¸é‡ (ä¸ç¡¬ç¼–ç å€¼ç›¸å), è¿™ç§æ–¹æ³•å…è®¸ä½ æ”¹å˜å•ä¸ª <code>ENV</code> æŒ‡ä»¤æ¥è‡ªåŠ¨ç¥å¥‡åœ°æå‡å®¹å™¨ä¸­è½¯ä»¶çš„ç‰ˆæœ¬</p>
<p>æ¯ä¸ª <code>ENV</code> è¡Œåˆ›å»ºä¸€ä¸ªæ–°çš„ä¸­é—´å±‚, å°±åƒ <code>RUN</code> å‘½ä»¤. è¿™æ„å‘³ç€å³ä½¿ä½ åœ¨åé¢çš„çš„å±‚ä¸­å–æ¶ˆ (unset) ç¯å¢ƒå˜é‡, è¿™ä¸ªç¯å¢ƒå˜é‡è¿˜ä¼šæŒä¹…åŒ–åœ¨è¿™ä¸ªå±‚ä¸­ä¸”å®ƒçš„å€¼å¯ä»¥è¢«è½¬å­˜ (dumped). ä½ å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ª Dockerfile å¹¶æ„å»ºå®ƒæ¥æµ‹è¯•ä¸€ä¸‹:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># syntax=docker/dockerfile:1</span></span><br><span class="line">FRO alpine</span><br><span class="line"><span class="keyword">ENV</span> ADMIN_USER=<span class="string">&quot;mark&quot;</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="variable">$ADMIN_USER</span> &gt; ./mark</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">unset</span> ADMIN_USER</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker run --<span class="built_in">rm</span> <span class="built_in">test</span> sh -c <span class="string">&#x27;echo $ADMIN_USER&#x27;</span></span><br><span class="line"></span><br><span class="line">mark</span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†é¿å…è¿™æ ·å¹¶çœŸæ­£åœ° unset ç¯å¢ƒå˜é‡, ä½¿ç”¨å¸¦æœ‰ shell å‘½ä»¤çš„ <code>RUN</code> å‘½ä»¤æ¥åœ¨å•ä¸ªå±‚ä¸­ set, use, unset è¿™ä¸ªå˜é‡</p>
<p>å¯ä»¥ä½¿ç”¨ <code>;</code> æˆ– <code>&amp;&amp;</code> æ¥åˆ†éš”ä½ çš„å‘½ä»¤. å¦‚æœä½¿ç”¨ <code>&amp;&amp;</code>, ä¸”ä»»ä½•ä¸€ä¸ªå‘½ä»¤å¤±è´¥, <code>docker build</code> ä¹Ÿä¼šè·Ÿç€å¤±è´¥. è¿™é€šå¸¸æ˜¯ä¸ªå¥½ä¸»æ„</p>
<p>ä½¿ç”¨ <code>\</code> ä½œä¸ºè¡ŒæŒç»­å­—ç¬¦æ¥ä¸º Linux Dockerfiles æé«˜å¯è¯»æ€§</p>
<p>ä½ ä¹Ÿå¯ä»¥å°†æ‰€æœ‰çš„å‘½ä»¤ä¿å­˜åˆ°ä¸€ä¸ª shell è„šæœ¬ä¸­, ç„¶åä½¿ç”¨ <code>RUN</code> å‘½ä»¤æ¥è¿è¡Œè¿™ä¸ª shell è„šæœ¬:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># syntax=docker/dockerfile:1</span></span><br><span class="line"><span class="keyword">FROM</span> alpine</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">export</span> ADMIN_USER=<span class="string">&quot;mark&quot;</span> \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; <span class="built_in">echo</span> <span class="variable">$ADMIN_USER</span> &gt; ./mark \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; <span class="built_in">unset</span> ADMIN_USER</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> sh</span></span><br></pre></td></tr></table></figure>

<h3 id="ADD-or-COPY-ADD-æˆ–-COPY-æŒ‡ä»¤"><a href="#ADD-or-COPY-ADD-æˆ–-COPY-æŒ‡ä»¤" class="headerlink" title="ADD or COPY (ADD æˆ– COPY æŒ‡ä»¤)"></a>ADD or COPY (ADD æˆ– COPY æŒ‡ä»¤)</h3><p>è™½ç„¶ <code>ADD</code> å’Œ <code>COPY</code> åŠŸèƒ½ç›¸ä¼¼, æ€»çš„æ¥è¯´, æ¨èä½¿ç”¨ <code>COPY</code></p>
<p>è¿™æ˜¯å› ä¸º <code>COPY</code> æ¯” <code>ADD</code> æ›´åŠ é€æ˜</p>
<p><code>COPY</code> <strong>åªæ”¯æŒåŸºç¡€çš„å°†æœ¬åœ°æ–‡ä»¶å¤åˆ¶åˆ°å®¹å™¨ä¸­</strong></p>
<p>ä½†æ˜¯ <code>ADD</code> è¿˜æœ‰ä¸€äº›ä¸æ˜¯å¾ˆæ˜æ˜¾çš„é¢å¤–çš„åŠŸèƒ½ (åƒæ˜¯ä»…é™æœ¬åœ°çš„ tar æ–‡ä»¶è§£å‹ç¼©å’Œè¿œç¨‹ URL è·å–)</p>
<p>å› æ­¤, <code>ADD</code> çš„æœ€ä½³ç”¨é€”æ˜¯å°†æœ¬åœ° tar æ–‡ä»¶è‡ªåŠ¨æå–åˆ°é•œåƒä¸­, ä¾‹å¦‚: <code>ADD rootfs.tar.xz /</code></p>
<p>å¦‚æœä½ æœ‰å¤šä¸ª <code>Dockerfile</code> æ­¥éª¤ä½¿ç”¨äº†æ¥è‡ªä½ çš„ä¸Šä¸‹æ–‡ä¸­çš„ä¸åŒæ–‡ä»¶, å•ç‹¬ <code>COPY</code> å®ƒä»¬, è€Œä¸æ˜¯ä¸€æ¬¡æ€§å…¨éƒ¨ <code>COPY</code>. è¿™ç¡®ä¿äº†æ¯ä¸ªæ­¥éª¤çš„æ„å»ºç¼“å­˜ä»…åœ¨ç‰¹å®šçš„éœ€è¦çš„æ–‡ä»¶å‘ç”Ÿæ”¹å˜æ—¶æ‰å¤±æ•ˆ (å¼ºåˆ¶é‡æ–°è¿è¡Œè¯¥æ­¥éª¤)</p>
<p>Example:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">COPY</span><span class="language-bash"> Requirements.txt /tmp/</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> pip install --requirement /tmp/requirements.txt</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . /tmp/</span></span><br></pre></td></tr></table></figure>

<p>ä¸å°† <code>COPY . /tmp/</code> æ”¾åœ¨å‰é¢ç›¸æ¯”, <code>RUN</code> æ­¥éª¤å¯¼è‡´çš„ç¼“å­˜å¤±æ•ˆæ›´å°‘. å› ä¸º <code>COPY . /tmp/</code> å°†æ›´å¤šçš„æ–‡ä»¶è¿›è¡Œäº†å¤åˆ¶</p>
<p>å› ä¸ºé•œåƒå¤§å°å¾ˆé‡è¦, æ‰€ä»¥å¼ºçƒˆå»ºè®®ä¸è¦ä½¿ç”¨ <code>ADD</code> ä»è¿œç¨‹ URLs è·å–åŒ…; åº”è¯¥æ”¹æˆä½¿ç”¨ <code>curl</code> æˆ– <code>wget</code></p>
<p>è¿™æ ·, å¯ä»¥åœ¨æå–æ–‡ä»¶ä¹‹ååˆ é™¤ä¸å†éœ€è¦çš„æ–‡ä»¶ä¸”ä¸å¿…åœ¨é•œåƒä¸­æ·»åŠ å¦å¤–ä¸€å±‚</p>
<p>Example - é¿å…è¿™æ ·åš:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ADD</span><span class="language-bash"> https://example.com/big.tar.xz /usr/src/things/</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> tar -xJf /usr/src/things/big.tar.xz -C /usr/src/things</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> make -C /usr/src/things all</span></span><br></pre></td></tr></table></figure>

<p>ç›¸ååœ°, è¦è¿™æ ·åš:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">mkdir</span> -p /usr/src/things \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; curl -SL https://example.com/big.tar.xz \</span></span><br><span class="line"><span class="language-bash">    | tar -xJC /usr/src/things \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; make -C /usr/src/things all</span></span><br></pre></td></tr></table></figure>

<p>å¯¹äºå…¶ä»–çš„ä¸éœ€è¦ä½¿ç”¨ <code>ADD</code> çš„è‡ªåŠ¨æŠ½å–åŠŸèƒ½çš„é¡¹ç›® (æ–‡ä»¶, ç›®å½•), åº”è¯¥æ€»æ˜¯ä½¿ç”¨ <code>COPY</code></p>
<h3 id="ENTRYPOINT-ENTRYPOINT-æŒ‡ä»¤"><a href="#ENTRYPOINT-ENTRYPOINT-æŒ‡ä»¤" class="headerlink" title="ENTRYPOINT (ENTRYPOINT æŒ‡ä»¤)"></a>ENTRYPOINT (ENTRYPOINT æŒ‡ä»¤)</h3><p><code>ENTRYPOINT</code> çš„æœ€ä½³ç”¨é€”æ˜¯è®¾ç½®é•œåƒçš„ä¸»å‘½ä»¤, ä½¿å¾—é•œåƒ åƒ è¯¥å‘½ä»¤ä¸€æ · è¿è¡Œ (ç„¶åä½¿ç”¨ <code>CMD</code> ä½œä¸ºé»˜è®¤æ ‡å¿—)</p>
<p>Example - ä½¿ç”¨ <code>s3cmd</code> å‘½ä»¤è¡Œå·¥å…·:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;s3cmd&quot;</span>]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;--help&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨é•œåƒå¯ä»¥åƒè¿™æ ·è¿è¡Œæ¥å±•ç¤ºå‘½ä»¤å¸®åŠ©ä¿¡æ¯: <code>$ docker run s3cmd</code></p>
<p>æˆ–è€…ä½¿ç”¨æ­£ç¡®çš„å‚æ•°æ¥æ‰§è¡Œå‘½ä»¤: <code>$ docker run s3cmd ls s3://mybucket</code></p>
<p>å¦‚åŒä¸Šé¢çš„å‘½ä»¤æ‰€ç¤ºçš„, è¿™éå¸¸æœ‰ç”¨, å› ä¸ºé•œåƒçš„åç§°å¯ä»¥å…¼ä½œå¯¹äºŒè¿›åˆ¶æ–‡ä»¶çš„å¼•ç”¨</p>
<p><code>ENTRYPOINT</code> æŒ‡ä»¤ä¹Ÿå¯ä»¥ä¸å¸®åŠ©è„šæœ¬ç»“åˆä½¿ç”¨, å…è®¸å®ƒä»¥ä¸ä¸Šè¿°å‘½ä»¤ç±»ä¼¼çš„æ–¹å¼è¿è¡Œ, å³ä½¿åœ¨å¯åŠ¨å·¥å…·æ—¶å¯èƒ½éœ€è¦å¤šä¸ªæ­¥éª¤</p>
<p>ä¾‹å¦‚, <a class="link"   target="_blank" rel="noopener" href="https://hub.docker.com/_/postgres/" >Postgres å®˜æ–¹é•œåƒ<i class="fas fa-external-link-alt"></i></a> ä½¿ç”¨å¦‚ä¸‹è„šæœ¬ä½œä¸ºå®ƒçš„ <code>ENTRYPOINT</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> = <span class="string">&#x27;postgres&#x27;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">chown</span> -R postgres <span class="string">&quot;<span class="variable">$PGDATA</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [ -z <span class="string">&quot;<span class="subst">$(ls -A <span class="string">&quot;<span class="variable">$PGDATA</span>&quot;</span>)</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        gosu postgres initdb</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">exec</span> gosu postgres <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå¸®åŠ©è„šæœ¬è¢«å¤åˆ¶åˆ°å®¹å™¨ä¸­, ä¸”åœ¨å®¹å™¨å¯åŠ¨æ—¶é€šè¿‡ <code>ENTRYPOINT</code> è¿è¡Œ:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./docker-entrypoint.sh /</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;/docker-entrypoint.sh&quot;</span>]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;postgres&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªè„šæœ¬å…è®¸ç”¨æˆ·ä»¥å¤šç§æ–¹å¼å’Œ Postgres è¿›è¡Œäº¤äº’</p>
<p>ç®€å•åœ°å¯åŠ¨ Postgres: <code>$ docker run postgres</code></p>
<p>è¿è¡Œ Postgres å¹¶ä¼ é€’å‚æ•°ç»™ server: <code>$ docker run postgres postgres --help</code></p>
<p>æœ€åå®ƒè¿˜å¯ä»¥ç”¨æ¥å¯åŠ¨ä¸€ä¸ªå®Œå…¨ä¸åŒçš„å·¥å…·, ä¾‹å¦‚: <code>$ docker run --rm -it postgres bash</code></p>
<h3 id="VOLUME-VOLUME-æŒ‡ä»¤"><a href="#VOLUME-VOLUME-æŒ‡ä»¤" class="headerlink" title="VOLUME (VOLUME æŒ‡ä»¤)"></a>VOLUME (VOLUME æŒ‡ä»¤)</h3><p><code>VOLUME</code> æŒ‡ä»¤åº”è¯¥ç”¨æ¥å…¬å¼€ä»»ä½•æ•°æ®åº“å­˜å‚¨åŒºåŸŸ, é…ç½®å­˜å‚¨æˆ–è€…ç”± docker å®¹å™¨åˆ›å»ºçš„æ–‡ä»¶&#x2F;æ–‡ä»¶å¤¹</p>
<p>å¼ºçƒˆå»ºè®®å°† <code>VOLUME</code> ç”¨äºé•œåƒçš„ä»»ä½• å¯å˜çš„ å’Œ&#x2F;æˆ– ç”¨æˆ·å¯ç»´æŠ¤çš„ éƒ¨åˆ†</p>
<h3 id="USER-USER-æŒ‡ä»¤"><a href="#USER-USER-æŒ‡ä»¤" class="headerlink" title="USER (USER æŒ‡ä»¤)"></a>USER (USER æŒ‡ä»¤)</h3><p>å¦‚æœä¸€ä¸ªæœåŠ¡å¯ä»¥ä¸éœ€è¦æƒé™æ¥è¿è¡Œ, ä½¿ç”¨ <code>USER</code> æ”¹æˆä¸€ä¸ªé root ç”¨æˆ·</p>
<p>é€šè¿‡åœ¨ <code>Dockerfile</code> ä¸­åˆ›å»ºç”¨æˆ·å’Œç”¨æˆ·ç»„æ¥å¼€å§‹, ä½¿ç”¨ç±»ä¼¼è¿™æ ·çš„æŒ‡ä»¤: <code>RUN groupadd -r postgres &amp;&amp; useradd --no-log-init -r -g postgres postgre</code></p>
<p>æ³¨æ„, è€ƒè™‘æ˜ç¡®çš„ UID&#x2F;GID: é•œåƒä¸­çš„ç”¨æˆ·å’Œç”¨æˆ·ç»„è¢«åˆ†é…äº†ä¸€ä¸ªä¸ç¡®å®šçš„ UID&#x2F;GID, å› ä¸ºæ— è®ºé•œåƒå¦‚ä½•é‡å»º, éƒ½ä¼šåˆ†é… â€œä¸‹ä¸€ä¸ªâ€ UID&#x2F;GID. æ‰€ä»¥, å¦‚æœå®ƒå¾ˆå…³é”®, åº”è¯¥åˆ†é…ä¸€ä¸ªæ˜¾ç¤ºçš„ UID&#x2F;GID</p>
<p>ç”±äº Go archive&#x2F;tar åŒ…çš„å¤„ç†ç¨€ç–æ–‡ä»¶çš„ä¸€ä¸ªæœªè§£å†³çš„ bug, å°è¯•åœ¨ Docker å®¹å™¨ä¸­åˆ›å»ºå…·æœ‰éå¸¸å¤§ UID çš„ç”¨æˆ·å¯èƒ½ä¼šå¯¼è‡´ç£ç›˜ç©ºé—´è€—å°½, å› ä¸ºå®¹å™¨å±‚ä¸­çš„ <code>/var/log/faillog</code> å·²å¡«å…… NULL (\0) å­—ç¬¦</p>
<p>ä¸€ç§è§£å†³æ–¹æ³•æ˜¯å°† <code>--no-log-init</code> æ ‡å¿—ä¼ é€’ç»™ useradd</p>
<p>Debian&#x2F;Ubuntu <code>adduser</code> åŒ…è£…å™¨ä¸æ”¯æŒè¿™ä¸ªæ ‡å¿—</p>
<p>é¿å…å®‰è£…æˆ–ä½¿ç”¨ <code>sudo</code>, å› ä¸ºå®ƒå…·æœ‰ä¸å¯é¢„æµ‹çš„ TTY å’Œå¯èƒ½å¯¼è‡´é—®é¢˜çš„ä¿¡å·è½¬å‘è¡Œä¸º. å¦‚æœä½ çœŸçš„éœ€è¦ç±»ä¼¼äº <code>sudo</code> çš„åŠŸèƒ½, ä¾‹å¦‚å°†å®ˆæŠ¤è¿›ç¨‹åˆå§‹åŒ–ä¸º <code>root</code> å½“ä»¥é <code>root</code> çš„èº«ä»½è¿è¡Œ, è¯·è€ƒè™‘ä½¿ç”¨ <code>gosu</code></p>
<p>æœ€å, ä¸ºäº†å‡å°‘å±‚å’Œå¤æ‚æ€§, é¿å…é¢‘ç¹åœ°æ¥å›åˆ‡æ¢ç”¨æˆ·</p>
<h3 id="WORKDIR-WORKDIR-æŒ‡ä»¤"><a href="#WORKDIR-WORKDIR-æŒ‡ä»¤" class="headerlink" title="WORKDIR (WORKDIR æŒ‡ä»¤)"></a>WORKDIR (WORKDIR æŒ‡ä»¤)</h3><p>ä¸ºäº†æ¸…æ™°æ€§å’Œå¯é æ€§, ä½ åº”è¯¥å§‹ç»ˆä¸ºä½ çš„ <code>WORKDIR</code> ä½¿ç”¨ç»å¯¹è·¯å¾„</p>
<p>æ­¤å¤–, ä½ åº”è¯¥ä½¿ç”¨ <code>WORKDIR</code> è€Œä¸æ˜¯åƒ <code>RUN cd ... &amp;&amp; do-something</code> ä¹‹ç±»çš„æŒ‡ä»¤, è¿™äº›æŒ‡ä»¤éš¾ä»¥é˜…è¯», æ•…éšœæ’é™¤å’Œç»´æŠ¤</p>
<h3 id="ONBUILD-ONBUILD-æŒ‡ä»¤"><a href="#ONBUILD-ONBUILD-æŒ‡ä»¤" class="headerlink" title="ONBUILD (ONBUILD æŒ‡ä»¤)"></a>ONBUILD (ONBUILD æŒ‡ä»¤)</h3><p>å½“å‰ <code>Dockerfile</code> æ„å»ºç»“æŸå, å°†æ‰§è¡Œ <code>ONBUILD</code> å‘½ä»¤</p>
<p><code>ONBUILD</code> åœ¨ ä»å½“å‰é•œåƒæ´¾ç”Ÿçš„ ä»»ä½•å­é•œåƒ ä¸­è¿è¡Œ</p>
<p>å°† <code>ONBUILD</code> å‘½ä»¤çœ‹ä½œ çˆ¶<code>Dockerfile</code> ä¼ é€’ç»™ å­<code>Dockerfile</code> çš„æŒ‡ä»¤</p>
<p>Docker æ„å»ºåœ¨ å­<code>Dockerfile</code> ä¸­çš„æ‰€æœ‰å‘½ä»¤ä¹‹å‰æ‰§è¡Œ <code>ONBUILD</code> å‘½ä»¤</p>
<p><code>ONBUILD</code> å¯¹äºé•œåƒå¾ˆæœ‰ç”¨, è¿™ä¸ªé•œåƒ <code>FROM</code> ä¸€ä¸ªç»™å®šé•œåƒä¸­æ„å»º. ä¾‹å¦‚, ä½ å¯ä»¥å°† <code>ONBUILD</code> ç”¨äºä¸€ä¸ªè¯­è¨€æ ˆé•œåƒ, è¿™ä¸ªé•œåƒåœ¨ <code>Dockerfile</code> ä¸­æ„å»ºä»¥è¯¥è¯­è¨€ç¼–å†™çš„ä»»æ„ç”¨æˆ·è½¯ä»¶, æ­£å¦‚ä½ åœ¨ <a target="_blank" rel="noopener" href="https://github.com/docker-library/ruby/blob/c43fef8a60cea31eb9e7d960a076d633cb62ba8d/2.4/jessie/onbuild/Dockerfile">Ruby çš„ <code>ONBUILD</code> å˜ä½“</a> ä¸­çœ‹åˆ°çš„</p>
<p>ä½¿ç”¨ <code>ONBUILD</code> æ„å»ºçš„é•œåƒè¦æœ‰ä¸€ä¸ªå•ç‹¬çš„æ ‡ç­¾, ä¾‹å¦‚: <code>ruby:1.9-onbuild</code> æˆ– <code>ruby:2.0-onbuild</code></p>
<p>å°† <code>ADD</code> æˆ– <code>COPY</code> æ·»åŠ åˆ° <code>ONBUILD</code> æ—¶è¦å°å¿ƒ. å¦‚æœæ–°æ„å»ºçš„ä¸Šä¸‹æ–‡ç¼ºå°‘è¦æ·»åŠ çš„èµ„æº, åˆ™ <code>ONBUILD</code> é•œåƒä¼šç¾éš¾æ€§åœ°å¤±è´¥. å¦‚ä¸Šæ‰€è¿°, æ·»åŠ ä¸€ä¸ªå•ç‹¬çš„æ ‡ç­¾æœ‰åŠ©äºè®© <code>Dockerfile</code> ä½œè€…åšå‡ºé€‰æ‹©æ¥ç¼“è§£è¿™ç§æƒ…å†µ</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/#leverage-build-cache" >Dockerfile best practices<i class="fas fa-external-link-alt"></i></a></p>

        </div>

        
            <div class="post-copyright-info">
                <div class="article-copyright-info-container">
    <ul>
        <li>æœ¬æ–‡æ ‡é¢˜ï¼šBest practices for writing Dockerfiles</li>
        <li>æœ¬æ–‡ä½œè€…ï¼šæ—å¨ç¾½</li>
        <li>åˆ›å»ºæ—¶é—´ï¼š2022-05-23 09:58:35</li>
        <li>
            æœ¬æ–‡é“¾æ¥ï¼šhttps://linweiyu21.github.io/docker/best-practices-for-writing-dockerfiles/
        </li>
        <li>
            ç‰ˆæƒå£°æ˜ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
        </li>
    </ul>
</div>

            </div>
        

        
            <ul class="post-tags-box">
                
                    <li class="tag-item">
                        <a href="/tags/Docker/">#Docker</a>&nbsp;
                    </li>
                
                    <li class="tag-item">
                        <a href="/tags/Notes/">#Notes</a>&nbsp;
                    </li>
                
            </ul>
        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/docker/compose/get-started-with-docker-compose/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Get started with Docker Compose</span>
                                <span class="post-nav-item">ä¸Šä¸€ç¯‡</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/docker/dockerfile-reference/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Dockerfile reference</span>
                                <span class="post-nav-item">ä¸‹ä¸€ç¯‡</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
            <div class="comment-container">
                <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        <i class="fas fa-comments">&nbsp;è¯„è®º</i>
    </div>
    

        
            
    <div class="valine-container">
        <script data-pjax
                src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script>
        <div id="vcomments"></div>
        <script data-pjax>
            function loadValine() {
                new Valine({
                    el: '#vcomments',
                    appId: '8xWQ0WFbKUNN4h8ixIO12etk-gzGzoHsz',
                    appKey: '7cLjTvkIsF6aIuIVSd0um89m',
                    meta: ['nick', 'mail', 'link'],
                    avatar: 'wavatar',
                    enableQQ: true,
                    placeholder: 'è¯·å¼€å§‹ä½ çš„è¡¨æ¼”',
                    lang: 'zh-CN'.toLowerCase()
                });

                function getAuthor(language) {
                    switch (language) {
                        case 'en':
                            return 'Author';
                        case 'zh-CN':
                            return 'åšä¸»';
                        default:
                            return 'Master';
                    }
                }

                // Add "Author" identify
                const getValineDomTimer = setInterval(() => {
                    const vcards = document.querySelectorAll('#vcomments .vcards .vcard');
                    if (vcards.length > 0) {
                        let author = 'æ—å¨ç¾½';

                        if (author) {
                            for (let vcard of vcards) {
                                const vnick_dom = vcard.querySelector('.vhead .vnick');
                                const vnick = vnick_dom.innerHTML;
                                if (vnick === author) {
                                    vnick_dom.innerHTML = `${vnick} <span class="author">${getAuthor(KEEP.hexo_config.language)}</span>`
                                }
                            }
                        }
                        clearInterval(getValineDomTimer);
                    } else {
                        clearInterval(getValineDomTimer);
                    }
                }, 2000);
            }

            if ('true') {
                const loadValineTimeout = setTimeout(() => {
                    loadValine();
                    clearTimeout(loadValineTimeout);
                }, 1000);
            } else {
                window.addEventListener('DOMContentLoaded', loadValine);
            }
        </script>
    </div>



        
    
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
            2022&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">æ—å¨ç¾½</a>
        </div>
        
            <script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        è®¿é—®äººæ•°&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
                    <span id="busuanzi_container_site_pv">
                        æ€»è®¿é—®é‡&nbsp;<span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            ç”± <a target="_blank" href="https://hexo.io">Hexo</a> é©±åŠ¨&nbsp;|&nbsp;ä¸»é¢˜&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.5</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fas fa-comment"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#General-guidelines-and-recommendations-%E4%B8%80%E8%88%AC%E5%87%86%E5%88%99%E5%92%8C%E5%BB%BA%E8%AE%AE"><span class="nav-number">1.</span> <span class="nav-text">General guidelines and recommendations (ä¸€èˆ¬å‡†åˆ™å’Œå»ºè®®)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Create-ephemeral-containers-%E5%88%9B%E5%BB%BA%E4%B8%B4%E6%97%B6%E5%AE%B9%E5%99%A8"><span class="nav-number">1.1.</span> <span class="nav-text">Create ephemeral containers (åˆ›å»ºä¸´æ—¶å®¹å™¨)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Understand-build-context-%E7%90%86%E8%A7%A3%E6%9E%84%E5%BB%BA%E4%B8%8A%E4%B8%8B%E6%96%87"><span class="nav-number">1.2.</span> <span class="nav-text">Understand build context (ç†è§£æ„å»ºä¸Šä¸‹æ–‡)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Pipe-Dockerfile-through-stdin-%E9%80%9A%E8%BF%87-stdin-%E7%AE%A1%E9%81%93%E5%8C%96-Dockerfile"><span class="nav-number">1.3.</span> <span class="nav-text">Pipe Dockerfile through stdin (é€šè¿‡ stdin ç®¡é“åŒ– Dockerfile)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Build-an-image-using-a-Dockerfile-from-stdin-without-sending-build-context-%E4%BD%BF%E7%94%A8%E6%9D%A5%E8%87%AA-stdin-%E7%9A%84-Dockerfile-%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F-%E4%B8%8D%E5%8F%91%E9%80%81%E6%9E%84%E5%BB%BA%E4%B8%8A%E4%B8%8B%E6%96%87"><span class="nav-number">1.3.1.</span> <span class="nav-text">Build an image using a Dockerfile from stdin, without sending build context (ä½¿ç”¨æ¥è‡ª stdin çš„ Dockerfile æ„å»ºé•œåƒ, ä¸å‘é€æ„å»ºä¸Šä¸‹æ–‡)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Build-from-a-local-build-context-using-a-Dockerfile-from-stdin-%E4%BB%8E%E6%9C%AC%E5%9C%B0%E6%9E%84%E5%BB%BA%E4%B8%8A%E4%B8%8B%E6%96%87%E8%BF%9B%E8%A1%8C%E6%9E%84%E5%BB%BA-%E4%BD%BF%E7%94%A8%E6%9D%A5%E8%87%AA-stdin-%E7%9A%84-Dockerfile"><span class="nav-number">1.3.2.</span> <span class="nav-text">Build from a local build context, using a Dockerfile from stdin (ä»æœ¬åœ°æ„å»ºä¸Šä¸‹æ–‡è¿›è¡Œæ„å»º, ä½¿ç”¨æ¥è‡ª stdin çš„ Dockerfile)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Build-from-a-remote-build-context-using-a-Dockerfile-from-stdin-%E4%BD%BF%E7%94%A8%E6%9D%A5%E8%87%AA-stdin-%E7%9A%84-Dockerfile-%E4%BB%8E%E4%B8%80%E4%B8%AA%E8%BF%9C%E7%A8%8B%E6%9E%84%E5%BB%BA%E4%B8%8A%E4%B8%8B%E6%96%87%E8%BF%9B%E8%A1%8C%E6%9E%84%E5%BB%BA"><span class="nav-number">1.3.3.</span> <span class="nav-text">Build from a remote build context, using a Dockerfile from stdin (ä½¿ç”¨æ¥è‡ª stdin çš„ Dockerfile, ä»ä¸€ä¸ªè¿œç¨‹æ„å»ºä¸Šä¸‹æ–‡è¿›è¡Œæ„å»º)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Exclude-with-dockerignore-%E4%BD%BF%E7%94%A8-dockerignore-%E8%BF%9B%E8%A1%8C%E6%8E%92%E9%99%A4"><span class="nav-number">1.4.</span> <span class="nav-text">Exclude with .dockerignore (ä½¿ç”¨ .dockerignore è¿›è¡Œæ’é™¤)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Use-multi-stage-builds-%E4%BD%BF%E7%94%A8%E5%A4%9A%E9%98%B6%E6%AE%B5%E6%9E%84%E5%BB%BA"><span class="nav-number">1.5.</span> <span class="nav-text">Use multi-stage builds (ä½¿ç”¨å¤šé˜¶æ®µæ„å»º)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Don%E2%80%99t-install-unnecessary-packages-%E4%B8%8D%E8%A6%81%E5%AE%89%E8%A3%85%E4%B8%8D%E5%BF%85%E8%A6%81%E7%9A%84%E5%8C%85"><span class="nav-number">1.6.</span> <span class="nav-text">Donâ€™t install unnecessary packages (ä¸è¦å®‰è£…ä¸å¿…è¦çš„åŒ…)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Decouple-applications-%E8%A7%A3%E8%80%A6%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="nav-number">1.7.</span> <span class="nav-text">Decouple applications (è§£è€¦åº”ç”¨ç¨‹åº)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Minimize-the-number-of-layers-%E6%9C%80%E5%B0%8F%E5%8C%96%E5%B1%82%E7%9A%84%E6%95%B0%E9%87%8F"><span class="nav-number">1.8.</span> <span class="nav-text">Minimize the number of layers (æœ€å°åŒ–å±‚çš„æ•°é‡)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Sort-multi-line-arguments-%E6%8E%92%E5%BA%8F%E5%A4%9A%E8%A1%8C%E5%8F%82%E6%95%B0"><span class="nav-number">1.9.</span> <span class="nav-text">Sort multi-line arguments (æ’åºå¤šè¡Œå‚æ•°)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Leverage-build-cache-%E5%88%A9%E7%94%A8%E6%9E%84%E5%BB%BA%E7%BC%93%E5%AD%98"><span class="nav-number">1.10.</span> <span class="nav-text">Leverage build cache (åˆ©ç”¨æ„å»ºç¼“å­˜)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dockerfile-instructions-Dockerfile-%E6%8C%87%E4%BB%A4"><span class="nav-number">2.</span> <span class="nav-text">Dockerfile instructions (Dockerfile æŒ‡ä»¤)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#FROM-FROM-%E6%8C%87%E4%BB%A4"><span class="nav-number">2.1.</span> <span class="nav-text">FROM (FROM æŒ‡ä»¤)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LABEL-LABEL-%E6%8C%87%E4%BB%A4"><span class="nav-number">2.2.</span> <span class="nav-text">LABEL (LABEL æŒ‡ä»¤)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RUN-RUN-%E6%8C%87%E4%BB%A4"><span class="nav-number">2.3.</span> <span class="nav-text">RUN (RUN æŒ‡ä»¤)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#apt-get"><span class="nav-number">2.3.1.</span> <span class="nav-text">apt-get</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Using-pipes-%E4%BD%BF%E7%94%A8%E7%AE%A1%E9%81%93"><span class="nav-number">2.3.2.</span> <span class="nav-text">Using pipes (ä½¿ç”¨ç®¡é“)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CMD-CMD-%E6%8C%87%E4%BB%A4"><span class="nav-number">2.4.</span> <span class="nav-text">CMD (CMD æŒ‡ä»¤)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#EXPOSE-EXPOSE-%E6%8C%87%E4%BB%A4"><span class="nav-number">2.5.</span> <span class="nav-text">EXPOSE (EXPOSE æŒ‡ä»¤)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ENV-ENV-%E6%8C%87%E4%BB%A4"><span class="nav-number">2.6.</span> <span class="nav-text">ENV (ENV æŒ‡ä»¤)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ADD-or-COPY-ADD-%E6%88%96-COPY-%E6%8C%87%E4%BB%A4"><span class="nav-number">2.7.</span> <span class="nav-text">ADD or COPY (ADD æˆ– COPY æŒ‡ä»¤)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ENTRYPOINT-ENTRYPOINT-%E6%8C%87%E4%BB%A4"><span class="nav-number">2.8.</span> <span class="nav-text">ENTRYPOINT (ENTRYPOINT æŒ‡ä»¤)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#VOLUME-VOLUME-%E6%8C%87%E4%BB%A4"><span class="nav-number">2.9.</span> <span class="nav-text">VOLUME (VOLUME æŒ‡ä»¤)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#USER-USER-%E6%8C%87%E4%BB%A4"><span class="nav-number">2.10.</span> <span class="nav-text">USER (USER æŒ‡ä»¤)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WORKDIR-WORKDIR-%E6%8C%87%E4%BB%A4"><span class="nav-number">2.11.</span> <span class="nav-text">WORKDIR (WORKDIR æŒ‡ä»¤)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ONBUILD-ONBUILD-%E6%8C%87%E4%BB%A4"><span class="nav-number">2.12.</span> <span class="nav-text">ONBUILD (ONBUILD æŒ‡ä»¤)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">3.</span> <span class="nav-text">å‚è€ƒ</span></a></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="æœç´¢..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>



<script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/dark-light-toggle.js"></script>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/local-search.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/code-copy.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/lazyload.js"></script>


<div class="post-scripts pjax">
    
        <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/left-side-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/libs/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/toc.js"></script>
    
</div>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/libs/pjax.min.js"></script>
<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>



</body>
</html>
