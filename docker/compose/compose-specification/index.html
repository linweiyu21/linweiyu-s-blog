<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Micronaut,Groovy,Gradle,Java,æ–‡æ¡£,ä¸­æ–‡">
    <meta name="description" content="Micronaut Groovy Gradle Java æ–‡æ¡£ ä¸­æ–‡">
    <meta name="author" content="æ—å¨ç¾½">
    
    <title>
        
            Compose specification |
        
        æ—å¨ç¾½çš„ç¬”è®°
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/logo.svg">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/css/font-awesome.min.css">
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"zh-CN","path":"search.json"};
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":true,"init_open":true},"style":{"primary_color":"rgb(153,153,0)","avatar":"/images/avatar.jpg","favicon":"/images/logo.svg","article_img_align":"left","left_side_width":"400px","content_max_width":"920px","hover":{"shadow":true,"scale":true},"first_screen":{"enable":true,"background_img":null,"description":"def containsğŸš€ = ['Micronaut', 'Groovy', 'Gradle', 'etc']"},"scroll":{"progress_bar":{"enable":true},"percent":{"enable":true}}},"local_search":{"enable":true,"preload":true},"code_copy":{"enable":true,"style":"mac"},"pjax":{"enable":true},"lazyload":{"enable":true},"version":"3.4.5"};
    KEEP.language_ago = {"second":"%s ç§’å‰","minute":"%s åˆ†é’Ÿå‰","hour":"%s å°æ—¶å‰","day":"%s å¤©å‰","week":"%s å‘¨å‰","month":"%s ä¸ªæœˆå‰","year":"%s å¹´å‰"};
  </script>
<meta name="generator" content="Hexo 6.1.0"></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fas fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                æ—å¨ç¾½çš„ç¬”è®°
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                é¦–é¡µ
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                åˆ†ç±»
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                æ ‡ç­¾
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                å½’æ¡£
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                å…³äº
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">é¦–é¡µ</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories">åˆ†ç±»</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags">æ ‡ç­¾</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">å½’æ¡£</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about">å…³äº</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

    <a target="_blank" rel="noopener" href="https://github.com/linweiyu21/" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80"
        viewBox="0 0 250 250" style="fill:#64CEAA; color:#fff; position: absolute; top: 0; border: 0; right: 0;"
        aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path
          d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
          fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path
          d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
          fill="currentColor" class="octo-body"></path>
      </svg></a>
    <style>
      .github-corner:hover .octo-arm {
        animation: octocat-wave 560ms ease-in-out
      }

      @keyframes octocat-wave {

        0%,
        100% {
          transform: rotate(0)
        }

        20%,
        60% {
          transform: rotate(-25deg)
        }

        40%,
        80% {
          transform: rotate(10deg)
        }
      }

      @media (max-width:500px) {
        .github-corner:hover .octo-arm {
          animation: none
        }

        .github-corner .octo-arm {
          animation: octocat-wave 560ms ease-in-out
        }
      }
    </style>
</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">Compose specification</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/avatar.jpg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">æ—å¨ç¾½</span>
                        
                            <span class="author-label">Lv8</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;
        <span class="pc">2022-05-25 11:01:57</span>
        <span class="mobile">2022-05-25 11:01</span>
    </span>
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/Docker-Compose/">Docker - Compose</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/Docker/">Docker</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/Notes/">Notes</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/Docker-Compose/">Docker Compose</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <!-- TOC -->

<ul>
<li><a href="#compose-file-compose-%E6%96%87%E4%BB%B6">Compose file (Compose æ–‡ä»¶)</a></li>
<li><a href="#profiles-%E9%85%8D%E7%BD%AE">Profiles (é…ç½®)</a><ul>
<li><a href="#illustrative-example-%E7%A4%BA%E4%BE%8B%E8%AF%B4%E6%98%8E">Illustrative example (ç¤ºä¾‹è¯´æ˜)</a></li>
</ul>
</li>
<li><a href="#version-top-level-element-%E9%A1%B6%E7%BA%A7%E5%85%83%E7%B4%A0-version">Version top-level element (é¡¶çº§å…ƒç´  <code>version</code>)</a></li>
<li><a href="#name-top-level-element-%E9%A1%B6%E7%BA%A7%E5%85%83%E7%B4%A0-name">Name top-level element (é¡¶çº§å…ƒç´  <code>name</code>)</a></li>
<li><a href="#services-top-level-element-%E9%A1%B6%E7%BA%A7%E5%85%83%E7%B4%A0-services">Services top-level element (é¡¶çº§å…ƒç´  <code>services</code>)</a><ul>
<li><a href="#build">build</a></li>
<li><a href="#blkio_config">blkio_config</a></li>
<li><a href="#cpu_count">cpu_count</a></li>
<li><a href="#cpu_percent">cpu_percent</a></li>
<li><a href="#cpu_shares">cpu_shares</a></li>
<li><a href="#cpu_period">cpu_period</a></li>
<li><a href="#cpu_quota">cpu_quota</a></li>
<li><a href="#cpu_rt_runtime">cpu_rt_runtime</a></li>
<li><a href="#cpu_rt_period">cpu_rt_period</a></li>
<li><a href="#cpus">cpus</a></li>
<li><a href="#cpuset">cpuset</a></li>
<li><a href="#cap_add">cap_add</a></li>
<li><a href="#cap_drop">cap_drop</a></li>
<li><a href="#cgroup_parent">cgroup_parent</a></li>
<li><a href="#command">command</a></li>
<li><a href="#configs">configs</a><ul>
<li><a href="#short-syntax">Short syntax</a></li>
<li><a href="#long-syntax">Long syntax</a></li>
</ul>
</li>
<li><a href="#container_name">container_name</a></li>
<li><a href="#credential_spec">credential_spec</a><ul>
<li><a href="#example-gmsa-configuration">Example gMSA configuration</a></li>
</ul>
</li>
<li><a href="#depends_on">depends_on</a><ul>
<li><a href="#short-syntax-1">Short syntax</a></li>
<li><a href="#long-syntax-1">Long syntax</a></li>
</ul>
</li>
<li><a href="#deploy">deploy</a></li>
<li><a href="#device_cgroup_rules">device_cgroup_rules</a></li>
<li><a href="#devices">devices</a></li>
<li><a href="#dns">dns</a></li>
<li><a href="#dns_opt">dns_opt</a></li>
<li><a href="#dns_search">dns_search</a></li>
<li><a href="#domainname">domainname</a></li>
<li><a href="#entrypoint">entrypoint</a></li>
<li><a href="#env_file">env_file</a><ul>
<li><a href="#env_file-format">Env_file format</a></li>
</ul>
</li>
<li><a href="#environment">environment</a></li>
<li><a href="#expose">expose</a></li>
<li><a href="#extends">extends</a><ul>
<li><a href="#restrictions">Restrictions</a></li>
<li><a href="#finding-referenced-service">Finding referenced service</a></li>
<li><a href="#merging-service-definitions">Merging service definitions</a><ul>
<li><a href="#mappings">Mappings</a></li>
<li><a href="#sequences">Sequences</a></li>
<li><a href="#scalars">Scalars</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#external_links">external_links</a></li>
<li><a href="#extra_hosts">extra_hosts</a></li>
<li><a href="#group_add">group_add</a></li>
<li><a href="#healthcheck">healthcheck</a></li>
<li><a href="#hostname">hostname</a></li>
<li><a href="#image">image</a></li>
<li><a href="#init">init</a></li>
<li><a href="#ipc">ipc</a></li>
<li><a href="#isolation">isolation</a></li>
<li><a href="#labels">labels</a></li>
<li><a href="#links">links</a></li>
<li><a href="#logging">logging</a></li>
<li><a href="#network_mode">network_mode</a></li>
<li><a href="#networks">networks</a><ul>
<li><a href="#aliases">aliases</a></li>
<li><a href="#ipv4_address-ipv6_address">ipv4_address, ipv6_address</a></li>
<li><a href="#link_local_ips">link_local_ips</a></li>
<li><a href="#priority">priority</a></li>
</ul>
</li>
<li><a href="#mac_address">mac_address</a></li>
<li><a href="#mem_limit">mem_limit</a></li>
<li><a href="#mem_reservation">mem_reservation</a></li>
<li><a href="#mem_swappiness">mem_swappiness</a></li>
<li><a href="#memswap_limit">memswap_limit</a></li>
<li><a href="#oom_kill_disable">oom_kill_disable</a></li>
<li><a href="#oom_score_adj">oom_score_adj</a></li>
<li><a href="#pid">pid</a></li>
<li><a href="#pids_limit">pids_limit</a></li>
<li><a href="#platform">platform</a></li>
<li><a href="#ports">ports</a><ul>
<li><a href="#short-syntax-2">Short syntax</a></li>
<li><a href="#long-syntax-2">Long syntax</a></li>
</ul>
</li>
<li><a href="#privileged">privileged</a></li>
<li><a href="#profiles">profiles</a></li>
<li><a href="#pull_policy">pull_policy</a></li>
<li><a href="#read_only">read_only</a></li>
<li><a href="#restart">restart</a></li>
<li><a href="#runtime">runtime</a></li>
<li><a href="#scale">scale</a></li>
<li><a href="#secrets">secrets</a><ul>
<li><a href="#short-syntax-3">Short syntax</a></li>
<li><a href="#long-syntax-3">Long syntax</a></li>
</ul>
</li>
<li><a href="#security_opt">security_opt</a></li>
<li><a href="#shm_size">shm_size</a></li>
<li><a href="#stdin_open">stdin_open</a></li>
<li><a href="#stop_grace_period">stop_grace_period</a></li>
<li><a href="#stop_signal">stop_signal</a></li>
<li><a href="#storage_opt">storage_opt</a></li>
<li><a href="#sysctls">sysctls</a></li>
<li><a href="#tmpfs">tmpfs</a></li>
<li><a href="#tty">tty</a></li>
<li><a href="#ulimits">ulimits</a></li>
<li><a href="#user">user</a></li>
<li><a href="#userns_mode">userns_mode</a></li>
<li><a href="#volumes">volumes</a><ul>
<li><a href="#short-syntax-4">Short syntax</a></li>
<li><a href="#long-syntax-4">Long syntax</a></li>
</ul>
</li>
<li><a href="#volumes_from">volumes_from</a></li>
<li><a href="#working_dir">working_dir</a></li>
</ul>
</li>
<li><a href="#networks-top-level-element-%E9%A1%B6%E7%BA%A7%E5%85%83%E7%B4%A0-networks">Networks top-level element (é¡¶çº§å…ƒç´  <code>networks</code>)</a><ul>
<li><a href="#driver">driver</a><ul>
<li><a href="#host-or-none">host or none</a></li>
</ul>
</li>
<li><a href="#driver_opts">driver_opts</a></li>
<li><a href="#attachable">attachable</a></li>
<li><a href="#enable_ipv6">enable_ipv6</a></li>
<li><a href="#ipma">ipma</a></li>
<li><a href="#internal">internal</a></li>
<li><a href="#labels-1">labels</a></li>
<li><a href="#external">external</a></li>
<li><a href="#name">name</a></li>
</ul>
</li>
<li><a href="#volumes-top-level-element-%E9%A1%B6%E7%BA%A7%E5%85%83%E7%B4%A0-volumes">Volumes top-level element (é¡¶çº§å…ƒç´  <code>volumes</code>)</a><ul>
<li><a href="#driver-1">driver</a></li>
<li><a href="#driver_opts-1">driver_opts</a></li>
<li><a href="#external-1">external</a></li>
<li><a href="#labels-2">labels</a></li>
<li><a href="#name-1">name</a></li>
</ul>
</li>
<li><a href="#configs-top-level-element-%E9%A1%B6%E7%BA%A7%E5%85%83%E7%B4%A0-configs">Configs top-level element (é¡¶çº§å…ƒç´  <code>configs</code>)</a></li>
<li><a href="#secrets-top-level-element-%E9%A1%B6%E7%BA%A7%E5%85%83%E7%B4%A0-secrets">Secrets top-level element (é¡¶çº§å…ƒç´  <code>secrets</code>)</a></li>
<li><a href="#fragments-%E5%88%86%E6%AE%B5">Fragments (åˆ†æ®µ)</a></li>
<li><a href="#extension-%E6%89%A9%E5%B1%95">Extension (æ‰©å±•)</a><ul>
<li><a href="#informative-historical-notes">Informative Historical Notes</a></li>
<li><a href="#using-extensions-as-fragments">Using extensions as fragments</a></li>
<li><a href="#specifying-byte-values">specifying byte values</a></li>
<li><a href="#specifying-durations">specifying durations</a></li>
</ul>
</li>
<li><a href="#interpolation-%E6%8F%92%E5%80%BC">Interpolation (æ’å€¼)</a></li>
<li><a href="#%E5%8F%82%E8%80%83">å‚è€ƒ</a></li>
</ul>
<!-- /TOC -->

<p>Compose æ–‡ä»¶æ˜¯ä¸€ä¸ªä¸º Docker åº”ç”¨ç¨‹åºå®šä¹‰æœåŠ¡, ç½‘ç»œå’Œå·çš„ YAML æ–‡ä»¶</p>
<p>åªæœ‰ <code>volumes</code> å¯ä»¥é…ç½®ä¸ºè¯»å†™è®¿é—®. <code>secrets</code> å’Œ <code>configs</code> éƒ½æ˜¯åªè¯»çš„</p>
<p><code>secrets</code> å’Œ <code>configs</code> å¯ä»¥ä½¿ç”¨ <code>external: true</code> æ¥å£°æ˜å®ƒä»¬ä¸æ˜¯ä½œä¸ºåº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸçš„ä¸€éƒ¨åˆ†æ¥ç®¡ç†çš„</p>
<h2 id="Compose-file-Compose-æ–‡ä»¶"><a href="#Compose-file-Compose-æ–‡ä»¶" class="headerlink" title="Compose file (Compose æ–‡ä»¶)"></a>Compose file (Compose æ–‡ä»¶)</h2><p>Compose file æ˜¯ä¸€ä¸ªå®šä¹‰ <a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/#version-top-level-element" >version<i class="fas fa-external-link-alt"></i></a>(å·²å¼ƒç”¨),<a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/#services-top-level-element" >services<i class="fas fa-external-link-alt"></i></a>(å¿…é€‰),<a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/#networks-top-level-element" >networks<i class="fas fa-external-link-alt"></i></a>,<a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/#volumes-top-level-element" >volumes<i class="fas fa-external-link-alt"></i></a>,<a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/#configs-top-level-element" >configs<i class="fas fa-external-link-alt"></i></a>å’Œ<a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/#secrets-top-level-element" >secrets<i class="fas fa-external-link-alt"></i></a> çš„ YAML æ–‡ä»¶</p>
<p>åœ¨å·¥ä½œç›®å½•ä¸­, Compose æ–‡ä»¶çš„é»˜è®¤è·¯å¾„æ˜¯ <code>compose.yaml</code>(æ¨è) æˆ– <code>compose.yml</code></p>
<p>ä¸ºäº†å‘åå…¼å®¹, Compose å®ç°è¦æ”¯æŒ <code>docker-compose.yaml</code> å’Œ <code>docker-compose.yml</code></p>
<p>å¦‚æœä¸¤ç§æ–‡ä»¶éƒ½å­˜åœ¨, ä¼˜å…ˆä½¿ç”¨ <code>compose.yaml</code></p>
<p>å¤šä¸ª Compose æ–‡ä»¶å¯ä»¥ç»“åˆåœ¨ä¸€èµ·æ¥å®šä¹‰åº”ç”¨ç¨‹åºæ¨¡å‹</p>
<h2 id="Profiles-é…ç½®"><a href="#Profiles-é…ç½®" class="headerlink" title="Profiles (é…ç½®)"></a>Profiles (é…ç½®)</h2><p>Profiles å…è®¸ä¸ºå¤šç§ç”¨é€”å’Œå¤šç§ç¯å¢ƒè°ƒæ•´ Compose åº”ç”¨æ¨¡å‹</p>
<p>é¡¶çº§å…ƒç´  services æ”¯æŒ <code>profiles</code> å±æ€§æ¥å®šä¹‰ä¸€ä¸ªå‘½åçš„ profiles åˆ—è¡¨</p>
<p>å¦‚æœæ²¡æœ‰ä¸åˆ—è¡¨ä¸­ä»»ä½•ä¸€ä¸ª <code>profiles</code> åŒ¹é…, é‚£ä¹ˆä¸€ä¸ª service å¿…é¡»è¢« Compose å®ç°å¿½ç•¥, é™¤éè¿™ä¸ª service åœ¨å‘½ä»¤ä¸­æ˜ç¡®æŒ‡å®šäº†</p>
<p>å…¶ä»–æ‰€æœ‰é¡¶çº§å…ƒç´ ä¸å— <code>profiles</code> å½±å“ä¸”æ€»æ˜¯æ¿€æ´»çš„</p>
<h3 id="Illustrative-example-ç¤ºä¾‹è¯´æ˜"><a href="#Illustrative-example-ç¤ºä¾‹è¯´æ˜" class="headerlink" title="Illustrative example (ç¤ºä¾‹è¯´æ˜)"></a>Illustrative example (ç¤ºä¾‹è¯´æ˜)</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">foo:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">foo</span></span><br><span class="line">  <span class="attr">bar:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">bar</span></span><br><span class="line">    <span class="attr">profiles:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">test</span></span><br><span class="line">  <span class="attr">baz:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">baz</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">bar</span></span><br><span class="line">    <span class="attr">profiles:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">test</span></span><br><span class="line">  <span class="attr">zot:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">zot</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">bar</span></span><br><span class="line">    <span class="attr">profiles:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">debug</span></span><br></pre></td></tr></table></figure>

<h2 id="Version-top-level-element-é¡¶çº§å…ƒç´ -version"><a href="#Version-top-level-element-é¡¶çº§å…ƒç´ -version" class="headerlink" title="Version top-level element (é¡¶çº§å…ƒç´  version)"></a>Version top-level element (é¡¶çº§å…ƒç´  <code>version</code>)</h2><p>é¡¶çº§å±æ€§ <code>version</code> ç”±è§„èŒƒå®šä¹‰, ç”¨äºå‘åå…¼å®¹, ä»…æä¾›ä¿¡æ¯</p>
<h2 id="Name-top-level-element-é¡¶çº§å…ƒç´ -name"><a href="#Name-top-level-element-é¡¶çº§å…ƒç´ -name" class="headerlink" title="Name top-level element (é¡¶çº§å…ƒç´  name)"></a>Name top-level element (é¡¶çº§å…ƒç´  <code>name</code>)</h2><p>é¡¶çº§å±æ€§ <code>name</code> å±æ€§ç”±è§„èŒƒå®šä¹‰, å¦‚æœç”¨æˆ·æ²¡æœ‰æŒ‡å®šæ˜ç¡®çš„åç§°, åˆ™ä½œä¸ºé¡¹ç›®åç§°</p>
<p>æ— è®ºæ˜¯å¦é€šè¿‡ <code>name</code> è®¾ç½®äº†é¡¹ç›®åç§°, å®ƒå¿…é¡»è¦æš´éœ²ç»™æ’å€¼æœºåˆ¶ä¸”å¯ä»¥ä½œä¸ºç¯å¢ƒå˜é‡ <code>COMPOSE_PROJECT_NAME</code> è¿›è¡Œè§£æ</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">foo:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">COMPOSE_PROJECT_NAME</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">echo</span> <span class="string">&quot;I&#x27;m running $&#123;COMPOSE_PROJECT_NAME&#125;&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="Services-top-level-element-é¡¶çº§å…ƒç´ -services"><a href="#Services-top-level-element-é¡¶çº§å…ƒç´ -services" class="headerlink" title="Services top-level element (é¡¶çº§å…ƒç´  services)"></a>Services top-level element (é¡¶çº§å…ƒç´  <code>services</code>)</h2><p><code>service</code> æ˜¯åº”ç”¨ç¨‹åºä¸­è®¡ç®—èµ„æºçš„æŠ½è±¡å®šä¹‰, å¯ä»¥ç‹¬ç«‹äºå…¶ä»–ç»„ä»¶è¿›è¡Œæ‰©å±•&#x2F;æ›¿æ¢</p>
<p>ä¸€ä¸ª Compose æ–‡ä»¶å¿…é¡»å£°æ˜ä¸€ä¸ªæ ¹å…ƒç´  <code>services</code> ä½œä¸ºä¸€ä¸ª map, è¿™ä¸ª map çš„ keys éƒ½æ˜¯ä»£è¡¨ <code>service</code> åç§°çš„å­—ç¬¦ä¸², values æ˜¯ <code>service</code> å®šä¹‰</p>
<p><code>service</code> å®šä¹‰åŒ…å«åº”ç”¨äºä¸ºè¯¥ <code>service</code> å¯åŠ¨çš„æ¯ä¸ªå®¹å™¨çš„é…ç½®</p>
<p>æ¯ä¸ª <code>service</code> åº”è¯¥è¿˜è¦åŒ…å«ä¸€ä¸ªæ„å»ºéƒ¨åˆ†, è¿™ä¸ªæ„ä»¶éƒ¨åˆ†å®šä¹‰äº†æ€æ ·ä¸º <code>service</code> åˆ›å»º Docker é•œåƒ</p>
<p>æ¯ä¸ª <code>service</code> å®šä¹‰è¿è¡Œæ—¶çº¦æŸå’Œè¦æ±‚æ¥è¿è¡Œå…¶å®¹å™¨. <code>deploy</code> éƒ¨åˆ†å¯¹è¿™äº›çº¦æŸè¿›è¡Œåˆ†ç»„, å¹¶å…è®¸å¹³å°è°ƒæ•´éƒ¨ç½²ç­–ç•¥ä»¥æœ€ä½³åŒ¹é…å®¹å™¨çš„éœ€æ±‚å’Œå¯ç”¨èµ„æº</p>
<h3 id="build"><a href="#build" class="headerlink" title="build"></a>build</h3><p><code>build</code> æŒ‡å®šç”¨äºä»æºåˆ›å»ºå®¹å™¨é•œåƒçš„æ„å»ºé…ç½®, æ­£å¦‚ <a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/build/" >Build support<i class="fas fa-external-link-alt"></i></a> æ–‡æ¡£ä¸­çš„å®šä¹‰</p>
<h3 id="blkio-config"><a href="#blkio-config" class="headerlink" title="blkio_config"></a>blkio_config</h3><p><code>blkio_config</code> å®šä¹‰äº†ä¸€ç»„é…ç½®é€‰é¡¹æ¥ä¸º <code>service</code> è®¾ç½®é˜»å¡ IO é™åˆ¶</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">foo:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">blkio_config:</span></span><br><span class="line">      <span class="attr">weight:</span> <span class="number">300</span></span><br><span class="line">      <span class="attr">weight_device:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/dev/sda</span></span><br><span class="line">          <span class="attr">weight:</span> <span class="number">400</span></span><br><span class="line">      <span class="attr">device_read_bps:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/dev/sdb</span></span><br><span class="line">          <span class="attr">rate:</span> <span class="string">&#x27;12mb&#x27;</span></span><br><span class="line">      <span class="attr">device_read_iops:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/dev/sdb</span></span><br><span class="line">          <span class="attr">rate:</span> <span class="number">120</span></span><br><span class="line">      <span class="attr">device_write_bps:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/dev/sdb</span></span><br><span class="line">          <span class="attr">rate:</span> <span class="string">&#x27;1024k&#x27;</span></span><br><span class="line">      <span class="attr">device_write_iops:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/dev/sdb</span></span><br><span class="line">          <span class="attr">rate:</span> <span class="number">30</span></span><br></pre></td></tr></table></figure>

<p>æ”¯æŒå¦‚ä¸‹é…ç½®é¡¹:</p>
<ul>
<li><code>device_read_bps</code>, <code>device_write_bps</code></li>
<li><code>device_read_iops</code>, <code>device_write_iops</code></li>
<li><code>weight</code></li>
<li><code>weight_device</code></li>
</ul>
<h3 id="cpu-count"><a href="#cpu-count" class="headerlink" title="cpu_count"></a>cpu_count</h3><p>å®šä¹‰æœåŠ¡å®¹å™¨çš„å¯ç”¨ CPU æ•°é‡</p>
<h3 id="cpu-percent"><a href="#cpu-percent" class="headerlink" title="cpu_percent"></a>cpu_percent</h3><p>å®šä¹‰å¯ç”¨ CPU çš„å¯ç”¨ç™¾åˆ†æ¯”</p>
<h3 id="cpu-shares"><a href="#cpu-shares" class="headerlink" title="cpu_shares"></a>cpu_shares</h3><p>å®šä¹‰ï¼ˆä½œä¸ºæ•´æ•°å€¼ï¼‰æœåŠ¡å®¹å™¨ç›¸å¯¹äºå…¶ä»–å®¹å™¨çš„ CPU æƒé‡</p>
<h3 id="cpu-period"><a href="#cpu-period" class="headerlink" title="cpu_period"></a>cpu_period</h3><p>å½“å¹³å°åŸºäº Linux å†…æ ¸æ—¶ï¼Œå…è®¸ Compose å®ç°é…ç½® CPU CFSï¼ˆå®Œå…¨å…¬å¹³è°ƒåº¦å™¨ï¼‰å‘¨æœŸ</p>
<h3 id="cpu-quota"><a href="#cpu-quota" class="headerlink" title="cpu_quota"></a>cpu_quota</h3><p>å½“å¹³å°åŸºäº Linux å†…æ ¸æ—¶ï¼Œå…è®¸ Compose å®ç°é…ç½® CPU CFSï¼ˆå®Œå…¨å…¬å¹³è°ƒåº¦å™¨ï¼‰é…é¢</p>
<h3 id="cpu-rt-runtime"><a href="#cpu-rt-runtime" class="headerlink" title="cpu_rt_runtime"></a>cpu_rt_runtime</h3><p>ä¸ºæ”¯æŒå®æ—¶è°ƒåº¦ç¨‹åºçš„å¹³å°é…ç½® CPU åˆ†é…å‚æ•°ã€‚ å¯ä»¥æ˜¯ä½¿ç”¨å¾®ç§’ä¸ºå•ä½çš„æ•´æ•°å€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯<a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/#specifying-durations" >æŒç»­æ—¶é—´<i class="fas fa-external-link-alt"></i></a></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cpu_rt_runtime:</span> <span class="string">&#x27;400ms&#x27;</span></span><br><span class="line"><span class="attr">cpu_rt_runtime:</span> <span class="number">95000</span></span><br></pre></td></tr></table></figure>

<h3 id="cpu-rt-period"><a href="#cpu-rt-period" class="headerlink" title="cpu_rt_period"></a>cpu_rt_period</h3><p>ä¸ºæ”¯æŒå®æ—¶è°ƒåº¦ç¨‹åºçš„å¹³å°é…ç½® CPU åˆ†é…å‚æ•°ã€‚ å¯ä»¥æ˜¯ä½¿ç”¨å¾®ç§’ä¸ºå•ä½çš„æ•´æ•°å€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯<a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/#specifying-durations" >æŒç»­æ—¶é—´<i class="fas fa-external-link-alt"></i></a></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cpu_rt_peroid:</span> <span class="string">&#x27;1400us&#x27;</span></span><br><span class="line"><span class="attr">cpu_rt_peroid:</span> <span class="number">11000</span></span><br></pre></td></tr></table></figure>

<h3 id="cpus"><a href="#cpus" class="headerlink" title="cpus"></a>cpus</h3><p>å·²åºŸå¼ƒ. ä½¿ç”¨ <a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/deploy/#cpus" >deploy.reservations.cpus<i class="fas fa-external-link-alt"></i></a></p>
<h3 id="cpuset"><a href="#cpuset" class="headerlink" title="cpuset"></a>cpuset</h3><p>å®šä¹‰å…è®¸æ‰§è¡Œçš„æŒ‡å®š CPUã€‚ å¯ä»¥æ˜¯èŒƒå›´ 0-3 æˆ–åˆ—è¡¨ 0,1</p>
<h3 id="cap-add"><a href="#cap-add" class="headerlink" title="cap_add"></a>cap_add</h3><p>å°†å…¶ä»–å®¹å™¨<a class="link"   target="_blank" rel="noopener" href="http://man7.org/linux/man-pages/man7/capabilities.7.html" >åŠŸèƒ½<i class="fas fa-external-link-alt"></i></a>æŒ‡å®šä¸ºå­—ç¬¦ä¸²</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cap_add:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ALL</span></span><br></pre></td></tr></table></figure>

<h3 id="cap-drop"><a href="#cap-drop" class="headerlink" title="cap_drop"></a>cap_drop</h3><p>æŒ‡å®šè¦ä½œä¸ºå­—ç¬¦ä¸²åˆ é™¤çš„å®¹å™¨<a class="link"   target="_blank" rel="noopener" href="http://man7.org/linux/man-pages/man7/capabilities.7.html" >åŠŸèƒ½<i class="fas fa-external-link-alt"></i></a></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cap_drop:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">NET_ADMIN</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">SYS_ADMIN</span></span><br></pre></td></tr></table></figure>

<h3 id="cgroup-parent"><a href="#cgroup-parent" class="headerlink" title="cgroup_parent"></a>cgroup_parent</h3><p>ä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªå¯é€‰çš„çˆ¶ <a class="link"   target="_blank" rel="noopener" href="http://man7.org/linux/man-pages/man7/cgroups.7.html" >cgroup<i class="fas fa-external-link-alt"></i></a></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cgroup_parent:</span> <span class="string">m-executor-abcd</span></span><br></pre></td></tr></table></figure>

<h3 id="command"><a href="#command" class="headerlink" title="command"></a>command</h3><p>è¦†ç›–å®¹å™¨é•œåƒï¼ˆå³ Dockerfile çš„ <code>CMD</code>ï¼‰å£°æ˜çš„é»˜è®¤å‘½ä»¤</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">command:</span> <span class="string">bundle</span> <span class="string">exec</span> <span class="string">thin</span> <span class="string">-p</span> <span class="number">3000</span></span><br></pre></td></tr></table></figure>

<p>å‘½ä»¤å¯ä»¥æ˜¯ä¸€ä¸ªåˆ—è¡¨, ä»¥ç±»ä¼¼ <a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/builder/#cmd" >Dockerfile<i class="fas fa-external-link-alt"></i></a> çš„æ–¹å¼:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">command:</span> [ <span class="string">&quot;bundle&quot;</span>, <span class="string">&quot;exec&quot;</span>, <span class="string">&quot;thin&quot;</span>, <span class="string">&quot;-p&quot;</span>, <span class="string">&quot;3000&quot;</span> ]</span><br></pre></td></tr></table></figure>

<h3 id="configs"><a href="#configs" class="headerlink" title="configs"></a>configs</h3><p><code>configs</code> ä½¿ç”¨ per-service <code>configs</code> é…ç½®åœ¨æ¯ä¸ªæœåŠ¡çš„åŸºç¡€ä¸Šæˆäºˆå¯¹é…ç½®çš„è®¿é—®æƒé™ã€‚ æ”¯æŒä¸¤ç§ä¸åŒçš„è¯­æ³•å˜ä½“</p>
<h4 id="Short-syntax"><a href="#Short-syntax" class="headerlink" title="Short syntax"></a>Short syntax</h4><p>çŸ­è¯­æ³•å˜ä½“ä»…æŒ‡å®šé…ç½®åç§°ã€‚è¿™å°†æˆäºˆå®¹å™¨å¯¹é…ç½®çš„è®¿é—®æƒé™å¹¶å°†å…¶å®‰è£…åœ¨å®¹å™¨å†…çš„ <code>/&lt;config_name&gt;</code> å¤„ã€‚æºåç§°å’Œç›®æ ‡æŒ‚è½½ç‚¹éƒ½è®¾ç½®ä¸ºé…ç½®åç§°ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:latest</span></span><br><span class="line">    <span class="attr">configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">my_config</span></span><br><span class="line"><span class="attr">configs:</span></span><br><span class="line">  <span class="attr">my_config:</span></span><br><span class="line">    <span class="attr">file:</span> <span class="string">./my_config.txt</span></span><br><span class="line">  <span class="attr">my_other_config:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h4 id="Long-syntax"><a href="#Long-syntax" class="headerlink" title="Long syntax"></a>Long syntax</h4><p>é•¿è¯­æ³•ä¸ºå¦‚ä½•åœ¨æœåŠ¡çš„ä»»åŠ¡å®¹å™¨ä¸­åˆ›å»ºé…ç½®æä¾›äº†æ›´å¤šç²’åº¦</p>
<ul>
<li><code>source</code></li>
<li><code>target</code></li>
<li><code>uid</code> å’Œ <code>gid</code></li>
<li><code>mode</code></li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:latest</span></span><br><span class="line">    <span class="attr">configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">source:</span> <span class="string">my_config</span></span><br><span class="line">        <span class="attr">target:</span> <span class="string">/redis_config</span></span><br><span class="line">        <span class="attr">uid:</span> <span class="string">&quot;103&quot;</span></span><br><span class="line">        <span class="attr">gid:</span> <span class="string">&quot;103&quot;</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="number">0440</span></span><br><span class="line"><span class="attr">configs:</span></span><br><span class="line">  <span class="attr">my_config:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">my_other_config:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>æ‚¨å¯ä»¥æˆäºˆæœåŠ¡è®¿é—®å¤šä¸ªé…ç½®çš„æƒé™ï¼Œå¹¶ä¸”å¯ä»¥æ··åˆä½¿ç”¨é•¿è¯­æ³•å’ŒçŸ­è¯­æ³•</p>
<h3 id="container-name"><a href="#container-name" class="headerlink" title="container_name"></a>container_name</h3><p>æŒ‡å®šè‡ªå®šä¹‰å®¹å™¨åç§°çš„å­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯ç”Ÿæˆçš„é»˜è®¤åç§°</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">container_name:</span> <span class="string">my-web-container</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœæä¾›äº†, <code>container_name</code> åº”è¯¥éµå¾ªè¿™æ ·çš„æ­£åˆ™è¡¨è¾¾å¼: <code>[a-zA-Z0-9][a-zA-Z0-9_.-]+</code></p>
<h3 id="credential-spec"><a href="#credential-spec" class="headerlink" title="credential_spec"></a>credential_spec</h3><p>ä¸ºæ‰˜ç®¡æœåŠ¡å¸æˆ·é…ç½®å‡­æ®è§„èŒƒ</p>
<p><code>credential_spec</code> å¿…é¡»æ˜¯ <code>file://&lt;filename&gt;</code> æˆ– <code>registry://&lt;value-name&gt;</code> çš„æ ¼å¼</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">credential_spec:</span></span><br><span class="line">  <span class="attr">file:</span> <span class="string">my-credential-spec.json</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">credential_spec:</span></span><br><span class="line">  <span class="attr">registry:</span> <span class="string">my-credential-spec</span></span><br></pre></td></tr></table></figure>

<h4 id="Example-gMSA-configuration"><a href="#Example-gMSA-configuration" class="headerlink" title="Example gMSA configuration"></a>Example gMSA configuration</h4><p>ä¸ºæœåŠ¡é…ç½® gMSA å‡­è¯è§„èŒƒæ—¶ï¼Œåªéœ€ä½¿ç”¨ <code>config</code> æŒ‡å®šå‡­è¯è§„èŒƒ</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">myservice:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">myimage:latest</span></span><br><span class="line">    <span class="attr">credential_spec:</span></span><br><span class="line">      <span class="attr">config:</span> <span class="string">my_credential_spec</span></span><br><span class="line"></span><br><span class="line"><span class="attr">configs:</span></span><br><span class="line">  <span class="attr">my_credentials_spec:</span></span><br><span class="line">    <span class="attr">file:</span> <span class="string">./my-credential-spec.json|</span></span><br></pre></td></tr></table></figure>

<h3 id="depends-on"><a href="#depends-on" class="headerlink" title="depends_on"></a>depends_on</h3><p>è¡¨ç¤ºæœåŠ¡ä¹‹é—´çš„å¯åŠ¨å’Œå…³é—­ä¾èµ–å…³ç³»</p>
<h4 id="Short-syntax-1"><a href="#Short-syntax-1" class="headerlink" title="Short syntax"></a>Short syntax</h4><p>çŸ­è¯­æ³•å˜ä½“ä»…æŒ‡å®šä¾èµ–é¡¹çš„æœåŠ¡åç§°</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">  <span class="attr">db:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">postgres</span></span><br></pre></td></tr></table></figure>

<p><code>db</code> å’Œ <code>redis</code> åœ¨ <code>web</code> ä¹‹å‰è¢«åˆ›å»º. ä»¥å®¹å™¨çš„ â€œreadyâ€ çŠ¶æ€æ¥åˆ¤æ–­è¢«ä¾èµ–çš„å®¹å™¨æ˜¯å¦å°±ç»ª</p>
<p><code>web</code> åœ¨ <code>db</code> å’Œ <code>redis</code> ä¹‹å‰è¢«åˆ é™¤</p>
<h4 id="Long-syntax-1"><a href="#Long-syntax-1" class="headerlink" title="Long syntax"></a>Long syntax</h4><p>å¯ç”¨æ— æ³•ä»¥ç®€çŸ­å½¢å¼è¡¨è¾¾çš„é™„åŠ å­—æ®µçš„é…ç½®</p>
<ul>
<li><code>condition</code><ul>
<li><code>service_started</code></li>
<li><code>service_healthy</code></li>
<li><code>service_completed_successfully</code></li>
</ul>
</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="attr">db:</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">service_healthy</span></span><br><span class="line">      <span class="attr">redis:</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">service_started</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">  <span class="attr">db:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">postgres</span></span><br></pre></td></tr></table></figure>

<p><code>db</code> å’Œ <code>redis</code> åœ¨ <code>web</code> ä¹‹å‰è¢«åˆ›å»º. ä»¥å®¹å™¨çš„ â€œhealthyâ€ çŠ¶æ€æ¥åˆ¤æ–­è¢«ä¾èµ–çš„å®¹å™¨æ˜¯å¦å°±ç»ª</p>
<p><code>web</code> åœ¨ <code>db</code> å’Œ <code>redis</code> ä¹‹å‰è¢«åˆ é™¤</p>
<h3 id="deploy"><a href="#deploy" class="headerlink" title="deploy"></a>deploy</h3><p>æŒ‡å®šæœåŠ¡çš„éƒ¨ç½²å’Œç”Ÿå‘½å‘¨æœŸçš„é…ç½®ï¼Œå¦‚æ­¤<a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/deploy/" >å¤„æ‰€<i class="fas fa-external-link-alt"></i></a>å®šä¹‰</p>
<h3 id="device-cgroup-rules"><a href="#device-cgroup-rules" class="headerlink" title="device_cgroup_rules"></a>device_cgroup_rules</h3><p>ä¸ºæ­¤å®¹å™¨å®šä¹‰è®¾å¤‡ cgroup è§„åˆ™åˆ—è¡¨ã€‚ æ ¼å¼ä¸Linuxå†…æ ¸åœ¨<a class="link"   target="_blank" rel="noopener" href="https://www.kernel.org/doc/html/latest/admin-guide/cgroup-v1/devices.html" >Control Groups Device Whitelist Controller<i class="fas fa-external-link-alt"></i></a>ä¸­æŒ‡å®šçš„æ ¼å¼ç›¸åŒ</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">device_cgroup_rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;c 1:3 mr&#x27;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;a 7:* rmw&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="devices"><a href="#devices" class="headerlink" title="devices"></a>devices</h3><p>ä»¥ <code>HOST_PATH:CONTAINER_PATH[:CGROUP_PERMISSIONS]</code>çš„å½¢å¼ä¸ºåˆ›å»ºçš„å®¹å™¨å®šä¹‰è®¾å¤‡æ˜ å°„åˆ—è¡¨</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">devices:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;/dev/ttyUSB0:/dev/ttyUSB0&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;/dev/sda:/dev/xvda:rwm&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="dns"><a href="#dns" class="headerlink" title="dns"></a>dns</h3><p>å®šä¹‰è¦åœ¨å®¹å™¨ç½‘ç»œæ¥å£é…ç½®ä¸Šè®¾ç½®çš„è‡ªå®šä¹‰ DNS æœåŠ¡å™¨ã€‚ å¯ä»¥æ˜¯å•ä¸ªå€¼æˆ–åˆ—è¡¨</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dns:</span> <span class="number">8.8</span><span class="number">.8</span><span class="number">.8</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dns:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">8.8</span><span class="number">.8</span><span class="number">.8</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">9.9</span><span class="number">.9</span><span class="number">.9</span></span><br></pre></td></tr></table></figure>

<h3 id="dns-opt"><a href="#dns-opt" class="headerlink" title="dns_opt"></a>dns_opt</h3><p>åˆ—å‡ºè¦ä¼ é€’ç»™å®¹å™¨çš„ DNS è§£æå™¨çš„è‡ªå®šä¹‰ DNS é€‰é¡¹ï¼ˆLinux ä¸Šçš„ <code>/etc/resolv.conf</code> æ–‡ä»¶ï¼‰</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dns_opt:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">use-vc</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">no</span><span class="string">-tld-query</span></span><br></pre></td></tr></table></figure>

<h3 id="dns-search"><a href="#dns-search" class="headerlink" title="dns_search"></a>dns_search</h3><p>å®šä¹‰è‡ªå®šä¹‰ DNS æœç´¢åŸŸä»¥åœ¨å®¹å™¨ç½‘ç»œæ¥å£é…ç½®ä¸Šè®¾ç½®ã€‚ å¯ä»¥æ˜¯å•ä¸ªå€¼æˆ–åˆ—è¡¨</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dns_search:</span> <span class="string">example.com</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dns_search:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">dc1.example.com</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">dc2.example.com</span></span><br></pre></td></tr></table></figure>

<h3 id="domainname"><a href="#domainname" class="headerlink" title="domainname"></a>domainname</h3><p>å£°æ˜ç”¨äºæœåŠ¡å®¹å™¨çš„è‡ªå®šä¹‰åŸŸåã€‚ å¿…é¡»æ˜¯æœ‰æ•ˆçš„ RFC 1123 ä¸»æœºå</p>
<h3 id="entrypoint"><a href="#entrypoint" class="headerlink" title="entrypoint"></a>entrypoint</h3><p>è¦†ç›– Docker æ˜ åƒçš„é»˜è®¤ entrypointï¼ˆå³ Dockerfile è®¾ç½®çš„ <code>entrypoint</code>ï¼‰</p>
<p>å½“ <code>entrypoint</code> ç”± Compose æ–‡ä»¶é…ç½®æ—¶ï¼ŒCompose å®ç°å¿…é¡»æ¸…é™¤ Docker é•œåƒä¸Šçš„ä»»ä½•é»˜è®¤å‘½ä»¤ - Dockerfile ä¸­çš„ <code>ENTRYPOINT</code> å’Œ <code>CMD</code> æŒ‡ä»¤</p>
<p>å¦‚æœè¿˜è®¾ç½®äº† <code>command</code>ï¼Œåˆ™å°†å…¶ç”¨ä½œ <code>entrypoint</code> çš„å‚æ•°ï¼Œä»¥æ›¿ä»£ Docker é•œåƒçš„ <code>CMD</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">entrypoint:</span> <span class="string">/code/entrypoint.sh</span></span><br></pre></td></tr></table></figure>

<p>entrypoint ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œæ–¹å¼ç±»ä¼¼äº <a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/builder/#cmd" >Dockerfile<i class="fas fa-external-link-alt"></i></a>:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">entrypoint:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">php</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">-d</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">zend_extension=/usr/local/lib/php/extensions/no-debug-non-zts-20100525/xdebug/so</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">-d</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">memory_limit=-1</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">vendor/bin/phpunit</span></span><br></pre></td></tr></table></figure>

<h3 id="env-file"><a href="#env-file" class="headerlink" title="env_file"></a>env_file</h3><p>æ ¹æ®æ–‡ä»¶å†…å®¹å‘å®¹å™¨æ·»åŠ ç¯å¢ƒå˜é‡</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">env_file:</span> <span class="string">.env</span></span><br></pre></td></tr></table></figure>

<p><code>env_file</code> ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªåˆ—è¡¨ã€‚ åˆ—è¡¨ä¸­çš„æ–‡ä»¶å¿…é¡»è‡ªä¸Šè€Œä¸‹å¤„ç†ã€‚ å¯¹äºä¸¤ä¸ª env æ–‡ä»¶ä¸­æŒ‡å®šçš„ç›¸åŒå˜é‡ï¼Œåˆ—è¡¨ä¸­æœ€åä¸€ä¸ªæ–‡ä»¶çš„å€¼å¿…é¡»ä¿æŒä¸å˜</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">env_file:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">./a.env</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">./b.env</span></span><br></pre></td></tr></table></figure>

<p>å¿…é¡»ä» Compose æ–‡ä»¶çš„çˆ¶æ–‡ä»¶å¤¹è§£æç›¸å¯¹è·¯å¾„</p>
<p>ç”±äºç»å¯¹è·¯å¾„ä¼šé˜»æ­¢ Compose æ–‡ä»¶çš„å¯ç§»æ¤æ€§ï¼Œå› æ­¤ Compose å®ç°åº”è¯¥åœ¨ä½¿ç”¨æ­¤ç±»è·¯å¾„è®¾ç½® <code>env_file</code> æ—¶è­¦å‘Šç”¨æˆ·</p>
<p>åœ¨ <a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/#environment" >environment<i class="fas fa-external-link-alt"></i></a> éƒ¨åˆ†ä¸­å£°æ˜çš„ç¯å¢ƒå˜é‡å¿…é¡»è¦†ç›–è¿™äº›å€¼ â€” å³ä½¿è¿™äº›å€¼ä¸ºç©ºæˆ–æœªå®šä¹‰ä¹Ÿæ˜¯å¦‚æ­¤</p>
<h4 id="Env-file-format"><a href="#Env-file-format" class="headerlink" title="Env_file format"></a>Env_file format</h4><p>env æ–‡ä»¶ä¸­çš„æ¯ä¸€è¡Œå¿…é¡»æ˜¯ <code>VAR[=[VAL]]</code> æ ¼å¼</p>
<p>å¿…é¡»å¿½ç•¥ä»¥ <code>#</code> å¼€å¤´çš„è¡Œã€‚ ç©ºè¡Œä¹Ÿå¿…é¡»è¢«å¿½ç•¥</p>
<p><code>VAL</code> çš„å€¼ç”¨ä½œåŸå§‹å­—ç¬¦ä¸²ï¼Œä¸ä½œä»»ä½•ä¿®æ”¹ã€‚ å¦‚æœå€¼è¢«å¼•å·åŒ…å›´ï¼ˆè¿™é€šå¸¸æ˜¯ shell å˜é‡çš„æƒ…å†µï¼‰ï¼Œå¼•å·å¿…é¡»åŒ…å«åœ¨ä¼ é€’ç»™ç”± Compose å®ç°åˆ›å»ºçš„å®¹å™¨çš„å€¼ä¸­</p>
<p><code>VAL</code> å¯ä»¥çœç•¥ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå˜é‡å€¼æ˜¯ç©ºå­—ç¬¦ä¸²ã€‚ <code>=VAL</code> å¯ä»¥çœç•¥ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå˜é‡æ˜¯æœªè®¾ç½® (unset) çš„</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Set Rails/Rack environment</span></span><br><span class="line"><span class="string">RACK_ENV=development</span></span><br><span class="line"><span class="string">VAR=&quot;quoted&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="environment"><a href="#environment" class="headerlink" title="environment"></a>environment</h3><p>å®šä¹‰å®¹å™¨ä¸­è®¾ç½®çš„ç¯å¢ƒå˜é‡</p>
<p><code>environment</code> å¯ä»¥ä½¿ç”¨æ•°ç»„æˆ– mapã€‚ ä»»ä½•å¸ƒå°”å€¼ï¼› true, false, yes, no, åº”è¯¥ç”¨å¼•å·æ‹¬èµ·æ¥ä»¥ç¡®ä¿å®ƒä»¬ä¸ä¼šè¢« YAML è§£æå™¨è½¬æ¢ä¸º True æˆ– False</p>
<p><code>environment</code> å¯ä»¥ç”±å•ä¸ªé”®å£°æ˜ï¼ˆç­‰å·æ²¡æœ‰å€¼ï¼‰ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒCompose å®ç°åº”è¯¥ä¾èµ–ä¸€äº›ç”¨æˆ·äº¤äº’æ¥è§£æå€¼ã€‚ å¦‚æœæ²¡æœ‰ï¼Œåˆ™è¯¥å˜é‡æœªè®¾ç½® (unset) å¹¶å°†ä»æœåŠ¡å®¹å™¨ç¯å¢ƒä¸­åˆ é™¤</p>
<p>Map è¯­æ³•:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">environment:</span></span><br><span class="line">  <span class="attr">RACK_ENV:</span> <span class="string">development</span></span><br><span class="line">  <span class="attr">SHOW:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">  <span class="attr">USER_INPUT:</span></span><br></pre></td></tr></table></figure>

<p>æ•°ç»„è¯­æ³•:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">environment:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">RACK_ENV=development</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">SHOW=true</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">USER_INPUT</span></span><br></pre></td></tr></table></figure>

<p>å½“ä¸ºæœåŠ¡è®¾ç½® <code>env_file</code> å’Œ <code>environment</code> æ—¶ï¼Œç”± <code>environment</code> è®¾ç½®çš„å€¼ä¼˜å…ˆ</p>
<h3 id="expose"><a href="#expose" class="headerlink" title="expose"></a>expose</h3><p>å®šä¹‰ Compose å®ç°å¿…é¡»ä»å®¹å™¨å…¬å¼€çš„ç«¯å£ã€‚ è¿™äº›ç«¯å£å¿…é¡»å¯ä¾›é“¾æ¥çš„æœåŠ¡è®¿é—®ï¼Œå¹¶ä¸”ä¸åº”å‘å¸ƒåˆ°å®¿ä¸»æœºã€‚ åªèƒ½æŒ‡å®šå†…éƒ¨å®¹å™¨ç«¯å£</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">expose:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;3000&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;8000&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="extends"><a href="#extends" class="headerlink" title="extends"></a>extends</h3><p>åœ¨å½“å‰æ–‡ä»¶æˆ–å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ç»§æ‰¿å¦ä¸€ä¸ªæœåŠ¡ï¼Œå¯é€‰æ‹©åœ°è¦†ç›–é…ç½®ã€‚ æ‚¨å¯ä»¥åœ¨ä»»ä½•æœåŠ¡ä¸Šä½¿ç”¨ <code>extends</code> ä»¥åŠå…¶ä»–é…ç½®é”®</p>
<p><code>extends</code> å€¼å¿…é¡»æ˜¯ä½¿ç”¨å¿…éœ€ <code>service</code> å’Œå¯é€‰çš„ <code>file</code> é”®å®šä¹‰çš„æ˜ å°„</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">extends:</span></span><br><span class="line">  <span class="attr">file:</span> <span class="string">common.yml</span></span><br><span class="line">  <span class="attr">service:</span> <span class="string">webapp</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ”¯æŒçš„ Compose å®ç°å¿…é¡»ä»¥ä¸‹åˆ—æ–¹å¼å¤„ç† <code>extends</code>:</p>
<ul>
<li><code>service</code> å®šä¹‰ä½œä¸ºåŸºç¡€å¼•ç”¨çš„æœåŠ¡çš„åç§°ï¼Œä¾‹å¦‚ <code>web</code> æˆ– <code>database</code></li>
<li><code>file</code> æ˜¯å®šä¹‰è¯¥æœåŠ¡çš„ Compose é…ç½®æ–‡ä»¶çš„ä½ç½®</li>
</ul>
<h4 id="Restrictions"><a href="#Restrictions" class="headerlink" title="Restrictions"></a>Restrictions</h4><p>ä»¥ä¸‹é™åˆ¶é€‚ç”¨äºè¢«å¼•ç”¨çš„æœåŠ¡:</p>
<ul>
<li>ä¾èµ–äºå…¶ä»–æœåŠ¡çš„æœåŠ¡ä¸èƒ½ä½œä¸ºåŸºç¡€ã€‚ å› æ­¤ï¼Œä»»ä½•å¼•å…¥å¯¹å¦ä¸€ä¸ªæœåŠ¡çš„ä¾èµ–çš„é”®éƒ½ä¸ <code>extends</code> ä¸å…¼å®¹; è¿™äº›é”®çš„éè¯¦å°½åˆ—è¡¨æ˜¯ï¼š<code>links</code>ã€<code>volumes_from</code>ã€<code>container</code> æ¨¡å¼ï¼ˆåœ¨<code>ipc</code>ã€<code>pid</code>ã€<code>network_mode</code>å’Œ<code>net</code>ä¸­ï¼‰ã€<code>service</code>æ¨¡å¼ï¼ˆåœ¨<code>ipc</code>ä¸­ï¼‰ , <code>pid</code> å’Œ <code>network_mode</code>), <code>depends_on</code></li>
<li>æœåŠ¡ä¸èƒ½æœ‰å¸¦ <code>extends</code> çš„å¾ªç¯å¼•ç”¨</li>
</ul>
<p>åœ¨æ‰€æœ‰è¿™äº›æƒ…å†µä¸‹ï¼ŒCompose å®ç°å¿…é¡»è¿”å›é”™è¯¯</p>
<h4 id="Finding-referenced-service"><a href="#Finding-referenced-service" class="headerlink" title="Finding referenced service"></a>Finding referenced service</h4><p><code>file</code> å€¼å¯ä»¥æ˜¯:</p>
<ul>
<li>ä¸å­˜åœ¨ã€‚ è¿™è¡¨æ˜æ­£åœ¨å¼•ç”¨åŒä¸€ Compose æ–‡ä»¶ä¸­çš„å¦ä¸€ä¸ªæœåŠ¡</li>
<li>æ–‡ä»¶è·¯å¾„ï¼Œå¯ä»¥æ˜¯ï¼š<ul>
<li>ç›¸å¯¹è·¯å¾„ã€‚ æ­¤è·¯å¾„è¢«è®¤ä¸ºæ˜¯ç›¸å¯¹äºä¸» Compose æ–‡ä»¶çš„ä½ç½®</li>
<li>ç»å¯¹è·¯å¾„</li>
</ul>
</li>
</ul>
<p>ç”± <code>service</code> è¡¨ç¤ºçš„æœåŠ¡å¿…é¡»å­˜åœ¨äºæ ‡è¯†çš„å¼•ç”¨ Compose æ–‡ä»¶ä¸­. Compose å®ç°å¿…é¡»è¿”å›ä¸€ä¸ªé”™è¯¯ï¼Œå¦‚æœ:</p>
<ul>
<li>æœªæ‰¾åˆ°ç”± <code>service</code> è¡¨ç¤ºçš„æœåŠ¡</li>
<li>æ‰¾ä¸åˆ°ç”±<code>file</code> è¡¨ç¤ºçš„ Compose æ–‡ä»¶</li>
</ul>
<h4 id="Merging-service-definitions"><a href="#Merging-service-definitions" class="headerlink" title="Merging service definitions"></a>Merging service definitions</h4><p>ä¸¤ä¸ªæœåŠ¡å®šä¹‰ï¼ˆå½“å‰ Compose æ–‡ä»¶ä¸­çš„ä¸»è¦ä¸€ä¸ªå’Œç”± <code>extends</code> æŒ‡å®šçš„å¼•ç”¨ä¸€ä¸ªï¼‰å¿…é¡»æŒ‰ä»¥ä¸‹æ–¹å¼åˆå¹¶:</p>
<ul>
<li>æ˜ å°„: ä¸»æœåŠ¡å®šä¹‰æ˜ å°„ä¸­çš„é”®è¦†ç›–å¼•ç”¨æœåŠ¡å®šä¹‰æ˜ å°„ä¸­çš„é”®ã€‚ æœªè¦†ç›–çš„é”®æŒ‰åŸæ ·åŒ…å«åœ¨å†…</li>
<li>åºåˆ—: é¡¹ç›®è¢«ç»„åˆæˆä¸€ä¸ªæ–°çš„åºåˆ—ã€‚ å…ƒç´ çš„é¡ºåºè¢«ä¿ç•™ï¼Œå¼•ç”¨çš„é¡¹ç›®åœ¨å‰ï¼Œä¸»è¦é¡¹ç›®åœ¨å</li>
<li>æ ‡é‡: ä¸»æœåŠ¡å®šä¹‰ä¸­çš„é”®ä¼˜å…ˆäºè¢«å¼•ç”¨çš„é”®</li>
</ul>
<h5 id="Mappings"><a href="#Mappings" class="headerlink" title="Mappings"></a>Mappings</h5><p>ä»¥ä¸‹å…³é”®å­—å¿…é¡»ä½œä¸ºæ˜ å°„çœ‹å¾…: <code>build.args</code>,<code>build.labels</code>,<code>build.extra_hosts</code>,<code>deploy.labels</code>,<code>deploy.update_config</code>,<code>deploy.rollback_config</code>,<code>deploy.restart_policy</code>,<code>deploy.resources.limits</code>,<code>environment</code>,<code>healthcheck</code>,<code>labels</code>,<code>logging.options</code>,<code>sysctls</code>,<code>storage_opt</code>,<code>extra_hosts</code>,<code>ulimits</code></p>
<p>é€‚ç”¨äº <code>healthcheck</code> çš„ä¸€ä¸ªä¾‹å¤–æ˜¯ä¸»æ˜ å°„ä¸èƒ½æŒ‡å®š <code>disable: true</code> é™¤éå¼•ç”¨çš„æ˜ å°„ä¹ŸæŒ‡å®š <code>disable: true</code>. åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒCompose å®ç°å¿…é¡»è¿”å›é”™è¯¯</p>
<p>ä¾‹å¦‚ï¼Œä¸‹é¢çš„è¾“å…¥:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">sercice:</span></span><br><span class="line">  <span class="attr">common:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">utc</span></span><br><span class="line">      <span class="attr">PORT:</span> <span class="number">80</span></span><br><span class="line">  <span class="attr">cli:</span></span><br><span class="line">    <span class="attr">extends:</span></span><br><span class="line">      <span class="attr">service:</span> <span class="string">common</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">PORT:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure>

<p>ä¸º <code>cli</code> æœåŠ¡ç”Ÿæˆä»¥ä¸‹é…ç½®ã€‚ å¦‚æœä½¿ç”¨æ•°ç»„è¯­æ³•ï¼Œåˆ™ä¼šäº§ç”Ÿç›¸åŒçš„è¾“å‡º:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">environment:</span></span><br><span class="line">  <span class="attr">PORT:</span> <span class="number">8080</span></span><br><span class="line">  <span class="attr">TZ:</span> <span class="string">utc</span></span><br><span class="line"><span class="attr">image:</span> <span class="string">busybox</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ <code>blkio_config.device_read_bps</code>,<code>blkio_config.device_read_iops</code>,<code>blkio_config.device_write_bps</code>,<code>blkio_config.device_write_iops</code>,<code>devices</code>,<code>volumes</code> ä¸‹é¢çš„ items ä¹Ÿè¢«è§†ä¸ºæ˜ å°„ï¼Œå…¶ä¸­ key æ˜¯å®¹å™¨å†…çš„ç›®æ ‡è·¯å¾„</p>
<p>ä¾‹å¦‚ï¼Œä¸‹é¢çš„è¾“å…¥:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">common:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">common-volume:/var/lib/backup/data:rw</span></span><br><span class="line">  <span class="attr">cli:</span></span><br><span class="line">    <span class="attr">extends:</span></span><br><span class="line">      <span class="attr">service:</span> <span class="string">common</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">cli-volume:/var/lib/backup/data:ro</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœå¼•ç”¨çš„æœåŠ¡å®šä¹‰åŒ…å« <code>extends</code> æ˜ å°„ï¼Œåˆ™å…¶ä¸‹çš„é¡¹ç›®å°†ç®€å•åœ°å¤åˆ¶åˆ°æ–°çš„åˆå¹¶å®šä¹‰ä¸­ã€‚ ç„¶åå†æ¬¡å¯åŠ¨åˆå¹¶è¿‡ç¨‹ï¼Œç›´åˆ°æ²¡æœ‰ <code>extends</code> é”®å‰©ä½™</p>
<p>ä¾‹å¦‚ï¼Œä¸‹é¢çš„è¾“å…¥:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">base:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">user:</span> <span class="string">root</span></span><br><span class="line">  <span class="attr">common:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">extends:</span></span><br><span class="line">      <span class="attr">service:</span> <span class="string">base</span></span><br><span class="line">  <span class="attr">cli:</span></span><br><span class="line">    <span class="attr">extends:</span></span><br><span class="line">      <span class="attr">service:</span> <span class="string">common</span></span><br></pre></td></tr></table></figure>

<p>ä¸º <code>cli</code> æœåŠ¡ç”Ÿæˆä»¥ä¸‹é…ç½®ã€‚ åœ¨è¿™é‡Œï¼Œ<code>cli</code> æœåŠ¡ä» <code>common</code> æœåŠ¡ä¸­è·å– <code>user</code> é”®ï¼Œè€Œåè€…åˆä» <code>base</code> æœåŠ¡ä¸­è·å–é”®</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line"><span class="attr">user:</span> <span class="string">root</span></span><br></pre></td></tr></table></figure>

<h5 id="Sequences"><a href="#Sequences" class="headerlink" title="Sequences"></a>Sequences</h5><p>ä»¥ä¸‹é”®åº”è¢«è§†ä¸ºåºåˆ—ï¼š<code>cap_add</code>,<code>cap_drop</code>,<code>configs</code>,<code>deploy.placement.constraints</code>,<code>deploy.placement.preferences</code>,<code>deploy.reservations.generic_resources</code>,<code>device_cgroup_rules</code>,<code>expose</code>,<code>external_links</code>,<code>ports</code>,<code>secrets</code>,<code>security_opt</code>. åˆ é™¤åˆå¹¶äº§ç”Ÿçš„ä»»ä½•é‡å¤é¡¹ï¼Œä»¥ä¾¿åºåˆ—ä»…åŒ…å«å”¯ä¸€å…ƒç´ </p>
<p>ä¾‹å¦‚ï¼Œä¸‹é¢çš„è¾“å…¥:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">common:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">security_opt:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">label:role:ROLE</span></span><br><span class="line">  <span class="attr">cli:</span></span><br><span class="line">    <span class="attr">extends:</span></span><br><span class="line">      <span class="attr">service:</span> <span class="string">common</span></span><br><span class="line">    <span class="attr">security_opt:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">label:user:USER</span></span><br></pre></td></tr></table></figure>

<p>ä¸º <code>cli</code> æœåŠ¡ç”Ÿæˆä»¥ä¸‹é…ç½®</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line"><span class="attr">security_opt:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">label:role:ROLE</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">label:user:USER</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½¿ç”¨åˆ—è¡¨è¯­æ³•ï¼Œåˆ™ä»¥ä¸‹é”®ä¹Ÿåº”è§†ä¸ºåºåˆ—ï¼š<code>dns</code>,<code>dns_search</code>,<code>env_file</code>,<code>tmpfs</code>; ä¸ä¸Šé¢æåˆ°çš„åºåˆ—å­—æ®µä¸åŒï¼Œåˆå¹¶äº§ç”Ÿçš„é‡å¤é¡¹ä¸ä¼šè¢«åˆ é™¤</p>
<h5 id="Scalars"><a href="#Scalars" class="headerlink" title="Scalars"></a>Scalars</h5><p>æœåŠ¡å®šä¹‰ä¸­çš„ä»»ä½•å…¶ä»–å…è®¸çš„é”®éƒ½åº”è§†ä¸ºæ ‡é‡</p>
<h3 id="external-links"><a href="#external-links" class="headerlink" title="external_links"></a>external_links</h3><p>å°†æœåŠ¡å®¹å™¨é“¾æ¥åˆ°åœ¨æ­¤ Compose åº”ç”¨ç¨‹åºä¹‹å¤–ç®¡ç†çš„æœåŠ¡</p>
<p><code>external_links</code> å®šä¹‰è¦ä½¿ç”¨å¹³å°æŸ¥æ‰¾æœºåˆ¶æ£€ç´¢çš„ç°æœ‰æœåŠ¡çš„åç§°ã€‚ å¯ä»¥æŒ‡å®š <code>SERVICE:ALIAS</code> å½¢å¼çš„åˆ«å</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">external_links:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">database:mysql</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">database:postgresql</span></span><br></pre></td></tr></table></figure>

<h3 id="extra-hosts"><a href="#extra-hosts" class="headerlink" title="extra_hosts"></a>extra_hosts</h3><p>å°†ä¸»æœºåæ˜ å°„æ·»åŠ åˆ°å®¹å™¨ç½‘ç»œæ¥å£é…ç½®ï¼ˆLinux çš„ <code>/etc/hosts</code>ï¼‰</p>
<p>å€¼å¿…é¡»ä»¥ <code>HOSTNAME:IP</code> çš„å½¢å¼ä¸ºå…¶ä»–ä¸»æœºè®¾ç½®ä¸»æœºåå’Œ IP åœ°å€</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">extra_hosts:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;somehost:162.242.195.82&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;otherhost:50.31.209.229&quot;</span></span><br></pre></td></tr></table></figure>

<p>Compose å®ç°å¿…é¡»åœ¨å®¹å™¨çš„ç½‘ç»œé…ç½®ä¸­åˆ›å»ºä¸ IP åœ°å€å’Œä¸»æœºååŒ¹é…çš„æ¡ç›®ï¼Œè¿™æ„å‘³ç€å¯¹äº Linux <code>/etc/hosts</code> å°†è·å¾—é¢å¤–çš„è¡Œ:</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">162.242.195.82  somehost</span><br><span class="line">50.31.209.229   otherhost</span><br></pre></td></tr></table></figure>

<h3 id="group-add"><a href="#group-add" class="headerlink" title="group_add"></a>group_add</h3><p>æŒ‡å®šå®¹å™¨å†…çš„ç”¨æˆ·å¿…é¡»æ˜¯é¢å¤–çš„ç»„çš„æˆå‘˜ï¼ˆæŒ‰åç§°æˆ–ç¼–å·ï¼‰</p>
<p>è¿™å¾ˆæœ‰ç”¨çš„ä¸€ä¸ªä¾‹å­æ˜¯, å½“å¤šä¸ªå®¹å™¨ï¼ˆä½œä¸ºä¸åŒçš„ç”¨æˆ·è¿è¡Œï¼‰éœ€è¦åœ¨å…±äº«å·ä¸Šè¯»å–æˆ–å†™å…¥ç›¸åŒçš„æ–‡ä»¶æ—¶. è¯¥æ–‡ä»¶å¯ä»¥ç”±æ‰€æœ‰å®¹å™¨å…±äº«çš„ç»„æ‹¥æœ‰ï¼Œå¹¶åœ¨ <code>group_add</code> ä¸­æŒ‡å®š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">myservice:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">alpine</span></span><br><span class="line">    <span class="attr">group_add:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mail</span></span><br></pre></td></tr></table></figure>

<p>åœ¨åˆ›å»ºçš„å®¹å™¨ä¸­è¿è¡Œ <code>id</code> å¿…é¡»æ˜¾ç¤ºç”¨æˆ·å±äº <code>mail</code> ç»„ï¼Œå¦‚æœæœªå£°æ˜ <code>group_add</code> åˆ™ä¸ä¼šå‡ºç°è¿™ç§æƒ…å†µ</p>
<h3 id="healthcheck"><a href="#healthcheck" class="headerlink" title="healthcheck"></a>healthcheck</h3><p>å£°æ˜è¿è¡Œæ£€æŸ¥ä»¥ç¡®å®šè¯¥æœåŠ¡çš„å®¹å™¨æ˜¯å¦ â€œhealthyâ€</p>
<p>è¿™ä¼šè¦†ç›–æœåŠ¡çš„ Docker æ˜ åƒè®¾ç½®çš„ <a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/builder/#healthcheck" >HEALTHCHECK Dockerfile instruction<i class="fas fa-external-link-alt"></i></a></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">healthcheck:</span></span><br><span class="line">  <span class="attr">test:</span> [<span class="string">&quot;CMD&quot;</span>, <span class="string">&quot;curl&quot;</span>, <span class="string">&quot;-f&quot;</span>, <span class="string">&quot;http://localhost&quot;</span>]</span><br><span class="line">  <span class="attr">interval:</span> <span class="string">1m30s</span></span><br><span class="line">  <span class="attr">timeout:</span> <span class="string">10s</span></span><br><span class="line">  <span class="attr">retries:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">start_period:</span> <span class="string">40s</span></span><br></pre></td></tr></table></figure>

<p><code>interval</code>,<code>timeout</code>,<code>start_period</code> è¢«<a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/#specifying-durations" >å®šä¹‰ä¸ºæ—¶é—´æ®µ<i class="fas fa-external-link-alt"></i></a></p>
<p><code>test</code> å®šä¹‰äº† Compose å®ç°å°†è¿è¡Œä»¥æ£€æŸ¥å®¹å™¨è¿è¡ŒçŠ¶å†µçš„å‘½ä»¤ã€‚ å®ƒå¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–åˆ—è¡¨ã€‚ å¦‚æœæ˜¯åˆ—è¡¨ï¼Œç¬¬ä¸€é¡¹å¿…é¡»æ˜¯ <code>NONE</code>ã€<code>CMD</code> æˆ– <code>CMD-SHELL</code>ã€‚ å¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™ç›¸å½“äºæŒ‡å®š <code>CMD-SHELL</code> åè·Ÿè¯¥å­—ç¬¦ä¸²</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Hit the local web app</span></span><br><span class="line"><span class="attr">test:</span> [<span class="string">&quot;CMD&quot;</span>, <span class="string">&quot;curl&quot;</span>, <span class="string">&quot;-f&quot;</span>, <span class="string">&quot;http://localhost&quot;</span>]</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ <code>CMD-SHELL</code> å°†ä½¿ç”¨å®¹å™¨çš„é»˜è®¤ shellï¼ˆLinux çš„<code>/bin/sh</code>ï¼‰è¿è¡Œé…ç½®ä¸ºå­—ç¬¦ä¸²çš„å‘½ä»¤ã€‚ ä¸‹é¢ä¸¤ç§å½¢å¼æ˜¯ç­‰ä»·çš„:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">test:</span> [<span class="string">&quot;CMD-SHELL&quot;</span>, <span class="string">&quot;curl -f http://localhost || exit 1&quot;</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">test:</span> <span class="string">curl</span> <span class="string">-f</span> <span class="string">https://localhost</span> <span class="string">||</span> <span class="string">exit</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p><code>NONE</code> ç¦ç”¨å¥åº·æ£€æŸ¥ï¼Œä¸»è¦ç”¨äºç¦ç”¨é€šè¿‡é•œåƒè®¾ç½®çš„å¥åº·æ£€æŸ¥ã€‚ æˆ–è€…ï¼Œå¯ä»¥é€šè¿‡è®¾ç½® <code>disable: true</code> æ¥ç¦ç”¨é•œåƒè®¾ç½®çš„å¥åº·æ£€æŸ¥:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">healthcheck:</span></span><br><span class="line">  <span class="attr">disable:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h3 id="hostname"><a href="#hostname" class="headerlink" title="hostname"></a>hostname</h3><p>å£°æ˜ç”¨äºæœåŠ¡å®¹å™¨çš„è‡ªå®šä¹‰ä¸»æœºåã€‚ å¿…é¡»æ˜¯æœ‰æ•ˆçš„ RFC 1123 ä¸»æœºå</p>
<h3 id="image"><a href="#image" class="headerlink" title="image"></a>image</h3><p>æŒ‡å®šå¯åŠ¨å®¹å™¨çš„é•œåƒã€‚ é•œåƒå¿…é¡»éµå¾ªå¼€æ”¾å®¹å™¨è§„èŒƒ <a class="link"   target="_blank" rel="noopener" href="https://github.com/opencontainers/org/blob/master/docs/docs/introduction/digests.md" >addressable image format<i class="fas fa-external-link-alt"></i></a>ï¼Œå¦‚ <code>[&lt;registry&gt;/][&lt;project&gt;/]&lt;image&gt;</code>[:<tag>|@<digest>]&#96;</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line"><span class="attr">image:</span> <span class="string">redis:5</span></span><br><span class="line"><span class="attr">image:</span> <span class="string">redis@sha256:0ed5d5928d4737458944eb604cc8509e245c3e19d02ad83935398bc4b991aac7</span></span><br><span class="line"><span class="attr">image:</span> <span class="string">library/redis</span></span><br><span class="line"><span class="attr">image:</span> <span class="string">docker.io/library/redis</span></span><br><span class="line"><span class="attr">image:</span> <span class="string">my_private.registry:5000/redis</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœå¹³å°ä¸Šä¸å­˜åœ¨è¯¥é•œåƒï¼ŒCompose å®ç°å¿…é¡»å°è¯•æ ¹æ® <code>pull_policy</code> æ‹‰å–å®ƒ</p>
<p>å…·æœ‰æ„å»ºæ”¯æŒçš„ Compose å®ç°å¯ä»¥ä¸ºæœ€ç»ˆç”¨æˆ·æä¾›æ›¿ä»£é€‰é¡¹ï¼Œä»¥æ§åˆ¶ä»æºæ„å»ºé•œåƒçš„æ‹‰å–ä¼˜å…ˆçº§ï¼Œä½†æ˜¯æ‹‰å–é•œåƒå¿…é¡»æ˜¯é»˜è®¤è¡Œä¸º</p>
<p>åªè¦å£°æ˜äº† <code>build</code> éƒ¨åˆ†ï¼Œå°±å¯ä»¥ä» Compose æ–‡ä»¶ä¸­çœç•¥ <code>image</code>ã€‚ å½“ Compose æ–‡ä»¶ä¸­ç¼ºå°‘ <code>image</code> æ—¶ï¼Œæ²¡æœ‰æ„å»ºæ”¯æŒçš„ Compose å®ç°å¿…é¡»å¤±è´¥</p>
<h3 id="init"><a href="#init" class="headerlink" title="init"></a>init</h3><p>åœ¨å®¹å™¨å†…è¿è¡Œä¸€ä¸ª init è¿›ç¨‹ (PID 1) æ¥è½¬å‘ä¿¡å·å¹¶è·å–è¿›ç¨‹. å°†æ­¤é€‰é¡¹è®¾ç½®ä¸º <code>true</code> ä»¥ä¸ºæœåŠ¡å¯ç”¨æ­¤åŠŸèƒ½</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">alpine:latest</span></span><br><span class="line">    <span class="attr">init:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨çš„ init äºŒè¿›åˆ¶æ–‡ä»¶æ˜¯ç‰¹å®šäºå¹³å°çš„</p>
<h3 id="ipc"><a href="#ipc" class="headerlink" title="ipc"></a>ipc</h3><p>é…ç½®æœåŠ¡å®¹å™¨è®¾ç½®çš„ IPC éš”ç¦»æ¨¡å¼</p>
<p>å¯ç”¨å€¼æ˜¯ç‰¹å®šäºå¹³å°çš„ï¼Œä½† Compose è§„èŒƒå®šä¹‰äº†ç‰¹å®šå€¼ï¼Œå¦‚æœæ”¯æŒï¼Œåˆ™å¿…é¡»æŒ‰ç…§æè¿°å®ç°ï¼š</p>
<ul>
<li><code>shareable</code>: å®ƒä¸ºå®¹å™¨æä¾›äº†è‡ªå·±çš„ç§æœ‰ IPC å‘½åç©ºé—´ï¼Œå¯ä»¥ä¸å…¶ä»–å®¹å™¨å…±äº«å®ƒ</li>
<li><code>service:&#123;name&#125;</code>: è¿™ä½¿å¾—å®¹å™¨åŠ å…¥å¦ä¸€ä¸ªï¼ˆ<code>shareable</code>ï¼‰å®¹å™¨çš„ IPC å‘½åç©ºé—´</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ipc:</span> <span class="string">&quot;shareable&quot;</span></span><br><span class="line"><span class="attr">ipc:</span> <span class="string">&quot;service:[service name]&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="isolation"><a href="#isolation" class="headerlink" title="isolation"></a>isolation</h3><p>æŒ‡å®šå®¹å™¨çš„éš”ç¦»æŠ€æœ¯ã€‚ æ”¯æŒçš„å€¼æ˜¯ç‰¹å®šäºå¹³å°çš„</p>
<h3 id="labels"><a href="#labels" class="headerlink" title="labels"></a>labels</h3><p>å°†å…ƒæ•°æ®æ·»åŠ åˆ°å®¹å™¨ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨æ•°ç»„æˆ– map</p>
<p>å»ºè®®æ‚¨ä½¿ç”¨åå‘ DNS è¡¨ç¤ºæ³•ï¼Œä»¥é˜²æ­¢æ‚¨çš„æ ‡ç­¾ä¸å…¶ä»–è½¯ä»¶ä½¿ç”¨çš„æ ‡ç­¾å†²çª</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">labels:</span></span><br><span class="line">  <span class="attr">com.example.description:</span> <span class="string">&quot;Accounting webapp&quot;</span></span><br><span class="line">  <span class="attr">com.example.department:</span> <span class="string">&quot;Finance&quot;</span></span><br><span class="line">  <span class="attr">com.example.label-with-empty-value:</span> <span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">labels:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;com.example.description=Accounting webapp&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;com.example.department=Finance&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;com.example.label-with-empty-value&quot;</span></span><br></pre></td></tr></table></figure>

<p>Compose å®ç°å¿…é¡»åˆ›å»ºå¸¦æœ‰è§„èŒƒæ ‡ç­¾çš„å®¹å™¨ï¼š</p>
<ul>
<li><code>com.docker.compose.project</code> å°† Compose å®ç°åˆ›å»ºçš„æ‰€æœ‰èµ„æºè®¾ç½®ä¸ºç”¨æˆ·é¡¹ç›®åç§°</li>
<li><code>com.docker.compose.service</code> ä½¿ç”¨ Compose æ–‡ä»¶ä¸­å®šä¹‰çš„æœåŠ¡åç§°åœ¨æœåŠ¡å®¹å™¨ä¸Šè®¾ç½®</li>
</ul>
<p><code>com.docker.compose</code> æ ‡ç­¾å‰ç¼€æ˜¯ä¿ç•™çš„ã€‚ åœ¨ Compose æ–‡ä»¶ä¸­æŒ‡å®šå¸¦æœ‰æ­¤å‰ç¼€çš„æ ‡ç­¾å¿…é¡»å¯¼è‡´è¿è¡Œæ—¶é”™è¯¯</p>
<h3 id="links"><a href="#links" class="headerlink" title="links"></a>links</h3><p>å®šä¹‰å¦ä¸€ä¸ªæœåŠ¡ä¸­å®¹å™¨çš„ç½‘ç»œé“¾æ¥</p>
<p>è¦ä¹ˆæŒ‡å®šæœåŠ¡åç§°å’Œé“¾æ¥åˆ«åï¼ˆ<code>SERVICE:ALIAS</code>ï¼‰ï¼Œè¦ä¹ˆåªæŒ‡å®šæœåŠ¡åç§°</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">web:</span></span><br><span class="line">  <span class="attr">links:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">db</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">db:database</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">redis</span></span><br></pre></td></tr></table></figure>

<p>é“¾æ¥æœåŠ¡çš„å®¹å™¨å¿…é¡»å¯ä»¥é€šè¿‡ä¸åˆ«åç›¸åŒçš„ä¸»æœºåè®¿é—®ï¼Œæˆ–è€…å¦‚æœæ²¡æœ‰æŒ‡å®šåˆ«åï¼Œåˆ™ä½¿ç”¨æœåŠ¡å</p>
<p>å¯ç”¨æœåŠ¡è¿›è¡Œé€šä¿¡ä¸éœ€è¦é“¾æ¥ - å½“æ²¡æœ‰è®¾ç½®ç‰¹å®šçš„ç½‘ç»œé…ç½®æ—¶ï¼Œä»»ä½•æœåŠ¡å¿…é¡»èƒ½å¤Ÿåœ¨ <code>default</code> ç½‘ç»œä¸Šä»¥è¯¥æœåŠ¡çš„åç§°è®¿é—®ä»»ä½•å…¶ä»–æœåŠ¡</p>
<p>å¦‚æœæœåŠ¡ç¡®å®å£°æ˜äº†å®ƒä»¬æ‰€è¿æ¥çš„ç½‘ç»œï¼Œåˆ™ <code>link</code> ä¸åº”è¯¥è¦†ç›–ç½‘ç»œé…ç½®ï¼Œå¹¶ä¸”æœªè¿æ¥åˆ°å…±äº«ç½‘ç»œçš„æœåŠ¡ä¸åº”è¯¥èƒ½å¤Ÿé€šä¿¡</p>
<p>Compose å®ç°å¯èƒ½ä¸ä¼šè­¦å‘Šç”¨æˆ·æ­¤é…ç½®ä¸åŒ¹é…</p>
<p>é“¾æ¥ä¹Ÿåƒ <code>depends_on</code> ä¸€æ ·è¡¨è¾¾æœåŠ¡ä¹‹é—´çš„éšå«ä¾èµ–å…³ç³»ï¼Œå› æ­¤å®ƒä»¬å†³å®šäº†æœåŠ¡å¯åŠ¨çš„é¡ºåº</p>
<h3 id="logging"><a href="#logging" class="headerlink" title="logging"></a>logging</h3><p>å®šä¹‰æœåŠ¡çš„æ—¥å¿—é…ç½®</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">driver:</span> <span class="string">syslog</span></span><br><span class="line">  <span class="attr">options:</span></span><br><span class="line">    <span class="attr">syslog-address:</span> <span class="string">&quot;tcp://192.168.0.42:123&quot;</span></span><br></pre></td></tr></table></figure>

<p><code>driver</code> åç§°æŒ‡å®šæœåŠ¡å®¹å™¨çš„æ—¥å¿—è®°å½•é©±åŠ¨ç¨‹åºã€‚ é»˜è®¤å€¼å’Œå¯ç”¨å€¼æ˜¯ç‰¹å®šäºå¹³å°çš„ã€‚ å¯ä»¥ä½¿ç”¨ <code>options</code> ä½œä¸ºé”®å€¼å¯¹æ¥è®¾ç½®é©±åŠ¨ç¨‹åºç‰¹å®šçš„é€‰é¡¹</p>
<h3 id="network-mode"><a href="#network-mode" class="headerlink" title="network_mode"></a>network_mode</h3><p>è®¾ç½®æœåŠ¡å®¹å™¨ç½‘ç»œæ¨¡å¼</p>
<p>å¯ç”¨å€¼æ˜¯ç‰¹å®šäºå¹³å°çš„ï¼Œä½† Compose è§„èŒƒå®šä¹‰äº†ç‰¹å®šå€¼ï¼Œå¦‚æœæ”¯æŒï¼Œåˆ™å¿…é¡»æŒ‰ç…§æè¿°å®ç°:</p>
<ul>
<li><code>none</code> ç¦ç”¨æ‰€æœ‰å®¹å™¨ç½‘ç»œ</li>
<li><code>host</code> ä¸ºå®¹å™¨æä¾›å¯¹ä¸»æœºç½‘ç»œæ¥å£çš„åŸå§‹è®¿é—®æƒé™</li>
<li><code>service:&#123;name&#125;</code> åªå…è®¸å®¹å™¨è®¿é—®æŒ‡å®šçš„æœåŠ¡</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line"><span class="attr">network_mode:</span> <span class="string">&quot;none&quot;</span></span><br><span class="line"><span class="attr">network_mode:</span> <span class="string">&quot;service: [service name]&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="networks"><a href="#networks" class="headerlink" title="networks"></a>networks</h3><p>å®šä¹‰æœåŠ¡å®¹å™¨é™„åŠ åˆ°çš„ç½‘ç»œï¼Œå¼•ç”¨ <code>top-level</code> ç½‘ç»œ <code>key</code> ä¸‹çš„æ¡ç›®</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">some-service:</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">some-network</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">other-network</span></span><br></pre></td></tr></table></figure>

<h4 id="aliases"><a href="#aliases" class="headerlink" title="aliases"></a>aliases</h4><p>åœ¨ç½‘ç»œä¸Šå£°æ˜æ­¤æœåŠ¡çš„å¤‡ç”¨ä¸»æœºå</p>
<p>åŒä¸€ç½‘ç»œä¸Šçš„å…¶ä»–å®¹å™¨å¯ä»¥ä½¿ç”¨æœåŠ¡åç§°æˆ–æ­¤åˆ«åè¿æ¥åˆ°æœåŠ¡çš„å®¹å™¨ä¹‹ä¸€</p>
<p>ç”±äº <code>aliases</code> æ˜¯ç½‘ç»œèŒƒå›´çš„ï¼Œç›¸åŒçš„æœåŠ¡åœ¨ä¸åŒçš„ç½‘ç»œä¸Šå¯ä»¥æœ‰ä¸åŒçš„åˆ«å</p>
<p>æ³¨æ„: ç½‘ç»œèŒƒå›´çš„åˆ«åå¯ä»¥è¢«å¤šä¸ªå®¹å™¨å…±äº«ï¼Œç”šè‡³å¯ä»¥è¢«å¤šä¸ªæœåŠ¡å…±äº«ã€‚ å¦‚æœæ˜¯ï¼Œåˆ™æ— æ³•ä¿è¯åç§°è§£æä¸ºå“ªä¸ªå®¹å™¨</p>
<p>ä¸€èˆ¬æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">some-service:</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="attr">some-network:</span></span><br><span class="line">        <span class="attr">aliases:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">alias1</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">alias3</span></span><br><span class="line">      <span class="attr">other-network:</span></span><br><span class="line">        <span class="attr">aliases:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">alias2</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼ŒæœåŠ¡ <code>frontend</code> å°†èƒ½å¤Ÿè®¿é—® <code>back-tier</code> ç½‘ç»œä¸Šä¸»æœºå <code>backend</code> æˆ– <code>database</code> ä¸­çš„ <code>backend</code> æœåŠ¡ï¼Œå¹¶ä¸”æœåŠ¡ <code>monitoring</code> å°†èƒ½å¤Ÿåœ¨ <code>admin</code> ç½‘ç»œä¸Šçš„ <code>db</code> æˆ– <code>mysql</code> è®¿é—®ç›¸åŒçš„ <code>backend</code> æœåŠ¡</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">frontent:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">awesome/webapp</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">front-tier</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">back-tier</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">monitoring:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">awesome/monitoring</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">admin</span></span><br><span class="line">  </span><br><span class="line">  <span class="attr">backend:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">awesome/backend</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="attr">back-tier:</span></span><br><span class="line">        <span class="attr">aliases:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">database</span></span><br><span class="line">      <span class="attr">admin:</span></span><br><span class="line">        <span class="attr">aliases:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">mysql</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">front-tier:</span></span><br><span class="line">  <span class="attr">back-tier:</span></span><br><span class="line">  <span class="attr">admin:</span>          </span><br></pre></td></tr></table></figure>

<h4 id="ipv4-address-ipv6-address"><a href="#ipv4-address-ipv6-address" class="headerlink" title="ipv4_address, ipv6_address"></a>ipv4_address, ipv6_address</h4><p>åŠ å…¥ç½‘ç»œæ—¶ï¼Œä¸ºæ­¤æœåŠ¡çš„å®¹å™¨æŒ‡å®šé™æ€ IP åœ°å€</p>
<p><a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/#networks" >é¡¶çº§ç½‘ç»œç« èŠ‚<i class="fas fa-external-link-alt"></i></a>ä¸­çš„ç›¸åº”ç½‘ç»œé…ç½®å¿…é¡»æœ‰ä¸€ä¸ª <code>ipam</code> å—ï¼Œå…¶ä¸­å­ç½‘é…ç½®è¦†ç›–æ¯ä¸ªé™æ€åœ°å€</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">frontend:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">awesome/webapp</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="attr">front-tier:</span></span><br><span class="line">        <span class="attr">ipv4_address:</span> <span class="number">172.16</span><span class="number">.238</span><span class="number">.10</span></span><br><span class="line">        <span class="attr">ipv6_address:</span> <span class="number">2001</span><span class="string">:3984:3989::10</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">front-tier:</span></span><br><span class="line">    <span class="attr">ipam:</span></span><br><span class="line">      <span class="attr">driver:</span> <span class="string">default</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">subnet:</span> <span class="string">&quot;172.16.238.0/24&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">subnet:</span> <span class="string">&quot;2001:3984:3989::/64&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="link-local-ips"><a href="#link-local-ips" class="headerlink" title="link_local_ips"></a>link_local_ips</h4><p>æŒ‡å®šé“¾æ¥æœ¬åœ° IP åˆ—è¡¨</p>
<p>Link-local IP æ˜¯å±äºä¼—æ‰€å‘¨çŸ¥çš„å­ç½‘çš„ç‰¹æ®Š IPï¼Œå®Œå…¨ç”±è¿è¥å•†ç®¡ç†ï¼Œé€šå¸¸å–å†³äºå®ƒä»¬éƒ¨ç½²åœ¨å“ªé‡Œçš„æ¶æ„. å®ç°æ˜¯ç‰¹å®šäºå¹³å°çš„</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">app:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">top</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="attr">app_net:</span></span><br><span class="line">        <span class="attr">link_local_ips:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="number">57.123</span><span class="number">.22</span><span class="number">.11</span></span><br><span class="line">          <span class="bullet">-</span> <span class="number">57.123</span><span class="number">.22</span><span class="number">.13</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">app_net:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br></pre></td></tr></table></figure>

<h4 id="priority"><a href="#priority" class="headerlink" title="priority"></a>priority</h4><p>æŒ‡ç¤º Compose å®ç°åº”è¯¥ä»¥ä½•ç§é¡ºåºå°†æœåŠ¡çš„å®¹å™¨è¿æ¥åˆ°å…¶ç½‘ç»œ. å¦‚æœæœªæŒ‡å®šï¼Œåˆ™é»˜è®¤å€¼ä¸º 0</p>
<p>åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œåº”ç”¨æœåŠ¡é¦–å…ˆè¿æ¥åˆ° app_net_1ï¼Œå› ä¸ºå®ƒå…·æœ‰æœ€é«˜ä¼˜å…ˆçº§</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">app:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">top</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="attr">app_net_1:</span></span><br><span class="line">        <span class="attr">priority:</span> <span class="number">1000</span></span><br><span class="line">      <span class="attr">app_net_2:</span></span><br><span class="line">      <span class="attr">app_net_3:</span></span><br><span class="line">        <span class="attr">priority:</span> <span class="number">100</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">app_net_1:</span></span><br><span class="line">  <span class="attr">app_net_2:</span></span><br><span class="line">  <span class="attr">app_net_3:</span></span><br></pre></td></tr></table></figure>

<h3 id="mac-address"><a href="#mac-address" class="headerlink" title="mac_address"></a>mac_address</h3><p>ä¸ºæœåŠ¡å®¹å™¨è®¾ç½® MAC åœ°å€</p>
<h3 id="mem-limit"><a href="#mem-limit" class="headerlink" title="mem_limit"></a>mem_limit</h3><p>å·²åºŸå¼ƒ. ä½¿ç”¨ <a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/deploy/#memory" >deploy.limits.memory<i class="fas fa-external-link-alt"></i></a></p>
<h3 id="mem-reservation"><a href="#mem-reservation" class="headerlink" title="mem_reservation"></a>mem_reservation</h3><p>å·²åºŸå¼ƒ. ä½¿ç”¨ <a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/deploy/#memory" >deploy.reservations.memory<i class="fas fa-external-link-alt"></i></a></p>
<h3 id="mem-swappiness"><a href="#mem-swappiness" class="headerlink" title="mem_swappiness"></a>mem_swappiness</h3><p><code>mem_swappiness</code> å®šä¹‰ä¸»æœºå†…æ ¸äº¤æ¢å®¹å™¨ä½¿ç”¨çš„åŒ¿åå†…å­˜é¡µçš„ç™¾åˆ†æ¯”ï¼ˆ0åˆ°100ä¹‹é—´çš„å€¼ï¼‰</p>
<ul>
<li>å€¼ 0 å…³é—­åŒ¿åé¡µé¢äº¤æ¢</li>
<li>å€¼ 100 å°†æ‰€æœ‰åŒ¿åé¡µé¢è®¾ç½®ä¸ºå¯äº¤æ¢</li>
</ul>
<p>é»˜è®¤å€¼æ˜¯ç‰¹å®šäºå¹³å°çš„</p>
<h3 id="memswap-limit"><a href="#memswap-limit" class="headerlink" title="memswap_limit"></a>memswap_limit</h3><p><code>memswap_limit</code> å®šä¹‰äº†å®¹å™¨å…è®¸çš„äº¤æ¢åˆ°ç£ç›˜çš„å†…å­˜æ•°é‡</p>
<p>è¿™æ˜¯ä¸€ä¸ªä¿®é¥°ç¬¦å±æ€§ï¼Œåªæœ‰åœ¨ä¹Ÿè®¾ç½®äº† <code>memory</code> æ—¶æ‰æœ‰æ„ä¹‰</p>
<p>ä½¿ç”¨äº¤æ¢å…è®¸å®¹å™¨åœ¨å®¹å™¨è€—å°½æ‰€æœ‰å¯ç”¨å†…å­˜æ—¶å°†è¿‡é‡çš„å†…å­˜éœ€æ±‚å†™å…¥ç£ç›˜</p>
<p>ç»å¸¸å°†å†…å­˜äº¤æ¢åˆ°ç£ç›˜çš„åº”ç”¨ç¨‹åºä¼šé™ä½æ€§èƒ½</p>
<ul>
<li>å¦‚æœ <code>memswap_limit</code> è®¾ç½®ä¸ºæ­£æ•´æ•°ï¼Œåˆ™å¿…é¡»åŒæ—¶è®¾ç½® <code>memory</code> å’Œ <code>memswap_limit</code>. <code>memswap_limit</code> è¡¨ç¤ºå¯ä»¥ä½¿ç”¨çš„å†…å­˜å’Œ swap çš„æ€»é‡ï¼Œ<code>memory</code> æ§åˆ¶é swap å†…å­˜çš„ä½¿ç”¨é‡. æ‰€ä»¥å¦‚æœ <code>memory</code> &#x3D;â€300mâ€å’Œ<code>memswap_limit</code>&#x3D;â€1gâ€ï¼Œå®¹å™¨å¯ä»¥ä½¿ç”¨ 300m çš„å†…å­˜å’Œ 700mï¼ˆ1g - 300mï¼‰çš„ swap</li>
<li>å¦‚æœ <code>memswap_limit</code> è®¾ç½®ä¸º 0ï¼Œåˆ™å¿…é¡»å¿½ç•¥è¯¥è®¾ç½®ï¼Œå¹¶å°†è¯¥å€¼è§†ä¸ºæœªè®¾ç½®</li>
<li>å¦‚æœ <code>memswap_limit</code> è®¾ç½®ä¸ºä¸ <code>memory</code> ç›¸åŒçš„å€¼ï¼Œå¹¶ä¸” <code>memory</code> è®¾ç½®ä¸ºæ­£æ•´æ•°ï¼Œåˆ™å®¹å™¨æ— æƒè®¿é—® swap</li>
<li>å¦‚æœ <code>memswap_limit</code> æœªè®¾ç½®ï¼Œå¹¶ä¸” <code>memory</code> è®¾ç½®ï¼Œå®¹å™¨å¯ä»¥ä½¿ç”¨ä¸ <code>memory</code> è®¾ç½®ä¸€æ ·å¤šçš„ swapï¼Œå¦‚æœä¸»æœºå®¹å™¨é…ç½®äº† swap å†…å­˜</li>
<li>ä¾‹å¦‚ï¼Œå¦‚æœ <code>memory</code> &#x3D;â€300mâ€å¹¶ä¸”æ²¡æœ‰è®¾ç½® <code>memswap_limit</code>ï¼Œå®¹å™¨æ€»å…±å¯ä»¥ä½¿ç”¨ 600m çš„å†…å­˜å’Œ swap</li>
<li>å¦‚æœ <code>memswap_limit</code> æ˜¾å¼è®¾ç½®ä¸º -1ï¼Œåˆ™å…è®¸å®¹å™¨ä½¿ç”¨æ— é™ swapï¼Œæœ€å¤šä¸ºä¸»æœºç³»ç»Ÿä¸Šå¯ç”¨çš„æ•°é‡</li>
</ul>
<h3 id="oom-kill-disable"><a href="#oom-kill-disable" class="headerlink" title="oom_kill_disable"></a>oom_kill_disable</h3><p>å¦‚æœè®¾ç½®äº† <code>oom_kill_disable</code>ï¼Œåˆ™ Compose å®ç°å¿…é¡»é…ç½®å¹³å°ï¼Œä»¥ä¾¿åœ¨å†…å­˜ä¸è¶³çš„æƒ…å†µä¸‹ä¸ä¼šæ€æ­»å®¹å™¨</p>
<h3 id="oom-score-adj"><a href="#oom-score-adj" class="headerlink" title="oom_score_adj"></a>oom_score_adj</h3><p><code>oom_score_adj</code> è°ƒæ•´å®¹å™¨åœ¨å†…å­˜ä¸è¶³çš„æƒ…å†µä¸‹è¢«å¹³å° kill çš„åå¥½ã€‚ å€¼å¿…é¡»åœ¨ <code>[-1000,1000]</code> èŒƒå›´å†…</p>
<h3 id="pid"><a href="#pid" class="headerlink" title="pid"></a>pid</h3><p>ä¸º Compose å®ç°åˆ›å»ºçš„å®¹å™¨è®¾ç½® PID æ¨¡å¼ã€‚ æ”¯æŒçš„å€¼æ˜¯ç‰¹å®šäºå¹³å°çš„</p>
<h3 id="pids-limit"><a href="#pids-limit" class="headerlink" title="pids_limit"></a>pids_limit</h3><p>å·²åºŸå¼ƒ: ä½¿ç”¨ <a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/deploy/#pids" >deploy.reservations.pids<i class="fas fa-external-link-alt"></i></a></p>
<h3 id="platform"><a href="#platform" class="headerlink" title="platform"></a>platform</h3><p><code>platform</code> ä½¿ç”¨ <code>os[/arch[/variant]]</code> è¯­æ³•å®šä¹‰äº†æ­¤æœåŠ¡å°†è¿è¡Œçš„ç›®æ ‡å¹³å°å®¹å™¨</p>
<p>Compose å®ç°å¿…é¡»åœ¨å£°æ˜æ—¶ä½¿ç”¨æ­¤å±æ€§æ¥ç¡®å®šå°†æå–å“ªä¸ªç‰ˆæœ¬çš„é•œåƒ å’Œ&#x2F;æˆ– å°†åœ¨å“ªä¸ªå¹³å°ä¸Šæ‰§è¡ŒæœåŠ¡çš„æ„å»º</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">platform:</span> <span class="string">osx</span></span><br><span class="line"><span class="attr">platform:</span> <span class="string">windows/amd64</span></span><br><span class="line"><span class="attr">platform:</span> <span class="string">linux/arm64/v8</span></span><br></pre></td></tr></table></figure>

<h3 id="ports"><a href="#ports" class="headerlink" title="ports"></a>ports</h3><p>æš´éœ²å®¹å™¨ç«¯å£. ç«¯å£æ˜ å°„ä¸å¾—ä¸ <code>network_mode: host</code> ä¸€èµ·ä½¿ç”¨ï¼Œè¿™æ ·åšå¿…é¡»å¯¼è‡´è¿è¡Œæ—¶é”™è¯¯</p>
<h4 id="Short-syntax-2"><a href="#Short-syntax-2" class="headerlink" title="Short syntax"></a>Short syntax</h4><p>ç®€çŸ­è¯­æ³•æ˜¯ä¸€ä¸ªå†’å·åˆ†éš”çš„å­—ç¬¦ä¸²ï¼Œç”¨äºè®¾ç½®ä¸»æœº IPã€ä¸»æœºç«¯å£å’Œå®¹å™¨ç«¯å£ï¼Œå½¢å¼ä¸º:</p>
<p><code>[HOST:]CONTAINER[/PROTOCOL]</code>:</p>
<ul>
<li><code>HOST</code> æ˜¯ <code>[IP:](port | range)</code></li>
<li><code>CONTAINER</code> æ˜¯ <code>port | range</code></li>
<li><code>PROTOCOL</code> å°†ç«¯å£é™åˆ¶ä¸ºæŒ‡å®šçš„åè®®ã€‚ <code>tcp</code> å’Œ <code>udp</code> å€¼ç”±è§„èŒƒå®šä¹‰ï¼ŒCompose å®ç°å¯ä»¥æä¾›å¯¹ç‰¹å®šäºå¹³å°çš„åè®®åç§°çš„æ”¯æŒ</li>
</ul>
<p>Host IPï¼Œå¦‚æœæœªè®¾ç½®ï¼Œå¿…é¡»ç»‘å®šåˆ°æ‰€æœ‰ç½‘ç»œæ¥å£</p>
<p>PORT å¯ä»¥æ˜¯å•ä¸ªå€¼æˆ–èŒƒå›´</p>
<p>ä¸»æœºå’Œå®¹å™¨å¿…é¡»ä½¿ç”¨ç­‰æ•ˆèŒƒå›´</p>
<p>è¦ä¹ˆæŒ‡å®šä¸¤ä¸ªç«¯å£ï¼ˆ<code>HOST:CONTAINER</code>ï¼‰ï¼Œè¦ä¹ˆåªæŒ‡å®šå®¹å™¨ç«¯å£. åœ¨åä¸€ç§æƒ…å†µä¸‹ï¼ŒCompose å®ç°åº”è¯¥è‡ªåŠ¨åˆ†é…ä»»ä½•æœªåˆ†é…çš„ä¸»æœºç«¯å£</p>
<p><code>HOST:CONTAINER</code> åº”å§‹ç»ˆæŒ‡å®šä¸ºï¼ˆå¸¦å¼•å·çš„ï¼‰å­—ç¬¦ä¸²ï¼Œä»¥é¿å…ä¸ <a class="link"   target="_blank" rel="noopener" href="https://yaml.org/type/float.html" >yaml base-60 float<i class="fas fa-external-link-alt"></i></a> å†²çª</p>
<p>ä¾‹å­:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;3000&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;3000-3005&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;8000:8000&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;9090-9091:8080-8081&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;49100:22&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;127.0.0.1:8001:8001&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;127.0.0.1:5000-5010:5000-5010&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;6060:6060/udp&quot;</span></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„: å¹³å°å¯èƒ½ä¸æ”¯æŒ Host IP æ˜ å°„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ Compose å®ç°åº”è¯¥æ‹’ç» Compose æ–‡ä»¶å¹¶ä¸”å¿…é¡»é€šçŸ¥ç”¨æˆ·ä»–ä»¬å°†å¿½ç•¥æŒ‡å®šçš„ Host IP</p>
<h4 id="Long-syntax-2"><a href="#Long-syntax-2" class="headerlink" title="Long syntax"></a>Long syntax</h4><p>é•¿æ ¼å¼è¯­æ³•å…è®¸é…ç½® æ— æ³•ä»¥çŸ­æ ¼å¼è¡¨ç¤ºçš„ é™„åŠ å­—æ®µ</p>
<ul>
<li><code>target</code>: å®¹å™¨ç«¯å£</li>
<li><code>published</code>: å…¬å¼€çš„ç«¯å£ã€‚ å¯ä»¥ä½¿ç”¨è¯­æ³• <code>start-end</code> è®¾ç½®ä¸ºä¸€ä¸ªèŒƒå›´ï¼Œç„¶ååº”è¯¥æ ¹æ®å¯ç”¨ç«¯å£åœ¨æ­¤èŒƒå›´å†…åˆ†é…å®é™…ç«¯å£</li>
<li><code>host_ip</code>: Host IP æ˜ å°„ï¼ŒæœªæŒ‡å®šè¡¨ç¤ºæ‰€æœ‰ç½‘ç»œæ¥å£ (<code>0.0.0.0</code>)</li>
<li><code>protocol</code>: ç«¯å£åè®®ï¼ˆ<code>tcp</code>æˆ–<code>udp</code>ï¼‰ï¼ŒæœªæŒ‡å®šè¡¨ç¤ºä»»ä½•åè®®</li>
<li><code>mode</code>: <code>host</code> ç”¨äºåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šå‘å¸ƒä¸»æœºç«¯å£ï¼Œæˆ– <code>ingress</code> ç”¨äºè¦è´Ÿè½½å¹³è¡¡çš„ç«¯å£</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">target:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">host_ip:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">    <span class="attr">published:</span> <span class="number">8080</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">tcp</span></span><br><span class="line">    <span class="attr">mode:</span> <span class="string">host</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">target:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">host_ip:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">    <span class="attr">published:</span> <span class="number">8000</span><span class="number">-9000</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">tcp</span></span><br><span class="line">    <span class="attr">mode:</span> <span class="string">host</span></span><br></pre></td></tr></table></figure>

<h3 id="privileged"><a href="#privileged" class="headerlink" title="privileged"></a>privileged</h3><p><code>privileged</code> å°†æœåŠ¡å®¹å™¨é…ç½®ä¸ºä»¥æå‡çš„æƒé™è¿è¡Œã€‚ æ”¯æŒå’Œå®é™…å½±å“å› å¹³å°è€Œå¼‚</p>
<h3 id="profiles"><a href="#profiles" class="headerlink" title="profiles"></a>profiles</h3><p><code>profiles</code> å®šä¹‰äº†è¦å¯ç”¨çš„æœåŠ¡çš„å‘½åé…ç½®æ–‡ä»¶åˆ—è¡¨ã€‚ æœªè®¾ç½®æ—¶ï¼ŒæœåŠ¡å§‹ç»ˆå¯ç”¨</p>
<p>å¦‚æœå­˜åœ¨ï¼Œ<code>profiles</code> åº”è¯¥éµå¾ª <code>[a-zA-Z0-9][a-zA-Z0-9_.-]+</code> çš„æ­£åˆ™è¡¨è¾¾å¼æ ¼å¼</p>
<h3 id="pull-policy"><a href="#pull-policy" class="headerlink" title="pull_policy"></a>pull_policy</h3><p><code>pull_policy</code> å®šä¹‰ Compose å®ç°åœ¨å¼€å§‹æ‹‰å–é•œåƒæ—¶å°†åšå‡ºçš„å†³å®š. å¯èƒ½çš„å€¼æ˜¯:</p>
<ul>
<li><code>always</code>: Compose å®ç°åº”è¯¥æ€»æ˜¯ä» registry ä¸­æ‹‰å–é•œåƒ</li>
<li><code>never</code>: Compose å®ç°ä¸åº”è¯¥ä» registry ä¸­æå–é•œåƒï¼Œå¹¶ä¸”åº”è¯¥ä¾èµ–äºå¹³å°ç¼“å­˜çš„é•œåƒã€‚ å¦‚æœæ²¡æœ‰ç¼“å­˜é•œåƒï¼Œåˆ™å¿…é¡»æŠ¥å‘Šå¤±è´¥</li>
<li><code>missing</code>: ä»…å½“å¹³å°ç¼“å­˜ä¸­ä¸å¯ç”¨æ—¶ï¼ŒCompose å®ç°æ‰åº”è¯¥æ‹‰å–é•œåƒã€‚ è¿™åº”è¯¥æ˜¯æ²¡æœ‰æ„å»ºæ”¯æŒçš„ Compose å®ç°çš„é»˜è®¤é€‰é¡¹. <code>if_not_present</code> åº”è¯¥è¢«è§†ä¸ºæ­¤å€¼çš„åˆ«åï¼Œä»¥å®ç°å‘åå…¼å®¹æ€§</li>
<li><code>build</code>: Compose å®ç°åº”è¯¥æ„å»ºé•œåƒã€‚ å¦‚æœå·²ç»å­˜åœ¨ï¼ŒCompose å®ç°åº”è¯¥é‡å»ºé•œåƒ</li>
</ul>
<p>å¦‚æœ <code>pull_policy</code> å’Œ <code>build</code> éƒ½å­˜åœ¨ï¼Œ Compose å®ç°åº”è¯¥é»˜è®¤æ„å»ºé•œåƒã€‚ Compose å®ç°å¯ä»¥è¦†ç›–å·¥å…·é“¾ä¸­çš„è¿™ç§è¡Œä¸º</p>
<h3 id="read-only"><a href="#read-only" class="headerlink" title="read_only"></a>read_only</h3><p><code>read_only</code> å°†æœåŠ¡å®¹å™¨é…ç½®ä¸ºä½¿ç”¨åªè¯»æ–‡ä»¶ç³»ç»Ÿåˆ›å»º</p>
<h3 id="restart"><a href="#restart" class="headerlink" title="restart"></a>restart</h3><p><code>restart</code> å®šä¹‰äº†å¹³å°å°†åœ¨å®¹å™¨ç»ˆæ­¢æ—¶åº”ç”¨çš„ç­–ç•¥</p>
<ul>
<li><code>no</code>: é»˜è®¤é‡å¯ç­–ç•¥ã€‚ åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½ä¸é‡å¯å®¹å™¨</li>
<li><code>always</code>: è¯¥ç­–ç•¥å§‹ç»ˆä¼šé‡æ–°å¯åŠ¨å®¹å™¨ï¼Œç›´åˆ°å°†å…¶åˆ é™¤</li>
<li><code>on-failure</code>: å¦‚æœé€€å‡ºä»£ç æŒ‡ç¤ºé”™è¯¯ï¼Œè¯¥ç­–ç•¥ä¼šé‡æ–°å¯åŠ¨å®¹å™¨</li>
<li><code>unless-stopped</code>: æ— è®ºé€€å‡ºä»£ç å¦‚ä½•ï¼Œè¯¥ç­–ç•¥éƒ½ä¼šé‡æ–°å¯åŠ¨å®¹å™¨ï¼Œä½†ä¼šåœ¨æœåŠ¡åœæ­¢æˆ–åˆ é™¤æ—¶åœæ­¢é‡æ–°å¯åŠ¨</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">restart:</span> <span class="string">&quot;no&quot;</span></span><br><span class="line"><span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"><span class="attr">restart:</span> <span class="string">on-failure</span></span><br><span class="line"><span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br></pre></td></tr></table></figure>

<h3 id="runtime"><a href="#runtime" class="headerlink" title="runtime"></a>runtime</h3><p><code>runtime</code> æŒ‡å®šç”¨äºæœåŠ¡å®¹å™¨çš„è¿è¡Œæ—¶</p>
<p><code>runtime</code> çš„å€¼æ˜¯ç‰¹å®šäºå®ç°çš„. ä¾‹å¦‚, <code>runtime</code> å¯ä»¥æ˜¯ <a class="link"   target="_blank" rel="noopener" href="https://github.com/opencontainers/runtime-spec/blob/master/implementations.md" >OCI Runtime Spec çš„å®ç°<i class="fas fa-external-link-alt"></i></a> çš„åç§°ï¼Œä¾‹å¦‚â€œruncâ€</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">web:</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">busybox:latest</span></span><br><span class="line">  <span class="attr">command:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">runtime:</span> <span class="string">runc</span></span><br></pre></td></tr></table></figure>

<h3 id="scale"><a href="#scale" class="headerlink" title="scale"></a>scale</h3><p>å·²åºŸå¼ƒ. ä½¿ç”¨ <a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/deploy/#replicas" >deploy&#x2F;replicas<i class="fas fa-external-link-alt"></i></a></p>
<h3 id="secrets"><a href="#secrets" class="headerlink" title="secrets"></a>secrets</h3><p><code>secrets</code> æˆäºˆ å¯¹åŸºäºæ¯ä¸ªæœåŠ¡çš„ <a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/#secrets" >secrets<i class="fas fa-external-link-alt"></i></a> å®šä¹‰çš„ æ•æ„Ÿæ•°æ®çš„è®¿é—®æƒé™. æ”¯æŒä¸¤ç§ä¸åŒçš„è¯­æ³•å˜ä½“ï¼šçŸ­è¯­æ³•å’Œé•¿è¯­æ³•</p>
<p>å¦‚æœ secret åœ¨å¹³å°ä¸Šä¸å­˜åœ¨æˆ–æœªåœ¨æ­¤ Compose æ–‡ä»¶çš„ <code>secrets</code> éƒ¨åˆ†ä¸­å®šä¹‰ï¼Œåˆ™ Compose å®ç°å¿…é¡»æŠ¥å‘Šé”™è¯¯</p>
<h4 id="Short-syntax-3"><a href="#Short-syntax-3" class="headerlink" title="Short syntax"></a>Short syntax</h4><p>çŸ­è¯­æ³•å˜ä½“ä»…æŒ‡å®š secret åç§°. è¿™å°†æˆäºˆå®¹å™¨å¯¹ secret çš„è®¿é—®æƒé™ï¼Œå¹¶å°†å…¶ä»¥åªè¯»æ–¹å¼æŒ‚è½½åˆ°å®¹å™¨å†…çš„ <code>/run/secrets/&lt;secret_name&gt;</code>. æºåç§°å’Œç›®æ ‡æŒ‚è½½ç‚¹éƒ½è®¾ç½®ä¸º secret åç§°</p>
<p>ä»¥ä¸‹ç¤ºä¾‹ä½¿ç”¨ç®€çŸ­è¯­æ³•æˆäºˆ <code>frontend</code> æœåŠ¡è®¿é—® <code>server-certificate</code> å¯†é’¥çš„æƒé™</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">frontend:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">awesome/webapp</span></span><br><span class="line">    <span class="attr">secrets:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">server-certificate</span></span><br><span class="line"><span class="attr">secrets:</span></span><br><span class="line">  <span class="attr">servce-certificate:</span></span><br><span class="line">    <span class="attr">file:</span> <span class="string">./server.cert</span></span><br></pre></td></tr></table></figure>

<h4 id="Long-syntax-3"><a href="#Long-syntax-3" class="headerlink" title="Long syntax"></a>Long syntax</h4><p>é•¿è¯­æ³•ä¸ºå¦‚ä½•åœ¨æœåŠ¡çš„å®¹å™¨ä¸­åˆ›å»º secret æä¾›äº†æ›´å¤šçš„ç²’åº¦</p>
<ul>
<li><code>source</code>: å¹³å°ä¸Šå­˜åœ¨çš„ secret åç§°</li>
<li><code>target</code>: è¦æŒ‚è½½åœ¨æœåŠ¡ä»»åŠ¡å®¹å™¨ä¸­çš„ <code>/run/secrets/</code> ä¸­çš„æ–‡ä»¶çš„åç§°ã€‚ å¦‚æœæœªæŒ‡å®šï¼Œåˆ™é»˜è®¤ä¸º <code>source</code></li>
<li><code>uid</code> å’Œ <code>gid</code>: æ‹¥æœ‰æœåŠ¡ä»»åŠ¡å®¹å™¨ä¸­ <code>/run/secrets/</code> ä¸­æ–‡ä»¶çš„æ•°å­— UID æˆ– GIDã€‚ é»˜è®¤å€¼ä¸ºè¿è¡Œå®¹å™¨çš„ USER</li>
<li><code>mode</code>: åœ¨æœåŠ¡çš„ä»»åŠ¡å®¹å™¨ä¸­çš„ <code>/run/secrets/</code> ä¸­æŒ‚è½½æ–‡ä»¶çš„<a class="link"   target="_blank" rel="noopener" href="http://permissions-calculator.org/" >æƒé™<i class="fas fa-external-link-alt"></i></a>ï¼Œä»¥å…«è¿›åˆ¶è¡¨ç¤ºã€‚ é»˜è®¤å€¼ä¸ºå…¨å±€å¯è¯»æƒé™ï¼ˆæ¨¡å¼ 0444ï¼‰ã€‚ å¦‚æœè®¾ç½®äº†å¯å†™ä½ï¼Œåˆ™å¿…é¡»å¿½ç•¥ã€‚ å¯æ‰§è¡Œä½å¯ä»¥è®¾ç½®</li>
</ul>
<p>ä»¥ä¸‹ç¤ºä¾‹å°†å®¹å™¨å†…çš„ <code>server-certificate</code> secret æ–‡ä»¶çš„åç§°è®¾ç½®ä¸º <code>server.crt</code>ï¼Œå°†æ¨¡å¼è®¾ç½®ä¸º <code>0440</code>ï¼ˆç»„å¯è¯»ï¼‰å¹¶å°†ç”¨æˆ·å’Œç»„è®¾ç½®ä¸º <code>103</code><br>s</p>
<p><code>server-certificate</code> secret çš„å€¼ç”±å¹³å°é€šè¿‡æŸ¥æ‰¾æä¾›ï¼Œå¹¶ä¸” secret ç”Ÿå‘½å‘¨æœŸä¸ç”± Compose å®ç°ç›´æ¥ç®¡ç†</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">frontent:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">awesome/webapp</span></span><br><span class="line">    <span class="attr">secrets:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">source:</span> <span class="string">server-certificate</span></span><br><span class="line">        <span class="attr">target:</span> <span class="string">server.cert</span></span><br><span class="line">        <span class="attr">uid:</span> <span class="string">&quot;103&quot;</span></span><br><span class="line">        <span class="attr">gid:</span> <span class="string">&quot;103&quot;</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="number">0440</span></span><br><span class="line"><span class="attr">secrets:</span></span><br><span class="line">  <span class="attr">server-certificate:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>æœåŠ¡å¯ä»¥è¢«æˆäºˆè®¿é—®å¤šä¸ª secret çš„æƒé™ã€‚ å¯ä»¥åœ¨åŒä¸€ä¸ª Compose æ–‡ä»¶ä¸­ä½¿ç”¨ secrets çš„é•¿è¯­æ³•å’ŒçŸ­è¯­æ³•ã€‚ åœ¨é¡¶çº§ <code>secrets</code> ä¸­å®šä¹‰ä¸€ä¸ª secret ç»ä¸èƒ½æš—ç¤ºæˆäºˆä»»ä½•æœåŠ¡å¯¹å…¶çš„è®¿é—®æƒé™ã€‚ æ­¤ç±»æˆæƒå¿…é¡»åœ¨æœåŠ¡è§„èŒƒä¸­æ˜ç¡®ä½œä¸º <a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/#secrets" >secrets<i class="fas fa-external-link-alt"></i></a> æœåŠ¡å…ƒç´ </p>
<h3 id="security-opt"><a href="#security-opt" class="headerlink" title="security_opt"></a>security_opt</h3><p><code>security_opt</code> è¦†ç›–æ¯ä¸ªå®¹å™¨çš„é»˜è®¤æ ‡ç­¾æ–¹æ¡ˆ</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">security_opt:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">label:user:USER</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">label:role:ROLE</span></span><br></pre></td></tr></table></figure>

<h3 id="shm-size"><a href="#shm-size" class="headerlink" title="shm_size"></a>shm_size</h3><p><code>shm_size</code> é…ç½®æœåŠ¡å®¹å™¨å…è®¸çš„å…±äº«å†…å­˜ï¼ˆLinux ä¸Šçš„<code>/dev/shm</code> åˆ†åŒºï¼‰çš„å¤§å°ã€‚ æŒ‡å®šä¸º<a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/#specifying-byte-values" >å­—èŠ‚å€¼<i class="fas fa-external-link-alt"></i></a></p>
<h3 id="stdin-open"><a href="#stdin-open" class="headerlink" title="stdin_open"></a>stdin_open</h3><p><code>stdin_open</code> å°†æœåŠ¡å®¹å™¨é…ç½®ä¸ºä½¿ç”¨åˆ†é…çš„æ ‡å‡†è¾“å…¥è¿è¡Œ</p>
<h3 id="stop-grace-period"><a href="#stop-grace-period" class="headerlink" title="stop_grace_period"></a>stop_grace_period</h3><p><code>stop_grace_period</code> æŒ‡å®š Compose å®ç°åœ¨å°è¯•åœæ­¢å®¹å™¨æ—¶å¿…é¡»ç­‰å¾…å¤šé•¿æ—¶é—´ï¼Œå¦‚æœå®ƒä¸å¤„ç† SIGTERMï¼ˆæˆ–ä½¿ç”¨ <code>stop_signal</code> æŒ‡å®šçš„ä»»ä½•åœæ­¢ä¿¡å·ï¼‰ï¼Œç„¶åå†å‘é€ SIGKILLã€‚ æŒ‡å®šä¸º<a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/#specifying-durations" >æŒç»­æ—¶é—´<i class="fas fa-external-link-alt"></i></a></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">stop_grace_period:</span> <span class="string">1s</span></span><br><span class="line"><span class="attr">stop_grace_period:</span> <span class="string">1m30s</span></span><br></pre></td></tr></table></figure>

<p>é»˜è®¤å€¼æ˜¯å®¹å™¨åœ¨å‘é€ SIGKILL ä¹‹å‰é€€å‡ºçš„ 10 ç§’</p>
<h3 id="stop-signal"><a href="#stop-signal" class="headerlink" title="stop_signal"></a>stop_signal</h3><p><code>stop_signal</code> å®šä¹‰äº† Compose å®ç°å¿…é¡»ç”¨æ¥åœæ­¢æœåŠ¡å®¹å™¨çš„ä¿¡å·ã€‚ å¦‚æœæœªè®¾ç½®çš„å®¹å™¨è¢« Compose å®ç°é€šè¿‡å‘é€ <code>SIGTERM</code> åœæ­¢</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">stop_signal:</span> <span class="string">SIGUSER1</span></span><br></pre></td></tr></table></figure>

<h3 id="storage-opt"><a href="#storage-opt" class="headerlink" title="storage_opt"></a>storage_opt</h3><p><code>storage_opt</code> å®šä¹‰æœåŠ¡çš„å­˜å‚¨é©±åŠ¨ç¨‹åºé€‰é¡¹</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">storage_opt:</span></span><br><span class="line">  <span class="attr">size:</span> <span class="string">&#x27;1G&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="sysctls"><a href="#sysctls" class="headerlink" title="sysctls"></a>sysctls</h3><p><code>sysctls</code> å®šä¹‰è¦åœ¨å®¹å™¨ä¸­è®¾ç½®çš„å†…æ ¸å‚æ•°ã€‚ <code>sysctls</code> å¯ä»¥ä½¿ç”¨æ•°ç»„æˆ–æ˜ å°„</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">sysctls:</span></span><br><span class="line">  <span class="attr">net.core.somaxconn:</span> <span class="number">1024</span></span><br><span class="line">  <span class="attr">net.ipv4.tcp_syncookies:</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">sysctls:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">net.core.somaxconn=1024</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">net.ipv4.tcp_syncookies=0</span></span><br></pre></td></tr></table></figure>

<p>æ‚¨åªèƒ½ä½¿ç”¨åœ¨å†…æ ¸ä¸­å‘½åç©ºé—´çš„ sysctlã€‚ Docker ä¸æ”¯æŒæ›´æ”¹å®¹å™¨å†…çš„ sysctls å› ä¸ºè¿™ä¹Ÿä¼šä¿®æ”¹ä¸»æœºç³»ç»Ÿ</p>
<p>æœ‰å…³æ”¯æŒçš„ sysctls çš„æ¦‚è¿°ï¼Œè¯·å‚é˜…<a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/run/#configure-namespaced-kernel-parameters-sysctls-at-runtime" >åœ¨è¿è¡Œæ—¶é…ç½®å‘½åç©ºé—´å†…æ ¸å‚æ•° (sysctls)<i class="fas fa-external-link-alt"></i></a></p>
<h3 id="tmpfs"><a href="#tmpfs" class="headerlink" title="tmpfs"></a>tmpfs</h3><p><code>tmpfs</code> åœ¨å®¹å™¨å†…æŒ‚è½½ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿã€‚ å¯ä»¥æ˜¯å•ä¸ªå€¼æˆ–åˆ—è¡¨</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">tmpfs:</span> <span class="string">/run</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">tmpfs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">/run</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">/tmp</span></span><br></pre></td></tr></table></figure>

<h3 id="tty"><a href="#tty" class="headerlink" title="tty"></a>tty</h3><p><code>tty</code> é…ç½®æœåŠ¡å®¹å™¨ä»¥ä½¿ç”¨ TTY è¿è¡Œ</p>
<h3 id="ulimits"><a href="#ulimits" class="headerlink" title="ulimits"></a>ulimits</h3><p><code>ulimits</code> è¦†ç›–å®¹å™¨çš„é»˜è®¤ ulimitsã€‚ è¦ä¹ˆå°†å•ä¸ªé™åˆ¶æŒ‡å®šä¸ºæ•´æ•°ï¼Œè¦ä¹ˆå°†è½¯&#x2F;ç¡¬é™åˆ¶æŒ‡å®šä¸ºæ˜ å°„</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ulimits:</span></span><br><span class="line">  <span class="attr">nproc:</span> <span class="number">65535</span></span><br><span class="line">  <span class="attr">nofile:</span></span><br><span class="line">    <span class="attr">soft:</span> <span class="number">20000</span></span><br><span class="line">    <span class="attr">hard:</span> <span class="number">40000</span></span><br></pre></td></tr></table></figure>

<h3 id="user"><a href="#user" class="headerlink" title="user"></a>user</h3><p><code>user</code> è¦†ç›–ç”¨äºè¿è¡Œå®¹å™¨è¿›ç¨‹çš„ç”¨æˆ·ã€‚ é»˜è®¤æ˜¯ç”±é•œåƒè®¾ç½®çš„ï¼ˆå³ Dockerfile <code>USER</code>ï¼‰ï¼Œå¦‚æœæœªè®¾ç½®ï¼Œåˆ™ä¸º <code>root</code></p>
<h3 id="userns-mode"><a href="#userns-mode" class="headerlink" title="userns_mode"></a>userns_mode</h3><p><code>userns_mode</code> è®¾ç½®æœåŠ¡çš„ç”¨æˆ·å‘½åç©ºé—´ã€‚ æ”¯æŒçš„å€¼æ˜¯ç‰¹å®šäºå¹³å°çš„ï¼Œå¯èƒ½å–å†³äºå¹³å°é…ç½®</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">userns_mode:</span> <span class="string">&quot;host&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="volumes"><a href="#volumes" class="headerlink" title="volumes"></a>volumes</h3><p><code>volumes</code> å®šä¹‰äº†æœåŠ¡å®¹å™¨å¿…é¡»å¯ä»¥è®¿é—®çš„æŒ‚è½½å®¿ä¸»æœºè·¯å¾„æˆ–å‘½åå·</p>
<p>å¦‚æœæŒ‚è½½æ˜¯å®¿ä¸»æœºè·¯å¾„å¹¶ä¸”ä»…ç”±å•ä¸ªæœåŠ¡ä½¿ç”¨ï¼Œåˆ™å¯ä»¥å°†å…¶å£°æ˜ä¸ºæœåŠ¡å®šä¹‰çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯é¡¶çº§ <code>volumes</code> é”®</p>
<p>è¦è·¨å¤šä¸ªæœåŠ¡é‡ç”¨ä¸€ä¸ªå·ï¼Œå¿…é¡»åœ¨ <a target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/#volumes-top-level-element">é¡¶å±‚<code>volumes</code>é”®</a> ä¸­å£°æ˜ä¸€ä¸ªå‘½åå·</p>
<p>æ­¤ç¤ºä¾‹æ˜¾ç¤ºäº† <code>backend</code> æœåŠ¡ä½¿ç”¨çš„å‘½åå·ï¼ˆ<code>db-data</code>ï¼‰ï¼Œä»¥åŠä¸ºå•ä¸ªæœåŠ¡å®šä¹‰çš„ç»‘å®šæŒ‚è½½</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">backend:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">awesome/backend</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">volume</span></span><br><span class="line">        <span class="attr">source:</span> <span class="string">db-data</span></span><br><span class="line">        <span class="attr">target:</span> <span class="string">/data</span></span><br><span class="line">        <span class="attr">volume:</span></span><br><span class="line">          <span class="attr">nocopy:</span> <span class="literal">true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">build</span></span><br><span class="line">        <span class="attr">source:</span> <span class="string">/var/run/postgres/postgres.sock</span></span><br><span class="line">        <span class="attr">target:</span> <span class="string">/var/run/postgres/postgres.sock</span></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">db-data:</span></span><br></pre></td></tr></table></figure>

<h4 id="Short-syntax-4"><a href="#Short-syntax-4" class="headerlink" title="Short syntax"></a>Short syntax</h4><p>ç®€çŸ­è¯­æ³•ä½¿ç”¨å¸¦æœ‰å†’å·åˆ†éš”å€¼çš„å•ä¸ªå­—ç¬¦ä¸²æ¥æŒ‡å®šå·æŒ‚è½½ (<code>VOLUME:CONTAINER_PATH</code>) æˆ–è®¿é—®æ¨¡å¼ (<code>VOLUME:CONTAINER_PATH:ACCESS_MODE</code>)</p>
<ul>
<li><code>VOLUME</code>: å¯ä»¥æ˜¯æ‰˜ç®¡å®¹å™¨çš„å¹³å°ä¸Šçš„ä¸»æœºè·¯å¾„ï¼ˆç»‘å®šæŒ‚è½½ï¼‰æˆ–å·å</li>
<li><code>CONTAINER_PATH</code>: å®¹å™¨ä¸­æŒ‚è½½å·çš„è·¯å¾„</li>
<li><code>ACCESS_MODE</code>: æ˜¯ä¸€ä¸ªé€—å·åˆ†éš” <code>,</code> çš„é€‰é¡¹åˆ—è¡¨ï¼Œå¯ä»¥è®¾ç½®ä¸º:<ul>
<li><code>rw</code>: è¯»å†™è®¿é—® (é»˜è®¤)</li>
<li><code>ro</code>: åªè¯»è®¿é—®</li>
<li><code>z</code>: SELinux é€‰é¡¹, è¡¨ç¤ºç»‘å®šæŒ‚è½½ä¸»æœºå†…å®¹æ˜¯åœ¨å¤šä¸ªå®¹å™¨ä¹‹é—´å…±äº«</li>
<li><code>Z</code>: SELinux é€‰é¡¹, è¡¨ç¤ºç»‘å®šæŒ‚è½½ä¸»æœºå†…å®¹æ˜¯ç§æœ‰çš„ï¼Œå¯¹å…¶ä»–å®¹å™¨ä¸å…±äº«</li>
</ul>
</li>
</ul>
<p>æ³¨æ„: SELinux re-labeling ç»‘å®šæŒ‚è½½é€‰é¡¹åœ¨æ²¡æœ‰ SELinux çš„å¹³å°ä¸Šè¢«å¿½ç•¥</p>
<p>æ³¨æ„: ç›¸å¯¹ä¸»æœºçš„è·¯å¾„å¿…é¡»ä»…ç”±éƒ¨ç½²åˆ°æœ¬åœ°å®¹å™¨è¿è¡Œæ—¶çš„ Compose å®ç°æ”¯æŒã€‚ è¿™æ˜¯å› ä¸ºç›¸å¯¹è·¯å¾„æ˜¯ä» Compose æ–‡ä»¶çš„çˆ¶ç›®å½•è§£æçš„ï¼Œè¯¥çˆ¶ç›®å½•ä»…é€‚ç”¨äºæœ¬åœ°æƒ…å†µã€‚ éƒ¨ç½²åˆ°éæœ¬åœ°å¹³å°çš„ Compose å®ç°å¿…é¡»æ‹’ç»ä½¿ç”¨ç›¸å¯¹ä¸»æœºè·¯å¾„å¹¶å‡ºç°é”™è¯¯çš„ Compose æ–‡ä»¶ã€‚ä¸ºé¿å…å‘½åå·çš„æ­§ä¹‰ï¼Œç›¸å¯¹è·¯å¾„åº”å§‹ç»ˆä»¥ <code>.</code> æˆ– <code>..</code> å¼€å¤´</p>
<h4 id="Long-syntax-4"><a href="#Long-syntax-4" class="headerlink" title="Long syntax"></a>Long syntax</h4><p>é•¿æ ¼å¼è¯­æ³•å…è®¸é…ç½®æ— æ³•ä»¥çŸ­æ ¼å¼è¡¨ç¤ºçš„é™„åŠ å­—æ®µ</p>
<ul>
<li><code>type</code>: æŒ‚è½½ç±»å‹ <code>volume</code>,<code>bind</code>,<code>tmpfs</code>,<code>npipe</code></li>
<li><code>source</code>: æŒ‚è½½çš„æºã€ä¸»æœºä¸Šç”¨äºç»‘å®šæŒ‚è½½çš„è·¯å¾„æˆ–åœ¨<a target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/#volumes-top-level-element">é¡¶å±‚ <code>volumes</code> é”®</a>ä¸­å®šä¹‰çš„å·çš„åç§°ã€‚ ä¸é€‚ç”¨äº tmpfs æŒ‚è½½</li>
<li><code>target</code>: å®¹å™¨ä¸­æŒ‚è½½å·çš„è·¯å¾„</li>
<li><code>read_only</code>: å°†å·è®¾ç½®ä¸ºåªè¯»çš„æ ‡å¿—</li>
<li><code>bind</code>: é…ç½®é¢å¤–çš„ç»‘å®šé€‰é¡¹<ul>
<li><code>propagation</code>: ç”¨äºç»‘å®šçš„ä¼ æ’­æ¨¡å¼</li>
<li><code>create_host_path</code>: å¦‚æœæ²¡æœ‰ä»»ä½•å†…å®¹ï¼Œè¯·åœ¨ä¸»æœºä¸Šçš„æºè·¯å¾„åˆ›å»ºä¸€ä¸ªç›®å½•ã€‚ å¦‚æœè·¯å¾„ä¸Šæœ‰ä¸œè¥¿ï¼Œä»€ä¹ˆä¹Ÿä¸åšã€‚ ä¸ºäº†å‘åå…¼å®¹ docker-compose legacy çš„çŸ­è¯­æ³•è‡ªåŠ¨æš—ç¤ºäº†è¿™ä¸€ç‚¹</li>
<li><code>selinux</code>: SELinux re-labeling é€‰é¡¹ <code>z</code> (å…±äº«) æˆ– <code>Z</code> (ç§æœ‰)</li>
</ul>
</li>
<li><code>volume</code>: é…ç½®é¢å¤–çš„å·é€‰é¡¹<ul>
<li><code>nocopy</code>: åˆ›å»ºå·æ—¶åœæ­¢ä»å®¹å™¨å¤åˆ¶æ•°æ®çš„æ ‡å¿—</li>
</ul>
</li>
<li><code>tmpfs</code>: é…ç½®é¢å¤–çš„ tmpfs é€‰é¡¹<ul>
<li><code>size</code>: tmpfs æŒ‚è½½çš„å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ï¼ˆæ•°å­—æˆ–å­—èŠ‚å•ä½ï¼‰</li>
</ul>
</li>
<li><code>consistency</code>: æŒ‚è½½çš„ä¸€è‡´æ€§è¦æ±‚ã€‚ å¯ç”¨å€¼æ˜¯ç‰¹å®šäºå¹³å°çš„</li>
</ul>
<h3 id="volumes-from"><a href="#volumes-from" class="headerlink" title="volumes_from"></a>volumes_from</h3><p><code>volumes_from</code> æŒ‚è½½æ¥è‡ªå¦ä¸€ä¸ªæœåŠ¡æˆ–å®¹å™¨çš„æ‰€æœ‰å·ï¼Œå¯é€‰æ‹©æŒ‡å®šåªè¯»è®¿é—® (ro) æˆ–è¯»å†™ (rw)ã€‚ å¦‚æœæœªæŒ‡å®šè®¿é—®çº§åˆ«ï¼Œåˆ™å¿…é¡»ä½¿ç”¨è¯»å†™</p>
<p>å­—ç¬¦ä¸²å€¼å®šä¹‰äº† Compose åº”ç”¨ç¨‹åºæ¨¡å‹ä¸­çš„å¦ä¸€ä¸ªæœåŠ¡æ¥æŒ‚è½½å·. <code>container:</code> å‰ç¼€ï¼ˆå¦‚æœæ”¯æŒï¼‰å…è®¸ä»ä¸å— Compose å®ç°ç®¡ç†çš„å®¹å™¨ä¸­æŒ‚è½½å·</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">volumes_from:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">service_name</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">service_name:ro</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">container:container_name</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">container:container_name:rw</span></span><br></pre></td></tr></table></figure>

<h3 id="working-dir"><a href="#working-dir" class="headerlink" title="working_dir"></a>working_dir</h3><p><code>working_dir</code> è¦†ç›–äº†é•œåƒæŒ‡å®šçš„å®¹å™¨å·¥ä½œç›®å½•ï¼ˆå³ Dockerfile <code>WORKDIR</code>ï¼‰</p>
<h2 id="Networks-top-level-element-é¡¶çº§å…ƒç´ -networks"><a href="#Networks-top-level-element-é¡¶çº§å…ƒç´ -networks" class="headerlink" title="Networks top-level element (é¡¶çº§å…ƒç´  networks)"></a>Networks top-level element (é¡¶çº§å…ƒç´  <code>networks</code>)</h2><p>ç½‘ç»œæ˜¯å…è®¸æœåŠ¡ç›¸äº’é€šä¿¡çš„å±‚ã€‚ å‘æœåŠ¡å…¬å¼€çš„ç½‘ç»œæ¨¡å‹ä»…é™äºä¸ç›®æ ‡æœåŠ¡å’Œå¤–éƒ¨èµ„æºçš„ç®€å• IP è¿æ¥ï¼Œè€Œç½‘ç»œå®šä¹‰å…è®¸å¾®è°ƒå¹³å°æä¾›çš„å®é™…å®ç°</p>
<p>å¯ä»¥é€šè¿‡åœ¨é¡¶å±‚ <code>networks</code> éƒ¨åˆ†ä¸‹æŒ‡å®šç½‘ç»œåç§°æ¥åˆ›å»ºç½‘ç»œã€‚ æœåŠ¡å¯ä»¥é€šè¿‡åœ¨æœåŠ¡ <code>networks</code> å°èŠ‚ä¸‹æŒ‡å®šç½‘ç»œåç§°æ¥è¿æ¥åˆ°ç½‘ç»œ</p>
<p>åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œåœ¨è¿è¡Œæ—¶ï¼Œå°†åˆ›å»ºç½‘ç»œ <code>front-tier</code> å’Œ <code>back-tier</code>ï¼Œå¹¶å°† <code>frontend</code> æœåŠ¡è¿æ¥åˆ° <code>front-tier</code> ç½‘ç»œå’Œ <code>back-tier</code> ç½‘ç»œ</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">frontend:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">awesome/webapp</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">front-tier</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">back-tier</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">front-tier:</span></span><br><span class="line">  <span class="string">back-tier</span></span><br></pre></td></tr></table></figure>

<h3 id="driver"><a href="#driver" class="headerlink" title="driver"></a>driver</h3><p><code>driver</code> æŒ‡å®šè¯¥ç½‘ç»œåº”è¯¥ä½¿ç”¨å“ªä¸ªé©±åŠ¨ç¨‹åºã€‚ å¦‚æœé©±åŠ¨ç¨‹åºåœ¨å¹³å°ä¸Šä¸å¯ç”¨ï¼Œåˆ™ Compose å®ç°å¿…é¡»è¿”å›é”™è¯¯</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">driver:</span> <span class="string">overlay</span></span><br></pre></td></tr></table></figure>

<p>é»˜è®¤å€¼å’Œå¯ç”¨å€¼æ˜¯ç‰¹å®šäºå¹³å°çš„ã€‚ Compose è§„èŒƒå¿…é¡»æ”¯æŒä»¥ä¸‹ç‰¹å®šé©±åŠ¨ç¨‹åºï¼š<code>none</code> å’Œ <code>host</code></p>
<ul>
<li><code>host</code> ä½¿ç”¨å®¿ä¸»æœºçš„ç½‘ç»œå †æ ˆ</li>
<li><code>none</code> å…³é—­ç½‘ç»œ</li>
</ul>
<h4 id="host-or-none"><a href="#host-or-none" class="headerlink" title="host or none"></a>host or none</h4><p>ä½¿ç”¨è¯¸å¦‚ <code>host</code> å’Œ <code>none</code> ç­‰å†…ç½®ç½‘ç»œçš„è¯­æ³•æ˜¯ä¸åŒçš„ï¼Œå› ä¸ºè¿™äº›ç½‘ç»œéšå«åœ°å­˜åœ¨äº Compose å®ç°çš„èŒƒå›´ä¹‹å¤–</p>
<p>è¦ä½¿ç”¨å®ƒä»¬ï¼Œå¿…é¡»å®šä¹‰ä¸€ä¸ªåä¸º <code>host</code> æˆ– <code>none</code> çš„å¤–éƒ¨ç½‘ç»œä»¥åŠ Compose å®ç°å¯ä»¥ä½¿ç”¨çš„åˆ«åï¼ˆä»¥ä¸‹ç¤ºä¾‹ä¸­çš„ <code>hostnet</code> æˆ– <code>nonet</code>ï¼‰ï¼Œç„¶åæˆäºˆæœåŠ¡è®¿é—®è¯¥ç½‘ç»œçš„æƒé™ ä½¿ç”¨å®ƒçš„åˆ«å</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="attr">hostnet:</span> &#123;&#125;</span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">hostnet:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">host</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="attr">nonet:</span> &#123;&#125;</span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">nonet:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">none</span></span><br></pre></td></tr></table></figure>

<h3 id="driver-opts"><a href="#driver-opts" class="headerlink" title="driver_opts"></a>driver_opts</h3><p><code>driver_opts</code> æŒ‡å®šé€‰é¡¹åˆ—è¡¨ä½œä¸ºé”®å€¼å¯¹ä¼ é€’ç»™è¯¥ç½‘ç»œçš„é©±åŠ¨ç¨‹åºã€‚ è¿™äº›é€‰é¡¹å–å†³äºé©±åŠ¨ç¨‹åº - è¯·å‚é˜…é©±åŠ¨ç¨‹åºæ–‡æ¡£ä»¥è·å–æ›´å¤šä¿¡æ¯ã€‚ å¯é€‰</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">driver_opts:</span></span><br><span class="line">  <span class="attr">foo:</span> <span class="string">&quot;bar&quot;</span></span><br><span class="line">  <span class="attr">baz:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h3 id="attachable"><a href="#attachable" class="headerlink" title="attachable"></a>attachable</h3><p>å¦‚æœ <code>attachable</code> è®¾ç½®ä¸º <code>true</code>ï¼Œé‚£ä¹ˆç‹¬ç«‹å®¹å™¨åº”è¯¥èƒ½å¤Ÿé™„åŠ åˆ°è¿™ä¸ªç½‘ç»œï¼Œé™¤äº†æœåŠ¡ã€‚ å¦‚æœç‹¬ç«‹å®¹å™¨è¿æ¥åˆ°ç½‘ç»œï¼Œå®ƒå¯ä»¥ä¸æœåŠ¡å’Œå…¶ä»–ä¹Ÿè¿æ¥åˆ°ç½‘ç»œçš„ç‹¬ç«‹å®¹å™¨é€šä¿¡</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">mynet1:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">overlay</span></span><br><span class="line">    <span class="attr">attachable:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h3 id="enable-ipv6"><a href="#enable-ipv6" class="headerlink" title="enable_ipv6"></a>enable_ipv6</h3><p>åœ¨è¿™ä¸ªç½‘ç»œä¸Šå¼€å¯ IPv6 ç½‘ç»œ</p>
<h3 id="ipma"><a href="#ipma" class="headerlink" title="ipma"></a>ipma</h3><p>æŒ‡å®šè‡ªå®šä¹‰ IPAM é…ç½®. è¿™æ˜¯ä¸€ä¸ªå…·æœ‰å¤šä¸ªå±æ€§çš„å¯¹è±¡ï¼Œæ¯ä¸ªå±æ€§éƒ½æ˜¯å¯é€‰çš„ï¼š</p>
<ul>
<li><code>driver</code>: è‡ªå®šä¹‰ IPAM é©±åŠ¨ç¨‹åºï¼Œè€Œä¸æ˜¯é»˜è®¤çš„</li>
<li><code>config</code>: å…·æœ‰é›¶ä¸ªæˆ–å¤šä¸ªé…ç½®å…ƒç´ çš„åˆ—è¡¨ï¼Œæ¯ä¸ªåŒ…å«<ul>
<li><code>subnet</code>: ä»£è¡¨ç½‘æ®µçš„ CIDR æ ¼å¼çš„å­ç½‘</li>
<li><code>ip_range</code>: åˆ†é…å®¹å™¨ IP çš„ IP èŒƒå›´</li>
<li><code>gateway</code>: ä¸»å­ç½‘çš„ IPv4 æˆ– IPv6 ç½‘å…³</li>
<li><code>aux_adderss</code>: ç½‘ç»œé©±åŠ¨ç¨‹åºä½¿ç”¨çš„è¾…åŠ© IPv4 æˆ– IPv6 åœ°å€ï¼Œä½œä¸ºä»ä¸»æœºååˆ° IP çš„æ˜ å°„</li>
</ul>
</li>
<li><code>options</code>: ç‰¹å®šäºé©±åŠ¨ç¨‹åºçš„é€‰é¡¹ä½œä¸ºé”®å€¼æ˜ å°„</li>
</ul>
<p>å®Œæ•´ä¾‹å­:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ipam:</span></span><br><span class="line">  <span class="attr">driver:</span> <span class="string">default</span></span><br><span class="line">  <span class="attr">config:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">subnet:</span> <span class="number">172.28</span><span class="number">.0</span><span class="number">.0</span><span class="string">/16</span></span><br><span class="line">      <span class="attr">ip_range:</span> <span class="number">172.28</span><span class="number">.5</span><span class="number">.0</span><span class="string">/24</span></span><br><span class="line">      <span class="attr">gateway:</span> <span class="number">172.28</span><span class="number">.5</span><span class="number">.254</span></span><br><span class="line">      <span class="attr">aux_addresses:</span></span><br><span class="line">        <span class="attr">host1:</span> <span class="number">172.28</span><span class="number">.1</span><span class="number">.5</span></span><br><span class="line">        <span class="attr">host2:</span> <span class="number">172.28</span><span class="number">.1</span><span class="number">.6</span></span><br><span class="line">        <span class="attr">host3:</span> <span class="number">172.28</span><span class="number">.1</span><span class="number">.7</span></span><br><span class="line">  <span class="attr">options:</span></span><br><span class="line">    <span class="attr">foo:</span> <span class="string">bar</span></span><br><span class="line">    <span class="attr">baz:</span> <span class="string">&quot;0&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="internal"><a href="#internal" class="headerlink" title="internal"></a>internal</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒCompose å®ç°å¿…é¡»æä¾›åˆ°ç½‘ç»œçš„å¤–éƒ¨è¿æ¥ã€‚ <code>internal</code> è®¾ç½®ä¸º <code>true</code> æ—¶å…è®¸åˆ›å»ºå¤–éƒ¨éš”ç¦»ç½‘ç»œ</p>
<h3 id="labels-1"><a href="#labels-1" class="headerlink" title="labels"></a>labels</h3><p>ä½¿ç”¨æ ‡ç­¾å°†å…ƒæ•°æ®æ·»åŠ åˆ°å®¹å™¨ã€‚ å¯ä»¥ä½¿ç”¨æ•°ç»„æˆ–å­—å…¸</p>
<p>ç”¨æˆ·åº”è¯¥ä½¿ç”¨åå‘ DNS ç¬¦å·æ¥é˜²æ­¢æ ‡ç­¾ä¸å…¶ä»–è½¯ä»¶ä½¿ç”¨çš„æ ‡ç­¾å†²çª</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">labels:</span></span><br><span class="line">  <span class="attr">com.example.description:</span> <span class="string">&quot;Financial transaction network&quot;</span></span><br><span class="line">  <span class="attr">com.example.department:</span> <span class="string">&quot;Finance&quot;</span></span><br><span class="line">  <span class="attr">com.example.label-with-empty-value:</span> <span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">labels:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;com.example.description=Financial transaction network&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;com.example.department=Finance&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;com.example.label-with-empty-value&quot;</span></span><br></pre></td></tr></table></figure>

<p>Compose å®ç°å¿…é¡»è®¾ç½® <code>com.docker.compose.project</code> å’Œ <code>com.docker.compose.network</code> æ ‡ç­¾</p>
<h3 id="external"><a href="#external" class="headerlink" title="external"></a>external</h3><p>å¦‚æœè®¾ç½®ä¸º <code>true</code>ï¼Œ<code>external</code> æŒ‡å®šæ­¤ç½‘ç»œçš„ç”Ÿå‘½å‘¨æœŸåœ¨åº”ç”¨ç¨‹åºä¹‹å¤–ç»´æŠ¤ã€‚ Compose å®ç°ä¸åº”è¯¥å°è¯•åˆ›å»ºè¿™äº›ç½‘ç»œï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ä¼šå¼•å‘é”™è¯¯</p>
<p>åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œ<code>proxy</code> æ˜¯é€šå¾€å¤–éƒ¨ä¸–ç•Œçš„ç½‘å…³ã€‚ ä¸å…¶å°è¯•åˆ›å»ºç½‘ç»œï¼ŒCompose å®ç°åº”è¯¥è¯¢é—®å¹³å°ä»¥è·å–ç®€å•ç§°ä¸º <code>outside</code> çš„ç°æœ‰ç½‘ç»œï¼Œå¹¶å°† <code>proxy</code> æœåŠ¡çš„å®¹å™¨è¿æ¥åˆ°å®ƒ</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">proxy:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">awesome/proxy</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">outside</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">default</span></span><br><span class="line">  <span class="attr">app:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">awesome/app</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">default</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">outside:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h3 id="name"><a href="#name" class="headerlink" title="name"></a>name</h3><p><code>name</code> è®¾ç½®æ­¤ç½‘ç»œçš„è‡ªå®šä¹‰åç§°ã€‚ åç§°å­—æ®µå¯ç”¨äºå¼•ç”¨åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„ç½‘ç»œã€‚ åç§°æŒ‰åŸæ ·ä½¿ç”¨ï¼Œä¸å—é¡¹ç›®åç§°çš„é™åˆ¶</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">network1:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">my-app-net</span></span><br></pre></td></tr></table></figure>

<p>å®ƒä¹Ÿå¯ä»¥ä¸ <code>external</code> å±æ€§ç»“åˆä½¿ç”¨æ¥å®šä¹‰ Compose å®ç°åº”è¯¥æ£€ç´¢çš„å¹³å°ç½‘ç»œï¼Œé€šå¸¸ä½¿ç”¨ä¸€ä¸ªå‚æ•°ï¼Œå› æ­¤ Compose æ–‡ä»¶ä¸éœ€è¦ç¡¬ç¼–ç è¿è¡Œæ—¶ç‰¹å®šçš„å€¼</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">network1:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;$&#123;NETWORK_ID&#125;&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="Volumes-top-level-element-é¡¶çº§å…ƒç´ -volumes"><a href="#Volumes-top-level-element-é¡¶çº§å…ƒç´ -volumes" class="headerlink" title="Volumes top-level element (é¡¶çº§å…ƒç´  volumes)"></a>Volumes top-level element (é¡¶çº§å…ƒç´  <code>volumes</code>)</h2><p>å·æ˜¯ç”±å¹³å°å®ç°çš„æŒä¹…æ•°æ®å­˜å‚¨ã€‚Composeè§„èŒƒä¸ºè£…è½½å·çš„æœåŠ¡å’Œåœ¨åŸºç¡€æ¶æ„ä¸Šåˆ†é…å·çš„é…ç½®å‚æ•°æä¾›äº†ä¸­ç«‹çš„æŠ½è±¡</p>
<p><code>volumes</code> éƒ¨åˆ†å…è®¸é…ç½®å¯è·¨å¤šä¸ªæœåŠ¡é‡ç”¨çš„å‘½åå·ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªåŒæœåŠ¡è®¾ç½®çš„ç¤ºä¾‹ï¼Œå…¶ä¸­æ•°æ®åº“çš„æ•°æ®ç›®å½•ä½œä¸ºåä¸º <code>db-data</code> çš„å·ä¸å¦ä¸€ä¸ªæœåŠ¡å…±äº«ï¼Œä»¥ä¾¿å¯ä»¥å®šæœŸå¤‡ä»½</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">backend:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">awesome/database</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db-data:/etc/data</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">backup:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">backup-service</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db-data:/var/lib/backup/data</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">db-data:</span></span><br></pre></td></tr></table></figure>

<p>é¡¶å±‚ <code>volumes</code> é”®ä¸‹çš„æ¡ç›®å¯ä»¥ä¸ºç©ºï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒä½¿ç”¨å¹³å°çš„é»˜è®¤é…ç½®æ¥åˆ›å»ºå·ã€‚ æˆ–è€…ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹é”®å¯¹å…¶è¿›è¡Œé…ç½®</p>
<h3 id="driver-1"><a href="#driver-1" class="headerlink" title="driver"></a>driver</h3><p>æŒ‡å®šåº”ä¸ºæ­¤å·ä½¿ç”¨çš„å·é©±åŠ¨ç¨‹åºã€‚ é»˜è®¤å€¼å’Œå¯ç”¨å€¼æ˜¯ç‰¹å®šäºå¹³å°çš„ã€‚ å¦‚æœé©±åŠ¨ç¨‹åºä¸å¯ç”¨ï¼ŒCompose å®ç°å¿…é¡»è¿”å›é”™è¯¯å¹¶åœæ­¢åº”ç”¨ç¨‹åºéƒ¨ç½²</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">driver:</span> <span class="string">foobar</span></span><br></pre></td></tr></table></figure>

<h3 id="driver-opts-1"><a href="#driver-opts-1" class="headerlink" title="driver_opts"></a>driver_opts</h3><p><code>driver_opts</code> å°†é€‰é¡¹åˆ—è¡¨æŒ‡å®šä¸ºé”®å€¼å¯¹ï¼Œä»¥ä¼ é€’ç»™æ­¤å·çš„é©±åŠ¨ç¨‹åºã€‚ è¿™äº›é€‰é¡¹å–å†³äºé©±åŠ¨ç¨‹åº</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">example:</span></span><br><span class="line">    <span class="attr">driver_opts:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">&quot;nfs&quot;</span></span><br><span class="line">      <span class="attr">o:</span> <span class="string">&quot;addr=10.40.0.199,nolock,soft,rw&quot;</span></span><br><span class="line">      <span class="attr">device:</span> <span class="string">&quot;:/docker/example&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="external-1"><a href="#external-1" class="headerlink" title="external"></a>external</h3><p>å¦‚æœè®¾ç½®ä¸º <code>true</code>ï¼Œåˆ™ <code>external</code> æŒ‡å®šæ­¤å·å·²å­˜åœ¨äºå¹³å°ä¸Šï¼Œå¹¶ä¸”å…¶ç”Ÿå‘½å‘¨æœŸåœ¨åº”ç”¨ç¨‹åºä¹‹å¤–è¿›è¡Œç®¡ç†ã€‚ Compose å®ç°ä¸å¾—å°è¯•åˆ›å»ºè¿™äº›å·ï¼Œå¦‚æœå®ƒä»¬ä¸å­˜åœ¨ï¼Œåˆ™å¿…é¡»è¿”å›é”™è¯¯</p>
<p>åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼ŒCompose å¹¶æ²¡æœ‰å°è¯•åˆ›å»ºä¸€ä¸ªåä¸º <code>&#123;project_name&#125;_db-data</code> çš„å·ï¼Œè€Œæ˜¯æŸ¥æ‰¾ä¸€ä¸ªåä¸º <code>db-data</code> çš„ç°æœ‰å·å¹¶å°†å…¶æŒ‚è½½åˆ° <code>åç«¯</code> æœåŠ¡çš„å®¹å™¨ä¸­</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span> </span><br><span class="line">  <span class="attr">backend:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">awesome/database</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db-data:/etc/data</span></span><br><span class="line">      </span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">db-data:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h3 id="labels-2"><a href="#labels-2" class="headerlink" title="labels"></a>labels</h3><p><code>labels</code> ç”¨äºå‘å·æ·»åŠ å…ƒæ•°æ®ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨æ•°ç»„æˆ– map</p>
<p>å»ºè®®æ‚¨ä½¿ç”¨åå‘ DNS è¡¨ç¤ºæ³•ï¼Œä»¥é˜²æ­¢æ‚¨çš„æ ‡ç­¾ä¸å…¶ä»–è½¯ä»¶ä½¿ç”¨çš„æ ‡ç­¾å†²çª</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">labels:</span></span><br><span class="line">  <span class="attr">com.example.description:</span> <span class="string">&quot;Database volume&quot;</span></span><br><span class="line">  <span class="attr">com.example.department:</span> <span class="string">&quot;IT/Ops&quot;</span></span><br><span class="line">  <span class="attr">com.example.label-with-empty-value:</span> <span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">labels:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;com.example.description=Database volume&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;com.example.department: &quot;</span><span class="string">IT/Ops&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">&quot;com.example.label-with-empty-value&quot;:</span> <span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>Compose å®ç°å¿…é¡»è®¾ç½® <code>com.docker.compose.project</code> å’Œ <code>com.docker.compose.volume</code> æ ‡ç­¾</p>
<h3 id="name-1"><a href="#name-1" class="headerlink" title="name"></a>name</h3><p><code>name</code> ä¸ºè¿™ä¸ªå·è®¾ç½®ä¸€ä¸ªè‡ªå®šä¹‰åç§°ã€‚ åç§°å­—æ®µå¯ç”¨äºå¼•ç”¨åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„å·ã€‚ è¯¥åç§°æŒ‰åŸæ ·ä½¿ç”¨ï¼Œä¸ä¼šä¸å †æ ˆåç§°å†²çª</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">data:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;my-app-data&quot;</span></span><br></pre></td></tr></table></figure>

<p>å®ƒä¹Ÿå¯ä»¥ä¸ <code>external</code> å±æ€§ç»“åˆä½¿ç”¨ã€‚ è¿™æ ·åšï¼Œç”¨äºåœ¨å¹³å°ä¸ŠæŸ¥æ‰¾å®é™…å·çš„å·çš„åç§°ä¸ Compose æ–‡ä»¶ä¸­ç”¨äºå¼•ç”¨å®ƒçš„åç§°åˆ†å¼€è®¾ç½®</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">db-data:</span></span><br><span class="line">    <span class="attr">external:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">actual-name-of-volume</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä½¿å¾—å¯ä»¥å°†æ­¤æŸ¥æ‰¾åç§°ä½œä¸º Compose æ–‡ä»¶çš„å‚æ•°ï¼Œä»¥ä¾¿å·çš„æ¨¡å‹ ID æ˜¯ç¡¬ç¼–ç çš„ï¼Œä½†å¹³å°ä¸Šçš„å®é™…å· ID åœ¨éƒ¨ç½²æœŸé—´åœ¨è¿è¡Œæ—¶è®¾ç½®</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">db-data:</span></span><br><span class="line">    <span class="attr">external:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">$&#123;DATABASE_VOLUME&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="Configs-top-level-element-é¡¶çº§å…ƒç´ -configs"><a href="#Configs-top-level-element-é¡¶çº§å…ƒç´ -configs" class="headerlink" title="Configs top-level element (é¡¶çº§å…ƒç´  configs)"></a>Configs top-level element (é¡¶çº§å…ƒç´  <code>configs</code>)</h2><p><code>Configs</code> å…è®¸æœåŠ¡è°ƒæ•´å…¶è¡Œä¸ºï¼Œè€Œæ— éœ€é‡å»º Docker æ˜ åƒã€‚ ä»æœåŠ¡çš„è§’åº¦æ¥çœ‹ï¼Œé…ç½®ä¸å·ç›¸å½“ï¼Œå› ä¸ºå®ƒä»¬è¢«æŒ‚è½½åˆ°æœåŠ¡çš„å®¹å™¨æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚ è·å–å¹³å°æä¾›çš„é…ç½®çš„å®é™…å®ç°ç»†èŠ‚å¯ä»¥ä»é…ç½®å®šä¹‰ä¸­è®¾ç½®</p>
<p>å½“æˆäºˆå¯¹é…ç½®çš„è®¿é—®æƒé™æ—¶ï¼Œé…ç½®å†…å®¹å°†ä½œä¸ºæ–‡ä»¶æŒ‚è½½åœ¨å®¹å™¨ä¸­. å®¹å™¨å†…æŒ‚è½½ç‚¹çš„ä½ç½®åœ¨ Linux å®¹å™¨ä¸­é»˜è®¤ä¸º <code>/&lt;config-name&gt;</code>ï¼Œåœ¨ Windows å®¹å™¨ä¸­é»˜è®¤ä¸º <code>C:\&lt;config-name&gt;</code></p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œé…ç½®å¿…é¡»ç”±è¿è¡Œå®¹å™¨å‘½ä»¤çš„ç”¨æˆ·æ‹¥æœ‰ï¼Œä½†å¯ä»¥è¢«æœåŠ¡é…ç½®è¦†ç›–ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œé…ç½®å¿…é¡»å…·æœ‰å…¨å±€å¯è¯»æƒé™ï¼ˆæ¨¡å¼ 0444ï¼‰ï¼Œé™¤éæœåŠ¡è¢«é…ç½®ä¸ºè¦†ç›–å®ƒ</p>
<p>æœåŠ¡åªèƒ½åœ¨ <code>configs</code> å­éƒ¨åˆ†æ˜ç¡®æˆäºˆæ—¶è®¿é—®é…ç½®</p>
<p>é¡¶çº§ <code>configs</code> å£°æ˜å®šä¹‰æˆ–å¼•ç”¨å¯ä»¥æˆäºˆæ­¤åº”ç”¨ç¨‹åºä¸­çš„æœåŠ¡çš„é…ç½®æ•°æ®ã€‚ é…ç½®çš„æ¥æºæ˜¯ <code>file</code> æˆ– <code>external</code></p>
<ul>
<li><code>file</code>: ä½¿ç”¨æŒ‡å®šè·¯å¾„ä¸­çš„æ–‡ä»¶å†…å®¹åˆ›å»ºé…ç½®</li>
<li><code>external</code>: å¦‚æœè®¾ç½®ä¸º trueï¼Œåˆ™æŒ‡å®šæ­¤é…ç½®å·²åˆ›å»ºã€‚ Compose å®ç°ä¸ä¼šå°è¯•åˆ›å»ºå®ƒï¼Œå¦‚æœå®ƒä¸å­˜åœ¨ï¼Œåˆ™ä¼šå‘ç”Ÿé”™è¯¯</li>
<li><code>name</code>: å¹³å°ä¸Šè¦æŸ¥æ‰¾çš„é…ç½®å¯¹è±¡çš„åç§°ã€‚ è¯¥å­—æ®µå¯ç”¨äºå¼•ç”¨åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„é…ç½®ã€‚ åç§°æŒ‰åŸæ ·ä½¿ç”¨ï¼Œä¸ä¼šä¸é¡¹ç›®åç§°å†²çª</li>
</ul>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>http_config</code> æ˜¯åœ¨åº”ç”¨ç¨‹åºéƒ¨ç½²æ—¶åˆ›å»ºçš„ï¼ˆä½œä¸º <code>&lt;project_name&gt;_http_config</code>ï¼‰ï¼Œå¹¶ä¸” <code>my_second_config</code> å¿…é¡»å·²ç»å­˜åœ¨äº Platform ä¸Šå¹¶ä¸”é€šè¿‡æŸ¥æ‰¾æ¥è·å–å€¼</p>
<p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œé€šè¿‡å°† <code>httpd.conf</code> çš„å†…å®¹æ³¨å†Œä¸ºé…ç½®æ•°æ®ï¼Œåœ¨éƒ¨ç½²åº”ç”¨ç¨‹åºæ—¶å°† <code>server-http_config</code> åˆ›å»ºä¸º <code>&lt;project_name&gt;_http_config</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">configs:</span></span><br><span class="line">  <span class="attr">http_config:</span></span><br><span class="line">    <span class="attr">file:</span> <span class="string">./httpd.conf</span></span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ï¼Œå¯ä»¥å°† <code>http_config</code> å£°æ˜ä¸ºå¤–éƒ¨ï¼Œè¿™æ ·åš Compose å®ç°å°†æŸ¥æ‰¾ <code>http_config</code> ä»¥å°†é…ç½®æ•°æ®å…¬å¼€ç»™ç›¸å…³æœåŠ¡</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">configs:</span></span><br><span class="line">  <span class="attr">http_config:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>å¤–éƒ¨é…ç½®æŸ¥æ‰¾ä¹Ÿå¯ä»¥é€šè¿‡æŒ‡å®š <code>name</code> æ¥ä½¿ç”¨ä¸åŒçš„é”®. ä¸‹é¢çš„ä¾‹å­ä¿®æ”¹äº†å‰é¢çš„ä¾‹å­ï¼Œä½¿ç”¨å‚æ•° <code>HTTP_CONFIG_KEY</code> æ¥æŸ¥æ‰¾é…ç½®. è¿™æ ·åšï¼Œå®é™…çš„æŸ¥æ‰¾é”®å°†åœ¨éƒ¨ç½²æ—¶é€šè¿‡å˜é‡çš„ <a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/#interpolation" >æ’å€¼<i class="fas fa-external-link-alt"></i></a> è®¾ç½®ï¼Œä½†ä½œä¸ºç¡¬ç¼–ç çš„ ID <code>http_config</code> æš´éœ²ç»™å®¹å™¨</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">configs:</span></span><br><span class="line">  <span class="attr">http_config:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;$&#123;HTTP_CONFIG_KEY&#125;&quot;</span></span><br></pre></td></tr></table></figure>

<p>Compose æ–‡ä»¶éœ€è¦æ˜ç¡®æˆäºˆå¯¹åº”ç”¨ç¨‹åºä¸­ç›¸å…³æœåŠ¡çš„é…ç½®çš„è®¿é—®æƒé™</p>
<h2 id="Secrets-top-level-element-é¡¶çº§å…ƒç´ -secrets"><a href="#Secrets-top-level-element-é¡¶çº§å…ƒç´ -secrets" class="headerlink" title="Secrets top-level element (é¡¶çº§å…ƒç´  secrets)"></a>Secrets top-level element (é¡¶çº§å…ƒç´  <code>secrets</code>)</h2><p>Secrets æ˜¯ä¸€ç§ä¸“æ³¨äºæ•æ„Ÿæ•°æ®çš„ Configsï¼Œå¯¹è¿™ç§ç”¨æ³•æœ‰ç‰¹å®šçš„é™åˆ¶. ç”±äºå¹³å°å®ç°å¯èƒ½ä¸é…ç½®æœ‰å¾ˆå¤§ä¸åŒï¼Œä¸“ç”¨çš„ Secrets éƒ¨åˆ†å…è®¸é…ç½®ç›¸å…³èµ„æº</p>
<p>é¡¶å±‚ <code>secrets</code> å£°æ˜å®šä¹‰æˆ–å¼•ç”¨å¯ä»¥æˆäºˆæ­¤åº”ç”¨ç¨‹åºä¸­çš„æœåŠ¡çš„æ•æ„Ÿæ•°æ®. <code>secret</code> çš„æ¥æºæ˜¯ <code>file</code> æˆ– <code>external</code></p>
<ul>
<li><code>file</code>: secret æ˜¯ä½¿ç”¨æŒ‡å®šè·¯å¾„çš„æ–‡ä»¶å†…å®¹åˆ›å»ºçš„</li>
<li><code>external</code>: å¦‚æœè®¾ç½®ä¸º trueï¼Œåˆ™æŒ‡å®šæ­¤ secret å·²åˆ›å»ºã€‚ Compose å®ç°ä¸ä¼šå°è¯•åˆ›å»ºå®ƒï¼Œå¦‚æœå®ƒä¸å­˜åœ¨ï¼Œåˆ™ä¼šå‘ç”Ÿé”™è¯¯</li>
<li><code>name</code>: Docker ä¸­ secret å¯¹è±¡çš„åç§°ã€‚ æ­¤å­—æ®µå¯ç”¨äºå¼•ç”¨åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„ secretsã€‚ åç§°æŒ‰åŸæ ·ä½¿ç”¨ï¼Œä¸ä¼šä¸é¡¹ç›®åç§°å†²çª</li>
</ul>
<p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œé€šè¿‡å°† <code>server.cert</code> çš„å†…å®¹æ³¨å†Œä¸ºå¹³å° secretï¼Œåœ¨éƒ¨ç½²åº”ç”¨ç¨‹åºæ—¶å°† <code>server-certificate</code> åˆ›å»ºä¸º <code>&lt;project_name&gt;_server-certificate</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">secrets:</span></span><br><span class="line">  <span class="attr">server-certificate:</span></span><br><span class="line">    <span class="attr">file:</span> <span class="string">./server.cert</span></span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ï¼Œ<code>server-certificate</code> å¯ä»¥å£°æ˜ä¸ºå¤–éƒ¨ï¼Œè¿™æ ·åš Compose å®ç°å°†æŸ¥æ‰¾ <code>server-certificate</code> ä»¥å‘ç›¸å…³æœåŠ¡å…¬å¼€ secret</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">secrets:</span></span><br><span class="line">  <span class="attr">server-certificate:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>å¤–éƒ¨ secrets æŸ¥æ‰¾ä¹Ÿå¯ä»¥é€šè¿‡æŒ‡å®š <code>name</code> æ¥ä½¿ç”¨ä¸åŒçš„ key. ä¸‹é¢çš„ä¾‹å­ä¿®æ”¹äº†å‰é¢çš„ä¾‹å­ï¼Œä½¿ç”¨å‚æ•° <code>CERTIFICATE_KEY</code> æ¥æŸ¥æ‰¾ secret</p>
<p>è¿™æ ·åšï¼Œå®é™…çš„æŸ¥æ‰¾ key å°†åœ¨éƒ¨ç½²æ—¶é€šè¿‡å˜é‡çš„ <a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/#interpolation" >interpolation<i class="fas fa-external-link-alt"></i></a> è®¾ç½®ï¼Œä½†ä½œä¸ºç¡¬ç¼–ç  ID <code>server-certificate</code> æš´éœ²ç»™å®¹å™¨</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">secrets:</span></span><br><span class="line">  <span class="attr">server-certificate:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;$&#123;CERTIFICATE_KEY&#125;&quot;</span></span><br></pre></td></tr></table></figure>

<p>Compose æ–‡ä»¶éœ€è¦æ˜ç¡®æˆäºˆå¯¹åº”ç”¨ç¨‹åºä¸­ç›¸å…³æœåŠ¡çš„ secrets çš„è®¿é—®æƒé™</p>
<h2 id="Fragments-åˆ†æ®µ"><a href="#Fragments-åˆ†æ®µ" class="headerlink" title="Fragments (åˆ†æ®µ)"></a>Fragments (åˆ†æ®µ)</h2><p>å¯ä»¥ä½¿ç”¨ <a class="link"   target="_blank" rel="noopener" href="http://www.yaml.org/spec/1.2/spec.html#id2765878" >YAML anchors<i class="fas fa-external-link-alt"></i></a> é‡ç”¨é…ç½®ç‰‡æ®µ</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">db-data:</span> <span class="string">&amp;default-volume</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">default</span></span><br><span class="line">  <span class="attr">metrics:</span> <span class="string">*default-volume</span></span><br></pre></td></tr></table></figure>

<p>åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼ŒåŸºäº <code>db-data</code> å·è§„èŒƒå°†é”šç‚¹åˆ›å»ºä¸º <code>default-volume</code>. å®ƒç¨åè¢«åˆ«å <code>*default-volume</code> é‡ç”¨ä»¥å®šä¹‰ <code>metrics</code> å·. ç›¸åŒçš„é€»è¾‘å¯ä»¥åº”ç”¨äº Compose æ–‡ä»¶ä¸­çš„ä»»ä½•å…ƒç´ . é”šè§£æå¿…é¡»åœ¨ <a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/#interpolation" >å˜é‡æ’å€¼<i class="fas fa-external-link-alt"></i></a> ä¹‹å‰è¿›è¡Œï¼Œå› æ­¤å˜é‡ä¸èƒ½ç”¨äºè®¾ç½®é”šæˆ–åˆ«å</p>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨ <a class="link"   target="_blank" rel="noopener" href="http://yaml.org/type/merge.html" >YAML merge type<i class="fas fa-external-link-alt"></i></a> éƒ¨åˆ†è¦†ç›–ç”±é”šå¼•ç”¨è®¾ç½®çš„å€¼. åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œ<code>metrics</code> å·è§„èŒƒä½¿ç”¨åˆ«åæ¥é¿å…é‡å¤ï¼Œä½†ä¼šè¦†ç›– <code>name</code> å±æ€§:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">backend:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">awesome/database</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db-data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">metrics-</span> <span class="string">image</span></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">db-data:</span> <span class="string">&amp;default-volume</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">default</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;data&quot;</span></span><br><span class="line">  <span class="attr">metrics:</span></span><br><span class="line">    <span class="string">&lt;&lt;:</span> <span class="string">*default-volume</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;metrics&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="Extension-æ‰©å±•"><a href="#Extension-æ‰©å±•" class="headerlink" title="Extension (æ‰©å±•)"></a>Extension (æ‰©å±•)</h2><p>ç‰¹æ®Šæ‰©å±•å­—æ®µå¯ä»¥æ˜¯ä»»ä½•æ ¼å¼ï¼Œåªè¦å®ƒä»¬çš„åç§°ä»¥ <code>x-</code> å­—ç¬¦åºåˆ—å¼€å¤´</p>
<p>å®ƒä»¬å¯ä»¥åœ¨ Compose æ–‡ä»¶çš„ä»»ä½•ç»“æ„ä¸­ä½¿ç”¨ã€‚ è¿™æ˜¯ Compose å®ç°è‡ªåŠ¨å¿½ç•¥æœªè¯†åˆ«å­—æ®µçš„å”¯ä¸€ä¾‹å¤–</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">x-custom:</span></span><br><span class="line">  <span class="attr">foo:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">bar</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">zot</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">webapp:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">awesome/webapp</span></span><br><span class="line">    <span class="attr">x-foo:</span> <span class="string">bar</span></span><br></pre></td></tr></table></figure>

<p>Compose è§„èŒƒæœªæŒ‡å®šæ­¤ç±»å­—æ®µçš„å†…å®¹ï¼Œä¹Ÿå¯ç”¨äºå¯ç”¨è‡ªå®šä¹‰åŠŸèƒ½ã€‚ Compose å®ç°é‡åˆ°æœªçŸ¥æ‰©å±•å­—æ®µçš„å®ç°ä¸èƒ½å¤±è´¥ï¼Œä½†å¯ä»¥è­¦å‘ŠæœªçŸ¥å­—æ®µ</p>
<p>å¯¹äºå¹³å°æ‰©å±•ï¼Œå¼ºçƒˆå»ºè®®ä½¿ç”¨å¹³å°&#x2F;ä¾›åº”å•†åç§°ä½œä¸ºæ‰©å±•å‰ç¼€ï¼Œå°±åƒæµè§ˆå™¨æ·»åŠ å¯¹<a class="link"   target="_blank" rel="noopener" href="https://www.w3.org/TR/2011/REC-CSS2-20110607/syndata.html#vendor-keywords" >è‡ªå®šä¹‰ CSS åŠŸèƒ½<i class="fas fa-external-link-alt"></i></a>çš„æ”¯æŒä¸€æ ·</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">service:</span></span><br><span class="line">  <span class="attr">backend:</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">placement:</span></span><br><span class="line">        <span class="attr">x-aws-role:</span> <span class="string">&quot;arn:aws:iam::XXXXXXXXXXXX:role/foo&quot;</span></span><br><span class="line">        <span class="attr">x-aws-region:</span> <span class="string">&quot;eu-west-3&quot;</span></span><br><span class="line">        <span class="attr">x-azure-region:</span> <span class="string">&quot;france-central&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="Informative-Historical-Notes"><a href="#Informative-Historical-Notes" class="headerlink" title="Informative Historical Notes"></a>Informative Historical Notes</h3><p>æœ¬èŠ‚å†…å®¹ä¸°å¯Œã€‚ åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œå·²çŸ¥å­˜åœ¨ä»¥ä¸‹å‰ç¼€:</p>
<table>
<thead>
<tr>
<th align="left">prefix</th>
<th align="left">verdor&#x2F;organization</th>
</tr>
</thead>
<tbody><tr>
<td align="left">docker</td>
<td align="left">Docker</td>
</tr>
<tr>
<td align="left">kubernetes</td>
<td align="left">Kubernetes</td>
</tr>
</tbody></table>
<h3 id="Using-extensions-as-fragments"><a href="#Using-extensions-as-fragments" class="headerlink" title="Using extensions as fragments"></a>Using extensions as fragments</h3><p>å€ŸåŠ©æ‰©å±•å­—æ®µçš„æ”¯æŒï¼ŒCompose æ–‡ä»¶å¯ä»¥ç¼–å†™å¦‚ä¸‹ï¼Œä»¥æé«˜é‡ç”¨ç‰‡æ®µçš„å¯è¯»æ€§ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">x-logging:</span> <span class="string">&amp;default-logging</span></span><br><span class="line">  <span class="attr">options:</span></span><br><span class="line">    <span class="attr">max-size:</span> <span class="string">&quot;12m&quot;</span></span><br><span class="line">    <span class="attr">max-file:</span> <span class="string">&quot;5&quot;</span></span><br><span class="line">  <span class="attr">driver:</span> <span class="string">json-file</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">frontend:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">awesome/webapp</span></span><br><span class="line">    <span class="attr">logging:</span> <span class="string">*default-logging</span></span><br><span class="line">  <span class="attr">backend:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">awesome/database</span></span><br><span class="line">    <span class="attr">logging:</span> <span class="string">*default-logging</span></span><br></pre></td></tr></table></figure>

<h3 id="specifying-byte-values"><a href="#specifying-byte-values" class="headerlink" title="specifying byte values"></a>specifying byte values</h3><p>Value ä»¥ <code>&#123;amount&#125;&#123;byte unit&#125;</code> æ ¼å¼å°†å­—èŠ‚å€¼è¡¨ç¤ºä¸ºå­—ç¬¦ä¸²ï¼šæ”¯æŒçš„å•ä½ä¸º <code>b</code>ï¼ˆå­—èŠ‚ï¼‰ã€<code>k</code> æˆ– <code>kb</code>ï¼ˆåƒå­—èŠ‚ï¼‰ã€<code>m</code> æˆ– <code>mb</code> ï¼ˆå…†å­—èŠ‚ï¼‰å’Œ<code>g</code>æˆ–<code>gb</code>ï¼ˆåƒå…†å­—èŠ‚ï¼‰</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">2b</span></span><br><span class="line"><span class="string">1024kb</span></span><br><span class="line"><span class="string">2048k</span></span><br><span class="line"><span class="string">300m</span></span><br><span class="line"><span class="string">1gb</span></span><br></pre></td></tr></table></figure>

<h3 id="specifying-durations"><a href="#specifying-durations" class="headerlink" title="specifying durations"></a>specifying durations</h3><p>å€¼ä»¥ <code>&#123;value&#125;&#123;unit&#125;</code> çš„å½¢å¼å°†æŒç»­æ—¶é—´è¡¨ç¤ºä¸ºå­—ç¬¦ä¸²ã€‚ æ”¯æŒçš„å•ä½æ˜¯ <code>us</code>ï¼ˆå¾®ç§’ï¼‰ã€<code>ms</code>ï¼ˆæ¯«ç§’ï¼‰ã€<code>s</code>ï¼ˆç§’ï¼‰ã€<code>m</code>ï¼ˆåˆ†é’Ÿï¼‰å’Œ <code>h</code>ï¼ˆå°æ—¶ï¼‰ã€‚ å€¼å¯ä»¥ç»„åˆå¤šä¸ªå€¼å¹¶ä½¿ç”¨ä¸å¸¦åˆ†éš”ç¬¦</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">10ms</span></span><br><span class="line"><span class="string">40s</span></span><br><span class="line"><span class="string">1m30s</span></span><br><span class="line"><span class="string">1h5m30s20ms</span></span><br></pre></td></tr></table></figure>

<h2 id="Interpolation-æ’å€¼"><a href="#Interpolation-æ’å€¼" class="headerlink" title="Interpolation (æ’å€¼)"></a>Interpolation (æ’å€¼)</h2><p>Compose æ–‡ä»¶ä¸­çš„å€¼å¯ä»¥ç”±å˜é‡è®¾ç½®ï¼Œå¹¶åœ¨è¿è¡Œæ—¶è¿›è¡Œæ’å€¼ã€‚ æ’°å†™æ–‡ä»¶ä½¿ç”¨ç±»ä¼¼ Bash çš„è¯­æ³• <code>$&#123;VARIABLE&#125;</code></p>
<p><code>$VARIABLE</code> å’Œ <code>$&#123;VARIABLE&#125;</code> è¯­æ³•éƒ½å—æ”¯æŒã€‚ å¯ä»¥ä½¿ç”¨å…¸å‹çš„ shell è¯­æ³•å†…è”å®šä¹‰é»˜è®¤å€¼ï¼šlatest</p>
<ul>
<li><code>$&#123;VARIABLE:-default&#125;</code> å¦‚æœ <code>VARIABLE</code> åœ¨ç¯å¢ƒä¸­æœªè®¾ç½®æˆ–ä¸ºç©ºï¼Œåˆ™è¯„ä¼°ä¸º <code>default</code></li>
<li><code>$&#123;VARIABLE-default&#125;</code> å¦‚æœ <code>VARIABLE</code> åœ¨ç¯å¢ƒä¸­æœªè®¾ç½®ï¼Œåˆ™è¯„ä¼°ä¸º <code>default</code></li>
</ul>
<p>åŒæ ·ï¼Œä»¥ä¸‹è¯­æ³•å…è®¸æ‚¨æŒ‡å®šå¼ºåˆ¶å˜é‡ï¼š</p>
<ul>
<li><code>$&#123;VARIABLE:?err&#125;</code> å¦‚æœ <code>VARIABLE</code> åœ¨ç¯å¢ƒä¸­æœªè®¾ç½®æˆ–ä¸ºç©ºï¼Œåˆ™é€€å‡ºå¹¶æ˜¾ç¤ºåŒ…å« err çš„ <code>error</code> æ¶ˆæ¯</li>
<li><code>$&#123;VARIABLE?err&#125;</code> å¦‚æœåœ¨ç¯å¢ƒä¸­æœªè®¾ç½® <code>VARIABLE</code>ï¼Œåˆ™ä»¥åŒ…å«é”™è¯¯çš„ <code>err</code> æ¶ˆæ¯é€€å‡º</li>
</ul>
<p>æ’å€¼ä¹Ÿå¯ä»¥åµŒå¥—ï¼š</p>
<ul>
<li><code>$&#123;VARIABLE:-$&#123;FOO&#125;&#125;</code></li>
<li><code>$&#123;VARIABLE?$&#123;FOO&#125;&#125;</code></li>
<li><code>$&#123;VARIABLE:-$&#123;FOO:-default&#125;&#125;</code></li>
</ul>
<p>Compose è§„èŒƒä¸æ”¯æŒå…¶ä»–æ‰©å±•çš„ shell-style åŠŸèƒ½ï¼Œä¾‹å¦‚ <code>$&#123;VARIABLE/foo/bar&#125;</code></p>
<p>å½“æ‚¨çš„é…ç½®éœ€è¦å­—é¢é‡ç¾å…ƒç¬¦å·æ—¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ $$ï¼ˆåŒç¾å…ƒç¬¦å·ï¼‰ã€‚ è¿™ä¹Ÿå¯ä»¥é˜²æ­¢ Compose æ’å…¥å€¼ï¼Œå› æ­¤ $$ å…è®¸æ‚¨å¼•ç”¨æ‚¨ä¸å¸Œæœ› Compose å¤„ç†çš„ç¯å¢ƒå˜é‡</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">web:</span></span><br><span class="line">  <span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">  <span class="attr">command:</span> <span class="string">&quot;$$VAR_NOT_INTERPOLATED_BY_COMPOSE&quot;</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœ Compose å®ç°æ— æ³•è§£ææ›¿æ¢å˜é‡å¹¶ä¸”æ²¡æœ‰å®šä¹‰é»˜è®¤å€¼ï¼Œå®ƒå¿…é¡»è­¦å‘Šç”¨æˆ·å¹¶ç”¨ç©ºå­—ç¬¦ä¸²æ›¿æ¢å˜é‡</p>
<p>ç”±äº Compose æ–‡ä»¶ä¸­çš„ä»»ä½•å€¼éƒ½å¯ä»¥é€šè¿‡å˜é‡æ›¿æ¢è¿›è¡Œæ’å€¼ï¼ŒåŒ…æ‹¬å¤æ‚å…ƒç´ çš„ç´§å‡‘å­—ç¬¦ä¸²è¡¨ç¤ºæ³•ï¼Œå› æ­¤å¿…é¡»åœ¨åŸºäºæ¯ä¸ªæ–‡ä»¶çš„åˆå¹¶ä¹‹å‰åº”ç”¨æ’å€¼</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/" >Compose specification<i class="fas fa-external-link-alt"></i></a></p>

        </div>

        
            <div class="post-copyright-info">
                <div class="article-copyright-info-container">
    <ul>
        <li>æœ¬æ–‡æ ‡é¢˜ï¼šCompose specification</li>
        <li>æœ¬æ–‡ä½œè€…ï¼šæ—å¨ç¾½</li>
        <li>åˆ›å»ºæ—¶é—´ï¼š2022-05-25 11:01:57</li>
        <li>
            æœ¬æ–‡é“¾æ¥ï¼šhttps://linweiyu21.github.io/docker/compose/compose-specification/
        </li>
        <li>
            ç‰ˆæƒå£°æ˜ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
        </li>
    </ul>
</div>

            </div>
        

        
            <ul class="post-tags-box">
                
                    <li class="tag-item">
                        <a href="/tags/Docker/">#Docker</a>&nbsp;
                    </li>
                
                    <li class="tag-item">
                        <a href="/tags/Notes/">#Notes</a>&nbsp;
                    </li>
                
                    <li class="tag-item">
                        <a href="/tags/Docker-Compose/">#Docker Compose</a>&nbsp;
                    </li>
                
            </ul>
        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/docker/compose/compose-specification-summary/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Compose specification æ€»ç»“</span>
                                <span class="post-nav-item">ä¸Šä¸€ç¯‡</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/docker/compose/control-startup-and-shutdown-order-in-compose/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Control startup and shutdown order in Compose</span>
                                <span class="post-nav-item">ä¸‹ä¸€ç¯‡</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
            <div class="comment-container">
                <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        <i class="fas fa-comments">&nbsp;è¯„è®º</i>
    </div>
    

        
            
    <div class="valine-container">
        <script data-pjax
                src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script>
        <div id="vcomments"></div>
        <script data-pjax>
            function loadValine() {
                new Valine({
                    el: '#vcomments',
                    appId: '8xWQ0WFbKUNN4h8ixIO12etk-gzGzoHsz',
                    appKey: '7cLjTvkIsF6aIuIVSd0um89m',
                    meta: ['nick', 'mail', 'link'],
                    avatar: 'wavatar',
                    enableQQ: true,
                    placeholder: 'è¯·å¼€å§‹ä½ çš„è¡¨æ¼”',
                    lang: 'zh-CN'.toLowerCase()
                });

                function getAuthor(language) {
                    switch (language) {
                        case 'en':
                            return 'Author';
                        case 'zh-CN':
                            return 'åšä¸»';
                        default:
                            return 'Master';
                    }
                }

                // Add "Author" identify
                const getValineDomTimer = setInterval(() => {
                    const vcards = document.querySelectorAll('#vcomments .vcards .vcard');
                    if (vcards.length > 0) {
                        let author = 'æ—å¨ç¾½';

                        if (author) {
                            for (let vcard of vcards) {
                                const vnick_dom = vcard.querySelector('.vhead .vnick');
                                const vnick = vnick_dom.innerHTML;
                                if (vnick === author) {
                                    vnick_dom.innerHTML = `${vnick} <span class="author">${getAuthor(KEEP.hexo_config.language)}</span>`
                                }
                            }
                        }
                        clearInterval(getValineDomTimer);
                    } else {
                        clearInterval(getValineDomTimer);
                    }
                }, 2000);
            }

            if ('true') {
                const loadValineTimeout = setTimeout(() => {
                    loadValine();
                    clearTimeout(loadValineTimeout);
                }, 1000);
            } else {
                window.addEventListener('DOMContentLoaded', loadValine);
            }
        </script>
    </div>



        
    
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
            2022&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">æ—å¨ç¾½</a>
        </div>
        
            <script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        è®¿é—®äººæ•°&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
                    <span id="busuanzi_container_site_pv">
                        æ€»è®¿é—®é‡&nbsp;<span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            ç”± <a target="_blank" href="https://hexo.io">Hexo</a> é©±åŠ¨&nbsp;|&nbsp;ä¸»é¢˜&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.5</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fas fa-comment"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Compose-file-Compose-%E6%96%87%E4%BB%B6"><span class="nav-number">1.</span> <span class="nav-text">Compose file (Compose æ–‡ä»¶)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Profiles-%E9%85%8D%E7%BD%AE"><span class="nav-number">2.</span> <span class="nav-text">Profiles (é…ç½®)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Illustrative-example-%E7%A4%BA%E4%BE%8B%E8%AF%B4%E6%98%8E"><span class="nav-number">2.1.</span> <span class="nav-text">Illustrative example (ç¤ºä¾‹è¯´æ˜)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Version-top-level-element-%E9%A1%B6%E7%BA%A7%E5%85%83%E7%B4%A0-version"><span class="nav-number">3.</span> <span class="nav-text">Version top-level element (é¡¶çº§å…ƒç´  version)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Name-top-level-element-%E9%A1%B6%E7%BA%A7%E5%85%83%E7%B4%A0-name"><span class="nav-number">4.</span> <span class="nav-text">Name top-level element (é¡¶çº§å…ƒç´  name)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Services-top-level-element-%E9%A1%B6%E7%BA%A7%E5%85%83%E7%B4%A0-services"><span class="nav-number">5.</span> <span class="nav-text">Services top-level element (é¡¶çº§å…ƒç´  services)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#build"><span class="nav-number">5.1.</span> <span class="nav-text">build</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#blkio-config"><span class="nav-number">5.2.</span> <span class="nav-text">blkio_config</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cpu-count"><span class="nav-number">5.3.</span> <span class="nav-text">cpu_count</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cpu-percent"><span class="nav-number">5.4.</span> <span class="nav-text">cpu_percent</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cpu-shares"><span class="nav-number">5.5.</span> <span class="nav-text">cpu_shares</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cpu-period"><span class="nav-number">5.6.</span> <span class="nav-text">cpu_period</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cpu-quota"><span class="nav-number">5.7.</span> <span class="nav-text">cpu_quota</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cpu-rt-runtime"><span class="nav-number">5.8.</span> <span class="nav-text">cpu_rt_runtime</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cpu-rt-period"><span class="nav-number">5.9.</span> <span class="nav-text">cpu_rt_period</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cpus"><span class="nav-number">5.10.</span> <span class="nav-text">cpus</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cpuset"><span class="nav-number">5.11.</span> <span class="nav-text">cpuset</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cap-add"><span class="nav-number">5.12.</span> <span class="nav-text">cap_add</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cap-drop"><span class="nav-number">5.13.</span> <span class="nav-text">cap_drop</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cgroup-parent"><span class="nav-number">5.14.</span> <span class="nav-text">cgroup_parent</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#command"><span class="nav-number">5.15.</span> <span class="nav-text">command</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#configs"><span class="nav-number">5.16.</span> <span class="nav-text">configs</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Short-syntax"><span class="nav-number">5.16.1.</span> <span class="nav-text">Short syntax</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Long-syntax"><span class="nav-number">5.16.2.</span> <span class="nav-text">Long syntax</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#container-name"><span class="nav-number">5.17.</span> <span class="nav-text">container_name</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#credential-spec"><span class="nav-number">5.18.</span> <span class="nav-text">credential_spec</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Example-gMSA-configuration"><span class="nav-number">5.18.1.</span> <span class="nav-text">Example gMSA configuration</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#depends-on"><span class="nav-number">5.19.</span> <span class="nav-text">depends_on</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Short-syntax-1"><span class="nav-number">5.19.1.</span> <span class="nav-text">Short syntax</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Long-syntax-1"><span class="nav-number">5.19.2.</span> <span class="nav-text">Long syntax</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#deploy"><span class="nav-number">5.20.</span> <span class="nav-text">deploy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#device-cgroup-rules"><span class="nav-number">5.21.</span> <span class="nav-text">device_cgroup_rules</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#devices"><span class="nav-number">5.22.</span> <span class="nav-text">devices</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dns"><span class="nav-number">5.23.</span> <span class="nav-text">dns</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dns-opt"><span class="nav-number">5.24.</span> <span class="nav-text">dns_opt</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dns-search"><span class="nav-number">5.25.</span> <span class="nav-text">dns_search</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#domainname"><span class="nav-number">5.26.</span> <span class="nav-text">domainname</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#entrypoint"><span class="nav-number">5.27.</span> <span class="nav-text">entrypoint</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#env-file"><span class="nav-number">5.28.</span> <span class="nav-text">env_file</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Env-file-format"><span class="nav-number">5.28.1.</span> <span class="nav-text">Env_file format</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#environment"><span class="nav-number">5.29.</span> <span class="nav-text">environment</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#expose"><span class="nav-number">5.30.</span> <span class="nav-text">expose</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#extends"><span class="nav-number">5.31.</span> <span class="nav-text">extends</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Restrictions"><span class="nav-number">5.31.1.</span> <span class="nav-text">Restrictions</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Finding-referenced-service"><span class="nav-number">5.31.2.</span> <span class="nav-text">Finding referenced service</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Merging-service-definitions"><span class="nav-number">5.31.3.</span> <span class="nav-text">Merging service definitions</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Mappings"><span class="nav-number">5.31.3.1.</span> <span class="nav-text">Mappings</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Sequences"><span class="nav-number">5.31.3.2.</span> <span class="nav-text">Sequences</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Scalars"><span class="nav-number">5.31.3.3.</span> <span class="nav-text">Scalars</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#external-links"><span class="nav-number">5.32.</span> <span class="nav-text">external_links</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#extra-hosts"><span class="nav-number">5.33.</span> <span class="nav-text">extra_hosts</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#group-add"><span class="nav-number">5.34.</span> <span class="nav-text">group_add</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#healthcheck"><span class="nav-number">5.35.</span> <span class="nav-text">healthcheck</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#hostname"><span class="nav-number">5.36.</span> <span class="nav-text">hostname</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#image"><span class="nav-number">5.37.</span> <span class="nav-text">image</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#init"><span class="nav-number">5.38.</span> <span class="nav-text">init</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ipc"><span class="nav-number">5.39.</span> <span class="nav-text">ipc</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#isolation"><span class="nav-number">5.40.</span> <span class="nav-text">isolation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#labels"><span class="nav-number">5.41.</span> <span class="nav-text">labels</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#links"><span class="nav-number">5.42.</span> <span class="nav-text">links</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#logging"><span class="nav-number">5.43.</span> <span class="nav-text">logging</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#network-mode"><span class="nav-number">5.44.</span> <span class="nav-text">network_mode</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#networks"><span class="nav-number">5.45.</span> <span class="nav-text">networks</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#aliases"><span class="nav-number">5.45.1.</span> <span class="nav-text">aliases</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ipv4-address-ipv6-address"><span class="nav-number">5.45.2.</span> <span class="nav-text">ipv4_address, ipv6_address</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#link-local-ips"><span class="nav-number">5.45.3.</span> <span class="nav-text">link_local_ips</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#priority"><span class="nav-number">5.45.4.</span> <span class="nav-text">priority</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mac-address"><span class="nav-number">5.46.</span> <span class="nav-text">mac_address</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mem-limit"><span class="nav-number">5.47.</span> <span class="nav-text">mem_limit</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mem-reservation"><span class="nav-number">5.48.</span> <span class="nav-text">mem_reservation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mem-swappiness"><span class="nav-number">5.49.</span> <span class="nav-text">mem_swappiness</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#memswap-limit"><span class="nav-number">5.50.</span> <span class="nav-text">memswap_limit</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#oom-kill-disable"><span class="nav-number">5.51.</span> <span class="nav-text">oom_kill_disable</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#oom-score-adj"><span class="nav-number">5.52.</span> <span class="nav-text">oom_score_adj</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pid"><span class="nav-number">5.53.</span> <span class="nav-text">pid</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pids-limit"><span class="nav-number">5.54.</span> <span class="nav-text">pids_limit</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#platform"><span class="nav-number">5.55.</span> <span class="nav-text">platform</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ports"><span class="nav-number">5.56.</span> <span class="nav-text">ports</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Short-syntax-2"><span class="nav-number">5.56.1.</span> <span class="nav-text">Short syntax</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Long-syntax-2"><span class="nav-number">5.56.2.</span> <span class="nav-text">Long syntax</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#privileged"><span class="nav-number">5.57.</span> <span class="nav-text">privileged</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#profiles"><span class="nav-number">5.58.</span> <span class="nav-text">profiles</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pull-policy"><span class="nav-number">5.59.</span> <span class="nav-text">pull_policy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#read-only"><span class="nav-number">5.60.</span> <span class="nav-text">read_only</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#restart"><span class="nav-number">5.61.</span> <span class="nav-text">restart</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#runtime"><span class="nav-number">5.62.</span> <span class="nav-text">runtime</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#scale"><span class="nav-number">5.63.</span> <span class="nav-text">scale</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#secrets"><span class="nav-number">5.64.</span> <span class="nav-text">secrets</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Short-syntax-3"><span class="nav-number">5.64.1.</span> <span class="nav-text">Short syntax</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Long-syntax-3"><span class="nav-number">5.64.2.</span> <span class="nav-text">Long syntax</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#security-opt"><span class="nav-number">5.65.</span> <span class="nav-text">security_opt</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#shm-size"><span class="nav-number">5.66.</span> <span class="nav-text">shm_size</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#stdin-open"><span class="nav-number">5.67.</span> <span class="nav-text">stdin_open</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#stop-grace-period"><span class="nav-number">5.68.</span> <span class="nav-text">stop_grace_period</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#stop-signal"><span class="nav-number">5.69.</span> <span class="nav-text">stop_signal</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#storage-opt"><span class="nav-number">5.70.</span> <span class="nav-text">storage_opt</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sysctls"><span class="nav-number">5.71.</span> <span class="nav-text">sysctls</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#tmpfs"><span class="nav-number">5.72.</span> <span class="nav-text">tmpfs</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#tty"><span class="nav-number">5.73.</span> <span class="nav-text">tty</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ulimits"><span class="nav-number">5.74.</span> <span class="nav-text">ulimits</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#user"><span class="nav-number">5.75.</span> <span class="nav-text">user</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#userns-mode"><span class="nav-number">5.76.</span> <span class="nav-text">userns_mode</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#volumes"><span class="nav-number">5.77.</span> <span class="nav-text">volumes</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Short-syntax-4"><span class="nav-number">5.77.1.</span> <span class="nav-text">Short syntax</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Long-syntax-4"><span class="nav-number">5.77.2.</span> <span class="nav-text">Long syntax</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#volumes-from"><span class="nav-number">5.78.</span> <span class="nav-text">volumes_from</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#working-dir"><span class="nav-number">5.79.</span> <span class="nav-text">working_dir</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Networks-top-level-element-%E9%A1%B6%E7%BA%A7%E5%85%83%E7%B4%A0-networks"><span class="nav-number">6.</span> <span class="nav-text">Networks top-level element (é¡¶çº§å…ƒç´  networks)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#driver"><span class="nav-number">6.1.</span> <span class="nav-text">driver</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#host-or-none"><span class="nav-number">6.1.1.</span> <span class="nav-text">host or none</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#driver-opts"><span class="nav-number">6.2.</span> <span class="nav-text">driver_opts</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#attachable"><span class="nav-number">6.3.</span> <span class="nav-text">attachable</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#enable-ipv6"><span class="nav-number">6.4.</span> <span class="nav-text">enable_ipv6</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ipma"><span class="nav-number">6.5.</span> <span class="nav-text">ipma</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#internal"><span class="nav-number">6.6.</span> <span class="nav-text">internal</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#labels-1"><span class="nav-number">6.7.</span> <span class="nav-text">labels</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#external"><span class="nav-number">6.8.</span> <span class="nav-text">external</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#name"><span class="nav-number">6.9.</span> <span class="nav-text">name</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Volumes-top-level-element-%E9%A1%B6%E7%BA%A7%E5%85%83%E7%B4%A0-volumes"><span class="nav-number">7.</span> <span class="nav-text">Volumes top-level element (é¡¶çº§å…ƒç´  volumes)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#driver-1"><span class="nav-number">7.1.</span> <span class="nav-text">driver</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#driver-opts-1"><span class="nav-number">7.2.</span> <span class="nav-text">driver_opts</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#external-1"><span class="nav-number">7.3.</span> <span class="nav-text">external</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#labels-2"><span class="nav-number">7.4.</span> <span class="nav-text">labels</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#name-1"><span class="nav-number">7.5.</span> <span class="nav-text">name</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Configs-top-level-element-%E9%A1%B6%E7%BA%A7%E5%85%83%E7%B4%A0-configs"><span class="nav-number">8.</span> <span class="nav-text">Configs top-level element (é¡¶çº§å…ƒç´  configs)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Secrets-top-level-element-%E9%A1%B6%E7%BA%A7%E5%85%83%E7%B4%A0-secrets"><span class="nav-number">9.</span> <span class="nav-text">Secrets top-level element (é¡¶çº§å…ƒç´  secrets)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Fragments-%E5%88%86%E6%AE%B5"><span class="nav-number">10.</span> <span class="nav-text">Fragments (åˆ†æ®µ)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Extension-%E6%89%A9%E5%B1%95"><span class="nav-number">11.</span> <span class="nav-text">Extension (æ‰©å±•)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Informative-Historical-Notes"><span class="nav-number">11.1.</span> <span class="nav-text">Informative Historical Notes</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-extensions-as-fragments"><span class="nav-number">11.2.</span> <span class="nav-text">Using extensions as fragments</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#specifying-byte-values"><span class="nav-number">11.3.</span> <span class="nav-text">specifying byte values</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#specifying-durations"><span class="nav-number">11.4.</span> <span class="nav-text">specifying durations</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Interpolation-%E6%8F%92%E5%80%BC"><span class="nav-number">12.</span> <span class="nav-text">Interpolation (æ’å€¼)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">13.</span> <span class="nav-text">å‚è€ƒ</span></a></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="æœç´¢..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>



<script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/dark-light-toggle.js"></script>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/local-search.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/code-copy.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/lazyload.js"></script>


<div class="post-scripts pjax">
    
        <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/left-side-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/libs/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/toc.js"></script>
    
</div>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/libs/pjax.min.js"></script>
<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>



</body>
</html>
