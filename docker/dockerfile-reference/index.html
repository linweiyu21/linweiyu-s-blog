<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Micronaut,Groovy,Gradle,Java,æ–‡æ¡£,ä¸­æ–‡">
    <meta name="description" content="Micronaut Groovy Gradle Java æ–‡æ¡£ ä¸­æ–‡">
    <meta name="author" content="æ—å¨ç¾½">
    
    <title>
        
            Dockerfile reference |
        
        æ—å¨ç¾½çš„ç¬”è®°
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/logo.svg">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/css/font-awesome.min.css">
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"zh-CN","path":"search.json"};
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":true,"init_open":true},"style":{"primary_color":"rgb(153,153,0)","avatar":"/images/avatar.jpg","favicon":"/images/logo.svg","article_img_align":"left","left_side_width":"400px","content_max_width":"920px","hover":{"shadow":true,"scale":true},"first_screen":{"enable":true,"background_img":null,"description":"def containsğŸš€ = ['Micronaut', 'Groovy', 'Gradle', 'etc']"},"scroll":{"progress_bar":{"enable":true},"percent":{"enable":true}}},"local_search":{"enable":true,"preload":true},"code_copy":{"enable":true,"style":"mac"},"pjax":{"enable":true},"lazyload":{"enable":true},"version":"3.4.5"};
    KEEP.language_ago = {"second":"%s ç§’å‰","minute":"%s åˆ†é’Ÿå‰","hour":"%s å°æ—¶å‰","day":"%s å¤©å‰","week":"%s å‘¨å‰","month":"%s ä¸ªæœˆå‰","year":"%s å¹´å‰"};
  </script>
<meta name="generator" content="Hexo 6.1.0"></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fas fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                æ—å¨ç¾½çš„ç¬”è®°
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                é¦–é¡µ
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                åˆ†ç±»
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                æ ‡ç­¾
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                å½’æ¡£
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                å…³äº
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">é¦–é¡µ</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories">åˆ†ç±»</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags">æ ‡ç­¾</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">å½’æ¡£</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about">å…³äº</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

    <a target="_blank" rel="noopener" href="https://github.com/linweiyu21/" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80"
        viewBox="0 0 250 250" style="fill:#64CEAA; color:#fff; position: absolute; top: 0; border: 0; right: 0;"
        aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path
          d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
          fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path
          d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
          fill="currentColor" class="octo-body"></path>
      </svg></a>
    <style>
      .github-corner:hover .octo-arm {
        animation: octocat-wave 560ms ease-in-out
      }

      @keyframes octocat-wave {

        0%,
        100% {
          transform: rotate(0)
        }

        20%,
        60% {
          transform: rotate(-25deg)
        }

        40%,
        80% {
          transform: rotate(10deg)
        }
      }

      @media (max-width:500px) {
        .github-corner:hover .octo-arm {
          animation: none
        }

        .github-corner .octo-arm {
          animation: octocat-wave 560ms ease-in-out
        }
      }
    </style>
</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">Dockerfile reference</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/avatar.jpg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">æ—å¨ç¾½</span>
                        
                            <span class="author-label">Lv8</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;
        <span class="pc">2022-05-18 10:38:18</span>
        <span class="mobile">2022-05-18 10:38</span>
    </span>
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/Docker/">Docker</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/Docker/">Docker</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/Reference/">Reference</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <!-- TOC -->

<ul>
<li><a href="#usage-%E4%BD%BF%E7%94%A8">Usage (ä½¿ç”¨)</a></li>
<li><a href="#buildkit">BuildKit</a></li>
<li><a href="#format-%E6%A0%BC%E5%BC%8F">Format (æ ¼å¼)</a></li>
<li><a href="#parser-directives-%E8%A7%A3%E6%9E%90%E5%99%A8%E6%8C%87%E4%BB%A4">Parser directives (è§£æå™¨æŒ‡ä»¤)</a><ul>
<li><a href="#syntax">syntax</a></li>
<li><a href="#escape">escape</a></li>
</ul>
</li>
<li><a href="#environment-replacement-%E7%8E%AF%E5%A2%83%E6%9B%B4%E6%8D%A2">Environment replacement (ç¯å¢ƒæ›´æ¢)</a></li>
<li><a href="#dockerignore-file-dockerignore-%E6%96%87%E4%BB%B6">.dockerignore file (<code>.dockerignore</code> æ–‡ä»¶)</a></li>
<li><a href="#from-from-%E6%8C%87%E4%BB%A4">FROM (FROM æŒ‡ä»¤)</a><ul>
<li><a href="#understanding-how-arg-and-from-interact-%E7%90%86%E8%A7%A3-arg-%E5%92%8C-from-%E6%80%8E%E6%A0%B7%E4%BA%A4%E4%BA%92">Understanding how ARG and FROM interact (ç†è§£ ARG å’Œ FROM æ€æ ·äº¤äº’)</a></li>
</ul>
</li>
<li><a href="#run-run-%E6%8C%87%E4%BB%A4">RUN (RUN æŒ‡ä»¤)</a><ul>
<li><a href="#know-issues-run-run-%E6%8C%87%E4%BB%A4%E7%9A%84%E5%B7%B2%E7%9F%A5%E9%97%AE%E9%A2%98">Know issues (RUN) (RUN æŒ‡ä»¤çš„å·²çŸ¥é—®é¢˜)</a></li>
</ul>
</li>
<li><a href="#cmd-cmd-%E6%8C%87%E4%BB%A4">CMD (CMD æŒ‡ä»¤)</a></li>
<li><a href="#label-label-%E6%8C%87%E4%BB%A4">LABEL (LABEL æŒ‡ä»¤)</a></li>
<li><a href="#maintainer-deprecated-maintainer-%E6%8C%87%E4%BB%A4-%E5%B7%B2%E8%BF%87%E6%97%B6">MAINTAINER (deprecated) (MAINTAINER æŒ‡ä»¤ å·²è¿‡æ—¶)</a></li>
<li><a href="#expose-expose-%E6%8C%87%E4%BB%A4">EXPOSE (EXPOSE æŒ‡ä»¤)</a></li>
<li><a href="#env-env-%E6%8C%87%E4%BB%A4">ENV (ENV æŒ‡ä»¤)</a><ul>
<li><a href="#%E6%9B%BF%E4%BB%A3%E7%9A%84%E8%AF%AD%E6%B3%95">æ›¿ä»£çš„è¯­æ³•</a></li>
</ul>
</li>
<li><a href="#add-add-%E6%8C%87%E4%BB%A4">ADD (ADD æŒ‡ä»¤)</a></li>
<li><a href="#copy-copy-%E6%8C%87%E4%BB%A4">COPY (COPY æŒ‡ä»¤)</a></li>
<li><a href="#entrypoint-entrypoint-%E6%8C%87%E4%BB%A4">ENTRYPOINT (ENTRYPOINT æŒ‡ä»¤)</a><ul>
<li><a href="#exec-form-entrypoint-example-exec-%E5%BD%A2%E5%BC%8F-entrypoint-%E4%BE%8B%E5%AD%90">Exec form ENTRYPOINT example (<code>Exec</code> å½¢å¼ <code>ENTRYPOINT</code> ä¾‹å­)</a></li>
<li><a href="#shell-form-entrypoint-example-shell-%E5%BD%A2%E5%BC%8F-entrypoint-%E4%BE%8B%E5%AD%90">Shell form ENTRYPOINT example (Shell å½¢å¼ <code>ENTRYPOINT</code> ä¾‹å­)</a></li>
<li><a href="#understand-how-cmd-and-entrypoint-interact-%E7%90%86%E8%A7%A3-cmd-%E5%92%8C-entrypoint-%E6%98%AF%E6%80%8E%E6%A0%B7%E4%BA%A4%E4%BA%92%E7%9A%84">Understand how CMD and ENTRYPOINT interact (ç†è§£ CMD å’Œ ENTRYPOINT æ˜¯æ€æ ·äº¤äº’çš„)</a></li>
</ul>
</li>
<li><a href="#volume-volume-%E6%8C%87%E4%BB%A4">VOLUME (VOLUME æŒ‡ä»¤)</a><ul>
<li><a href="#notes-about-specifying-volumes-%E5%85%B3%E4%BA%8E%E6%8C%87%E5%AE%9A%E5%8D%B7%E7%9A%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9">Notes about specifying volumes (å…³äºæŒ‡å®šå·çš„æ³¨æ„äº‹é¡¹)</a></li>
<li><a href="#%E7%90%86%E8%A7%A3">ç†è§£</a></li>
</ul>
</li>
<li><a href="#user-user-%E6%8C%87%E4%BB%A4">USER (USER æŒ‡ä»¤)</a></li>
<li><a href="#workdir-workdir-%E6%8C%87%E4%BB%A4">WORKDIR (WORKDIR æŒ‡ä»¤)</a></li>
<li><a href="#arg-arg-%E6%8C%87%E4%BB%A4">ARG (ARG æŒ‡ä»¤)</a><ul>
<li><a href="#default-values-%E9%BB%98%E8%AE%A4%E5%80%BC">Default values (é»˜è®¤å€¼)</a></li>
<li><a href="#scope-%E4%BD%9C%E7%94%A8%E5%9F%9F">Scope (ä½œç”¨åŸŸ)</a></li>
<li><a href="#using-arg-variables-%E4%BD%BF%E7%94%A8-arg-%E5%8F%98%E9%87%8F">Using ARG variables (ä½¿ç”¨ ARG å˜é‡)</a></li>
<li><a href="#predefined-args-%E9%A2%84%E5%AE%9A%E4%B9%89%E7%9A%84-args">Predefined ARGs (é¢„å®šä¹‰çš„ ARGs)</a></li>
<li><a href="#automatic-platform-args-in-the-global-scope-%E5%85%A8%E5%B1%80%E8%8C%83%E5%9B%B4%E5%86%85%E7%9A%84%E8%87%AA%E5%8A%A8%E5%B9%B3%E5%8F%B0-args">Automatic platform ARGs in the global scope (å…¨å±€èŒƒå›´å†…çš„è‡ªåŠ¨å¹³å° ARGs)</a></li>
<li><a href="#impact-on-build-caching-%E5%AF%B9%E6%9E%84%E5%BB%BA%E7%BC%93%E5%AD%98%E7%9A%84%E5%BD%B1%E5%93%8D">Impact on build caching (å¯¹æ„å»ºç¼“å­˜çš„å½±å“)</a></li>
</ul>
</li>
<li><a href="#onbuild-onbuild-%E6%8C%87%E4%BB%A4">ONBUILD (ONBUILD æŒ‡ä»¤)</a></li>
<li><a href="#stopsignal-stopsignal-%E6%8C%87%E4%BB%A4">STOPSIGNAL (STOPSIGNAL æŒ‡ä»¤)</a></li>
<li><a href="#healthcheck-healthcheck-%E6%8C%87%E4%BB%A4">HEALTHCHECK (HEALTHCHECK æŒ‡ä»¤)</a></li>
<li><a href="#shell-shell-%E6%8C%87%E4%BB%A4">SHELL (SHELL æŒ‡ä»¤)</a></li>
<li><a href="#%E5%8F%82%E8%80%83">å‚è€ƒ</a></li>
</ul>
<!-- /TOC -->

<blockquote>
<p>Docker can build images automatically by reading the instructions from a <code>Dockerfile</code>.</p>
</blockquote>
<p>é€šè¿‡ä»ä¸€ä¸ª <code>Dockerfile</code> ä¸­è¯»å–æŒ‡ä»¤, Docker å¯ä»¥è‡ªåŠ¨æ„å»ºé•œåƒ</p>
<blockquote>
<p>A <code>Dockerfile</code> is a text document that contains all the commands a user could call on the command line to assemble an image.</p>
</blockquote>
<p>Dockerfile æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡æ¡£, åŒ…å«äº†ç”¨æˆ·å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸Šè°ƒç”¨çš„, ä»¥ç»„åˆé•œåƒçš„æ‰€æœ‰å‘½ä»¤</p>
<blockquote>
<p>Using <code>docker build</code> users can create an automated build that executes several command-line instructions in succession.</p>
</blockquote>
<p>ä½¿ç”¨ <code>docker build</code>, ç”¨æˆ·å¯ä»¥åˆ›å»ºä¸€ä¸ªè‡ªåŠ¨åŒ–æ„å»º, è¿™ä¸ªæ„å»ºè¿ç»­æ‰§è¡Œå¤šä¸ªå‘½ä»¤è¡ŒæŒ‡ä»¤</p>
<blockquote>
<p>This page describes the commands you can use in a Dockerfile.</p>
</blockquote>
<p>è¿™ä¸ªé¡µé¢æè¿°äº†ä½ å¯ä»¥åœ¨ <code>Dockerfile</code> ä¸­ä½¿ç”¨çš„å‘½ä»¤</p>
<blockquote>
<p>When you are done reading this page, refer to the <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/"><code>Dockerfile</code> Best Practices</a> for a tip-oriented guide.</p>
</blockquote>
<p>åœ¨ä½ è¯»å®Œè¿™ä¸ªé¡µé¢ä¹‹å, æŸ¥çœ‹ <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/"><code>Dockerfile</code> Best Practices</a> ä»¥è·å–é¢å‘æç¤ºçš„æŒ‡å—</p>
<h2 id="Usage-ä½¿ç”¨"><a href="#Usage-ä½¿ç”¨" class="headerlink" title="Usage (ä½¿ç”¨)"></a>Usage (ä½¿ç”¨)</h2><blockquote>
<p>The <a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/build/" >docker build<i class="fas fa-external-link-alt"></i></a> command builds an image from a <code>Dockerfile</code> and a context.</p>
</blockquote>
<p><a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/build/" >docker build<i class="fas fa-external-link-alt"></i></a> å‘½ä»¤ä» <code>Dockerfile</code> å’Œ ä¸Šä¸‹æ–‡ ä¸­æ„å»ºé•œåƒ</p>
<blockquote>
<p>The buildâ€™s context is the set of files at a specified location <code>PATH</code> or <code>URL</code>.</p>
</blockquote>
<p>æ„å»ºçš„ä¸Šä¸‹æ–‡æ˜¯ä½äºæŒ‡å®š <code>PATH</code> æˆ– <code>URL</code> çš„ä½ç½®ä¸­çš„ä¸€ç»„æ–‡ä»¶</p>
<blockquote>
<p>The <code>PATH</code> is a directory on your local filesystem. The <code>URL</code> is a Git repository location.</p>
</blockquote>
<p><code>PATH</code> æ˜¯åœ¨ä½ æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸Šçš„ä¸€ä¸ªæ–‡ä»¶å¤¹. <code>URL</code> æ˜¯ä¸€ä¸ª Git ä»“åº“åœ°å€</p>
<blockquote>
<p>The build context is processed recursively. So, a <code>PATH</code> includes any subdirectories and the <code>URL</code> includes the repository and its submodules.</p>
</blockquote>
<p>æ„å»ºä¸Šä¸‹æ–‡æ˜¯é€’å½’å¤„ç†çš„. æ‰€ä»¥, <code>PATH</code> åŒ…æ‹¬äº†æ‰€æœ‰çš„å­ç›®å½•, <code>URL</code> åŒ…æ‹¬äº†ä»“åº“å’Œå®ƒçš„å­æ¨¡å—</p>
<blockquote>
<p>This example shows a build command that uses the current directory (.) as build context:</p>
</blockquote>
<p>è¿™ä¸ªä¾‹å­å±•ç¤ºäº†ä¸€ä¸ªä½¿ç”¨å½“å‰ç›®å½• (.) ä½œä¸ºæ„å»ºä¸Šä¸‹æ–‡çš„æ„å»ºå‘½ä»¤:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker build .</span><br></pre></td></tr></table></figure>

<blockquote>
<p>The build is run by the Docker daemon, not by the CLI. The first thing a build process does is send the entire context (recursively) to the daemon. In most cases, itâ€™s best to start with an empty directory as context and keep your Dockerfile in that directory. Add only the files needed for building the Dockerfile.</p>
</blockquote>
<p>è¿™ä¸ªæ„å»ºæ˜¯é€šè¿‡ Docker daemon è¿è¡Œçš„, ä¸æ˜¯é€šè¿‡ CLI. æ„å»ºè¿‡ç¨‹åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯å°†æ•´ä¸ªä¸Šä¸‹æ–‡ (é€’å½’åœ°) å‘é€åˆ° daemon. åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹, æœ€å¥½ä½¿ç”¨ä¸€ä¸ªç©ºç›®å½•ä½œä¸ºä¸Šä¸‹æ–‡æ¥å¼€å§‹, å¹¶å°† <code>Dockerfile</code> ä¿å­˜åœ¨è¿™ä¸ªç›®å½•ä¸­. åªæ·»åŠ æ„å»º <code>Dockerfile</code> æ‰€éœ€è¦çš„æ–‡ä»¶</p>
<blockquote>
<p>Warning<br>Do not use your root directory, <code>/</code>, as the <code>PATH</code> for your build context, as it causes the build to transfer the entire contents of your hard drive to the Docker daemon.</p>
</blockquote>
<p>è­¦å‘Š, ä¸è¦å°†æ ¹ç›®å½• <code>/</code> è®¾ç½®ä¸ºä½ çš„æ„å»ºä¸Šä¸‹æ–‡çš„ <code>PATH</code>, å› ä¸ºè¿™å°†ä¼šå¯¼è‡´æ„å»ºå°†ä½ ç¡¬ç›˜ä¸Šçš„å…¨éƒ¨å†…å®¹ä¼ è¾“ç»™ Docker daemon</p>
<blockquote>
<p>To use a file in the build context, the <code>Dockerfile</code> refers to the file specified in an instruction, for example, a <code>COPY</code> instruction. To increase the buildâ€™s performance, exclude files and directories by adding a <code>.dockerignore</code> file to the context directory. For information about how to <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/builder/#dockerignore-file">create a <code>.dockerignore</code> file</a> see the documentation on this page.</p>
</blockquote>
<p>è¦åœ¨æ„å»ºä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨æ–‡ä»¶, <code>Dockerfile</code> æŸ¥çœ‹ (refer to) åœ¨æŒ‡ä»¤ä¸­æŒ‡å®šçš„æ–‡ä»¶, ä¾‹å¦‚, ä¸€ä¸ª <code>COPY</code> æŒ‡ä»¤. ä¸ºäº†æé«˜æ„å»ºçš„æ€§èƒ½, é€šè¿‡æ·»åŠ ä¸€ä¸ª <code>.dockerignore</code> æ–‡ä»¶åˆ°ä¸Šä¸‹æ–‡ç›®å½•ä¸­æ¥æ’é™¤æ–‡ä»¶å’Œç›®å½•. æŸ¥çœ‹è¿™ä¸ªé¡µé¢ä¸Šçš„ <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/builder/#dockerignore-file">create a <code>.dockerignore</code> file</a> è·å–å…³äºå¦‚ä½•åˆ›å»ºä¸€ä¸ª <code>.dockeringore</code> æ–‡ä»¶çš„ä¿¡æ¯</p>
<blockquote>
<p>Traditionally, the <code>Dockerfile</code> is called <code>Dockerfile</code> and located in the root of the context. You use the <code>-f</code> flag with <code>docker build</code> to point to a Dockerfile anywhere in your file system.</p>
</blockquote>
<p>ä¹ æƒ¯ä¸Š, <code>Dockerfile</code> è¢«ç§°ä¸º <code>Dockerfile</code>, ä½äºä¸Šä¸‹æ–‡çš„æ ¹ç›®å½•ä¸­. ä½ å¯ä»¥åœ¨ <code>docker build</code> ä¸­ä½¿ç”¨ <code>-f</code> æ ‡å¿—æ¥æŒ‡å‘ä¸€ä¸ªåœ¨ä½ æ–‡ä»¶ç³»ç»Ÿä¸­ä»»ä½•ä½ç½®ä¸Šçš„ Dockerfile</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker build -f /path/to/a/Dockerfile .</span><br></pre></td></tr></table></figure>

<blockquote>
<p>You can specify a repository and tag at which to save the new image if the build succeeds:</p>
</blockquote>
<p>ä½ å¯ä»¥æŒ‡å®šåœ¨æ„å»ºæˆåŠŸä¿å­˜æ–°é•œåƒæ—¶ä½¿ç”¨çš„ä»“åº“å’Œæ ‡ç­¾:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker build -t shyke/myapp .</span><br></pre></td></tr></table></figure>

<blockquote>
<p>To tag the image into multiple repositories after the build, add multiple <code>-t</code> parameters when you run the <code>build</code> command:</p>
</blockquote>
<p>è¦åœ¨æ„å»ºä¹‹åå°†é•œåƒæ ‡è®°åˆ°å¤šä¸ªä»“åº“, åœ¨è¿è¡Œ <code>build</code> å‘½ä»¤æ—¶æ·»åŠ å¤šä¸ª <code>-t</code> å‚æ•°:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker build -t shyke/myapp:1.0.2 -t shyke/myapp:latest .</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Before the Docker daemon runs the instructions in the <code>Dockerfile</code>, it performs a preliminary validation of the <code>Dockerfile</code> and returns an error if the syntax is incorrect:</p>
</blockquote>
<p>åœ¨ Docker daemon è¿è¡Œ <code>Dockerfile</code> ä¸­çš„æŒ‡ä»¤å‰, Docker daemon å¯¹ <code>Dockerfile</code> è¿›è¡Œä¸€ä¸ªåˆæ­¥çš„æ ¡éªŒ, å¦‚æœè¯­æ³•ä¸æ­£ç¡®è¿™è¿”å›é”™è¯¯:</p>
<blockquote>
<p>The Docker daemon runs the instructions in the <code>Dockerfile</code> one-by-one, committing the result of each instruction to a new image if necessary, before finally outputting the ID of your new image. The Docker daemon will automatically clean up the context you sent.</p>
</blockquote>
<p>Docker daemon ä¸€ä¸ªä¸€ä¸ªåœ°è¿è¡Œ <code>Dockerfile</code> ä¸­çš„æŒ‡ä»¤, å¦‚æœå¿…è¦çš„è¯, åœ¨æœ€ç»ˆè¾“å‡ºä½ çš„æ–°é•œåƒçš„ ID å‰, æäº¤æ¯ä¸€ä¸ªæŒ‡ä»¤çš„ç»“æœåˆ°ä¸€ä¸ªæ–°çš„é•œåƒä¸­. Docker daemon ä¼šè‡ªåŠ¨æ¸…ç†ä½ ä½ å‘é€çš„ä¸Šä¸‹æ–‡</p>
<blockquote>
<p>Note that each instruction is run independently, and causes a new image to be created - so <code>RUN cd /tmp</code> will not have any effect on the next instructions.</p>
</blockquote>
<p>æ³¨æ„, æ¯ä¸ªæŒ‡ä»¤éƒ½æ˜¯ç‹¬ç«‹è¿è¡Œçš„, å¯¼è‡´ä¸€ä¸ªæ–°é•œåƒè¢«åˆ›å»º, æ‰€ä»¥ <code>RUN cd /tmp</code> å°†ä¸ä¼šå¯¹ä¸‹ä¸€ä¸ªæŒ‡ä»¤äº§ç”Ÿä»»ä½•å½±å“</p>
<blockquote>
<p>Whenever possible, Docker uses a build-cache to accelerate the <code>docker build</code> process significantly. This is indicated by the <code>CACHED</code> message in the console output. (For more information, see the <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/"><code>Dockerfile</code> best practices guide</a>):</p>
</blockquote>
<p>åªè¦æœ‰å¯èƒ½, Docker å°±ä¼šä½¿ç”¨æ„å»ºç¼“å­˜æ¥æ˜¾è‘—åŠ å¿« <code>docker build</code> çš„å¤„ç†. è¿™ç”±æ§åˆ¶å°è¾“å‡ºä¸­çš„ <code>CACHED</code> æ¶ˆæ¯æŒ‡ç¤º. (æŸ¥çœ‹ <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/"><code>Dockerfile</code> best practices guide</a> è·å–æ›´å¤šä¿¡æ¯):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker build -t svendowideit/ambassador .</span><br></pre></td></tr></table></figure>

<blockquote>
<p>By default, the build cache is based on results from previous builds on the machine on which you are building. The <code>--cache-from</code> option also allows you to use a build-cache thatâ€™s distributed through an image registry refer to the <a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/build/#specifying-external-cache-sources" >specifying external cache sources section<i class="fas fa-external-link-alt"></i></a> in the <code>docker build</code> command reference.</p>
</blockquote>
<p>é»˜è®¤æƒ…å†µä¸‹, æ„å»ºç¼“å­˜åŸºäºä½ æ­£åœ¨æ„å»ºçš„æœºå™¨ä¸Šçš„å…ˆå‰çš„æ„å»ºç»“æœ. <code>--cache-from</code> é€‰é¡¹è¿˜å…è®¸ä½ ä½¿ç”¨é€šè¿‡é•œåƒæ³¨å†Œå¤„åˆ†å‘çš„æ„å»ºç¼“å­˜, è¯·å‚è€ƒ <code>docker build</code> å‘½ä»¤æ‰‹å†Œä¸­çš„ <a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/build/#specifying-external-cache-sources" >specifying external cache sources section<i class="fas fa-external-link-alt"></i></a> éƒ¨åˆ†</p>
<blockquote>
<p>When youâ€™re done with your build, youâ€™re ready to look into <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/scan/">scanning your image with <code>docker scan</code></a>, and <a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/docker-hub/repos/" >pushing your image to Docker Hub<i class="fas fa-external-link-alt"></i></a>.</p>
</blockquote>
<p>å½“å®Œæˆæ„å»ºæ—¶, ä½ å°±å¯ä»¥å¼€å§‹ä½¿ç”¨ <code>docker scan</code> æ¥<a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/engine/scan/" >æ‰«æä½ çš„é•œåƒ<i class="fas fa-external-link-alt"></i></a>, å¹¶<a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/docker-hub/repos/" >æ¨é€ä½ çš„é•œåƒåˆ° Docker Hub<i class="fas fa-external-link-alt"></i></a></p>
<h2 id="BuildKit"><a href="#BuildKit" class="headerlink" title="BuildKit"></a>BuildKit</h2><p><a class="link"   target="_blank" rel="noopener" href="https://github.com/moby/buildkit" >BuildKit<i class="fas fa-external-link-alt"></i></a> åç«¯æä¾›äº†æ¯”æ—§çš„æ„å»ºå·¥å…·æ›´å¤šçš„åŠŸèƒ½</p>
<p>è®¾ç½® <code>DOCKER_BUILDKIT=1</code> ç¯å¢ƒå˜é‡æ¥å¼€å¯ä½¿ç”¨ BuildKit</p>
<h2 id="Format-æ ¼å¼"><a href="#Format-æ ¼å¼" class="headerlink" title="Format (æ ¼å¼)"></a>Format (æ ¼å¼)</h2><p><code>Dockerfile</code> ä¸­çš„æ ¼å¼:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ³¨é‡Š</span></span><br><span class="line">æŒ‡ä»¤ å‚æ•°</span><br></pre></td></tr></table></figure>

<p>æŒ‡ä»¤ä¸æ˜¯å¤§å°å†™æ•æ„Ÿçš„,çº¦å®šä½¿ç”¨å¤§å†™å½¢å¼</p>
<p>ä¸€ä¸ª <code>Dockerfile</code> å¿…é¡»ä»¥ <code>FROM</code> æŒ‡ä»¤ä¸ºå¼€å§‹</p>
<p>ä½†æ˜¯ <code>FROM</code> æŒ‡ä»¤å¯ä»¥å‡ºç°åœ¨ <code>è§£æå™¨æŒ‡ä»¤(parser directives)</code>, <code>æ³¨é‡Š</code>, <code>å…¨å±€èŒƒå›´çš„ ARGs</code> ä¹‹å</p>
<p><code>FROM</code> ä¹‹å‰åªèƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ª <code>ARG</code> æŒ‡ä»¤ï¼Œè¿™äº›æŒ‡ä»¤å£°æ˜åœ¨ <code>Dockerfile</code> çš„ <code>FROM</code> è¡Œä¸­ä½¿ç”¨çš„å‚æ•°</p>
<p>Docker åªä¼šå°†ä»¥ <code>#</code> å¼€å¤´çš„è¡Œçœ‹ä½œæ˜¯æ³¨é‡Š</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Comment</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&#x27;we are running some # of cool things&#x27;</span></span></span><br></pre></td></tr></table></figure>

<p>æ³¨é‡Šè¡Œåœ¨ Dockerfile æŒ‡ä»¤å¼€å§‹æ‰§è¡Œå‰å°†ä¼šè¢«åˆ é™¤</p>
<p>Example - ä»¥ä¸‹ä¸¤ä¸ªæŒ‡ä»¤æ˜¯ç­‰åŒçš„:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> hello \</span></span><br><span class="line"><span class="language-bash"><span class="comment"># comment</span></span></span><br><span class="line">world</span><br></pre></td></tr></table></figure>

<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> hello \</span></span><br><span class="line"><span class="language-bash">world</span></span><br></pre></td></tr></table></figure>

<p>åœ¨æ³¨é‡Šä¸­ä¸æ”¯æŒ è¡Œç»§ç»­å­—ç¬¦ (Line continuation)</p>
<p>ä¸ºäº†å‘åå…¼å®¹, <code>#</code> å’Œ æŒ‡ä»¤ å‰çš„ç©ºæ ¼å°†ä¼šè¢«å¿½ç•¥</p>
<p>Example - ä»¥ä¸‹ä¸¤ç§å†™æ³•æ˜¯ç­‰åŒçš„:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">        <span class="comment"># this is a comment-line</span></span><br><span class="line">    <span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> hello</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> world</span></span><br></pre></td></tr></table></figure>

<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># this is a comment-line</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> hello</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> world</span></span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯, åœ¨æŒ‡ä»¤å‚æ•°ä¸­çš„ç©ºæ ¼æ˜¯ä¼šè¢«ä¿ç•™çš„:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;\</span></span></span><br><span class="line"><span class="string"><span class="language-bash">     hello\</span></span></span><br><span class="line"><span class="string"><span class="language-bash">     world&quot;</span></span></span><br></pre></td></tr></table></figure>

<h2 id="Parser-directives-è§£æå™¨æŒ‡ä»¤"><a href="#Parser-directives-è§£æå™¨æŒ‡ä»¤" class="headerlink" title="Parser directives (è§£æå™¨æŒ‡ä»¤)"></a>Parser directives (è§£æå™¨æŒ‡ä»¤)</h2><p>è§£æå™¨æŒ‡ä»¤æ˜¯å¯é€‰çš„, å¹¶ä¸”ä¼šå½±å“ <code>Dockerfile</code> ä¸­åç»­è¡Œçš„å¤„ç†æ–¹å¼</p>
<p>è§£æå™¨æŒ‡ä»¤ä¸ä¼šæ·»åŠ å±‚ (layers) åˆ°æ„å»ºä¸­, ä¹Ÿä¸ä¼šä½œä¸ºä¸€ä¸ªæ„å»ºæ­¥éª¤å‡ºç°</p>
<p>è§£æå™¨æŒ‡ä»¤é€šè¿‡ <code># directive=value</code> çš„å½¢å¼ä½œä¸ºç‰¹æ®Šçš„æ³¨é‡Šç±»å‹å‡ºç°</p>
<p>ä¸€ä¸ªæŒ‡ä»¤åªèƒ½ä½¿ç”¨ä¸€æ¬¡</p>
<p>ä¸€æ—¦ä¸€ä¸ªæ³¨é‡Š, ç©ºç™½è¡Œæˆ–è€…æ„å»ºå™¨æŒ‡ä»¤ (builder instruction) å·²ç»è¢«å¤„ç†äº†, é‚£ä¹ˆ Docker å°†ä¸ä¼šå†å¯»æ‰¾è§£æå™¨æŒ‡ä»¤. Docker å°†æ‰€æœ‰çš„è§£æå™¨æŒ‡ä»¤çœ‹ä½œæ˜¯æ™®é€šçš„æ³¨é‡Š, ä¸ä¼šå»æ ¡éªŒå®ƒæ˜¯å¦ä¸ºä¸€ä¸ªè§£æå™¨æŒ‡ä»¤</p>
<p>å› æ­¤, æ‰€æœ‰çš„è§£æå™¨æŒ‡ä»¤å¿…é¡»åœ¨ <code>Dockerfile</code> çš„æœ€ä¸Šé¢</p>
<p>è§£æå™¨æŒ‡ä»¤ä¸ä¼šå¤§å°å†™æ•æ„Ÿçš„, ä½†æ˜¯çº¦å®šä½¿ç”¨å°å†™</p>
<p>è¿˜çº¦å®šåœ¨ä»»ä½•è§£æå™¨æŒ‡ä»¤åé¢åŒ…å«ä¸€ä¸ªç©ºè¡Œ</p>
<p>åœ¨è§£æå™¨æŒ‡ä»¤ä¸­ä¸æ”¯æŒæ¢è¡Œç¬¦</p>
<p>æœªçŸ¥çš„è§£æå™¨æŒ‡ä»¤å½“åšæ™®é€šæ³¨é‡Š</p>
<p>è§£æå™¨æŒ‡ä»¤ä¸­å…è®¸ä½¿ç”¨éæ¢è¡Œç©ºæ ¼</p>
<p>æ”¯æŒå¦‚ä¸‹ä¸¤ç§è§£æå™¨æŒ‡ä»¤:</p>
<ul>
<li><code>syntax</code></li>
<li><code>escape</code></li>
</ul>
<h3 id="syntax"><a href="#syntax" class="headerlink" title="syntax"></a>syntax</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># syntax=[remote image reference]</span></span><br></pre></td></tr></table></figure>

<p>ä¾‹å¦‚:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># syntax=docker/dockerfile:1</span></span><br><span class="line"><span class="comment"># syntax=docker.io/docker/dockerfile:1</span></span><br><span class="line"><span class="comment"># syntax=example.com/user/repo:tag@sha256:abcdef...</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªåŠŸèƒ½åªèƒ½åœ¨ä½¿ç”¨ BuildKit åç«¯æ—¶ä½¿ç”¨, åœ¨ä½¿ç”¨ä¼ ç»Ÿæ„å»ºå™¨åç«¯æ—¶å°†ä¼šè¢«å¿½ç•¥</p>
<p>syntax æŒ‡ä»¤å®šä¹‰äº†ç”¨æ¥æ„å»º Dockerfile çš„ Dockerfile è¯­æ³•çš„ä½ç½®</p>
<p>è¿™äº› Dockerfile è¯­æ³•å®ç°ä½œä¸ºä¸€ä¸ª Docker é•œåƒè¿›è¡Œå‘å¸ƒ</p>
<p>BuildKit ä½¿ç”¨å¤–éƒ¨çš„ Dockerfile è¯­æ³•å®ç°æ¥åœ¨ä¸€ä¸ªå®¹å™¨æ²™ç›’ç¯å¢ƒä¸­æ‰§è¡Œæ„å»º</p>
<p>å®˜æ–¹çš„ Dockerfile è¯­æ³•å®ç°ä½äº Docker Hub ä¸­çš„ <code>docker/dockerfile</code> ä»“åº“ä¸­</p>
<p>ç¨³å®šç‰ˆæœ¬çš„è¯­æ³•å®ç°: <code>docker/dockerfile:1</code></p>
<p>å®éªŒç‰ˆæœ¬çš„è¯­æ³•å®ç°: <code>docker/dockerfile:labs</code></p>
<h3 id="escape"><a href="#escape" class="headerlink" title="escape"></a>escape</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># escape=\</span></span><br></pre></td></tr></table></figure>

<p>æˆ–è€…</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># escape=`</span></span><br></pre></td></tr></table></figure>

<p><code>escape</code> æŒ‡ä»¤ç”¨æ¥è®¾ç½®åœ¨ <code>Dockerfile</code> ä¸­ä½¿ç”¨çš„è½¬ä¹‰ç¬¦ç¬¦å·. é»˜è®¤çš„è½¬ä¹‰ç¬¦å·æ˜¯ <code>\</code></p>
<p>åœ¨ Windows å¹³å°ä¸­, è·¯å¾„åˆ†éš”ç¬¦æ˜¯ <code>\</code>, å› æ­¤å¯ä»¥ä½¿ç”¨è¿™ä¸ªæŒ‡ä»¤æ¥è®¾ç½®è½¬ä¹‰ç¬¦å·ä¸º `</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># escape=`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> microsoft/nanoserver</span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> testfile.txt c:\</span></span><br><span class="line"><span class="language-bash">RUN <span class="built_in">dir</span> c:\</span></span><br></pre></td></tr></table></figure>

<h2 id="Environment-replacement-ç¯å¢ƒæ›´æ¢"><a href="#Environment-replacement-ç¯å¢ƒæ›´æ¢" class="headerlink" title="Environment replacement (ç¯å¢ƒæ›´æ¢)"></a>Environment replacement (ç¯å¢ƒæ›´æ¢)</h2><p>ç¯å¢ƒå˜é‡ï¼ˆä½¿ç”¨ <code>ENV</code> è¯­å¥å£°æ˜ï¼‰ä¹Ÿå¯ä»¥åœ¨æŸäº›æŒ‡ä»¤ä¸­ç”¨ä½œè¦ç”± <code>Dockerfile</code> è§£é‡Šçš„å˜é‡</p>
<p>è¿˜ä¼šå¤„ç†è½¬ä¹‰æ¥å°†ç±»ä¼¼å˜é‡çš„è¯­æ³•åŒ…å«åœ¨è¯­å¥å­—é¢é‡ä¸­</p>
<p>ç¯å¢ƒå˜é‡åœ¨ <code>Dockerfile</code> ä¸­ç”¨ <code>$variable_name</code> æˆ– <code>$&#123;variable_name&#125;</code> è¡¨ç¤º</p>
<p>ä½¿ç”¨ <code>\</code> å¯¹ $ è¿›è¡Œè½¬ä¹‰</p>
<p><code>Dockerfile</code> ä¸­çš„å¦‚ä¸‹æŒ‡ä»¤æ”¯æŒç¯å¢ƒå˜é‡:</p>
<ul>
<li><code>ADD</code></li>
<li><code>COPY</code></li>
<li><code>ENV</code></li>
<li><code>EXPOSE</code></li>
<li><code>FROM</code></li>
<li><code>LABEL</code></li>
<li><code>STOPSIGNAL</code></li>
<li><code>USER</code></li>
<li><code>VOLUME</code></li>
<li><code>WORKDIR</code></li>
<li><code>ONBUILD</code> (å’Œä¸Šé¢çš„æŒ‡ä»¤ç»“åˆçš„æ—¶å€™)</li>
</ul>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> abc=hello</span><br><span class="line"><span class="keyword">ENV</span> abc=bye def=$abc</span><br><span class="line"><span class="keyword">ENV</span> ghi=$abc</span><br></pre></td></tr></table></figure>

<p><code>def</code> çš„å€¼ä¸º <code>hello</code>; <code>ghi</code> çš„å€¼ä¸º <code>bye</code>; å› ä¸ºæ¯ä¸€è¡Œçš„æŒ‡ä»¤æ˜¯åŸºäºä¸Šä¸€ä¸ªæŒ‡ä»¤ç”Ÿæˆçš„é•œåƒçš„</p>
<h2 id="dockerignore-file-dockerignore-æ–‡ä»¶"><a href="#dockerignore-file-dockerignore-æ–‡ä»¶" class="headerlink" title=".dockerignore file (.dockerignore æ–‡ä»¶)"></a>.dockerignore file (<code>.dockerignore</code> æ–‡ä»¶)</h2><p>åœ¨ Docker CLI å°†ä¸Šä¸‹æ–‡å‘é€ç»™ Docker Daemon å‰, Docker CLI åœ¨ä¸Šä¸‹æ–‡çš„æ ¹ç›®å½•ä¸­å¯»æ‰¾ä¸€ä¸ªåç§°ä¸º <code>.dockerignore</code> çš„æ–‡ä»¶</p>
<p>å¦‚æœè¿™ä¸ªæ–‡ä»¶å­˜åœ¨, CLI å°†ä¼šä¿®æ”¹ä¸Šä¸‹æ–‡æ¥æ’é™¤åŒ¹é…è¿™ä¸ªæ–‡ä»¶ä¸­çš„æ¨¡å¼çš„æ–‡ä»¶æˆ–ç›®å½•</p>
<p>è¿™é¿å…äº†å°†å¾ˆå¤§çš„æ–‡ä»¶æˆ–è€…æ•æ„Ÿçš„æ–‡ä»¶å‘é€åˆ° Daemon ä¸­</p>
<p>å¹¶ä¸”é¿å…äº†åœ¨ä½¿ç”¨ <code>ADD</code> æˆ– <code>COPY</code> æ—¶æ½œåœ¨åœ°æ·»åŠ å¤§æ–‡ä»¶æˆ–æ•æ„Ÿæ–‡ä»¶åˆ°é•œåƒä¸­</p>
<p>CLI è§£æ <code>.dockerignore</code> æ–‡ä»¶</p>
<p><code>.dockerignore</code> æ–‡ä»¶ä½¿ç”¨æ–°è¡Œä½œä¸ºå¤šä¸ªæ¨¡å¼çš„åˆ†éš”</p>
<p>ä¸ºäº†è¿›è¡ŒåŒ¹é…, ä¸Šä¸‹æ–‡çš„æ ¹ä½œä¸ºå·¥ä½œç›®å½•å’Œæ ¹ç›®å½•</p>
<p>ä¾‹å¦‚, æ¨¡å¼ <code>/foo/bar</code> å’Œ <code>foo/bar</code> éƒ½ä¼šæ’é™¤ <code>PATH</code> ä¸‹ <code>foo</code> ç›®å½•ä¸­çš„åç§°ä¸º <code>bar</code> çš„æ–‡ä»¶æˆ–ç›®å½•, æˆ–è€…æ˜¯æ’é™¤ä½äº <code>URL</code> æŒ‡å‘çš„ Git ä»“åº“çš„æ ¹ä¸‹çš„ <code>foo</code> ç›®å½•ä¸­çš„ <code>bar</code> æ–‡ä»¶æˆ–ç›®å½•</p>
<p><code>.dockerignore</code> æ–‡ä»¶ä¸­ç¬¬ä¸€åˆ—ä¸º <code>#</code> çš„è¡Œè¢«è®¤ä¸ºæ˜¯æ³¨é‡Š, ä¸ä¼šè¢« CLI è§£æ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># comment</span><br><span class="line">*/temp*</span><br><span class="line">*/*/temp*</span><br><span class="line">temp?</span><br></pre></td></tr></table></figure>

<p>Table - Build behavior:</p>
<table>
<thead>
<tr>
<th align="left">Rule</th>
<th align="left">Behavior</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code># comment</code></td>
<td align="left">å¿½ç•¥</td>
</tr>
<tr>
<td align="left"><code>*/temp*</code></td>
<td align="left">æ’é™¤æ ¹ (root) ä¸‹çš„ä¸€çº§å­ç›®å½•ä¸­åç§°ä»¥ <code>temp</code> å¼€å¤´çš„æ–‡ä»¶æˆ–ç›®å½•</td>
</tr>
<tr>
<td align="left"><code>*/*/temp*</code></td>
<td align="left">æ’é™¤æ ¹ (root) ä¸‹çš„äºŒçº§å­ç›®å½•ä¸­åç§°ä»¥ <code>temp</code> å¼€å¤´çš„æ–‡ä»¶æˆ–ç›®å½•</td>
</tr>
<tr>
<td align="left"><code>temp?</code></td>
<td align="left">æ’é™¤æ ¹ (root) ç›®å½•ä¸‹æ‰€æœ‰çš„åå­—ä»¥ <code>temp</code> å¼€å¤´ç„¶åæ¥ä¸€ä¸ªå­—ç¬¦çš„æ–‡ä»¶æˆ–ç›®å½•. ä¾‹å¦‚ <code>/tempa</code>, <code>/tempb</code></td>
</tr>
</tbody></table>
<p>åŒ¹é…ä½¿ç”¨ Go è¯­è¨€çš„ <a class="link"   target="_blank" rel="noopener" href="https://golang.org/pkg/path/filepath#Match" >filepath.Match<i class="fas fa-external-link-alt"></i></a> è§„åˆ™</p>
<p>ä¸€ä¸ªé¢„å¤„ç†æ­¥éª¤åˆ é™¤äº†å¤´å°¾çš„ç©ºç™½å­—ç¬¦, å¹¶ä½¿ç”¨ Go è¯­è¨€çš„ <a class="link"   target="_blank" rel="noopener" href="https://golang.org/pkg/path/filepath/#Clean" >filepath.Clean<i class="fas fa-external-link-alt"></i></a> æ¶ˆé™¤ <code>.</code> å’Œ <code>..</code> å…ƒç´ </p>
<p>åœ¨é¢„å¤„ç†å, ç©ºç™½è¡Œå°†ä¼šè¢«å¿½ç•¥</p>
<p>Docker è¿˜æ”¯æŒä½¿ç”¨ <code>**</code> æ¥åŒ¹é…ä»»ä½•æ•°é‡çš„ç›®å½• (åŒ…æ‹¬ 0 ä¸ªç›®å½•). ä¾‹å¦‚ <code>**/*.go</code> å°†ä¼šæ’é™¤æ‰€æœ‰ç›®å½•ä¸­ä»¥ <code>.go</code> ç»“å°¾çš„æ‰€æœ‰æ–‡ä»¶, æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶ä¹Ÿä¼šè¢«æ’é™¤</p>
<p>ä»¥ç¬¦å· <code>!</code> å¼€å¤´çš„è¡Œç”¨æ¥å£°æ˜ä¸è¦è¿›è¡Œæ’é™¤çš„æ–‡ä»¶æˆ–ç›®å½•</p>
<p>Example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">*.md</span><br><span class="line">!README.md</span><br></pre></td></tr></table></figure>

<p>é™¤äº† <code>README.md</code> æ–‡ä»¶ä¹‹å¤–çš„ä»¥ <code>.md</code> ç»“å°¾çš„æ–‡ä»¶éƒ½ä¼šè¢«æ’é™¤</p>
<p>ä½ è¿˜å¯ä»¥ä½¿ç”¨ <code>.dockerignore</code> æ–‡ä»¶æ¥æ’é™¤ <code>Dockerfile</code> æ–‡ä»¶å’Œ <code>.dockerignore</code> æ–‡ä»¶. è¿™ä¸¤ä¸ªæ–‡ä»¶ä»ç„¶ä¼šè¢«å‘é€åˆ° Daemon, å› ä¸ºéœ€è¦ä½¿ç”¨å®ƒä»¬æ¥è¿›è¡Œæ„å»º. ä½†æ˜¯ <code>ADD</code> å’Œ <code>COPY</code> æŒ‡ä»¤ä¸ä¼šå¤åˆ¶å®ƒä»¬åˆ°é•œåƒä¸­</p>
<p>å› ä¸ºå†å²åŸå› , <code>.</code> æ¨¡å¼è¢«å¿½ç•¥äº†</p>
<h2 id="FROM-FROM-æŒ‡ä»¤"><a href="#FROM-FROM-æŒ‡ä»¤" class="headerlink" title="FROM (FROM æŒ‡ä»¤)"></a>FROM (FROM æŒ‡ä»¤)</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> [--platform=&lt;platform&gt;] &lt;image&gt; [AS &lt;name&gt;]</span><br></pre></td></tr></table></figure>

<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> [--platform=&lt;platform&gt;] &lt;image&gt;[:&lt;tag&gt;] [AS &lt;name&gt;]</span><br></pre></td></tr></table></figure>

<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> [--platform=&lt;platform&gt;] &lt;image&gt;[@&lt;digest&gt;] [AS &lt;name&gt;]</span><br></pre></td></tr></table></figure>

<p><code>FROM</code> æŒ‡ä»¤åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„æ„å»ºé˜¶æ®µ, ä¸ºåç»­æŒ‡ä»¤è®¾ç½®<a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/glossary/#base-image" >åŸºç¡€é•œåƒ<i class="fas fa-external-link-alt"></i></a></p>
<p>å› æ­¤, æœ‰æ•ˆçš„ <code>Dockerfile</code> å¿…é¡»ä»¥ä¸€ä¸ª <code>FROM</code> æŒ‡ä»¤å¼€å§‹</p>
<p><code>iamge</code> å¯ä»¥æ˜¯ä»»ä½•æœ‰æ•ˆçš„é•œåƒ, å¯ä»¥ç‰¹åˆ«å®¹æ˜“åœ°ä»<a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/docker-hub/repos/" >å…¬å¼€ä»“åº“<i class="fas fa-external-link-alt"></i></a> æ‹‰å–ä¸€ä¸ªé•œåƒæ¥å¼€å§‹</p>
<p><code>ARG</code> æ˜¯ <code>Dokcerfile</code> ä¸­å”¯ä¸€å¯ä»¥å‡ºç°åœ¨ <code>FROM</code> å‰é¢çš„æŒ‡ä»¤</p>
<p><code>FROM</code> å¯ä»¥åœ¨å•ä¸ª <code>Dockerfile</code> ä¸­å‡ºç°å¤šæ¬¡æ¥åˆ›å»ºå¤šä¸ªé•œåƒ, æˆ–è€…ä½¿ç”¨ä¸€ä¸ªæ„å»ºé˜¶æ®µä½œä¸ºå¦ä¸€ä¸ªæ„å»ºé˜¶æ®µçš„ä¾èµ–</p>
<p>åªéœ€åœ¨æ¯ä¸ªæ–°çš„ <code>FROM</code> æŒ‡ä»¤ä¹‹å‰è®°å½• æäº¤çš„æœ€åä¸€ä¸ªè¾“å‡ºçš„ é•œåƒID</p>
<p>æ¯ä¸ª <code>FROM</code> æŒ‡ä»¤éƒ½ä¼šæ¸…é™¤å…ˆå‰æŒ‡ä»¤åˆ›å»ºçš„ä»»ä½•çŠ¶æ€</p>
<p>é€šè¿‡æ·»åŠ  <code>AS name</code> ç»™ <code>FROM</code> æŒ‡ä»¤, å¯ä»¥å¯é€‰åœ°ä¸ºä¸€ä¸ªæ–°çš„æ„å»ºé˜¶æ®µæŒ‡å®šåå­—. è¿™ä¸ªåå­—å¯ä»¥åœ¨åé¢çš„ <code>FROM</code> å’Œ <code>COPY --from=&lt;name&gt;</code> æŒ‡ä»¤ä¸­ç”¨æ¥æŒ‡å‘è¿™ä¸ªé˜¶æ®µä¸­æ„å»ºçš„é•œåƒ</p>
<p><code>tag</code> å’Œ <code>digest</code> å€¼æ˜¯å¯é€‰çš„, å¦‚æœéƒ½æ²¡æœ‰æŒ‡å®šè¿™ä¸¤ä¸ªå€¼, æ„å»ºå™¨é»˜è®¤ä½¿ç”¨ <code>latest</code> æ ‡ç­¾. å¦‚æœæ„å»ºå™¨æ‰¾ä¸åˆ° <code>tag</code> å€¼å°†ä¼šè¿”å›è¿”å›ä¸€ä¸ªé”™è¯¯</p>
<p>å¦‚æœ <code>FROM</code> å¼•ç”¨å¤šå¹³å°é•œåƒï¼Œå¯é€‰çš„ <code>--platform</code> æ ‡å¿—å¯ç”¨äºæŒ‡å®šé•œåƒçš„å¹³å°. ä¾‹å¦‚ <code>linux/amd64</code>, <code>linux/arm64</code>, <code>windows/amd64</code></p>
<p>é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨æ„å»ºè¯·æ±‚çš„ç›®æ ‡å¹³å°</p>
<p>å…¨å±€æ„å»ºå‚æ•°å¯ä»¥ç”¨äº <code>--platform</code> æ ‡å¿—çš„å€¼, ä¾‹å¦‚ <a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/builder/#automatic-platform-args-in-the-global-scope" >è‡ªåŠ¨çš„å¹³å° ARGs<i class="fas fa-external-link-alt"></i></a> å…è®¸ä½ å¼ºåˆ¶é˜¶æ®µä¸ºå½“æœ¬åœ°æ„å»ºå¹³å° (<code>--platform=$BUILDPLATFORM</code>), å¹¶ä½¿ç”¨å®ƒäº¤å‰ç¼–è¯‘åˆ°é˜¶æ®µå†…çš„ç›®æ ‡å¹³å°</p>
<h3 id="Understanding-how-ARG-and-FROM-interact-ç†è§£-ARG-å’Œ-FROM-æ€æ ·äº¤äº’"><a href="#Understanding-how-ARG-and-FROM-interact-ç†è§£-ARG-å’Œ-FROM-æ€æ ·äº¤äº’" class="headerlink" title="Understanding how ARG and FROM interact (ç†è§£ ARG å’Œ FROM æ€æ ·äº¤äº’)"></a>Understanding how ARG and FROM interact (ç†è§£ ARG å’Œ FROM æ€æ ·äº¤äº’)</h3><p><code>FROM</code> æŒ‡ä»¤æ”¯æŒä»»ä½•é€šè¿‡ <code>ARG</code> æŒ‡ä»¤å£°æ˜çš„å˜é‡, <code>ARG</code> æŒ‡ä»¤å‡ºç°åœ¨ç¬¬ä¸€ä¸ª <code>FROM</code> æŒ‡ä»¤ä¹‹å‰</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ARG</span> CODE_VERSION=latest</span><br><span class="line"><span class="keyword">FROM</span> base:$&#123;CODE_VERSION&#125;</span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> /code/run-app</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> extras:$&#123;CODE_VERSION&#125;</span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> /code/run-extras</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ <code>FROM</code> æŒ‡ä»¤ä¹‹å‰å£°æ˜çš„ <code>ARG</code> æŒ‡ä»¤åœ¨æ„å»ºé˜¶æ®µä¹‹å¤–, æ‰€ä»¥å®ƒä¸èƒ½åœ¨ <code>FROM</code> æŒ‡ä»¤ä¹‹åçš„ä»»ä½•æŒ‡ä»¤ä¸­ä½¿ç”¨</p>
<p>è¦ä½¿ç”¨åœ¨ç¬¬ä¸€ä¸ª <code>FROM</code> ä¹‹å‰å£°æ˜çš„ <code>ARG</code> çš„é»˜è®¤å€¼ï¼Œè¯·ä½¿ç”¨åœ¨æ„å»ºé˜¶æ®µå†…æ²¡æœ‰å€¼çš„ <code>ARG</code> æŒ‡ä»¤:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ARG</span> VERSION=latest</span><br><span class="line"><span class="keyword">FROM</span> busybos:$VERSION</span><br><span class="line"><span class="keyword">ARG</span> VERSION</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="variable">$VERSION</span> &gt; image_version</span></span><br></pre></td></tr></table></figure>

<h2 id="RUN-RUN-æŒ‡ä»¤"><a href="#RUN-RUN-æŒ‡ä»¤" class="headerlink" title="RUN (RUN æŒ‡ä»¤)"></a>RUN (RUN æŒ‡ä»¤)</h2><p><code>RUN</code> æŒ‡ä»¤æœ‰ä¸¤ç§å½¢å¼:</p>
<ul>
<li><code>RUN &lt;command&gt;</code> (<strong>shell</strong>å½¢å¼, å‘½ä»¤æ˜¯åœ¨ä¸€ä¸ª shell ä¸­è¿è¡Œçš„, åœ¨ Linux ä¸Šé»˜è®¤æ˜¯ <code>/bin/sh -c</code>, åœ¨ Windows ä¸Šé»˜è®¤æ˜¯ <code>cmd /S /C</code>)</li>
<li><code>RUN [&quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot;]</code> (<strong>exec</strong>å½¢å¼)</li>
</ul>
<p><code>RUN</code> æŒ‡ä»¤å°†ä¼šåœ¨å½“å‰é•œåƒä¹‹ä¸Šçš„æ–°å±‚ä¸­æ‰§è¡Œä»»ä½•å‘½ä»¤å¹¶æäº¤ç»“æœ. æäº¤çš„ç»“æœé•œåƒå°†ç”¨äº <code>Dockerfile</code> ä¸­çš„ä¸‹ä¸€æ­¥</p>
<p>å°† <code>RUN</code> æŒ‡ä»¤åˆ†å±‚å¹¶ç”Ÿæˆæäº¤ ç¬¦åˆ Docker çš„æ ¸å¿ƒæ¦‚å¿µ, å…¶ä¸­æäº¤éå¸¸å»‰ä»·, å¹¶ä¸”å¯ä»¥ä»é•œåƒå†å²çš„ä»»ä½•ç‚¹åˆ›å»ºå®¹å™¨, å°±åƒæºä»£ç æ§åˆ¶ä¸€æ ·</p>
<p><code>exec</code> å½¢å¼å¯ä»¥é¿å… shell å­—ç¬¦ä¸²å¤„ç†, å¹¶ä½¿ç”¨ä¸åŒ…å«æŒ‡å®š shell æ‰§è¡Œæ–‡ä»¶çš„åŸºç¡€é•œåƒ <code>RUN</code> å‘½ä»¤</p>
<p>å¯ä»¥ä½¿ç”¨ <code>SHELL</code> æŒ‡ä»¤æ¥ä¸º <code>shell</code> å½¢å¼æ”¹å˜é»˜è®¤çš„ shell</p>
<p>åœ¨ <code>shell</code> å½¢å¼ä¸­ä½ å¯ä»¥ä½¿ç”¨ <code>\</code> æ¥å°†ä¸€ä¸ª <code>RUN</code> æŒ‡ä»¤æ¢è¡Œåˆ°ä¸‹ä¸€è¡Œ:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="language-bash"> /bin/bash -c <span class="string">&#x27;source $HOME/.bashrc; \</span></span></span><br><span class="line"><span class="string"><span class="language-bash">echo $HOME&#x27;</span></span></span><br></pre></td></tr></table></figure>

<p>è¦ä½¿ç”¨ä¸åŒçš„ shell, è€Œä¸æ˜¯ <code>/bin/sh</code>, åœ¨ <code>exec</code> å½¢å¼ä¸­ä¼ å…¥æƒ³è¦çš„ shell:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="language-bash"> [<span class="string">&quot;/bin/bash&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;echo hello&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p><code>exec</code> å½¢å¼è¢«è§£æä¸ºä¸€ä¸ª JSON æ•°ç»„, æ„å‘³ç€ä½ å¿…é¡»ä½¿ç”¨åŒå¼•å· <code>&quot;</code> æ¥åŒ…å›´è¯è¯­, ä¸è¦ä½¿ç”¨å•å¼•å·</p>
<p>ä¸åƒ <code>shell</code> å½¢å¼, <code>exec</code> å½¢å¼ä¸ä¼šè°ƒç”¨ä¸€ä¸ªå‘½ä»¤ shell. è¿™æ„å‘³ç€ä¸ä¼šå‘ç”Ÿæ­£å¸¸çš„ shell å¤„ç†. ä¾‹å¦‚, <code>RUN [ &quot;echo&quot;, &quot;$HOME&quot; ]</code> å°†ä¸ä¼šåœ¨ <code>$HOME</code> ä¸Šåšå˜é‡æ›¿æ¢. å¦‚æœä½ æƒ³è¦ shell å¤„ç†, é‚£ä¹ˆå¯ä»¥ä½¿ç”¨ <code>shell</code> å½¢å¼, æˆ–è€…ç›´æ¥æ‰§è¡Œä¸€ä¸ª shell ä¾‹å¦‚: <code>RUN [ &quot;sh&quot;, &quot;-c&quot;, &quot;echo $HOME&quot; ]</code>. å½“ä½¿ç”¨ <code>exec</code> å½¢å¼å¹¶ç›´æ¥æ‰§è¡Œä¸€ä¸ª shell æ—¶, å’Œä½¿ç”¨ <code>shell</code> å½¢å¼ä¸€æ ·, æ˜¯ shell æ¥å¤„ç†ç¯å¢ƒå˜é‡æ‰©å±•, è€Œä¸æ˜¯ Docker</p>
<p>åœ¨ <code>JSON</code> å½¢å¼ä¸­æœ‰å¿…è¦è¿›è¡Œåæ–œçº¿è½¬ä¹‰. è¿™åœ¨åæ–œæ æ˜¯è·¯å¾„åˆ†éš”ç¬¦çš„ Windows ä¸Šå°¤ä¸ºé‡è¦:</p>
<p>é”™è¯¯: <code>RUN [&quot;c:\windows\system32\tasklist.exe&quot;]</code></p>
<p>æ­£ç¡®: <code>RUN [&quot;c:\\windows\\system32\\tasklist.exe&quot;]</code></p>
<p><code>RUN</code> æŒ‡ä»¤çš„ç¼“å­˜ä¸ä¼šåœ¨ä¸‹ä¸€æ¬¡æ„å»ºæœŸé—´è‡ªåŠ¨å¤±æ•ˆ</p>
<p>åƒ <code>RUN apt-get dist-upgrade -y</code> è¿™æ ·çš„æŒ‡ä»¤çš„ç¼“å­˜åœ¨ä¸‹æ¬¡æ„å»ºæœŸé—´ä¼šè¢«é‡æ–°ä½¿ç”¨</p>
<p><code>RUN</code> æŒ‡ä»¤çš„ç¼“å­˜å¯ä»¥é€šè¿‡ä½¿ç”¨ <code>--no-cache</code> æ ‡å¿—æ¥æ— æ•ˆåŒ–, ä¾‹å¦‚ <code>docker build --no-cache</code></p>
<p>æŸ¥çœ‹ <code>Dockerfile</code> <a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/" >æœ€ä½³å®è·µ<i class="fas fa-external-link-alt"></i></a> è·å–æ›´å¤šä¿¡æ¯</p>
<p>å¯ä»¥é€šè¿‡ <code>ADD</code> å’Œ <code>COPY</code> æŒ‡ä»¤æ¥ä½¿ <code>RUN</code> æŒ‡ä»¤çš„ç¼“å­˜æ— æ•ˆ</p>
<h3 id="Know-issues-RUN-RUN-æŒ‡ä»¤çš„å·²çŸ¥é—®é¢˜"><a href="#Know-issues-RUN-RUN-æŒ‡ä»¤çš„å·²çŸ¥é—®é¢˜" class="headerlink" title="Know issues (RUN) (RUN æŒ‡ä»¤çš„å·²çŸ¥é—®é¢˜)"></a>Know issues (RUN) (RUN æŒ‡ä»¤çš„å·²çŸ¥é—®é¢˜)</h3><p><a class="link"   target="_blank" rel="noopener" href="https://github.com/docker/docker/issues/783" >é—®é¢˜ 783<i class="fas fa-external-link-alt"></i></a> æ˜¯å…³äºæ–‡ä»¶æƒé™çš„é—®é¢˜, è¿™ä¸ªé—®é¢˜ä¼šåœ¨ä½¿ç”¨ AUFS æ–‡ä»¶ç³»ç»Ÿæ—¶å‡ºç°. å°è¯• <code>rm</code> ä¸€ä¸ªæ–‡ä»¶æ—¶å¯ä»¥æ³¨æ„åˆ°è¿™ä¸ªé—®é¢˜</p>
<h2 id="CMD-CMD-æŒ‡ä»¤"><a href="#CMD-CMD-æŒ‡ä»¤" class="headerlink" title="CMD (CMD æŒ‡ä»¤)"></a>CMD (CMD æŒ‡ä»¤)</h2><p><code>CMD</code> æŒ‡ä»¤æœ‰ä¸‰ç§å½¢å¼:</p>
<ul>
<li><code>CMD [&quot;executable&quot;,&quot;param1&quot;,&quot;param2&quot;]</code> (<code>exec</code> å½¢å¼, æ¨èä½¿ç”¨è¿™ç§å½¢å¼)</li>
<li><code>CMD [&quot;param1&quot;,&quot;param2&quot;]</code> (ä½œä¸º <code>ENTRYPOINT</code> çš„é»˜è®¤å‚æ•°)</li>
<li><code>CMD command param1 param2</code> (<code>shell</code> å½¢å¼)</li>
</ul>
<p>åœ¨ <code>Dockerfile</code> ä¸­åªèƒ½æœ‰ä¸€ä¸ª <code>CMD</code> æŒ‡ä»¤. å¦‚æœä½ æŒ‡å®šäº†è¶…è¿‡ 1 ä¸ª <code>CMD</code> æŒ‡ä»¤, é‚£ä¹ˆåªæœ‰æœ€åä¸€ä¸ª <code>CMD</code> æŒ‡ä»¤ç”Ÿæ•ˆ</p>
<p><code>CMD</code> æŒ‡ä»¤çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºæ­£åœ¨æ‰§è¡Œçš„å®¹å™¨æä¾›é»˜è®¤å€¼</p>
<p>è¿™äº›é»˜è®¤å€¼<strong>å¯ä»¥</strong>åŒ…æ‹¬å¯æ‰§è¡Œæ–‡ä»¶. ä¹Ÿå¯ä»¥çœç•¥å¯æ‰§è¡Œæ–‡ä»¶, åœ¨è¿™ç§æƒ…å†µä¸‹, ä½ å¿…é¡»æŒ‡å®š <code>ENTRYPOINT</code> æŒ‡ä»¤</p>
<p>å¦‚æœ <code>CMD</code> æŒ‡ä»¤ç”¨æ¥ä¸º <code>ENTRYPOINT</code> æŒ‡ä»¤æä¾›é»˜è®¤å‚æ•°, é‚£ä¹ˆ <code>CMD</code> æŒ‡ä»¤å’Œ <code>ENTRYPOINT</code> æŒ‡ä»¤éƒ½è¦ä½¿ç”¨ JSON æ•°ç»„æ ¼å¼æ¥æŒ‡å®š</p>
<p><code>CMD</code> æŒ‡ä»¤çš„ <code>exec</code> å½¢å¼ä½œä¸º JSON æ•°ç»„è¢«è§£æ, è¿™æ„å‘³ç€ä½ å¿…é¡»ä½¿ç”¨åŒå¼•å·æ¥åŒ…è£¹å†…å®¹</p>
<p>ä¸åƒ <code>shell</code> å½¢å¼, <code>exec</code> å½¢å¼ä¸ä¼šè°ƒç”¨ä¸€ä¸ªå‘½ä»¤ shell. è¿™æ„å‘³ç€ä¸ä¼šå‘ç”Ÿæ­£å¸¸çš„ shell å¤„ç†</p>
<p>ä¾‹å¦‚ <code>CMD [ &quot;echo&quot;, &quot;$HOME&quot; ]</code> å°†ä¸ä¼šåœ¨ <code>$HOME</code> ä¸Šæ‰§è¡Œå˜é‡æ›¿æ¢</p>
<p>å¦‚æœä½ æƒ³è¦ <code>shell</code> å¤„ç†, è¦ä¹ˆä½¿ç”¨ <code>shell</code> å½¢å¼, è¦ä¹ˆç›´æ¥æ‰§è¡Œ shell, åƒè¿™æ ·: <code>CMD [ &quot;sh&quot;, &quot;-c&quot;, &quot;echo $HOME&quot; ]</code></p>
<p>å½“ä½¿ç”¨ <code>exec</code> å½¢å¼ä¸”ç›´æ¥æ‰§è¡Œä¸€ä¸ª shell, æ­£å¦‚åœ¨ <code>shell</code> å½¢å¼ä¸­é‚£æ ·, å°†ä¼šæ˜¯ç”± shell è€Œä¸æ˜¯ Docker æ¥æ‰§è¡Œç¯å¢ƒå˜é‡æ‰©å±•</p>
<p>å½“ä½¿ç”¨ <code>shell</code> æˆ– <code>exec</code> æ ¼å¼æ—¶, <code>CMD</code> æŒ‡ä»¤è®¾ç½®äº†åœ¨è¿è¡Œé•œåƒæ—¶æ‰§è¡Œçš„å‘½ä»¤</p>
<p>å¦‚æœä½ ä½¿ç”¨ <code>CMD</code> æŒ‡ä»¤çš„ <code>shell</code> å½¢å¼, é‚£ä¹ˆ <code>&lt;command&gt;</code> å°†ä¼šåœ¨ <code>/bin/sh -c</code> ä¸­æ‰§è¡Œ:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;This is a test.&quot;</span> | <span class="built_in">wc</span> -</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ æƒ³è¦åœ¨æ²¡æœ‰ shell æƒ…å†µä¸‹è¿è¡Œ <code>&lt;command&gt;</code>, åˆ™å¿…é¡»å°†å‘½ä»¤è¡¨ç¤ºä¸º JSON æ•°ç»„å¹¶æä¾›å¯æ‰§è¡Œæ–‡ä»¶çš„å®Œæ•´è·¯å¾„</p>
<p><strong>è¿™ç§æ•°ç»„å½¢å¼æ˜¯ <code>CMD</code> æŒ‡ä»¤çš„é¦–é€‰æ ¼å¼</strong></p>
<p>æ‰€æœ‰é¢å¤–å‚æ•°åœ¨æ•°ç»„ä¸­å¿…é¡»è¡¨è¾¾ä¸ºå­—ç¬¦ä¸²:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [ <span class="string">&quot;/usr/bin/wc&quot;</span>, <span class="string">&quot;--help&quot;</span> ]</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ æƒ³è¦ä½ çš„å®¹å™¨<strong>æ¯æ¬¡</strong>éƒ½è¿è¡Œ<strong>ç›¸åŒçš„</strong>å¯æ‰§è¡Œæ–‡ä»¶, é‚£ä¹ˆå¯ä»¥ç»“åˆä½¿ç”¨ <code>CMD</code> æŒ‡ä»¤å’Œ <code>ENTRYPOINT</code> æŒ‡ä»¤</p>
<p>å¦‚æœç”¨æˆ·åœ¨ <code>docker run</code> ä¸­æŒ‡å®šçš„å‚æ•°, é‚£ä¹ˆè¿™äº›å‚æ•°å°†ä¼šè¦†ç›– <code>CMD</code> æŒ‡ä»¤ä¸­æŒ‡å®šçš„é»˜è®¤å€¼</p>
<p>Note: ä¸è¦æ··æ·† <code>RUN</code> å’Œ <code>CMD</code> æŒ‡ä»¤. <code>RUN</code> æŒ‡ä»¤å®é™…è¿è¡Œä¸€ä¸ªå‘½ä»¤å¹¶æäº¤ç»“æœ; <code>CMD</code> æŒ‡ä»¤åœ¨æ„å»ºæ—¶æ²¡æœ‰æ‰§è¡Œä»»ä½•ä¸œè¥¿, ä½†æ˜¯æŒ‡å®šäº†é•œåƒçš„é¢„æœŸ (intended) å‘½ä»¤</p>
<h2 id="LABEL-LABEL-æŒ‡ä»¤"><a href="#LABEL-LABEL-æŒ‡ä»¤" class="headerlink" title="LABEL (LABEL æŒ‡ä»¤)"></a>LABEL (LABEL æŒ‡ä»¤)</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; ...</span></span><br></pre></td></tr></table></figure>

<p><code>LABEL</code> æŒ‡ä»¤ä¸ºé•œåƒæ·»åŠ å…ƒæ•°æ®</p>
<p>ä¸€ä¸ª <code>LABEL</code> æ˜¯ä¸€ä¸ªé”®å€¼å¯¹</p>
<p>è¦åœ¨ <code>LABEL</code> å€¼ä¸­åŒ…å«ç©ºæ ¼, è¯·åƒåœ¨å‘½ä»¤è¡Œè§£æä¸­ä¸€æ ·ä½¿ç”¨å¼•å·å’Œåæ–œçº¿</p>
<p>Example:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> <span class="string">&quot;com.example.vendor&quot;</span>=<span class="string">&quot;ACME Incorporated&quot;</span></span></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> com.example.label-with-avlue=<span class="string">&quot;foo&quot;</span></span></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> version=<span class="string">&quot;1.0&quot;</span></span></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> describes=<span class="string">&quot;This is text illustrates \</span></span></span><br><span class="line"><span class="string"><span class="language-bash">that label-values can span multiple lines.&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸ªé•œåƒå¯ä»¥æœ‰å¤šä¸ª label</p>
<p>å¯ä»¥åœ¨å•ç‹¬ä¸€è¡Œä¸­æŒ‡å®šå¤šä¸ª label. åœ¨ Docker 1.10 ç‰ˆæœ¬ä¹‹å‰, è¿™å¯ä»¥å‡å°‘æœ€ç»ˆçš„é•œåƒå¤§å°, ä½†æ˜¯ç°åœ¨ä¸æ˜¯è¿™æ ·å­äº†</p>
<p>ä½ ä¹Ÿè¿˜å¯ä»¥é€‰æ‹©åœ¨å•ç‹¬ä¸€è¡Œä¸­çŸ¥é“æŒ‡å®šå¤šä¸ª label, ä½¿ç”¨å¦‚ä¸‹ä¸¤ç§æ–¹å¼:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> multi.label1=<span class="string">&quot;value1&quot;</span> multi.label2=<span class="string">&quot;value2&quot;</span> other=<span class="string">&quot;value3&quot;</span></span></span><br></pre></td></tr></table></figure>

<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> multi.label1=<span class="string">&quot;value1&quot;</span> \</span></span><br><span class="line"><span class="language-bash">      multi.label2=<span class="string">&quot;value2&quot;</span> \</span></span><br><span class="line"><span class="language-bash">      other=<span class="string">&quot;value3&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>åŸºç¡€é•œåƒæˆ–çˆ¶é•œåƒ (<code>FROM</code> è¡Œä¸­çš„é•œåƒ) ä¸­åŒ…å«çš„ labels ç”±ä½ çš„é•œåƒè¿›è¡Œç»§æ‰¿</p>
<p>å¦‚æœ label å·²ç»å­˜åœ¨ä½†å…·æœ‰ä¸åŒçš„å€¼, é‚£ä¹ˆæœ€è¿‘åº”ç”¨çš„å€¼å°†è¦†ç›–ä»»ä½•ä¹‹å‰è®¾ç½®çš„å€¼</p>
<p>è¦æŸ¥çœ‹é•œåƒçš„ labels, ä½¿ç”¨ <code>docker image inspect</code> å‘½ä»¤. å¯ä»¥ä½¿ç”¨ <code>--format</code> é€‰é¡¹æ¥å£°æ˜ä»…å±•ç¤º labels:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker image inspect --format=<span class="string">&#x27;&#x27;</span> myimage</span><br></pre></td></tr></table></figure>

<h2 id="MAINTAINER-deprecated-MAINTAINER-æŒ‡ä»¤-å·²è¿‡æ—¶"><a href="#MAINTAINER-deprecated-MAINTAINER-æŒ‡ä»¤-å·²è¿‡æ—¶" class="headerlink" title="MAINTAINER (deprecated) (MAINTAINER æŒ‡ä»¤ å·²è¿‡æ—¶)"></a>MAINTAINER (deprecated) (MAINTAINER æŒ‡ä»¤ å·²è¿‡æ—¶)</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">MAINTAINER</span> &lt;name&gt;</span><br></pre></td></tr></table></figure>

<p><code>MAINTAINER</code> æŒ‡ä»¤ç”¨æ¥è®¾ç½®åˆ›å»ºé•œåƒçš„ä½œè€…å­—æ®µ</p>
<p>ä½¿ç”¨ <code>LABEL</code> æŒ‡ä»¤æ¥ä»£æ›¿ <code>MAINTAINER</code> æŒ‡ä»¤: <code>LABEL org.opencontainers.image.authors=&quot;SvenDowideit@home.org.au&quot;</code></p>
<h2 id="EXPOSE-EXPOSE-æŒ‡ä»¤"><a href="#EXPOSE-EXPOSE-æŒ‡ä»¤" class="headerlink" title="EXPOSE (EXPOSE æŒ‡ä»¤)"></a>EXPOSE (EXPOSE æŒ‡ä»¤)</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXPOSE</span> &lt;port&gt; [&lt;port&gt;/&lt;protocol&gt;...]</span><br></pre></td></tr></table></figure>

<p><code>EXPOSE</code> æŒ‡ä»¤é€šçŸ¥ Docker, å®¹å™¨è¦åœ¨è¿è¡Œæ—¶ç›‘å¬æŒ‡å®šçš„ç½‘ç»œç«¯å£</p>
<p>ä½ å¯ä»¥æŒ‡å®šç«¯å£æ˜¯ç›‘å¬åœ¨ TCP è¿˜æ˜¯ UDP ä¸Š, å¦‚æœæ²¡æœ‰æŒ‡å®šåè®®é‚£ä¹ˆé»˜è®¤æ˜¯ TCP</p>
<p><code>EXPOSE</code> æŒ‡ä»¤å®é™…ä¸Šå¹¶æ²¡æœ‰å‘å¸ƒ (publish) ç«¯å£</p>
<p><code>EXPOSE</code> æŒ‡ä»¤å……å½“ æ„å»ºé•œåƒçš„äºº å’Œ è¿è¡Œå®¹å™¨çš„äºº ä¹‹é—´çš„ä¸€ç§æ–‡æ¡£, å…³äº<strong>æ‰“ç®—</strong>å‘å¸ƒ (publish) å“ªäº›ç«¯å£çš„æ–‡æ¡£</p>
<p>è¦åœ¨è¿è¡Œå®¹å™¨æ—¶å®é™…ä¸Šå‘å¸ƒç«¯å£, åœ¨ <code>docker run</code> å‘½ä»¤ä¸Šä½¿ç”¨ <code>-p</code> æ ‡å¿—æ¥å‘å¸ƒå¹¶æ˜ å°„ä¸€åˆ°å¤šä¸ªç«¯å£, æˆ–è€…ä½¿ç”¨ <code>-P</code> æ ‡å¿—æ¥å‘å¸ƒæ‰€æœ‰æš´éœ²çš„ (exposed) ç«¯å£å¹¶å°†å®ƒä»¬æ˜ å°„åˆ°é«˜é˜¶ç«¯å£ (high-order ports)</p>
<p>é»˜è®¤åœ°, <code>EXPOSE</code> æŒ‡ä»¤å‡å®šä½¿ç”¨ TCP. ä½ è¿˜å¯ä»¥æŒ‡å®š UDP:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span>/udp</span><br></pre></td></tr></table></figure>

<p>è¦åŒæ—¶æš´éœ² TCP å’Œ UDP, é‚£ä¹ˆåŒ…å«ä¸¤è¡Œ:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span>/tcp</span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span>/udp</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ç§æƒ…å†µä¸‹, å¦‚æœä½ å°† <code>-P</code> å’Œ <code>docker run</code> ä¸€èµ·ä½¿ç”¨, è¿™ä¸ªç«¯å£å°†ä¸º TCP æš´éœ²ä¸€æ¬¡, ä¸º UDP æš´éœ²ä¸€æ¬¡. è®°ä½, <code>-P</code> ä½¿ç”¨ä½¿ç”¨ä¸»æœºä¸Šçš„ä¸´æ—¶é«˜é˜¶ä¸»æœºç«¯å£ (high-ordered host port), æ‰€ä»¥ TCP å’Œ UDP çš„ç«¯å£å°†ä¼šä¸åŒ</p>
<p><code>-P</code> æ ‡å¿—å°†å®¹å™¨ä¸­æ‰€æœ‰æš´éœ²çš„ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœºä¸Šçš„éšæœºç«¯å£</p>
<p>ä¸ç®¡ <code>EXPOSE</code> å¦‚ä½•è®¾ç½®, ä½ å¯ä»¥åœ¨è¿è¡Œæ—¶ä½¿ç”¨ <code>-p</code> æ ‡å¿—æ¥è¦†ç›–å®ƒä»¬:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -p 80:80/tcp -p 80:80/udp</span><br></pre></td></tr></table></figure>

<p>è¦åœ¨ä¸»æœºç³»ç»Ÿä¸Šè®¾ç½®ç«¯å£é‡å®šå‘, æŸ¥çœ‹<a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/run/#expose-incoming-ports">ä½¿ç”¨ <code>-P</code> æ ‡å¿—</a></p>
<p><code>docker network</code> å‘½ä»¤æ”¯æŒä¸ºå®¹å™¨ä¹‹é—´çš„é€šä¿¡åˆ›å»ºç½‘ç»œ, è€Œæ— éœ€æš´éœ²æˆ–å‘å¸ƒç‰¹å®šç«¯å£, å› ä¸ºè¿æ¥åˆ°ç½‘ç»œçš„å®¹å™¨å¯ä»¥é€šè¿‡ä»»ä½•ç«¯å£äº’ç›¸é€šä¿¡. æ›´è¯¦ç»†çš„ä¿¡æ¯è¯·æŸ¥çœ‹<a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/engine/userguide/networking/" >è¿™ä¸ªåŠŸèƒ½<i class="fas fa-external-link-alt"></i></a></p>
<h2 id="ENV-ENV-æŒ‡ä»¤"><a href="#ENV-ENV-æŒ‡ä»¤" class="headerlink" title="ENV (ENV æŒ‡ä»¤)"></a>ENV (ENV æŒ‡ä»¤)</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> &lt;key&gt;=&lt;value&gt; ...</span><br></pre></td></tr></table></figure>

<p><code>ENV</code> æŒ‡ä»¤è®¾ç½®ç¯å¢ƒå˜é‡ <code>&lt;key&gt;</code> çš„å€¼ä¸º <code>&lt;value&gt;</code></p>
<p>è¯¥å€¼å°†åœ¨æ„å»ºé˜¶æ®µçš„æ‰€æœ‰åç»­æŒ‡ä»¤çš„ç¯å¢ƒä¸­, ä¹Ÿå¯ä»¥åœ¨è®¸å¤šæŒ‡ä»¤ä¸­<a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/builder/#environment-replacement" >å†…è”æ›¿æ¢<i class="fas fa-external-link-alt"></i></a></p>
<p>è¯¥å€¼å°†ä¼šè¢«è§£æä¸ºå…¶ä»–ç¯å¢ƒå˜é‡, æ‰€ä»¥å¦‚æœå¼•å·å­—ç¬¦æ²¡æœ‰è¢«è½¬ä¹‰, é‚£ä¹ˆå¼•å·å­—ç¬¦å°†ä¼šè¢«åˆ é™¤</p>
<p>ä¸å‘½ä»¤è¡Œè§£æä¸€æ ·, å¼•å·å’Œåæ–œçº¿å¯ä»¥ç”¨æ¥åœ¨å€¼ä¸­åŒ…å«ç©ºæ ¼</p>
<p>Example:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> MY_NAME=<span class="string">&quot;John Doe&quot;</span></span><br><span class="line"><span class="keyword">ENV</span> MY_DOG=Rex\ The\ Dog <span class="comment"># ä½¿ç”¨åæ–œçº¿æ¥å¯¹ç©ºæ ¼è½¬ä¹‰</span></span><br><span class="line"><span class="keyword">ENV</span> MY_CAT=fluffy</span><br></pre></td></tr></table></figure>

<p><code>ENV</code> æŒ‡ä»¤å…è®¸åŒæ—¶è®¾ç½®å¤šä¸ª <code>&lt;key&gt;=&lt;value&gt;</code> å˜é‡, ä¸‹é¢çš„ä¾‹å­å°†ä¼šåœ¨æœ€ç»ˆé•œåƒä¸­äº§ç”Ÿç›¸åŒçš„æœ€ç»ˆç»“æœ:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> MY_NAME=<span class="string">&quot;John Doe&quot;</span> MY_DOG=Rex\ The\ Dog \</span><br><span class="line">    MY_CAT=fluffy</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ <code>ENV</code> è®¾ç½®çš„ç¯å¢ƒå˜é‡å°†æŒç»­åˆ°å®¹å™¨ä»ç»“æœé•œåƒä¸­è¿è¡Œçš„æ—¶å€™. ä½ å¯ä»¥ä½¿ç”¨ <code>docker inspect</code> å‘½ä»¤æ¥æŸ¥çœ‹è¿™äº›ç¯å¢ƒå˜é‡å€¼. å¯ä»¥ä½¿ç”¨ <code>docker run --env &lt;key&gt;=&lt;value&gt;</code> å‘½ä»¤æ¥ä¿®æ”¹è¿™äº›ç¯å¢ƒå˜é‡å€¼</p>
<p>ç¯å¢ƒå˜é‡çš„æŒä¹…åŒ–å¯èƒ½å¯¼è‡´ä¸å¯é¢„æ–™çš„å‰¯ä½œç”¨. ä¾‹å¦‚, è®¾ç½® <code>ENV DEBIAN_FRONTEND=noninteractive</code> ä¿®æ”¹ <code>apt-get</code> çš„è¡Œä¸º, å¯èƒ½ä¼šè®©ä½ çš„é•œåƒçš„ç”¨æˆ·æ„Ÿåˆ°è¿·æƒ‘</p>
<p>å¦‚æœä¸€ä¸ªç¯å¢ƒå˜é‡ä»…ä»…åœ¨æ„å»ºæ—¶éœ€è¦è€Œåœ¨æœ€ç»ˆé•œåƒä¸­ä¸éœ€è¦, è€ƒè™‘ä¸ºå•ç‹¬ä¸€ä¸ªå‘½ä»¤è®¾ç½®ç¯å¢ƒå˜é‡å€¼:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="language-bash"> DEBIAN_FRONTEND=noninteractive apt-get update &amp;&amp; apt-get install -y ...</span></span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ä½¿ç”¨ <code>ARG</code> æŒ‡ä»¤, è¿™ä¸ªæŒ‡ä»¤çš„å€¼ä¸ä¼šæŒç»­åˆ°æœ€ç»ˆé•œåƒä¸­:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ARG</span> DEBIAN_FRONTEND=noninteractive</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get install -y ...</span></span><br></pre></td></tr></table></figure>

<h3 id="æ›¿ä»£çš„è¯­æ³•"><a href="#æ›¿ä»£çš„è¯­æ³•" class="headerlink" title="æ›¿ä»£çš„è¯­æ³•"></a>æ›¿ä»£çš„è¯­æ³•</h3><p><code>ENV</code> æŒ‡ä»¤è¿˜æœ‰ä¸€ä¸ªæ›¿ä»£çš„è¯­æ³• <code>ENV &lt;key&gt; &lt;value&gt;</code>, å»æ‰äº† <code>=</code>:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> MY_VAR my-value</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªè¯­æ³•<strong>ä¸å…è®¸</strong>*åœ¨å•ä¸ª <code>ENV</code> æŒ‡ä»¤ä¸­è®¾ç½®å¤šä¸ªç¯å¢ƒå˜é‡</p>
<p>è¿™ä¸ªæ›¿ä»£çš„è¯­æ³•æ˜¯ä¸ºäº†å‘åçš„å…¼å®¹æ€§, ä¸å»ºè®®ç»§ç»­ä½¿ç”¨</p>
<h2 id="ADD-ADD-æŒ‡ä»¤"><a href="#ADD-ADD-æŒ‡ä»¤" class="headerlink" title="ADD (ADD æŒ‡ä»¤)"></a>ADD (ADD æŒ‡ä»¤)</h2><p><code>ADD</code> æŒ‡ä»¤æœ‰ä¸¤ç§å½¢å¼:</p>
<ul>
<li><code>ADD [--chown=&lt;user&gt;:&lt;group&gt;] &lt;src&gt;... &lt;dest&gt;</code></li>
<li><code>ADD [--chown=&lt;user&gt;:&lt;group&gt;] [&quot;&lt;src&gt;&quot;,...&quot;&lt;dest&gt;&quot;]</code></li>
</ul>
<p>åŒ…å«ç©ºæ ¼çš„è·¯å¾„éœ€è¦ç¬¬äºŒç§å½¢å¼</p>
<p><code>--chown</code> åŠŸèƒ½ä»…åœ¨ç”¨äºæ„å»º Linux å®¹å™¨çš„ Dockfile ä¸Šå—æ”¯æŒ, åœ¨ Windows å®¹å™¨ä¸Šä¸æ”¯æŒ. å› ä¸ºç”¨æˆ·å’Œç”¨æˆ·ç»„æ‰€æœ‰æƒæ¦‚å¿µä¸èƒ½åœ¨ Linux å’Œ Windows ä¹‹é—´è½¬æ¢, å› æ­¤ä½¿ç”¨ <code>/etc/passwd</code> å’Œ <code>/etc/group</code> å°†ç”¨æˆ·åå’Œç»„åè½¬æ¢ä¸º ID ä¼šé™åˆ¶æ­¤åŠŸèƒ½ä»…é€‚ç”¨äºåŸºäº Linux æ“ä½œç³»ç»Ÿçš„å®¹å™¨</p>
<p><code>ADD</code> æŒ‡ä»¤ä» <code>&lt;src&gt;</code> <strong>å¤åˆ¶</strong>æ–°çš„ æ–‡ä»¶,ç›®å½•,è¿œç¨‹æ–‡ä»¶URLs , å¹¶å°†å®ƒä»¬<strong>æ·»åŠ </strong>åˆ°é•œåƒçš„æ–‡ä»¶ç³»ç»Ÿä¸­çš„ <code>&lt;dest&gt;</code> è·¯å¾„ä¸Š</p>
<p>å¯ä»¥æŒ‡å®šå¤šä¸ª <code>&lt;src&gt;</code> èµ„æº, ä½†æ˜¯å¦‚æœå®ƒä»¬æ˜¯æ–‡ä»¶æˆ–è€…ç›®å½•, å®ƒä»¬çš„è·¯å¾„è¢«è§£æä¸ºç›¸å¯¹äºæ„å»ºä¸Šä¸‹æ–‡çš„æº</p>
<p>æ¯ä¸ª <code>&lt;src&gt;</code> å¯ä»¥åŒ…å«é€šé…ç¬¦, å¹¶ä½¿ç”¨ Go è¯­è¨€çš„ <a class="link"   target="_blank" rel="noopener" href="https://golang.org/pkg/path/filepath#Match" >filepath.Match<i class="fas fa-external-link-alt"></i></a> æ¥è¿›è¡ŒåŒ¹é…:</p>
<p>Example - æ·»åŠ æ‰€æœ‰ä¸€ä¸ª â€œhomâ€ å¼€å¤´çš„æ–‡ä»¶:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ADD</span><span class="language-bash"> hom* /mydir/</span></span><br></pre></td></tr></table></figure>

<p>Example - <code>?</code> ç¬¦å·ç”¨æ¥åŒ¹é…ä»»ä½•å•ä¸ªå­—ç¬¦:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ADD</span><span class="language-bash"> hom?.txt /mydir/</span></span><br></pre></td></tr></table></figure>

<p><code>&lt;dest&gt;</code> æ˜¯ä¸€ä¸ªç»å¯¹è·¯å¾„, æˆ–è€…ç›¸å¯¹äº <code>WORKDIR</code> çš„è·¯å¾„, <code>&lt;src&gt;</code> å°†ä¼šè¢«å¤åˆ¶åˆ°ç›®æ ‡å®¹å™¨å†…çš„è¿™ä¸ªè·¯å¾„ä¸­</p>
<p>Example - ä½¿ç”¨ç›¸å¯¹è·¯å¾„, å¹¶æ·»åŠ  test.txt åˆ° <code>&lt;WORKDIR&gt;/relativeDir/</code> ä¸­:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ADD</span><span class="language-bash"> test.txt relativeDir /</span></span><br></pre></td></tr></table></figure>

<p>Example - ä½¿ç”¨ç»å¯¹è·¯å¾„, æ·»åŠ  test.txt åˆ° <code>/absoluteDir/</code> ä¸­:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ADD</span><span class="language-bash"> test.txt /absoluteDir/</span></span><br></pre></td></tr></table></figure>

<p>å½“æ·»åŠ åŒ…å«ç‰¹æ®Šå­—ç¬¦ (ä¾‹å¦‚ <code>[</code> å’Œ <code>]</code>) çš„æ–‡ä»¶æˆ–ç›®å½•æ—¶, ä½ éœ€è¦ä½¿ç”¨ Golang è§„åˆ™è½¬ä¹‰é‚£äº›è·¯å¾„æ¥é¿å…å°†å®ƒä»¬ä½œä¸ºä¸€ä¸ªåŒ¹é…æ¨¡å¼æ¥çœ‹å¾…</p>
<p>Example - æ·»åŠ ä¸€ä¸ªåç§°ä¸º <code>arr[0].txt</code> çš„æ–‡ä»¶:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ADD</span><span class="language-bash"> arr[[]0].txt /mydir/</span></span><br></pre></td></tr></table></figure>

<p>æ‰€æœ‰æ–°æ–‡ä»¶å’Œç›®å½•ä½¿ç”¨ä¸ºé›¶çš„ UID å’Œ GID è¿›è¡Œåˆ›å»º, é™¤éæŒ‡å®šäº†å¯é€‰çš„ <code>--chown</code> æ ‡å¿—, <code>--chown</code> æ ‡å¿—æŒ‡å®šäº†ç»™å®šçš„ç”¨æˆ·å, ç»„å, æˆ–è€… UID&#x2F;GID çš„ç»„åˆä»¥è¯·æ±‚æ·»åŠ å†…å®¹çš„ç‰¹å®šæ‰€æœ‰æƒ</p>
<p><code>--chown</code> æ ‡å¿—çš„æ ¼å¼å…è®¸ç”¨æˆ·åå’Œç»„åå­—ç¬¦ä¸²æˆ–ç›´æ¥æ•´æ•° UID å’Œ GID çš„ä»»æ„ç»„åˆ</p>
<p>æä¾›ä¸å¸¦ç»„åçš„ç”¨æˆ·åæˆ–ä¸å¸¦ GID çš„ UID å°†ä½¿ç”¨ä¸ GID ç›¸åŒçš„æ•°å­—ä½œä¸º GID</p>
<p>å¦‚æœæä¾›äº†ç”¨æˆ·åæˆ–ç»„å, åˆ™å®¹å™¨çš„æ ¹æ–‡ä»¶ç³»ç»Ÿ <code>/etc/passwd</code> å’Œ <code>/etc/group</code> æ–‡ä»¶å°†åˆ†åˆ«ç”¨äºæ‰§è¡Œä»åç§°åˆ°æ•´æ•° UID æˆ– GID çš„è½¬æ¢</p>
<p>Example - ä¸‹é¢ä¾‹å­å±•ç¤º <code>--chown</code> æ ‡å¿—çš„æœ‰æ•ˆå®šä¹‰:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ADD</span><span class="language-bash"> --<span class="built_in">chown</span>=55:mygroup files* /somedir/</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> --<span class="built_in">chown</span>=bin files* /somedir/</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> --<span class="built_in">chown</span>=1 files* /somedir/</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> --<span class="built_in">chown</span>=10:11 files* /somedir/</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœå®¹å™¨æ ¹æ–‡ä»¶ç³»ç»Ÿä¸åŒ…å« <code>/etc/passwd</code> æˆ– <code>/etc/group</code> æ–‡ä»¶, å¹¶ä¸”åœ¨ <code>--chown</code> æ ‡å¿—ä¸­ä½¿ç”¨äº†ç”¨æˆ·åæˆ–ç»„å, åˆ™æ„å»ºå°†åœ¨ <code>ADD</code> æ“ä½œæ—¶å¤±è´¥</p>
<p>ä½¿ç”¨æ•°å­—å½¢ ID ä¸éœ€è¦æŸ¥æ‰¾, å¹¶ä¸”ä¸ä¾èµ–äºå®¹å™¨æ ¹æ–‡ä»¶ç³»ç»Ÿ</p>
<p>åœ¨ <code>&lt;src&gt;</code> æ˜¯ä¸€ä¸ªè¿œç¨‹æ–‡ä»¶ URL çš„æƒ…å†µä¸‹, <code>&lt;dest&gt;</code> å°†æ‹¥æœ‰ 600 çš„æƒé™</p>
<p>å¦‚æœæ­£åœ¨è·å–çš„è¿œç¨‹æ–‡ä»¶å…·æœ‰ HTTP <code>Last-Modified</code> è¯·æ±‚å¤´, åˆ™è¯¥è¯·æ±‚å¤´ä¸­çš„æ—¶é—´æˆ³å°†ç”¨äºè®¾ç½®ç›®æ ‡æ–‡ä»¶çš„ <code>mtime</code></p>
<p>ä½†æ˜¯, ä¸åœ¨ <code>ADD</code> æœŸé—´å¤„ç†çš„ä»»ä½•å…¶ä»–æ–‡ä»¶ä¸€æ ·, åœ¨ç¡®å®šæ–‡ä»¶æ˜¯å¦å·²æ›´æ”¹ä»¥åŠæ˜¯å¦åº”è¯¥æ›´æ–°ç¼“å­˜æ—¶, ä¸ä¼šåŒ…å« <code>mtime</code></p>
<p>å¦‚æœä½ é€šè¿‡ STDIN (<code>docker build - &lt; somefile</code>) ä¼ é€’ <code>Dockerfile</code> æ¥è¿›è¡Œæ„å»º, é‚£å°†ä¼šæ²¡æœ‰æ„å»ºä¸Šä¸‹æ–‡, æ‰€ä»¥ <code>Dockerfile</code> åªèƒ½åŒ…å«ä¸€ä¸ªåŸºäº URL çš„ <code>ADD</code> æŒ‡ä»¤</p>
<p>ä½ è¿˜å¯ä»¥é€šè¿‡ STDIN ä¼ é€’å‹ç¼©æ–‡ä»¶: (<code>docker build - &lt; archive.tar.gz</code>), å‹ç¼©æ–‡ä»¶æ ¹ç›®å½•ä¸­çš„ <code>Dockerfile</code> å’Œå‹ç¼©æ–‡ä»¶çš„å…¶ä½™éƒ¨åˆ†å°†ç”¨ä½œæ„å»ºçš„ä¸Šä¸‹æ–‡</p>
<p>å¦‚æœä½ çš„ URL æ–‡ä»¶æ˜¯ä½¿ç”¨è®¤è¯ä¿æŠ¤çš„, ä½ éœ€è¦ä½¿ç”¨ <code>RUN wget</code>, <code>RUN curl</code> æˆ–å®¹å™¨ä¸­çš„å…¶ä»–å·¥å…·, å› ä¸º <code>ADD</code> æŒ‡ä»¤ä¸æ”¯æŒè®¤è¯</p>
<p>å¦‚æœ <code>&lt;src&gt;</code> çš„å†…å®¹å·²æ›´æ”¹, åˆ™ç¬¬ä¸€ä¸ªé‡åˆ°çš„ <code>ADD</code> æŒ‡ä»¤å°†ä½¿ <code>Dockerfile</code> ä¸­æ‰€æœ‰åç»­æŒ‡ä»¤çš„ç¼“å­˜æ— æ•ˆ. è¿™åŒ…æ‹¬ä½¿ <code>RUN</code> æŒ‡ä»¤çš„ç¼“å­˜æ— æ•ˆåŒ–. æŸ¥çœ‹ <a target="_blank" rel="noopener" href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/#leverage-build-cache"><code>Dockerfile</code> Best Practices guide - Leverage build cache</a> è·å–ä¿¡æ¯</p>
<p><code>ADD</code> éµå¾ªä»¥ä¸‹è§„åˆ™:</p>
<ul>
<li><code>&lt;src&gt;</code> çš„è·¯å¾„å¿…é¡»åœ¨æ„å»ºçš„ä¸Šä¸‹æ–‡ä¸­; ä¸å¯ä»¥ <code>ADD ../something/something</code>, å› ä¸º <code>docker build</code> çš„ç¬¬ä¸€æ­¥æ˜¯å‘é€ä¸Šä¸‹æ–‡ç›®å½• (å’Œå­ç›®å½•) ç»™ Docker Daemon</li>
<li>å¦‚æœ <code>&lt;src&gt;</code> æ˜¯ä¸€ä¸ª URL ä¸” <code>&lt;dest&gt;</code> æ²¡æœ‰ä»¥ä¸€ä¸ªæ–œçº¿ç»“å°¾, é‚£ä¹ˆæ–‡ä»¶ä» URL ä¸­ä¸‹è½½å¹¶å¤åˆ¶åˆ° <code>&lt;dest&gt;</code></li>
<li>å¦‚æœ <code>&lt;src&gt;</code> æ˜¯ä¸€ä¸ª URL ä¸” <code>&lt;dest&gt;</code> ä»¥ä¸€ä¸ªæ–œçº¿ç»“å°¾, é‚£ä¹ˆå°†ä» URL ä¸­æ¨æ–­æ–‡ä»¶å, å¹¶å°†æ–‡ä»¶ä¸‹è½½åˆ° <code>&lt;dest&gt;/&lt;filename&gt;</code>. ä¾‹å¦‚, <code>ADD http://example.com/foobar /</code> å°†ä¼šåˆ›å»ºæ–‡ä»¶ <code>/foobar</code>. URL å¿…é¡»æœ‰ä¸€ä¸ªé‡è¦çš„è·¯å¾„, ä»¥ä¾¿åœ¨è¿™ç§æƒ…å†µä¸‹å¯ä»¥æ‰¾åˆ°é€‚å½“çš„æ–‡ä»¶å (<code>http://example.com</code> æ— æ³•å·¥ä½œ)</li>
<li>å¦‚æœ <code>&lt;src&gt;</code> æ˜¯ä¸€ä¸ªç›®å½•, é‚£ä¹ˆç›®å½•çš„å…¨éƒ¨å†…å®¹è¢«å¤åˆ¶, åŒ…æ‹¬æ–‡ä»¶ç³»ç»Ÿå…ƒæ•°æ®; <strong>ç›®å½•æœ¬èº«ä¸ä¼šè¢«å¤åˆ¶, åªæœ‰ç›®å½•ä¸­çš„å†…å®¹ä¼šè¢«å¤åˆ¶</strong></li>
<li>å¦‚æœ <code>&lt;src&gt;</code> æ˜¯å¯è¯†åˆ«çš„å‹ç¼©æ ¼å¼ (identity, gzip, bzip2 æˆ– xz) çš„æœ¬åœ° tar å­˜æ¡£, åˆ™å°†å…¶è§£å‹ç¼©ä¸ºç›®å½•. ä»è¿œç¨‹ URLs è·å–çš„èµ„æº<strong>ä¸ä¼š</strong>è§£å‹ç¼©. å½“ä¸€ä¸ªç›®å½•è¢«å¤åˆ¶æˆ–è§£å‹ç¼©æ—¶, å®ƒå…·æœ‰ä¸ <code>tar -x</code> ç›¸åŒçš„è¡Œä¸º, ç»“æœæ˜¯å¦‚ä¸‹çš„ç»“åˆ:<ul>
<li>ç›®æ ‡è·¯å¾„ä¸Šå­˜åœ¨çš„ä»»ä½•ä¸œè¥¿</li>
<li>æºæ ‘ (source tree) çš„å†…å®¹, ç”¨ â€œ2â€ çš„æ–¹å¼è§£å†³å†²çª. ä»¥é€ä¸ªæ–‡ä»¶ä¸ºåŸºç¡€</li>
</ul>
</li>
<li>æ–‡ä»¶æ˜¯å¦è¢«é‰´å®šä¸ºå¯è¯†åˆ«çš„å‹ç¼©æ ¼å¼ä»…å–å†³äºæ–‡ä»¶çš„å†…å®¹, è€Œä¸æ˜¯æ–‡ä»¶å. ä¾‹å¦‚, å¦‚æœä¸€ä¸ªç©ºæ–‡ä»¶æ°å¥½ä»¥ <code>.tar.gz</code> ç»“å°¾, è¿™å°†ä¸ä¼šè¢«è¯†åˆ«ä¸ºå‹ç¼©æ–‡ä»¶, ä¹Ÿä¸ä¼šç”Ÿæˆä»»ä½•ç±»å‹çš„è§£å‹ç¼©é”™è¯¯æ¶ˆæ¯, è€Œæ˜¯å°†æ–‡ä»¶ç®€å•åœ°å¤åˆ¶åˆ°ç›®æ ‡ä½ç½®</li>
<li>å¦‚æœ <code>&lt;src&gt;</code> æ˜¯ä»»ä½•å…¶ä»–ç±»å‹çš„æ–‡ä»¶, å®ƒä¼šä¸å…ƒæ•°æ®ä¸€èµ·å•ç‹¬å¤åˆ¶. åœ¨è¿™ç§æƒ…å†µä¸‹, å¦‚æœ <code>&lt;dest&gt;</code> ä»¥ <code>/</code> ç»“å°¾, åˆ™å°†å…¶è§†ä¸ºç›®å½•, ä¸” <code>&lt;src&gt;</code> çš„å†…å®¹å°†å†™å…¥ <code>&lt;dest&gt;/base(&lt;src&gt;</code></li>
<li>å¦‚æœæŒ‡å®šäº†å¤šä¸ª <code>&lt;src&gt;</code> æº, æ— è®ºæ˜¯ç›´æ¥æŒ‡å®šè¿˜æ˜¯ä½¿ç”¨äº†é€šé…ç¬¦æŒ‡å®š, é‚£ä¹ˆ <code>&lt;dest&gt;</code> å¿…é¡»æ˜¯ç›®å½•, å¹¶ä¸”å¿…é¡»ä»¥ <code>/</code> ç»“å°¾</li>
<li>å¦‚æœ <code>&lt;dest&gt;</code> ä¸æ˜¯ä»¥ <code>/</code> ç»“å°¾, é‚£ä¹ˆ <code>&lt;dest&gt;</code> å°†è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªæ™®é€šæ–‡ä»¶ä¸” <code>&lt;src&gt;</code> çš„å†…å®¹å°†ä¼šè¢«å†™åˆ° <code>&lt;dest&gt;</code></li>
<li>å¦‚æœ <code>&lt;dest&gt;</code> ä¸å­˜åœ¨, å®ƒä¼šè¿åŒå…¶è·¯å¾„ä¸­æ‰€æœ‰ç¼ºå¤±çš„ç›®å½•ä¸€èµ·åˆ›å»º</li>
</ul>
<h2 id="COPY-COPY-æŒ‡ä»¤"><a href="#COPY-COPY-æŒ‡ä»¤" class="headerlink" title="COPY (COPY æŒ‡ä»¤)"></a>COPY (COPY æŒ‡ä»¤)</h2><p><code>COPY</code> æŒ‡ä»¤æœ‰ä¸¤ç§å½¢å¼:</p>
<ul>
<li><code>COPY [--chown=&lt;user&gt;:&lt;group&gt;] &lt;src&gt;... &lt;dest&gt;</code></li>
<li><code>COPY [--chown=&lt;user&gt;:&lt;group&gt;] [&quot;&lt;src&gt;&quot;,... &quot;&lt;dest&gt;&quot;]</code></li>
</ul>
<p>åŒ…å«ç©ºæ ¼çš„è·¯å¾„éœ€è¦ä½¿ç”¨åä¸€ç§å½¢å¼</p>
<p><code>--chown</code> åŠŸèƒ½ä»…åœ¨ç”¨äºæ„å»º Linux å®¹å™¨çš„ Dockfile ä¸Šå—æ”¯æŒ, åœ¨ Windows å®¹å™¨ä¸Šä¸æ”¯æŒ. å› ä¸ºç”¨æˆ·å’Œç”¨æˆ·ç»„æ‰€æœ‰æƒæ¦‚å¿µä¸èƒ½åœ¨ Linux å’Œ Windows ä¹‹é—´è½¬æ¢, å› æ­¤ä½¿ç”¨ <code>/etc/passwd</code> å’Œ <code>/etc/group</code> å°†ç”¨æˆ·åå’Œç»„åè½¬æ¢ä¸º ID ä¼šé™åˆ¶æ­¤åŠŸèƒ½ä»…é€‚ç”¨äºåŸºäº Linux æ“ä½œç³»ç»Ÿçš„å®¹å™¨</p>
<p><code>COPY</code> æŒ‡ä»¤ä» <code>&lt;src&gt;</code> ä¸­<strong>å¤åˆ¶</strong>æ–°æ–‡ä»¶æˆ–ç›®å½•, å¹¶å°†å®ƒä»¬æ·»åŠ åˆ°å®¹å™¨æ–‡ä»¶ç³»ç»Ÿçš„ <code>&lt;dest&gt;</code> ä¸­</p>
<p>å¯ä»¥æŒ‡å®šå¤šä¸ª <code>&lt;src&gt;</code> èµ„æº, ä½†æ–‡ä»¶å’Œç›®å½•çš„è·¯å¾„è¢«è§£é‡Šä¸ºç›¸å¯¹äºæ„å»ºä¸Šä¸‹æ–‡çš„æº (source)</p>
<p>æ¯ä¸ª <code>&lt;src&gt;</code> å¯èƒ½åŒ…å«é€šé…ç¬¦ä¸”å°†ä¼šä½¿ç”¨ Go è¯­è¨€çš„ <a class="link"   target="_blank" rel="noopener" href="https://golang.org/pkg/path/filepath#Match" >filepath.Match<i class="fas fa-external-link-alt"></i></a> è§„åˆ™è¿›è¡ŒåŒ¹é…</p>
<p>Example - æ·»åŠ æ‰€æœ‰ä»¥ â€œhomâ€ å¼€å¤´çš„æ–‡ä»¶:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">COPY</span><span class="language-bash"> hom* /mydir/</span></span><br></pre></td></tr></table></figure>

<p>Example - <code>?</code> ç”¨æ¥ä»£æ›¿ä»»ä½•å•ä¸ªå­—ç¬¦. ä¾‹å¦‚ â€œhome.txtâ€:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">COPY</span><span class="language-bash"> hom?.txt /mydir/</span></span><br></pre></td></tr></table></figure>

<p><code>&lt;dest&gt;</code> æ˜¯ä¸€ä¸ªç»å¯¹è·¯å¾„, æˆ–è€…ä¸€ä¸ªç›¸å¯¹äº <code>WORKDIR</code> çš„è·¯å¾„, æº (source) å°†è¢«å¤åˆ¶åˆ°ç›®æ ‡å®¹å™¨ä¸­</p>
<p>Example - ä½¿ç”¨ä¸€ä¸ªç›¸å¯¹è·¯å¾„, æ·»åŠ  <code>test.txt</code> åˆ° <code>&lt;WORKDIR&gt;/relativeDir/</code>:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">COPY</span><span class="language-bash"> test.txt relativeDir/</span></span><br></pre></td></tr></table></figure>

<p>Example - ä½¿ç”¨ç»å¯¹è·¯å¾„, æ·»åŠ  <code>test.txt</code> åˆ° <code>/absoluteDir/</code>:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">COPY</span><span class="language-bash"> test.txt /absoluteDir/</span></span><br></pre></td></tr></table></figure>

<p>å½“æ·»åŠ åŒ…å«ç‰¹æ®Šå­—ç¬¦ (ä¾‹å¦‚ <code>[</code> å’Œ <code>]</code>) çš„æ–‡ä»¶æˆ–ç›®å½•æ—¶, ä½ éœ€è¦ä½¿ç”¨ Golang è§„åˆ™è½¬ä¹‰é‚£äº›è·¯å¾„æ¥é¿å…å°†å®ƒä»¬ä½œä¸ºä¸€ä¸ªåŒ¹é…æ¨¡å¼æ¥çœ‹å¾…</p>
<p>Example - æ·»åŠ ä¸€ä¸ªåç§°ä¸º <code>arr[0].txt</code> çš„æ–‡ä»¶:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">COPY</span><span class="language-bash"> arr[[]0].txt /mydir/</span></span><br></pre></td></tr></table></figure>

<p>æ‰€æœ‰æ–°æ–‡ä»¶å’Œç›®å½•ä½¿ç”¨ä¸ºé›¶çš„ UID å’Œ GID è¿›è¡Œåˆ›å»º, é™¤éæŒ‡å®šäº†å¯é€‰çš„ <code>--chown</code> æ ‡å¿—, <code>--chown</code> æ ‡å¿—æŒ‡å®šäº†ç»™å®šçš„ç”¨æˆ·å, ç»„å, æˆ–è€… UID&#x2F;GID çš„ç»„åˆä»¥è¯·æ±‚æ·»åŠ å†…å®¹çš„ç‰¹å®šæ‰€æœ‰æƒ</p>
<p><code>--chown</code> æ ‡å¿—çš„æ ¼å¼å…è®¸ç”¨æˆ·åå’Œç»„åå­—ç¬¦ä¸²æˆ–ç›´æ¥æ•´æ•° UID å’Œ GID çš„ä»»æ„ç»„åˆ</p>
<p>æä¾›ä¸å¸¦ç»„åçš„ç”¨æˆ·åæˆ–ä¸å¸¦ GID çš„ UID å°†ä½¿ç”¨ä¸ GID ç›¸åŒçš„æ•°å­—ä½œä¸º GID</p>
<p>å¦‚æœæä¾›äº†ç”¨æˆ·åæˆ–ç»„å, åˆ™å®¹å™¨çš„æ ¹æ–‡ä»¶ç³»ç»Ÿ <code>/etc/passwd</code> å’Œ <code>/etc/group</code> æ–‡ä»¶å°†åˆ†åˆ«ç”¨äºæ‰§è¡Œä»åç§°åˆ°æ•´æ•° UID æˆ– GID çš„è½¬æ¢</p>
<p>Example - ä¸‹é¢ä¾‹å­å±•ç¤º <code>--chown</code> æ ‡å¿—çš„æœ‰æ•ˆå®šä¹‰:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --<span class="built_in">chown</span>=55:mygroup files* /somedir/</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --<span class="built_in">chown</span>=bin files* /somedir/</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --<span class="built_in">chown</span>=1 files* /somedir/</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --<span class="built_in">chown</span>=10:11 files* /somedir/</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœå®¹å™¨æ ¹æ–‡ä»¶ç³»ç»Ÿä¸åŒ…å« <code>/etc/passwd</code> æˆ– <code>/etc/group</code> æ–‡ä»¶, å¹¶ä¸”åœ¨ <code>--chown</code> æ ‡å¿—ä¸­ä½¿ç”¨äº†ç”¨æˆ·åæˆ–ç»„å, åˆ™æ„å»ºå°†åœ¨ <code>COPY</code> æ“ä½œæ—¶å¤±è´¥</p>
<p>ä½¿ç”¨æ•°å­—å½¢ ID ä¸éœ€è¦æŸ¥æ‰¾, å¹¶ä¸”ä¸ä¾èµ–äºå®¹å™¨æ ¹æ–‡ä»¶ç³»ç»Ÿ</p>
<p>å¦‚æœä½ é€šè¿‡ STDIN (<code>docker build - &lt; somefile</code>) ä¼ é€’ <code>Dockerfile</code> æ¥è¿›è¡Œæ„å»º, é‚£å°†ä¼šæ²¡æœ‰æ„å»ºä¸Šä¸‹æ–‡, æ‰€ä»¥ä¸èƒ½ä½¿ç”¨ <code>COPY</code></p>
<p><code>COPY</code> å¯é€‰åœ°æ¥å—ä¸€ä¸ª <code>--from=&lt;name&gt;</code> æ ‡å¿—, è¿™ä¸ªæ ‡å¿—å¯ç”¨äºå°†æºä½ç½®è®¾ç½®ä¸ºå…ˆå‰çš„æ„å»ºé˜¶æ®µ (ä½¿ç”¨ <code>FROM .. AS &lt;name&gt;</code> åˆ›å»º), è¯¥é˜¶æ®µå°†ç”¨äºä»£æ›¿ç”¨æˆ·å‘é€çš„æ„å»ºä¸Šä¸‹æ–‡</p>
<p>å¦‚æœæ‰¾ä¸åˆ°å…·æœ‰æŒ‡å®šåç§°çš„æ„å»ºé˜¶æ®µ, åˆ™å°è¯•ä½¿ç”¨å…·æœ‰ç›¸åŒåç§°çš„é•œåƒ</p>
<p><code>COPY</code> éµå¾ªå¦‚ä¸‹è§„åˆ™:</p>
<ul>
<li><code>&lt;src&gt;</code> è·¯å¾„å¿…é¡»åœ¨æ„å»ºçš„ä¸Šä¸‹æ–‡ä¸­; ä½ ä¸èƒ½ <code>COPY ../something/something</code>, å› ä¸º <code>docker build</code> çš„ç¬¬ä¸€æ­¥æ˜¯å‘é€ä¸Šä¸‹æ–‡ä»¶å¤¹ (å’Œå­æ–‡ä»¶å¤¹) ç»™ Docker Daemon</li>
<li>å¦‚æœ <code>&lt;src&gt;</code> æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹, é‚£ä¹ˆè¿™ä¸ªæ–‡ä»¶å¤¹ä¸­çš„å…¨éƒ¨å†…å®¹éƒ½è¢«å¤åˆ¶, åŒ…æ‹¬æ–‡ä»¶ç³»ç»Ÿå…ƒæ•°æ®; æ–‡ä»¶å¤¹æœ¬èº«ä¸ä¼šè¢«å¤åˆ¶, åªä¼šå¤åˆ¶å®ƒé‡Œé¢çš„å†…å®¹</li>
<li>å¦‚æœ <code>&lt;src&gt;</code> æ˜¯ä»»ä½•å…¶ä»–ç±»å‹çš„æ–‡ä»¶, å®ƒä¼šä¸å®ƒçš„å…ƒæ•°æ®ä¸€èµ·å•ç‹¬å¤åˆ¶. åœ¨è¿™ç§æƒ…å†µä¸‹, å¦‚æœ <code>&lt;dest&gt;</code> ä»¥ <code>/</code> ç»“å°¾, åˆ™å°†å…¶è§†ä¸ºç›®å½•, å¹¶ä¸” <code>&lt;src&gt;</code> çš„å†…å®¹å°†å†™å…¥ <code>&lt;dest&gt;/base(&lt;src&gt;)</code></li>
<li>å¦‚æœæŒ‡å®šäº†å¤šä¸ª <code>&lt;src&gt;</code> èµ„æº, æ— è®ºæ˜¯ç›´æ¥æŒ‡å®šè¿˜æ˜¯é€šè¿‡ä½¿ç”¨é€šé…ç¬¦æŒ‡å®š, é‚£ä¹ˆ <code>&lt;dest&gt;</code> å¿…é¡»æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹, å®ƒå¿…é¡»ä»¥ <code>\</code> ä½œä¸ºç»“å°¾</li>
<li>å¦‚æœ <code>&lt;dest&gt;</code> ä¸æ˜¯ä»¥ <code>\</code> ä½œä¸ºç»“å°¾, å®ƒå°†è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªæ™®é€šæ–‡ä»¶, ä¸” <code>&lt;src&gt;</code> çš„å†…å®¹å°†è¢«å†™åˆ° <code>&lt;dest&gt;</code></li>
<li>å¦‚æœ <code>&lt;dest&gt;</code> ä¸å­˜åœ¨, å®ƒä¼šè¿åŒå…¶è·¯å¾„ä¸­æ‰€æœ‰ç¼ºå¤±çš„ç›®å½•ä¸€èµ·åˆ›å»º</li>
</ul>
<p>å¦‚æœ <code>&lt;src&gt;</code> çš„å†…å®¹å·²æ›´æ”¹, åˆ™ç¬¬ä¸€ä¸ªé‡åˆ°çš„ <code>COPY</code> æŒ‡ä»¤å°†ä½¿ Dockerfile ä¸­æ‰€æœ‰åç»­æŒ‡ä»¤çš„ç¼“å­˜æ— æ•ˆ. è¿™åŒ…æ‹¬ä½¿ <code>RUN</code> æŒ‡ä»¤çš„ç¼“å­˜æ— æ•ˆ</p>
<p>æŸ¥çœ‹ <a target="_blank" rel="noopener" href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/#leverage-build-cache"><code>Dockerfile</code> best practices guide - Leverage build cache</a> è·å–æ›´å¤šä¿¡æ¯</p>
<h2 id="ENTRYPOINT-ENTRYPOINT-æŒ‡ä»¤"><a href="#ENTRYPOINT-ENTRYPOINT-æŒ‡ä»¤" class="headerlink" title="ENTRYPOINT (ENTRYPOINT æŒ‡ä»¤)"></a>ENTRYPOINT (ENTRYPOINT æŒ‡ä»¤)</h2><p><code>ENTRYPOINT</code> æœ‰ä¸¤ç§å½¢å¼:</p>
<p><code>exec</code> å½¢å¼, è¿™æ˜¯é¦–é€‰å½¢å¼: <code>ENTRYPOINT [ &quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot; ]</code></p>
<p><code>shell</code> å½¢å¼: <code>ENTRYPOINT command param1 param2</code></p>
<p><code>ENTRYPOINT</code> å…è®¸ä½ é…ç½® å®¹å™¨ ä½œä¸ºä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶æ¥è¿è¡Œ</p>
<p>Example - ä½¿ç”¨é»˜è®¤å†…å®¹å¯åŠ¨ Nginx, ç›‘å¬ 80 ç«¯å£:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="keyword">run</span><span class="language-bash"> -i -t --<span class="built_in">rm</span> -p 80:80 nginx</span></span><br></pre></td></tr></table></figure>

<p>ä¼ ç»™ <code>docker run &lt;image&gt;</code> çš„å‘½ä»¤è¡Œå‚æ•°å°†ä¼šé™„åŠ åˆ° <code>exec</code> å½¢å¼ <code>ENTRYPOINT</code> æŒ‡ä»¤ä¸­æ‰€æœ‰å…ƒç´ çš„åé¢, <strong>å¹¶ä¸”ä¼šè¦†ç›–æ‰€æœ‰ä½¿ç”¨ <code>CMD</code> æŒ‡å®šçš„å…ƒç´ </strong></p>
<p>è¿™å…è®¸ä¼ é€’å‚æ•°ç»™ <code>ENTRYPOINT</code>, ä¾‹å¦‚ <code>docker run &lt;image&gt; -d</code> å°†ä¼šä¼ é€’ <code>-d</code> å‚æ•°ç»™ <code>ENTRYPOINT</code></p>
<p>å¯ä»¥ä½¿ç”¨ <code>docker run --entrypoint</code> æ ‡å¿—æ¥è¦†ç›– <code>ENTRYPOINT</code> æŒ‡ä»¤</p>
<p><code>shell</code> å½¢å¼é˜»æ­¢ä½¿ç”¨æ‰€æœ‰ <code>CMD</code> æŒ‡ä»¤æˆ– <code>run</code> å‘½ä»¤è¡Œå‚æ•°, ä½†ç¼ºç‚¹æ˜¯ä½ çš„ <code>ENTRYPOINT</code> å°†ä½œä¸º <code>/bin/sh -c</code> çš„å­å‘½ä»¤å¯åŠ¨, è¿™æ ·ä¸ä¼šä¼ é€’ä¿¡å· (signals)</p>
<p>è¿™æ„å‘³ç€å¯æ‰§è¡Œæ–‡ä»¶ä¸ä¼šæ˜¯å®¹å™¨çš„ <code>PID 1</code>, ä¸”ä¸ä¼šæ¥å—åˆ° Unix ä¿¡å· (signals), æ‰€ä»¥ä½ çš„å¯æ‰§è¡Œæ–‡ä»¶ä¸ä¼šä» <code>docker stop &lt;container&gt;</code> æ¥å—åˆ°ä¸€ä¸ª <code>SIGTERM</code></p>
<p>åªæœ‰ <code>Dockerfile</code> ä¸­çš„æœ€åä¸€ä¸ª <code>ENTRYPOINT</code> æŒ‡ä»¤ä¼šç”Ÿæ•ˆ</p>
<h3 id="Exec-form-ENTRYPOINT-example-Exec-å½¢å¼-ENTRYPOINT-ä¾‹å­"><a href="#Exec-form-ENTRYPOINT-example-Exec-å½¢å¼-ENTRYPOINT-ä¾‹å­" class="headerlink" title="Exec form ENTRYPOINT example (Exec å½¢å¼ ENTRYPOINT ä¾‹å­)"></a>Exec form ENTRYPOINT example (<code>Exec</code> å½¢å¼ <code>ENTRYPOINT</code> ä¾‹å­)</h3><p>å¯ä»¥ä½¿ç”¨ <code>ENTRYPOINT</code> çš„ <code>exec</code> å½¢å¼æ¥è®¾ç½®éå¸¸ç¨³å®šçš„é»˜è®¤å‘½ä»¤å’Œå‚æ•°, ç„¶åä½¿ç”¨ä»»ä¸€å½¢å¼çš„ <code>CMD</code> æ¥è®¾ç½®é¢å¤–çš„å¾ˆæœ‰å¯èƒ½æ”¹å˜çš„é»˜è®¤å€¼</p>
<p>å¦‚æœä½ éœ€è¦ä¸ºä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ç¼–å†™ä¸€ä¸ªå¯åŠ¨è„šæœ¬, ä½ å¯ä»¥é€šè¿‡ä½¿ç”¨ <code>exec</code> å’Œ <code>gosu</code> å‘½ä»¤æ¥ç¡®ä¿æœ€åçš„å¯æ‰§è¡Œæ–‡ä»¶æ¥å— Unix ä¿¡å· (signals):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> = <span class="string">&#x27;postgres&#x27;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">chown</span> -R postgres <span class="string">&quot;<span class="variable">$PGDATA</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [ -z <span class="string">&quot;<span class="subst">$(ls -A <span class="string">&quot;<span class="variable">$PGDATA</span>&quot;</span>)</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        gosu postgres initdb</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">exec</span> gosu postgres <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p>æœ€å, å¦‚æœä½ éœ€è¦åœ¨å…³é—­ (shutdown) çš„æ—¶å€™åšä¸€äº›é¢å¤–çš„æ¸…ç†å·¥ä½œ (æˆ–è€…å’Œå…¶ä»–å®¹å™¨é€šä¿¡), æˆ–è€…åè°ƒå¤šä¸ªå¯æ‰§è¡Œæ–‡ä»¶, ä½ å¯èƒ½éœ€è¦ç¡®ä¿ <code>ENTRYPOINT</code> è„šæœ¬æ¥æ”¶ Unix ä¿¡å· (signals), ä¼ é€’å®ƒä»¬, ç„¶ååšæ›´å¤šçš„å·¥ä½œ:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="comment"># Note: I&#x27;ve written this using sh so it works in the busybox container too</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># USE the trap if you need to also do manual cleanup after the service is stopped,</span></span><br><span class="line"><span class="comment">#     or need to start multiple services in the one container</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;echo TRAPed signal&quot;</span> HUP INT QUIT TERM</span><br><span class="line"></span><br><span class="line"><span class="comment"># start service in background here</span></span><br><span class="line">/usr/sbin/apachectl start</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[hit enter key to exit] or run &#x27;docker stop &lt;container&gt;&#x27;&quot;</span></span><br><span class="line"><span class="built_in">read</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># stop service and clean up here</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;stopping apache&quot;</span></span><br><span class="line">/usr/sbin/apachectl stop</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;exited <span class="variable">$0</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ ä½¿ç”¨ <code>docker run -it --rm -p 80:80 --name test apache</code> æ¥è¿è¡Œè¿™ä¸ªé•œåƒ, ä½ å¯ä»¥ä½¿ç”¨ <code>docker exec</code> æˆ– <code>docker top</code> æ£€æŸ¥å®¹å™¨çš„è¿›ç¨‹, ç„¶åå‘Šè¯‰ (ask) è„šæœ¬å»åœæ­¢ Apache:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ /usr/bin/time docker stop <span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<p>ä½ å¯ä»¥ä½¿ç”¨ <code>--entrypoint</code> è¦†ç›– <code>ENTRYPOINT</code> è®¾ç½®, ä½†æ˜¯è¿™åªèƒ½å°†äºŒè¿›åˆ¶æ–‡ä»¶è®¾ç½®ä¸º <code>exec</code> (ä¸ä¼šä½¿ç”¨ <code>sh -c</code>)</p>
<p><code>exec</code> å½¢å¼ä½œä¸ºä¸€ä¸ª JSON æ•°ç»„æ¥è§£æ, è¿™æ„å‘³ç€ä½ å¿…é¡»ä½¿ç”¨åŒå¼•å·æ¥åŒ…è£¹å•è¯</p>
<p>ä¸åƒ <code>shell</code> å½¢å¼, <code>exec</code> å½¢å¼ä¸ä¼šè°ƒç”¨ä¸€ä¸ªå‘½ä»¤ shell. è¿™æ„å‘³ç€æ­£å¸¸çš„ shell å¤„ç†ä¸ä¼šå‘ç”Ÿ. ä¾‹å¦‚, <code>ENTRYPOINT [&quot;echo&quot;, &quot;$HOME&quot;]</code> å°†ä¸ä¼šåœ¨ <code>$HOME</code> ä¸Šæ‰§è¡Œå˜é‡æ›¿æ¢. å¦‚æœä½ æƒ³è¦ shell å¤„ç†, è¦ä¹ˆä½¿ç”¨ <code>shell</code> å½¢å¼è¦ä¹ˆç›´æ¥æ‰§è¡Œä¸€ä¸ª <code>shell</code>, ä¾‹å¦‚: <code>ENTRYPOINT [&quot;sh&quot;, &quot;-c&quot;, &quot;echo $HOME&quot;]</code>. å½“ä½¿ç”¨ <code>exec</code> å½¢å¼å¹¶ç›´æ¥æ‰§è¡Œä¸€ä¸ª shell, ä¸ä½¿ç”¨ <code>shell</code> å½¢å¼çš„æƒ…å†µä¸€æ ·, è¿›è¡Œç¯å¢ƒå˜é‡æ‰©å±•çš„æ˜¯ shell è€Œä¸æ˜¯ Docker</p>
<h3 id="Shell-form-ENTRYPOINT-example-Shell-å½¢å¼-ENTRYPOINT-ä¾‹å­"><a href="#Shell-form-ENTRYPOINT-example-Shell-å½¢å¼-ENTRYPOINT-ä¾‹å­" class="headerlink" title="Shell form ENTRYPOINT example (Shell å½¢å¼ ENTRYPOINT ä¾‹å­)"></a>Shell form ENTRYPOINT example (Shell å½¢å¼ <code>ENTRYPOINT</code> ä¾‹å­)</h3><p>å¯ä»¥ä¸º <code>ENTRYPOINT</code> æŒ‡å®šä¸€ä¸ªçº¯å­—ç¬¦ä¸², è¿™ä¸ªå­—ç¬¦ä¸²å°†ä¼šåœ¨ <code>/bin/sh -c</code> ä¸­æ‰§è¡Œ</p>
<p>è¿™ä¸ªå½¢å¼å°†ä¼šä½¿ç”¨ shell æ¥å¤„ç†ç¯å¢ƒå˜é‡æ›¿æ¢, æ‰€æœ‰ <code>CMD</code> æˆ–è€… <code>docker run</code> å‘½ä»¤è¡Œå‚æ•°éƒ½ä¼šè¢«å¿½ç•¥</p>
<p>ä¸ºäº†ç¡®ä¿ <code>docker stop</code> ä¼šæ­£ç¡®åœ°é€šçŸ¥é•¿æ—¶é—´è¿è¡Œçš„ <code>ENTRYPOINT</code> å¯æ‰§è¡Œæ–‡ä»¶, è®°å¾—ä½¿ç”¨ <code>exec</code> æ¥å¯åŠ¨:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> <span class="built_in">exec</span> top -b</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸ä½¿ç”¨ <code>exec</code> æ‰§è¡Œå‘½ä»¤, åˆ™å¯åŠ¨åçš„å‘½ä»¤çš„è¿›ç¨‹ PID å°†ä¸æ˜¯ 1, æ— æ³•æ­£å¸¸æ¥æ”¶åˆ° <code>docker stop</code> å‘é€çš„ä¿¡å·</p>
<h3 id="Understand-how-CMD-and-ENTRYPOINT-interact-ç†è§£-CMD-å’Œ-ENTRYPOINT-æ˜¯æ€æ ·äº¤äº’çš„"><a href="#Understand-how-CMD-and-ENTRYPOINT-interact-ç†è§£-CMD-å’Œ-ENTRYPOINT-æ˜¯æ€æ ·äº¤äº’çš„" class="headerlink" title="Understand how CMD and ENTRYPOINT interact (ç†è§£ CMD å’Œ ENTRYPOINT æ˜¯æ€æ ·äº¤äº’çš„)"></a>Understand how CMD and ENTRYPOINT interact (ç†è§£ CMD å’Œ ENTRYPOINT æ˜¯æ€æ ·äº¤äº’çš„)</h3><p><code>CMD</code> å’Œ <code>ENTRYPOINT</code> æŒ‡ä»¤éƒ½å®šä¹‰äº†è¿è¡Œå®¹å™¨æ—¶è¦æ‰§è¡Œçš„å‘½ä»¤</p>
<p>ä¸‹é¢æ˜¯æè¿°å®ƒä»¬åˆä½œçš„è§„åˆ™:</p>
<ol>
<li>Dockerfile å¿…é¡»æŒ‡å®šè‡³å°‘ä¸€ä¸ª <code>CMD</code> æˆ– <code>ENTRYPOINT</code> å‘½ä»¤</li>
<li>å°†å®¹å™¨ä½œä¸ºå¯æ‰§è¡Œæ–‡ä»¶æ—¶åº”è¯¥å®šä¹‰ <code>ENTRYPOINT</code></li>
<li><code>CMD</code> åº”è¯¥ç”¨ä½œ ä¸º<code>ENTRYPOINT</code>å‘½ä»¤ æˆ– åœ¨å®¹å™¨ä¸­æ‰§è¡Œä¸´æ—¶å‘½ä»¤ å®šä¹‰é»˜è®¤å‚æ•°çš„ä¸€ç§æ–¹å¼</li>
<li>è¿è¡Œå®¹å™¨æ—¶çš„æ›¿ä»£å‚æ•°ä¼šè¦†ç›–æ‰ <code>CMD</code></li>
</ol>
<p>Table - ä¸åŒ <code>ENTRYPOINT</code> &#x2F; <code>CMD</code> ç»„åˆä¸‹ä¼šæ‰§è¡Œçš„å‘½ä»¤:</p>
<ul>
<li>| No ENTRYPOINT | ENTRYPOINT ENTRY_exec ENTRY_p1 | ENTRYPOINT [â€œENTRY_execâ€, â€œENTRY_p1â€]<br>:â€”|:â€”|:â€”|:â€”<br>No CMD | error, not allowed | &#x2F;bin&#x2F;sh -c ENTRY_exec ENTRY_p1 | ENTRY_exec ENTRY_p1<br>CMD [â€œCMD_execâ€, â€œCMD_p1â€] | CMD_exec CMD_p1 | &#x2F;bin&#x2F;sh -c ENTRY_exec ENTRY_p1 | ENTRY_exec ENTRY_p1 CMD_exec CMD_p1<br>CMD [â€œCMD_p1â€, â€œCMD_p2â€] | CMD_p1 CMD_p2 | &#x2F;bin&#x2F;sh -c ENTRY_exec ENTRY_p1 | ENTRY_exec ENTRY_p1 CMD_p1 CMD_p2<br>CMD CMD_exec CMD_p1 | &#x2F;bin&#x2F;sh -c CMD_exec CMD_p1 | &#x2F;bin&#x2F;sh -c ENTRY_exec ENTRY_p1 | ENTRY_exec ENTRY_p1 &#x2F;bin&#x2F;sh -c CMD_exec CMD_p1</li>
</ul>
<p>å¦‚æœ <code>CMD</code> æ˜¯åœ¨åŸºç¡€é•œåƒä¸­å®šä¹‰çš„, é‚£ä¹ˆè®¾ç½® <code>ENTRYPOINT</code> å°†ä¼šé‡ç½® <code>CMD</code> ä¸ºç©ºå€¼. åœ¨è¿™ç§æƒ…å†µä¸‹, <code>CMD</code> å¿…é¡»åœ¨å½“å‰é•œåƒä¸­å®šä¹‰æ¥èµ‹äºˆä¸€ä¸ªå€¼</p>
<h2 id="VOLUME-VOLUME-æŒ‡ä»¤"><a href="#VOLUME-VOLUME-æŒ‡ä»¤" class="headerlink" title="VOLUME (VOLUME æŒ‡ä»¤)"></a>VOLUME (VOLUME æŒ‡ä»¤)</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">VOLUME</span><span class="language-bash"> [<span class="string">&quot;/data&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>The VOLUME instruction creates a mount point with the specified name and marks it as holding externally mounted volumes from native host or other containers.</p>
</blockquote>
<p><code>VOLUME</code> æŒ‡ä»¤åˆ›å»ºä¸€ä¸ªå…·æœ‰æŒ‡å®šåç§°çš„æŒ‚è½½ç‚¹, å¹¶å°†å…¶æ ‡è®°ä¸º ä¿å­˜ æ¥è‡ªæœ¬åœ°ä¸»æœºæˆ–å…¶ä»–å®¹å™¨çš„ å¤–éƒ¨æŒ‚è½½å·</p>
<p>å€¼å¯ä»¥æ˜¯ä¸€ä¸ª JSON æ•°ç»„, <code>VOLUME [&quot;/var/log/&quot;]</code>, æˆ–è€…å¸¦æœ‰å¤šä¸ªå‚æ•°çš„çº¯å­—ç¬¦ä¸², ä¾‹å¦‚ <code>VOLUME /var/log</code> æˆ– <code>VOLUME /var/log /var/db</code></p>
<p>æœ‰å…³é€šè¿‡ Docker å®¢æˆ·ç«¯çš„æ›´å¤šä¿¡æ¯&#x2F;ä¾‹å­å’ŒæŒ‚è½½è¯´æ˜, è¯·å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/storage/volumes/" >Share Directories via Volumes<i class="fas fa-external-link-alt"></i></a> æ–‡æ¡£</p>
<p><code>docker run</code> å‘½ä»¤ä½¿ç”¨åŸºç¡€é•œåƒä¸­ æŒ‡å®šä½ç½® å­˜åœ¨çš„ä»»ä½•æ•°æ® åˆå§‹åŒ–æ–°åˆ›å»ºçš„å·</p>
<p>Example:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">mkdir</span> /myvol</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;hello world&quot;</span> &gt; /myvol/greeting</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="language-bash"> /myvol</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ª Dockerfile ç”Ÿæˆä¸€ä¸ªé•œåƒ, è¿™ä¸ªé•œåƒå¯¼è‡´ <code>docker run</code> åœ¨ <code>/myvol</code> åˆ›å»ºä¸€ä¸ªæ–°çš„æŒ‚è½½ç‚¹, å¹¶å°† <code>/greeting</code> æ–‡ä»¶å¤åˆ¶åˆ°æ–°åˆ›å»ºçš„å·ä¸­</p>
<h3 id="Notes-about-specifying-volumes-å…³äºæŒ‡å®šå·çš„æ³¨æ„äº‹é¡¹"><a href="#Notes-about-specifying-volumes-å…³äºæŒ‡å®šå·çš„æ³¨æ„äº‹é¡¹" class="headerlink" title="Notes about specifying volumes (å…³äºæŒ‡å®šå·çš„æ³¨æ„äº‹é¡¹)"></a>Notes about specifying volumes (å…³äºæŒ‡å®šå·çš„æ³¨æ„äº‹é¡¹)</h3><p>è¯·è®°ä½ä»¥ä¸‹ <code>Dockerfile</code> ä¸­å…³äºå·çš„äº‹é¡¹</p>
<ul>
<li><strong>åŸºäº Windows çš„å®¹å™¨ ä¸Šçš„å·</strong>: å½“ä½¿ç”¨åŸºäº Windows çš„å®¹å™¨æ—¶, å®¹å™¨ä¸­å·çš„ç›®çš„åœ°å¿…é¡»æ˜¯ä»¥ä¸‹ä¹‹ä¸€<ul>
<li>ä¸€ä¸ªä¸å­˜åœ¨çš„æˆ–ç©ºçš„ç›®å½•</li>
<li><code>C:</code> ä¹‹å¤–çš„é©±åŠ¨å™¨</li>
</ul>
</li>
<li><strong>ä» <code>Dockerfile</code> ä¸­æ›´æ”¹å·</strong>: å¦‚æœä»»ä½•æ„å»ºæ­¥éª¤åœ¨å·å£°æ˜ä¹‹åä¿®æ”¹äº†å·ä¸­çš„æ•°æ®, åˆ™è¿™äº›ä¿®æ”¹å°†è¢«ä¸¢å¼ƒ</li>
<li><strong>JSON æ ¼å¼</strong>: è¿™ä¸ªåˆ—è¡¨ä½œä¸ºä¸€ä¸ª JSON æ•°ç»„æ¥è§£æ. ä½ å¿…é¡»ä½¿ç”¨åŒå¼•å·æ¥åŒ…è£¹è¯è¯­</li>
<li><strong>ä¸»æœºç›®å½•æ˜¯åœ¨å®¹å™¨è¿è¡Œæ—¶å£°æ˜çš„</strong>: ä¸»æœºç›®å½• (æŒ‚è½½ç‚¹) æœ¬è´¨ä¸Šæ˜¯ä¾èµ–äºä¸»æœºçš„. è¿™æ˜¯ä¸ºäº†ä¿æŒé•œåƒçš„å¯ç§»æ¤æ€§, å› ä¸ºä¸èƒ½ä¿è¯ç»™å®šçš„ä¸»æœºç›®å½•åœ¨æ‰€æœ‰ä¸»æœºä¸Šéƒ½å¯ç”¨. æ‰€ä»¥, ä½ ä¸èƒ½ä» Dockerfile ä¸­æŒ‚è½½ä¸»æœºç›®å½•. <code>VOLUME</code> æŒ‡ä»¤ä¸æ”¯æŒæŒ‡å®šä¸€ä¸ª <code>host-dir</code> å‚æ•°. ä½ å¿…é¡»åœ¨åˆ›å»ºæˆ–è¿è¡Œå®¹å™¨æ—¶æŒ‡å®šæŒ‚è½½ç‚¹</li>
</ul>
<h3 id="ç†è§£"><a href="#ç†è§£" class="headerlink" title="ç†è§£"></a>ç†è§£</h3><p>å¦‚æœè¿è¡Œæ—¶ç”¨æˆ·å¿˜è®°å°†ä¿å­˜æ–‡ä»¶çš„ç›®å½•æŒ‚è½½ä¸ºå·, é‚£ä¹ˆå°±ä¼šåœ¨å®¹å™¨å­˜å‚¨å±‚å‘ç”Ÿå†™æ“ä½œ</p>
<p>å¯ä»¥åœ¨ <code>Dockerfile</code> ä¸­äº‹å…ˆæŒ‡å®šæŸäº›ç›®å½•æŒ‚è½½ä¸º<strong>åŒ¿åå·</strong></p>
<p>è¿™æ ·åœ¨è¿è¡Œæ—¶å³ä½¿ç”¨æˆ·ä¸æŒ‡å®šæŒ‚è½½, å®¹å™¨ä¹Ÿå¯ä»¥æ­£å¸¸è¿è¡Œ, ä¹Ÿä¸ä¼šå‘å®¹å™¨å­˜å‚¨å±‚å†™å…¥å¤§é‡æ•°æ®</p>
<p>å½“å®¹å™¨è¿è¡Œæ—¶, å¦‚æœæœªä½¿ç”¨ <code>-v</code> æŒ‡å®šæŒ‚è½½æˆ–æœªä½¿ç”¨ <code>--mount</code> æŒ‡å®šæ•°æ®å·, é‚£ä¹ˆ Docker å°†ä¼šè‡ªåŠ¨åœ¨ <code>/var/lib/docker/volumes/</code> åˆ›å»ºä¸€ä¸ªæ•°æ®å· (å¯ä»¥ä½¿ç”¨ <code>docker volume ls</code> æŸ¥çœ‹åˆ°è¿™ä¸ªæ•°æ®å·), å¹¶å°†è¿™ä¸ªæ•°æ®å·æŒ‚è½½åˆ° <code>VOLUME</code> è®¾å®šçš„ç›®å½•ä¸­</p>
<h2 id="USER-USER-æŒ‡ä»¤"><a href="#USER-USER-æŒ‡ä»¤" class="headerlink" title="USER (USER æŒ‡ä»¤)"></a>USER (USER æŒ‡ä»¤)</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USER</span> &lt;<span class="keyword">user</span>&gt;[:&lt;group&gt;]</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USER</span> &lt;UID&gt;[:&lt;GID&gt;]</span><br></pre></td></tr></table></figure>

<p><code>USER</code> æŒ‡ä»¤è®¾ç½® åœ¨è¿è¡Œé•œåƒæ—¶ ä¸ <code>Dockerfile</code>ä¸­<code>USER</code>æŒ‡ä»¤ä¹‹åçš„ä»»ä½•<code>RUN</code>,<code>CMD</code>,<code>ENTRYPOINT</code>æŒ‡ä»¤ ä½¿ç”¨çš„ç”¨æˆ·åç§° (æˆ–è€… UID) å’Œå¯é€‰çš„ç”¨æˆ·ç»„ (æˆ–è€… GID)</p>
<p>æ³¨æ„, ä¸ºç”¨æˆ·æŒ‡å®šç”¨æˆ·ç»„æ—¶, ç”¨æˆ·å°†ä»…å…·æœ‰æŒ‡å®šçš„ç»„æˆå‘˜èµ„æ ¼. å°†å¿½ç•¥ä»»ä½•å…¶ä»–é…ç½®çš„ç»„æˆå‘˜èº«ä»½</p>
<p>å½“ç”¨æˆ·æ²¡æœ‰ä¸€ä¸ªä¸»è¦ç»„æ—¶, é•œåƒ (æˆ–ä¸‹ä¸€æ¡æŒ‡ä»¤) å°†ä¼šä½¿ç”¨ <code>root</code> ç»„æ¥è¿è¡Œ</p>
<p>åœ¨ Windows ä¸Š, å¦‚æœç”¨æˆ·ä¸æ˜¯å†…ç½®è´¦æˆ·, åˆ™å¿…é¡»å…ˆåˆ›å»ºè¯¥ç”¨æˆ·. å¯ä»¥é€šè¿‡å°† <code>net user</code> å‘½ä»¤è°ƒç”¨ä½œä¸º Dockerfile çš„ä¸€éƒ¨åˆ†æ¥å®Œæˆ</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> microsoft/windowsservercore</span><br><span class="line"><span class="comment"># Create Windows user in the container</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> net user /add patrick</span></span><br><span class="line"><span class="comment"># Set it for subsequent commands</span></span><br><span class="line"><span class="keyword">USER</span> patrick</span><br></pre></td></tr></table></figure>

<h2 id="WORKDIR-WORKDIR-æŒ‡ä»¤"><a href="#WORKDIR-WORKDIR-æŒ‡ä»¤" class="headerlink" title="WORKDIR (WORKDIR æŒ‡ä»¤)"></a>WORKDIR (WORKDIR æŒ‡ä»¤)</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /path/to/workdir</span></span><br></pre></td></tr></table></figure>

<p><code>WORKDIR</code> æŒ‡ä»¤ä¸º <code>Dockerfile</code> ä¸­æ‰€æœ‰ <code>RUN</code>,<code>CMD</code>,<code>ENTRYPOINT</code>,<code>COPY</code>,<code>ADD</code> æŒ‡ä»¤è®¾ç½®å·¥ä½œç›®å½•</p>
<p>å¦‚æœ <code>WORKDIR</code> ä¸å­˜åœ¨, å³ä½¿åœ¨éšåçš„ <code>Dockerfile</code> æ‰€æœ‰æŒ‡ä»¤ä¸­éƒ½æ²¡æœ‰ç”¨ä¸Š, å®ƒè¿˜æ˜¯ä¼šè¢«åˆ›å»º</p>
<p><code>WORKDIR</code> æŒ‡ä»¤å¯ä»¥åœ¨ <code>Dockerfile</code> ä¸­ä½¿ç”¨å¤šæ¬¡. å¦‚æœæä¾›äº†ä¸€ä¸ªç›¸å¯¹è·¯å¾„, è¿™ä¸ªè·¯å¾„å°†ä¼šç›¸å¯¹äºä¸Šä¸€ä¸ª <code>WORKDIR</code> æŒ‡ä»¤çš„è·¯å¾„</p>
<p>Example:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /a</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> b</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> c</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">pwd</span></span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ª <code>Dockerfile</code> ä¸­çš„ <code>pwd</code> å‘½ä»¤çš„æœ€ç»ˆè¾“å‡ºæ˜¯ <code>/a/b/c</code></p>
<p><code>WORKDIR</code> æŒ‡ä»¤å¯ä»¥è§£æå…ˆå‰ä½¿ç”¨ <code>ENV</code> è®¾ç½®çš„ç¯å¢ƒå˜é‡. ä½ åªèƒ½ä½¿ç”¨åœ¨ <code>Dockerfile</code> ä¸­æ˜ç¡®è®¾ç½®çš„ç¯å¢ƒå˜é‡:</p>
<p>Example:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> DIRPATH=/path</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> <span class="variable">$DIRPATH</span>/<span class="variable">$DIRNAME</span></span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">pwd</span></span></span><br></pre></td></tr></table></figure>

<p>åœ¨ <code>Dockerfile</code> ä¸­æœ€ç»ˆçš„ <code>pwd</code> å‘½ä»¤çš„è¾“å‡ºæ˜¯ <code>/path/$DIRNAME</code></p>
<p>å¦‚æœæ²¡æœ‰æ˜ç¡®æŒ‡å®š, é‚£ä¹ˆé»˜è®¤çš„å·¥ä½œç›®å½•æ˜¯ <code>/</code>. åœ¨å®è·µä¸­, å¦‚æœä½ ä¸æ˜¯ä»å¤´å¼€å§‹ (<code>FROM scratch</code>) æ„å»º Dockerfile, é‚£ä¹ˆ <code>WORKDIR</code> å¾ˆæœ‰å¯èƒ½ç”±ä½ æ­£åœ¨ä½¿ç”¨çš„åŸºç¡€é•œåƒè®¾ç½®</p>
<p>å› æ­¤, ä¸ºäº†é¿å…åœ¨æœªçŸ¥ç›®å½•ä¸‹çš„è¿›è¡Œæ„å¤–æ“ä½œ, æœ€ä½³å®è·µæ˜¯æ˜ç¡®è®¾ç½®ä½ çš„ <code>WORKDIR</code></p>
<h2 id="ARG-ARG-æŒ‡ä»¤"><a href="#ARG-ARG-æŒ‡ä»¤" class="headerlink" title="ARG (ARG æŒ‡ä»¤)"></a>ARG (ARG æŒ‡ä»¤)</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ARG</span> &lt;name&gt;[=&lt;default value&gt;]</span><br></pre></td></tr></table></figure>

<p><code>ARG</code> æŒ‡ä»¤å®šä¹‰ä¸€ä¸ªå˜é‡, ç”¨æˆ·å¯ä»¥åœ¨æ„å»ºæ—¶ä½¿ç”¨å¸¦æœ‰ <code>--build-arg &lt;varname&gt;=&lt;value&gt;</code> æ ‡å¿—çš„ <code>docker build</code> å‘½ä»¤å°†è¿™ä¸ªå˜é‡ä¼ é€’ç»™æ„å»ºå™¨ (builder). å¦‚æœç”¨æˆ·æŒ‡å®šäº†ä¸€ä¸ªæ²¡æœ‰åœ¨ Dockerfile ä¸­å®šä¹‰çš„æ„å»ºå‚æ•°, é‚£ä¹ˆæ„å»ºå°†ä¼šè¾“å‡ºä¸€ä¸ªè­¦å‘Š: <code>[Warning] One or more build-args [foo] were not consumed.</code></p>
<p>ä¸€ä¸ª Dockerfile å¯ä»¥åŒ…å«å¤šä¸ª <code>ARG</code> æŒ‡ä»¤</p>
<p>Example:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> busybox</span><br><span class="line"><span class="keyword">ARG</span> user1</span><br><span class="line"><span class="keyword">ARG</span> buildno</span><br></pre></td></tr></table></figure>

<p>è­¦å‘Š: ä¸å»ºè®®ä½¿ç”¨æ„å»ºæ—¶å˜é‡ä¼ é€’æœºå¯†, ä¾‹å¦‚ Github keys, ç”¨æˆ·è®¤è¯ç­‰. é€šè¿‡ <code>docker history</code> å‘½ä»¤, æ„å»ºæ—¶å˜é‡å¯¹æ‰€æœ‰ä½¿ç”¨é•œåƒçš„ç”¨æˆ·éƒ½æ˜¯å¯è§çš„. æŸ¥çœ‹ <a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/develop/develop-images/build_enhancements/#new-docker-build-secret-information" >build images with BuildKit<i class="fas fa-external-link-alt"></i></a> éƒ¨åˆ†, äº†è§£æ„å»ºé•œåƒæ—¶ä½¿ç”¨æœºå¯†çš„å®‰å…¨æ–¹æ³•</p>
<h3 id="Default-values-é»˜è®¤å€¼"><a href="#Default-values-é»˜è®¤å€¼" class="headerlink" title="Default values (é»˜è®¤å€¼)"></a>Default values (é»˜è®¤å€¼)</h3><p><code>ARG</code> æŒ‡ä»¤å¯ä»¥é€‰æ‹©åŒ…å«é»˜è®¤å€¼:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> busybox</span><br><span class="line"><span class="keyword">ARG</span> user1=someuser</span><br><span class="line"><span class="keyword">ARG</span> buildno=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœ <code>ARG</code> æŒ‡ä»¤æœ‰ä¸€ä¸ªé»˜è®¤å€¼, ä½†æ˜¯åœ¨æ„å»ºæ—¶æ²¡æœ‰ä¼ é€’å€¼è¿›æ¥, é‚£ä¹ˆæ„å»ºå™¨ (builder) ä½¿ç”¨é»˜è®¤å€¼</p>
<h3 id="Scope-ä½œç”¨åŸŸ"><a href="#Scope-ä½œç”¨åŸŸ" class="headerlink" title="Scope (ä½œç”¨åŸŸ)"></a>Scope (ä½œç”¨åŸŸ)</h3><p><code>ARG</code> å˜é‡å®šä¹‰ä»åœ¨ <code>Dockerfile</code> ä¸­å®šä¹‰å®ƒçš„è¡Œçš„ä½ç½®å¼€å§‹ç”Ÿæ•ˆ, è€Œä¸æ˜¯ä»å‘½ä»¤è¡Œæˆ–è€…å…¶ä»–åœ°æ–¹çš„å‚æ•°ä½¿ç”¨å¼€å§‹</p>
<p>Example:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="keyword">FROM</span> busybox</span><br><span class="line"><span class="number">2</span> <span class="keyword">USER</span> $&#123;<span class="keyword">user</span>:-some_user&#125;</span><br><span class="line"><span class="number">3</span> <span class="keyword">ARG</span> <span class="keyword">user</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">USER</span> $<span class="keyword">user</span></span><br></pre></td></tr></table></figure>

<p>Example - ç”¨æˆ·é€šè¿‡è¿™æ ·è°ƒç”¨æ¥æ„å»ºè¿™ä¸ªæ–‡ä»¶:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker build --build-arg user=what_user .</span><br></pre></td></tr></table></figure>

<p>ç¬¬ <code>2</code> è¡Œçš„ <code>USER</code> è®¡ç®—ç»“æœä¸º <code>some_user</code>, å› ä¸º <code>user</code> å˜é‡åœ¨éšåçš„ç¬¬ <code>3</code> è¡Œå®šä¹‰</p>
<p>ç¬¬ <code>4</code> è¡Œçš„ <code>USER</code> è®¡ç®—ç»“æœä¸º <code>what_user</code>, å› ä¸º <code>user</code> å·²ç»å®šä¹‰ä¸”å€¼ <code>what_user</code> å·²åœ¨å‘½ä»¤è¡Œä¸Šä¼ é€’</p>
<p>åœ¨é€šè¿‡ <code>ARG</code> æŒ‡ä»¤å®šä¹‰ä¹‹å‰, å¯¹å˜é‡çš„ä»»ä½•ä½¿ç”¨éƒ½ä¼šå¯¼è‡´ç©ºå­—ç¬¦ä¸²</p>
<p><code>ARG</code> æŒ‡ä»¤åœ¨å®šä¹‰å®ƒçš„æ„å»ºé˜¶æ®µç»“æŸæ—¶è¶…å‡ºäº† (goes out of) ä½œç”¨åŸŸ. è¦åœ¨å¤šä¸ªé˜¶æ®µä½¿ç”¨ä¸€ä¸ª arg, æ¯ä¸ªé˜¶æ®µå¿…é¡»åŒ…å« <code>ARG</code> æŒ‡ä»¤</p>
<p>Example:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> busybox</span><br><span class="line"><span class="keyword">ARG</span> SETTINGS</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> ./run/setup <span class="variable">$SETTINGS</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> busybox</span><br><span class="line"><span class="keyword">ARG</span> SETTINGS</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> ./run/other <span class="variable">$SETTINGS</span></span></span><br></pre></td></tr></table></figure>

<h3 id="Using-ARG-variables-ä½¿ç”¨-ARG-å˜é‡"><a href="#Using-ARG-variables-ä½¿ç”¨-ARG-å˜é‡" class="headerlink" title="Using ARG variables (ä½¿ç”¨ ARG å˜é‡)"></a>Using ARG variables (ä½¿ç”¨ ARG å˜é‡)</h3><p>ä½ å¯ä»¥ä½¿ç”¨ <code>ARG</code> æˆ– <code>ENV</code> æŒ‡ä»¤æ¥æŒ‡å®šå¯ç”¨äº <code>RUN</code> æŒ‡ä»¤çš„å˜é‡</p>
<p>ä½¿ç”¨ <code>ENV</code> æŒ‡ä»¤å®šä¹‰çš„ç¯å¢ƒå˜é‡æ€»æ˜¯è¦†ç›–ç›¸åŒåå­—çš„ <code>ARG</code> æŒ‡ä»¤</p>
<p>Example - è€ƒè™‘è¿™ä¸ªæœ‰ <code>ENV</code> å’Œ <code>ARG</code> æŒ‡ä»¤çš„ Dockerfile:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"><span class="keyword">ARG</span> CONT_IMG_VER</span><br><span class="line"><span class="keyword">ENV</span> CONT_IMG_VER=v1.<span class="number">0.0</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="variable">$CONT_IMG_VER</span></span></span><br></pre></td></tr></table></figure>

<p>ç„¶å, å‡è®¾ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ„å»ºè¿™ä¸ªé•œåƒ:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker build --build-arg CONT_IMG_VER=v2.0.1 .</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªæƒ…å†µä¸‹, <code>RUN</code> æŒ‡ä»¤ä½¿ç”¨ <code>v1.0.0</code> è€Œä¸æ˜¯ é€šè¿‡ç”¨æˆ·ä¼ é€’ç»™ <code>ARG</code> çš„ <code>v2.0.1</code></p>
<p>è¿™ä¸ªè¡Œä¸ºç±»ä¼¼äº shell è„šæœ¬, å…¶ä¸­å±€éƒ¨èŒƒå›´çš„å˜é‡ä»å®ƒçš„å®šä¹‰ç‚¹ä¼šè¦†ç›–ä½œä¸ºå‚æ•°ä¼ é€’æˆ–ä»ç¯å¢ƒç»§æ‰¿çš„å˜é‡</p>
<p>ä½¿ç”¨ä¸Šé¢çš„ç¤ºä¾‹ä½†æ˜¯ä½¿ç”¨ä¸åŒçš„ <code>ENV</code> è§„èŒƒ, ä½ å¯ä»¥åœ¨ <code>ARG</code> å’Œ <code>ENV</code> æŒ‡ä»¤ä¹‹é—´åˆ›å»ºæ›´æœ‰ç”¨çš„äº¤äº’:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"><span class="keyword">ARG</span> CONT_IMG_VER</span><br><span class="line"><span class="keyword">ENV</span> CONT_IMG_VER=$&#123;CONT_IMG_VER:-v1.<span class="number">0.0</span>&#125;</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="variable">$CONT_IMG_VER</span></span></span><br></pre></td></tr></table></figure>

<p>ä¸åƒ <code>ARG</code> æŒ‡ä»¤ ,<code>ENV</code> å€¼åœ¨æ„å»ºçš„é•œåƒä¸­æŒç»­å­˜åœ¨. è€ƒè™‘ä¸€ä¸ªä¸ä½¿ç”¨ <code>--build-arg</code> æ ‡å¿—çš„ docker æ„å»º: <code>$ docker build .</code></p>
<p>ä½¿ç”¨ä¸Šè¿°ä¾‹å­çš„ Dockerfile, <code>CONT_IMG_VER</code> è¿˜æ˜¯æŒç»­å­˜åœ¨äºé•œåƒä¸­, ä½†æ˜¯å®ƒçš„å€¼å°†ä¼šæ˜¯ <code>v1.0.0</code>, å› ä¸ºå®ƒçš„é»˜è®¤å€¼åœ¨ç¬¬ <code>3</code> è¡Œé€šè¿‡ <code>ENV</code> æŒ‡ä»¤è®¾ç½®</p>
<p>è¿™ä¸ªä¾‹å­ä¸­çš„å˜é‡æ‰©å±•æŠ€æœ¯å…è®¸ä½ ä»å‘½ä»¤è¡Œä¼ é€’å‚æ•°, å¹¶é€šè¿‡åˆ©ç”¨ <code>ENV</code> æŒ‡ä»¤å°†å®ƒä»¬ä¿å­˜åœ¨æœ€ç»ˆé•œåƒä¸­</p>
<p><a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/builder/#environment-replacement" >ä»…æœ‰é™çš„ä¸€ç»„ Dockerfile æŒ‡ä»¤<i class="fas fa-external-link-alt"></i></a> æ”¯æŒå˜é‡æ‰©å±•</p>
<h3 id="Predefined-ARGs-é¢„å®šä¹‰çš„-ARGs"><a href="#Predefined-ARGs-é¢„å®šä¹‰çš„-ARGs" class="headerlink" title="Predefined ARGs (é¢„å®šä¹‰çš„ ARGs)"></a>Predefined ARGs (é¢„å®šä¹‰çš„ ARGs)</h3><p>Docker æœ‰ä¸€ç»„é¢„å®šä¹‰çš„ <code>ARG</code> å˜é‡, ä½ å¯ä»¥åœ¨ Dockerfile ä¸­æ²¡æœ‰å¯¹åº”çš„ <code>ARG</code> æŒ‡ä»¤çš„æƒ…å†µä¸‹ä½¿ç”¨è¿™äº›å˜é‡</p>
<ul>
<li><code>HTTP_PROXY</code></li>
<li><code>http_proxy</code></li>
<li><code>HTTPS_PROXY</code></li>
<li><code>https_proxy</code></li>
<li><code>FTP_PROXY</code></li>
<li><code>ftp_proxy</code></li>
<li><code>NO_PROXY</code></li>
<li><code>no_proxy</code></li>
</ul>
<p>è¦ä½¿ç”¨è¿™äº›å˜é‡, ä½¿ç”¨ <code>--build-arg</code> æ ‡å¿—åœ¨å‘½ä»¤è¡Œä¸Šä¼ é€’å®ƒä»¬, ä¾‹å¦‚: <code>$ docker build --build-arg HTTPS_PROXY=https://my-proxy.example.com</code></p>
<p>é»˜è®¤æƒ…å†µä¸‹, è¿™äº›é¢„å®šä¹‰å˜é‡ä» <code>docker history</code> çš„è¾“å‡ºä¸­æ’é™¤. æ’é™¤å®ƒä»¬å¯ä»¥é™ä½åœ¨ <code>HTTP_PROXY</code> å˜é‡ä¸­æ„å¤–æ³„éœ²æ•æ„Ÿèº«ä»½éªŒè¯ä¿¡æ¯çš„é£é™©</p>
<p>ä¾‹å¦‚, è€ƒè™‘ä½¿ç”¨ <code>--build-arg HTTP_PROXY=http://user:pass@proxy.lon.example.com</code> æ¥æ„å»ºä¸‹é¢çš„ Dockerfile:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;Hello World&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ç§æƒ…å†µä¸‹, <code>HTTP_PROXY</code> å˜é‡çš„å€¼åœ¨ <code>docker history</code> ä¸­æ˜¯ä¸å¯ç”¨çš„, ä¸”ä¸ä¼šè¢«ç¼“å­˜. å¦‚æœä½ æƒ³è¦ä¿®æ”¹åæ ‡ (location), ä¸”ä½ çš„ä»£ç†æœåŠ¡å™¨ä¿®æ”¹ä¸º <code>http://user:pass@proxy.sfo.example.com</code>, åç»­çš„æ„å»ºä¸ä¼šå¯¼è‡´ç¼“å­˜æœªå‘½ä¸­</p>
<p>å¦‚æœä½ éœ€è¦è¦†ç›–è¿™ä¸ªè¡Œä¸º, ä½ å¯ä»¥åƒä¸‹é¢è¿™æ ·é€šè¿‡åœ¨ Dockerfile ä¸­æ·»åŠ ä¸€ä¸ª <code>ARG</code> æŒ‡ä»¤:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"><span class="keyword">ARG</span> HTTP_PROXY</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;Hello World&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>æ„å»ºè¿™ä¸ª Dockerfile æ—¶, <code>HTTP_PROXY</code> ä¿ç•™åœ¨ <code>docker history</code> ä¸­, æ›´æ”¹å…¶å€¼ä¼šä½¿æ„å»ºç¼“å­˜å¤±æ•ˆ</p>
<h3 id="Automatic-platform-ARGs-in-the-global-scope-å…¨å±€èŒƒå›´å†…çš„è‡ªåŠ¨å¹³å°-ARGs"><a href="#Automatic-platform-ARGs-in-the-global-scope-å…¨å±€èŒƒå›´å†…çš„è‡ªåŠ¨å¹³å°-ARGs" class="headerlink" title="Automatic platform ARGs in the global scope (å…¨å±€èŒƒå›´å†…çš„è‡ªåŠ¨å¹³å° ARGs)"></a>Automatic platform ARGs in the global scope (å…¨å±€èŒƒå›´å†…çš„è‡ªåŠ¨å¹³å° ARGs)</h3><p>è¿™ä¸ªåŠŸèƒ½åªæœ‰åœ¨ä½¿ç”¨ <a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/builder/#buildkit" >BuildKit<i class="fas fa-external-link-alt"></i></a> æ—¶ç”Ÿæ•ˆ</p>
<p>Docker é¢„å®šä¹‰äº†ä¸€ç»„ <code>ARG</code> å˜é‡, å…¶ä¸­åŒ…å«æœ‰å…³æ‰§è¡Œæ„å»ºçš„èŠ‚ç‚¹å¹³å° (æ„å»ºå¹³å°) å’Œç”Ÿæˆé•œåƒçš„å¹³å° (ç›®æ ‡å¹³å°) çš„ä¿¡æ¯</p>
<p>ç›®æ ‡å¹³å°å¯ä»¥ä½¿ç”¨ <code>docker build</code> ä¸Šçš„ <code>--platform</code> æ ‡å¿—æ¥æŒ‡å®š</p>
<p>è‡ªåŠ¨è®¾ç½®å¦‚ä¸‹ <code>ARG</code> å˜é‡:</p>
<ul>
<li><code>TARGETPLATFORM</code> - æ„å»ºç»“æœçš„å¹³å°. ä¾‹å¦‚ <code>linux/amd64</code>,<code>linux/arm/v7</code>,<code>windows/amd64</code></li>
<li><code>TARGETOS</code> - TARGETPLATFORM çš„ OS ç»„ä»¶</li>
<li><code>TARGETARCH</code> - TARGETPLATFORM çš„æ¶æ„ç»„ä»¶</li>
<li><code>TARGETVARIANT</code> - TARGETPLATFORM çš„å˜ä½“ (variant) ç»„ä»¶</li>
<li><code>BUILDPLATFORM</code> - æ‰§è¡Œæ„å»ºçš„èŠ‚ç‚¹å¹³å°</li>
<li><code>BUILDOS</code> - BUILDPLATFORM çš„ OS ç»„ä»¶</li>
<li><code>BUILDARCH</code> - BUILDPLATFORM çš„æ¶æ„ç»„ä»¶</li>
<li><code>BUILDVARIANT</code> - BUILDPLATFORM çš„å˜ä½“ (variant) ç»„ä»¶</li>
</ul>
<p>è¿™äº›å‚æ•°æ˜¯åœ¨å…¨å±€èŒƒå›´å†…å®šä¹‰çš„, å› æ­¤åœ¨æ„å»ºé˜¶æ®µæˆ–ä½ çš„ <code>RUN</code> å‘½ä»¤ä¸­ä¸ä¼šè‡ªåŠ¨ä½¿ç”¨. è¦åœ¨æ„å»ºé˜¶æ®µæš´éœ²è¿™äº›å‚æ•°ä¸­çš„ä¸€ä¸ª, ä¸è¦å£°æ˜å€¼çš„æ–¹å¼æ¥é‡æ–°å®šä¹‰å®ƒ:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> alpine</span><br><span class="line"><span class="keyword">ARG</span> TARGETPLATFORM</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;I&#x27;m building for <span class="variable">$TARGETPLATFORM</span>&quot;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="Impact-on-build-caching-å¯¹æ„å»ºç¼“å­˜çš„å½±å“"><a href="#Impact-on-build-caching-å¯¹æ„å»ºç¼“å­˜çš„å½±å“" class="headerlink" title="Impact on build caching (å¯¹æ„å»ºç¼“å­˜çš„å½±å“)"></a>Impact on build caching (å¯¹æ„å»ºç¼“å­˜çš„å½±å“)</h3><p><code>ARG</code> å˜é‡ä¸æƒ³ <code>ENV</code> å˜é‡é‚£æ ·æŒç»­å­˜åœ¨åˆ°æ„å»ºçš„é•œåƒä¸­</p>
<p>ä½†æ˜¯, <code>ARG</code> å˜é‡ä»¥ç±»ä¼¼çš„æ–¹å¼å½±å“æ„å»ºç¼“å­˜</p>
<p>å¦‚æœä¸€ä¸ª Dockerfile å®šä¹‰äº†ä¸€ä¸ª <code>ARG</code> å˜é‡, è¿™ä¸ªå˜é‡çš„å€¼å’Œä¹‹å‰çš„æ„å»ºä¸­ä¸åŒ, ç„¶åä¼šåœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨è¿™ä¸ªå˜é‡çš„æ—¶å€™å‘ç”Ÿ â€œç¼“å­˜ä¸å‘½ä¸­â€, è€Œä¸æ˜¯åœ¨è¿™ä¸ªå˜é‡å®šä¹‰çš„æ—¶å€™</p>
<p>ç‰¹åˆ«æ˜¯, åœ¨ <code>ARG</code> æŒ‡ä»¤ä¹‹åçš„æ‰€æœ‰ <code>RUN</code> æŒ‡ä»¤éƒ½éšå¼ä½¿ç”¨ <code>ARG</code> å˜é‡ (ä½œä¸ºç¯å¢ƒå˜é‡), å› æ­¤å¯èƒ½å¯¼è‡´ç¼“å­˜æœªå‘½ä¸­</p>
<p>æ‰€ä»¥é¢„å®šä¹‰çš„ <code>ARG</code> å˜é‡éƒ½å…äºç¼“å­˜, é™¤é Dockerfile ä¸­æœ‰åŒ¹é…çš„ <code>ARG</code> è¯­å¥</p>
<p>Example - è€ƒè™‘å¦‚ä¸‹ä¸¤ä¸ª Dockerfile:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"><span class="keyword">ARG</span> CONT_IMG_VER</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="variable">$CONT_IMG_VER</span></span></span><br></pre></td></tr></table></figure>

<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"><span class="keyword">ARG</span> CONT_IMG_VER</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> hello</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ åœ¨å‘½ä»¤è¡Œä¸­æŒ‡å®šäº† <code>--build-arg CONT_IMG_VER=&lt;value&gt;</code>, åœ¨ä¸¤ç§æƒ…å†µä¸‹, ç¬¬ <code>2</code> è¡Œçš„è§„èŒƒä¸ä¼šå¯¼è‡´ä¸€ä¸ªç¼“å­˜æœªå‘½ä¸­</p>
<p>ç¬¬ <code>3</code> è¡Œå¯¼è‡´ç¼“å­˜æœªå‘½ä¸­</p>
<p><code>ARG CONT_IMG_VER</code> å¯¼è‡´ <code>RUN</code> é‚£è¡Œè¢«è¯†åˆ«ä¸ºä¸è¿è¡Œ <code>CONT_IMG_VER=&lt;value&gt; echo hello</code> ç›¸åŒ, å› æ­¤å¦‚æœ <code>&lt;value&gt;</code> å‘ç”Ÿå˜åŒ–, æˆ‘ä»¬ä¼šå¾—åˆ°ç¼“å­˜æœªå‘½ä¸­</p>
<p>è€ƒè™‘åŒä¸€å‘½ä»¤è¡Œä¸‹çš„å¦ä¸€ä¸ªç¤ºä¾‹:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"><span class="keyword">ARG</span> CONT_IMG_VER</span><br><span class="line"><span class="keyword">ENV</span> CONT_IMG_VER=$CONT_IMG_VER</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="variable">$CONT_IMG_VER</span></span></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­, ç¼“å­˜æœªå‘½ä¸­å‘ç”Ÿåœ¨ç¬¬ä¸‰è¡Œ. å‘ç”Ÿæœªå‘½ä¸­æ˜¯å› ä¸º <code>ENV</code> ä¸­å˜é‡çš„å€¼å¼•ç”¨ <code>ARG</code> å˜é‡ä¸”è¿™ä¸ª <code>ARG</code> å˜é‡é€šè¿‡å‘½ä»¤è¡Œæ”¹å˜äº†. åœ¨è¿™ä¸ªä¾‹å­ä¸­, <code>ENV</code> å‘½ä»¤å¯¼è‡´é•œåƒåŒ…å«äº†è¿™ä¸ªå€¼</p>
<p>å¦‚æœ <code>ENV</code> æŒ‡ä»¤è¦†ç›–åŒåçš„ <code>ARG</code> æŒ‡ä»¤:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"><span class="keyword">ARG</span> CONT_IMG_VER</span><br><span class="line"><span class="keyword">ENV</span> CONT_IMG_VER=hello</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="variable">$CONT_IMG_VER</span></span></span><br></pre></td></tr></table></figure>

<p>ç¬¬ <code>3</code> è¡Œä¸ä¼šå¯¼è‡´ä¸€ä¸ªç¼“å­˜æœªå‘½ä¸­, å› ä¸º <code>CONT_IMG_VER</code> çš„å€¼æ˜¯ä¸€ä¸ªå¸¸é‡ (<code>hello</code>). å› æ­¤, åœ¨ <code>RUN</code> (ç¬¬ <code>4</code> è¡Œ) ä¸­ä½¿ç”¨çš„ç¯å¢ƒå˜é‡å’Œå€¼åœ¨æ„å»ºä¹‹é—´ä¸ä¼šå‘ç”Ÿå˜åŒ–</p>
<h2 id="ONBUILD-ONBUILD-æŒ‡ä»¤"><a href="#ONBUILD-ONBUILD-æŒ‡ä»¤" class="headerlink" title="ONBUILD (ONBUILD æŒ‡ä»¤)"></a>ONBUILD (ONBUILD æŒ‡ä»¤)</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ONBUILD</span> &lt;INSTRUCTION&gt;</span><br></pre></td></tr></table></figure>

<p><code>ONBUILD</code> æŒ‡ä»¤å°† <code>trigger</code> æŒ‡ä»¤æ·»åŠ åˆ°é•œåƒä¸­, ä»¥ä¾¿ç¨åæ‰§è¡Œ, æ­¤æ—¶è¿™ä¸ªé•œåƒç”¨ä½œå¦ä¸€ä¸ªæ„å»ºçš„åŸºç¡€</p>
<p><code>trigger</code> å°†åœ¨ä¸‹æ¸¸æ„å»ºçš„ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œ ,å°±å¥½åƒå®ƒæ˜¯åœ¨ä¸‹æ¸¸ <code>Dockerfile</code> ä¸­çš„ <code>FROM</code> æŒ‡ä»¤ä¹‹åç«‹å³æ’å…¥çš„ä¸€æ ·</p>
<p>ä»»ä½•æ„å»ºæŒ‡ä»¤éƒ½å¯ä»¥æ³¨å†Œä¸º <code>trigger</code></p>
<p>è¿™åœ¨ä½ æ„å»ºä¸€ä¸ª ç”¨ä½œæ„å»ºå…¶ä»–é•œåƒçš„åŸºç¡€ çš„é•œåƒæ—¶å¾ˆæœ‰ç”¨, ä¾‹å¦‚ä¸€ä¸ªåº”ç”¨ç¨‹åºæ„å»ºç¯å¢ƒæˆ–è€…ä¸€ä¸ªå¯ä»¥ä½¿ç”¨ç”¨æˆ·ç‰¹å®šé…ç½®è‡ªå®šä¹‰çš„å®ˆæŠ¤è¿›ç¨‹</p>
<p>ä¾‹å¦‚, å¦‚æœä½ çš„é•œåƒæ˜¯ä¸€ä¸ªå¯é‡å¤ä½¿ç”¨çš„ Python åº”ç”¨ç¨‹åºæ„å»ºå™¨ ,å®ƒè¦æ±‚æ·»åŠ åº”ç”¨ç¨‹åºæºä»£ç åˆ°ä¸€ä¸ªæŒ‡å®šçš„ç›®å½•, ç„¶åå¯èƒ½éœ€è¦åœ¨æ­¤ä¹‹åè°ƒç”¨çš„æ„å»ºè„šæœ¬</p>
<p>ç°åœ¨ä½ è¿˜ä¸èƒ½å°±è°ƒç”¨ <code>ADD</code> å’Œ <code>RUN</code>, å› ä¸ºä½ è¿˜ä¸èƒ½è®¿é—®åº”ç”¨ç¨‹åºæºä»£ç , å¹¶ä¸”æ¯ä¸ªåº”ç”¨ç¨‹åºæ„å»ºéƒ½ä¼šä¸ä¸€æ ·</p>
<p>ä½ å¯ä»¥ç®€å•åœ°ä¸ºåº”ç”¨ç¨‹åºå¼€å‘äººå‘˜æä¾›æ¨¡æ¿ <code>Dockerfile</code> ä»¥å°†å…¶å¤åˆ¶ç²˜è´´åˆ°ä»–ä»¬çš„åº”ç”¨ç¨‹åºä¸­, ä½†è¿™æ ·æ•ˆç‡ä½ä¸‹, å®¹æ˜“å‡ºé”™ä¸”éš¾ä»¥æ›´æ–°, å› ä¸ºå®ƒä¸ç‰¹å®šåº”ç”¨ç¨‹åºä»£ç æ··åˆåœ¨ä¸€èµ·</p>
<p>è§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨ <code>ONBUILD</code> æ³¨å†Œé¢„å®šä¹‰æŒ‡ä»¤, ä»¥ä¾¿ç¨ååœ¨ä¸‹ä¸€ä¸ªæ„å»ºé˜¶æ®µè¿è¡Œ</p>
<p>å®ƒæ˜¯è¿™æ ·å·¥ä½œçš„:</p>
<ol>
<li>å½“é‡åˆ°ä¸€ä¸ª <code>ONBUILD</code> æŒ‡ä»¤æ—¶, æ„å»ºå™¨å°†ä¸€ä¸ª trigger æ·»åŠ åˆ°æ­£åœ¨æ„å»ºçš„é•œåƒçš„å…ƒæ•°æ®ä¸­. <code>ONBUILD</code> æŒ‡ä»¤ä¸ä¼šå½±å“å½“å‰çš„æ„å»º</li>
<li>åœ¨æ„å»ºç»“æŸæ—¶, æ‰€æœ‰è§¦å‘å™¨çš„åˆ—è¡¨å­˜å‚¨åˆ°é•œåƒæ¸…å• (manifest) ä¸­, åœ¨ <code>ONBUILD</code> é”®ä¸‹. å®ƒä»¬å¯ä»¥ä½¿ç”¨ <code>docker inspect</code> å‘½ä»¤æ¥æ£€æŸ¥</li>
<li>ç„¶åè¿™ä¸ªé•œåƒå¯èƒ½ç”¨åšä¸€ä¸ªæ–°æ„å»ºçš„åŸºç¡€é•œåƒ, ä½¿ç”¨ <code>FROM</code> æŒ‡ä»¤. ä½œä¸ºå¤„ç† <code>FROM</code> æŒ‡ä»¤çš„ä¸€éƒ¨åˆ†, ä¸‹æ¸¸æ„å»ºå™¨æŸ¥æ‰¾ <code>ONBUILD</code> triggers, å¹¶æŒ‰å®ƒä»¬æ³¨å†Œçš„ç›¸åŒé¡ºåºæ‰§è¡Œå®ƒä»¬. å¦‚æœä»»ä½•è§¦å‘å™¨å¤±è´¥, <code>FROM</code> æŒ‡ä»¤å°†è¢«ä¸­æ­¢, è¿™åè¿‡æ¥å¯¼è‡´æ„å»ºå¤±è´¥. å¦‚æœæ‰€æœ‰ triggers éƒ½æ‰§è¡ŒæˆåŠŸ, åˆ™ <code>FROM</code> æŒ‡ä»¤å®Œæˆå¹¶ä¸”æ„å»ºç…§å¸¸ç»§ç»­è¿›è¡Œ</li>
<li>è§¦å‘å™¨åœ¨æ‰§è¡Œåä¼šä»æœ€ç»ˆé•œåƒä¸­æ¸…é™¤. æ¢å¥è¯è¯´, å®ƒä»¬ä¸ä¼šè¢«ä¸‹ä¸‹ä¸ªæ„å»ºç»§æ‰¿</li>
</ol>
<p>Example - ä½ å¯ä»¥æ·»åŠ è¿™æ ·çš„ä¸œè¥¿:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ONBUILD</span> <span class="keyword">ADD</span><span class="language-bash"> . /app/src</span></span><br><span class="line"><span class="keyword">ONBUILD</span> <span class="keyword">RUN</span><span class="language-bash"> /usr/local/bin/python-build --<span class="built_in">dir</span> /app/src</span></span><br></pre></td></tr></table></figure>

<p>è­¦å‘Š: ä¸å…è®¸ä½¿ç”¨ <code>ONBUILD ONBUILD</code> çš„é“¾å¼ <code>ONBUILD</code> æŒ‡ä»¤</p>
<p>è­¦å‘Š: <code>ONBUILD</code> æŒ‡ä»¤å¯èƒ½ä¸ä¼šè§¦å‘ <code>FROM</code> æˆ– <code>MAINTAINER</code> æŒ‡ä»¤</p>
<h2 id="STOPSIGNAL-STOPSIGNAL-æŒ‡ä»¤"><a href="#STOPSIGNAL-STOPSIGNAL-æŒ‡ä»¤" class="headerlink" title="STOPSIGNAL (STOPSIGNAL æŒ‡ä»¤)"></a>STOPSIGNAL (STOPSIGNAL æŒ‡ä»¤)</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">STOPSIGNAL</span> signal</span><br></pre></td></tr></table></figure>

<p><code>STOPSIGNAL</code> æŒ‡ä»¤è®¾ç½®ç³»ç»Ÿè°ƒç”¨ä¿¡å·, è¿™ä¸ªä¿¡å·å°†è¢«å‘é€åˆ°å®¹å™¨ä»¥é€€å‡º</p>
<p>è¿™ä¸ªä¿¡å·å¯ä»¥æ˜¯æ ¼å¼ä¸º <code>SIG&lt;NAME&gt;</code> çš„ä¿¡å·åç§°, ä¾‹å¦‚ <code>SIGKILL</code>, ä¹Ÿå¯ä»¥æ˜¯åŒ¹é…å†…æ ¸ç³»ç»Ÿè°ƒç”¨è¡¨ä¸­æŸä¸ªä½ç½®çš„æ— ç¬¦å·æ•°å€¼, ä¾‹å¦‚ <code>9</code>. å¦‚æœæ²¡æœ‰å®šä¹‰åˆ™é»˜è®¤å€¼æ˜¯ <code>SIGTERM</code></p>
<p>å¯ä»¥è¦†ç›–æ¯ä¸ªå®¹å™¨çš„é•œåƒçš„é»˜è®¤åœæ­¢ä¿¡å·, åœ¨ <code>docker run</code> å’Œ <code>docker create</code> ä¸Šä½¿ç”¨ <code>--stop-signal</code> æ ‡å¿—</p>
<h2 id="HEALTHCHECK-HEALTHCHECK-æŒ‡ä»¤"><a href="#HEALTHCHECK-HEALTHCHECK-æŒ‡ä»¤" class="headerlink" title="HEALTHCHECK (HEALTHCHECK æŒ‡ä»¤)"></a>HEALTHCHECK (HEALTHCHECK æŒ‡ä»¤)</h2><p><code>HEALTHCHECK</code> æŒ‡ä»¤æœ‰ä¸¤ç§å½¢å¼:</p>
<ul>
<li><code>HEALTHCHECK [OPTIONS] CMD command</code> (é€šè¿‡åœ¨å®¹å™¨ä¸­è¿è¡Œä¸€ä¸ªå‘½ä»¤æ¥æ£€æŸ¥å®¹å™¨å¥åº·)</li>
<li><code>HEALTHCHECK NONE</code> (å…³é—­æ‰€æœ‰ä»åŸºç¡€é•œåƒç»§æ‰¿çš„å¥åº·æ£€æŸ¥)</li>
</ul>
<p><code>HEALTHCHECK</code> æŒ‡ä»¤å‘Šè¯‰ Docker æ€æ ·æµ‹è¯•ä¸€ä¸ªå®¹å™¨, æ£€æŸ¥å®ƒæ˜¯å¦è¿˜å·¥ä½œ. è¿™å¯ä»¥æ£€æµ‹è¯¸å¦‚ Web æœåŠ¡å™¨é™·å…¥æ— é™å¾ªç¯å¹¶ä¸”æ— æ³•å¤„ç†æ–°è¿æ¥çš„æƒ…å†µ, å³ä½¿æœåŠ¡å™¨è¿›ç¨‹ä»åœ¨è¿è¡Œ</p>
<p>å½“å®¹å™¨æŒ‡å®šäº†å¥åº·æ£€æŸ¥æ—¶, é™¤äº†æ­£å¸¸çŠ¶æ€å¤–, å®ƒè¿˜å…·æœ‰å¥åº·çŠ¶æ€. è¿™ä¸ªå¥åº·çŠ¶æ€ä»¥ <code>starting</code> ä¸ºåˆå§‹çŠ¶æ€. æ¯å½“å¥åº·æ£€æŸ¥é€šè¿‡æ—¶, å®ƒå°±ä¼šå˜æˆ <code>healthy</code> (æ— è®ºå®ƒä»¥å‰å¤„äºä»€ä¹ˆçŠ¶æ€). åœ¨è¿ç»­å¤±è´¥ä¸€å®šæ¬¡æ•°å, å®ƒå˜æˆ <code>unhealthy</code> çŠ¶æ€</p>
<p>å¯ä»¥å‡ºç°åœ¨ <code>CMD</code> å‰çš„é€‰é¡¹æ˜¯:</p>
<ul>
<li><code>--interval=DURATION</code> (é»˜è®¤: <code>30s</code>)</li>
<li><code>--timeout=DURATION</code> (é»˜è®¤: <code>30s</code>)</li>
<li><code>--start-period=DURATION</code> (é»˜è®¤: <code>0s</code>)</li>
<li><code>--retries=N</code> (é»˜è®¤: <code>3</code>)</li>
</ul>
<p>å¥åº·æ£€æŸ¥ä¼šåœ¨å®¹å™¨å¯åŠ¨åé—´éš” <strong>interval</strong> ç§’åç¬¬ä¸€æ¬¡æ‰§è¡Œ, ç„¶ååœ¨æ¯æ¬¡æ£€æŸ¥ç»“æŸåå†é—´éš” <strong>interval</strong> ç§’æ‰§è¡Œ</p>
<p>å¦‚æœå•ä¸ªæ£€æŸ¥ä»»åŠ¡è¿è¡Œè¶…è¿‡ <strong>timeout</strong> ç§’, åˆ™è®¤ä¸ºæ£€æŸ¥å¤±è´¥</p>
<p>å®¹å™¨è¿ç»­é‡è¯• <strong>retries</strong> æ¬¡å¥åº·æ£€æŸ¥å¤±è´¥åˆ™å®¹å™¨è¢«è®¤ä¸ºæ˜¯ <code>unhealthy</code></p>
<p><code>start period</code> ä¸ºéœ€è¦æ—¶é—´å¯åŠ¨çš„å®¹å™¨æä¾›åˆå§‹åŒ–æ—¶é—´. åœ¨æ­¤æœŸé—´çš„æ¢æµ‹å¤±è´¥ä¸ä¼šè¢«è®¡å…¥æœ€å¤§é‡è¯•æ¬¡æ•°</p>
<p>ä½†æ˜¯, å¦‚æœå¥åº·æ£€æŸ¥åœ¨å¯åŠ¨é—´éš”æœŸé—´æˆåŠŸäº†, é‚£ä¹ˆå®¹å™¨åˆ™è¢«è®¤ä¸ºæ˜¯å·²ç»å¯åŠ¨çš„å¹¶ä¸”æ‰€æœ‰è¿ç»­å¤±è´¥éƒ½è®¡å…¥æœ€å¤§é‡è¯•æ¬¡æ•°</p>
<p>åœ¨ Dockerfile ä¸­åªèƒ½æœ‰ä¸€ä¸ª <code>HEALTHCHECK</code> æŒ‡ä»¤. å¦‚æœä½ æŒ‡å®šäº†å¤šä¸ª <code>HEALTHCHECK</code> æŒ‡ä»¤, é‚£ä¹ˆåªæœ‰æœ€åä¸€ä¸ª <code>HEALTHCHECK</code> æŒ‡ä»¤ç”Ÿæ•ˆ</p>
<p><code>CMD</code> å…³é”®å­—åé¢çš„å‘½ä»¤å¯ä»¥æ˜¯ä¸€ä¸ª shell å‘½ä»¤ (ä¾‹å¦‚, <code>HEALTHCHECK CMD /bin/check-running</code>) æˆ–è€…ä¸€ä¸ª <code>exec</code> æ•°ç»„</p>
<p>å‘½ä»¤çš„é€€å‡ºçŠ¶æ€æŒ‡æ˜äº†å®¹å™¨çš„å¥åº·çŠ¶æ€. å¯èƒ½çš„å€¼:</p>
<ul>
<li><code>0</code>: æˆåŠŸ - å®¹å™¨æ˜¯å¥åº·çš„ä¸”å¯ä»¥ä½¿ç”¨äº†</li>
<li><code>1</code>: ä¸å¥åº·çš„ - å®¹å™¨æ²¡æœ‰æ­£ç¡®åœ°å·¥ä½œ</li>
<li><code>2</code>: ä¿ç•™çš„ - ä¸è¦ä½¿ç”¨è¿™ä¸ªé€€å‡ºç </li>
</ul>
<p>Example - æ¯äº”åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ç½‘ç»œæœåŠ¡å™¨æ˜¯å¦èƒ½å¤Ÿåœ¨ä¸‰ç§’å†…ä¸ºç½‘ç«™ä¸»é¡µæä¾›æœåŠ¡:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">HEALTHCHECK</span><span class="language-bash"> --interval=5m --<span class="built_in">timeout</span>=3s CMD curl -f http://localhost/ || <span class="built_in">exit</span> 1</span></span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†å¸®åŠ©è°ƒè¯•å¤±è´¥çš„æ¢é’ˆ, å‘½ä»¤å†™åˆ° stdout&#x2F;stderr çš„ä»»ä½•è¾“å‡ºæ–‡æœ¬ (UTF-8 ç¼–ç çš„)éƒ½ä¼šè¢«å­˜å‚¨åˆ°å¥åº·çŠ¶æ€ä¸­, å¹¶ä¸”å¯ä»¥ä½¿ç”¨ <code>docker inspect</code> æ¥æŸ¥è¯¢. è¿™æ ·çš„è¾“å‡ºæ–‡æœ¬è¦ä¿å­˜çŸ­å° (å½“å‰åªæœ‰å¤´ 4096 å­—èŠ‚ä¼šè¢«å­˜å‚¨)</p>
<p>å½“ä¸€ä¸ªå®¹å™¨çš„å¥åº·çŠ¶æ€æ”¹å˜äº†, å°†ä¼šäº§ç”Ÿä¸€ä¸ªå¸¦æœ‰æ–°çŠ¶æ€çš„ <code>health_status</code></p>
<h2 id="SHELL-SHELL-æŒ‡ä»¤"><a href="#SHELL-SHELL-æŒ‡ä»¤" class="headerlink" title="SHELL (SHELL æŒ‡ä»¤)"></a>SHELL (SHELL æŒ‡ä»¤)</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHELL</span><span class="language-bash"> [<span class="string">&quot;executable&quot;</span>, <span class="string">&quot;parameters&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p><code>SHELL</code> æŒ‡ä»¤å…è®¸è¦†ç›–ç”¨äºå‘½ä»¤çš„ <code>shell</code> å½¢å¼çš„é»˜è®¤ shell</p>
<p>Linux ä¸Šçš„é»˜è®¤ shell æ˜¯ <code>[&quot;/bin/sh&quot;, &quot;-c&quot;]</code>, åœ¨ Windows ä¸Šæ˜¯ <code>[&quot;cmd&quot;, &quot;/S&quot;, &quot;/C&quot;]</code></p>
<p>åœ¨ Dockerfile ä¸­ <code>SHELL</code> æŒ‡ä»¤å¿…é¡»ä½¿ç”¨ JSON å½¢å¼æ¥ç¼–å†™</p>
<p><code>SHELL</code> æŒ‡ä»¤åœ¨ Windows ä¸Šç‰¹åˆ«æœ‰ç”¨, Windows ä¸Šæœ‰ä¸¤ä¸ªå¸¸ç”¨ä¸”éå¸¸ä¸åŒçš„æœ¬åœ° shell: <code>cmd</code> å’Œ <code>powershell</code>, ä»¥åŠåŒ…æ‹¬ <code>sh</code> åœ¨å†…çš„å¤‡ç”¨ shells</p>
<p><code>SHELL</code> æŒ‡ä»¤å¯ä»¥å‡ºç°å¤šæ¬¡. æ¯ä¸ª <code>SHELL</code> æŒ‡ä»¤è¦†ç›–å‰é¢æ‰€æœ‰é¢ <code>SHELL</code> æŒ‡ä»¤, å¹¶å½±å“æ‰€æœ‰æ¥ä¸‹æ¥çš„æŒ‡ä»¤</p>
<p>Example:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> microsoft/windowsservercore</span><br><span class="line"><span class="comment"># Executed as cmd /S /C echo default</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> default</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Executed as cmd /S /C powershell -command Write-Host default</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> powershell -<span class="built_in">command</span> Write-Host default</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Executed as powershell -command Write-Host hello</span></span><br><span class="line"><span class="keyword">SHELL</span><span class="language-bash"> [<span class="string">&quot;powershell&quot;</span>, <span class="string">&quot;-command&quot;</span>]</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> Write-Host hello</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Executed as cmd /S /C echo hello</span></span><br><span class="line"><span class="keyword">SHELL</span><span class="language-bash"> [<span class="string">&quot;CMD&quot;</span>, <span class="string">&quot;/S&quot;</span>, <span class="string">&quot;/C&quot;</span>]</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> hello</span></span><br></pre></td></tr></table></figure>

<p>è¿™äº›æŒ‡ä»¤åœ¨ Dockerfile ä¸­ä½¿ç”¨å®ƒä»¬çš„ <code>shell</code> å½¢å¼æ—¶ä¼šå—åˆ° <code>SHELL</code> æŒ‡ä»¤çš„å½±å“: <code>RUN</code>,<code>CMD</code>,<code>ENTRYPOINT</code></p>
<p>ä»¥ä¸‹ç¤ºä¾‹æ˜¯åœ¨ Windows ä¸Šå‘ç°çš„å¸¸è§æ¨¡å¼, å¯ä»¥ä½¿ç”¨ <code>SHELL</code> æŒ‡ä»¤è¿›è¡Œç®€åŒ–:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="language-bash"> powershell -<span class="built_in">command</span> Execute-MyCmdlet -param1 <span class="string">&quot;c:\foo.txt&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>è¢« docker æ‰§è¡Œçš„å‘½ä»¤å°†ä¼šæ˜¯: <code>cmd /S /C powershell -command Execute-MyCmdlet -param1 &quot;c:\foo.txt&quot;</code></p>
<p>è¿™æ ·åšæœ‰ä¸¤ä¸ªä¸é«˜æ•ˆçš„ç†ç”±. é¦–å…ˆ, è°ƒç”¨äº†ä¸€ä¸ªæ²¡æœ‰å¿…è¦çš„ cmd.ext å‘½ä»¤è¿›ç¨‹ (åˆå shell). å…¶æ¬¡, æ¯ä¸ªä½¿ç”¨ <code>shell</code> å½¢å¼çš„ <code>RUN</code> æŒ‡ä»¤è¦æ±‚ä¸€ä¸ªé¢å¤–çš„ <code>powershell -command</code> ä½œä¸ºå‘½ä»¤çš„å‰ç¼€</p>
<p>ä¸ºäº†è®©å…¶æ›´åŠ é«˜æ•ˆ, å¯ä»¥é‡‡ç”¨ä¸¤ç§æœºåˆ¶ä¹‹ä¸€. ä¸€ç§æ˜¯ä½¿ç”¨ JSON å½¢å¼ <code>RUN</code> å‘½ä»¤:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="language-bash"> [<span class="string">&quot;powershell&quot;</span>, <span class="string">&quot;-command&quot;</span>, <span class="string">&quot;Execute-MyCmdlet&quot;</span>, <span class="string">&quot;-param1 \&quot;c:\\foo.txt\&quot;&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>è™½ç„¶ JSON æ ¼å¼æ˜¯æ˜ç¡®çš„å¹¶ä¸”æ²¡æœ‰ä½¿ç”¨ä¸å¿…è¦çš„ cmd.exeï¼Œä½†å®ƒç¡®å®éœ€è¦é€šè¿‡åŒå¼•å·å’Œè½¬ä¹‰æ¥å¢åŠ è¯¦ç»†ä¿¡æ¯</p>
<p>å¦ä¸€ç§æœºåˆ¶æ˜¯ä½¿ç”¨ <code>SHELL</code> æŒ‡ä»¤å’Œ <code>shell</code> å½¢å¼ï¼Œä¸º Windows ç”¨æˆ·æä¾›æ›´è‡ªç„¶çš„è¯­æ³•ï¼Œå°¤å…¶æ˜¯ä¸ <code>escape</code> è§£æå™¨æŒ‡ä»¤ç»“åˆä½¿ç”¨æ—¶:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># escape=`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> microsoft/nanoserver</span><br><span class="line"><span class="keyword">SHELL</span><span class="language-bash"> [<span class="string">&quot;powershell&quot;</span>, <span class="string">&quot;-command&quot;</span>]</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> New-Item -ItemType Directory C:\Example</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> Execute-MyCmdlet.ps1 c:\example\</span></span><br><span class="line"><span class="language-bash">RUN c:\example\Execute-MyCmdlet -sample <span class="string">&#x27;hello world&#x27;</span></span></span><br></pre></td></tr></table></figure>

<p><code>SHELL</code> æŒ‡ä»¤ä¹Ÿå¯ä»¥ç”¨äºä¿®æ”¹ shell çš„æ“ä½œæ–¹å¼. ä¾‹å¦‚, åœ¨ Windows ä¸Šä½¿ç”¨ <code>SHELL cmd /S /C /V:ON|OFF</code>, å¯ä»¥ä¿®æ”¹å»¶è¿Ÿçš„ç¯å¢ƒå˜é‡æ‰©å±•è¯­ä¹‰</p>
<p>å¦‚æœéœ€è¦å…¶ä»– shellï¼Œä¾‹å¦‚ <code>zsh</code>, <code>csh</code>, <code>tcsh</code> ç­‰ï¼Œä¹Ÿå¯ä»¥åœ¨ Linux ä¸Šä½¿ç”¨ <code>SHELL</code> æŒ‡ä»¤</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/builder/#expose" >Dockerfile reference<i class="fas fa-external-link-alt"></i></a></p>

        </div>

        
            <div class="post-copyright-info">
                <div class="article-copyright-info-container">
    <ul>
        <li>æœ¬æ–‡æ ‡é¢˜ï¼šDockerfile reference</li>
        <li>æœ¬æ–‡ä½œè€…ï¼šæ—å¨ç¾½</li>
        <li>åˆ›å»ºæ—¶é—´ï¼š2022-05-18 10:38:18</li>
        <li>
            æœ¬æ–‡é“¾æ¥ï¼šhttps://linweiyu21.github.io/docker/dockerfile-reference/
        </li>
        <li>
            ç‰ˆæƒå£°æ˜ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
        </li>
    </ul>
</div>

            </div>
        

        
            <ul class="post-tags-box">
                
                    <li class="tag-item">
                        <a href="/tags/Docker/">#Docker</a>&nbsp;
                    </li>
                
                    <li class="tag-item">
                        <a href="/tags/Reference/">#Reference</a>&nbsp;
                    </li>
                
            </ul>
        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/docker/best-practices-for-writing-dockerfiles/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Best practices for writing Dockerfiles</span>
                                <span class="post-nav-item">ä¸Šä¸€ç¯‡</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/elasticsearch/elasticsearch-guide/query-dsl/elasticsearch-match-all-query/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Elasticsearch Match all query</span>
                                <span class="post-nav-item">ä¸‹ä¸€ç¯‡</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
            <div class="comment-container">
                <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        <i class="fas fa-comments">&nbsp;è¯„è®º</i>
    </div>
    

        
            
    <div class="valine-container">
        <script data-pjax
                src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script>
        <div id="vcomments"></div>
        <script data-pjax>
            function loadValine() {
                new Valine({
                    el: '#vcomments',
                    appId: '8xWQ0WFbKUNN4h8ixIO12etk-gzGzoHsz',
                    appKey: '7cLjTvkIsF6aIuIVSd0um89m',
                    meta: ['nick', 'mail', 'link'],
                    avatar: 'wavatar',
                    enableQQ: true,
                    placeholder: 'è¯·å¼€å§‹ä½ çš„è¡¨æ¼”',
                    lang: 'zh-CN'.toLowerCase()
                });

                function getAuthor(language) {
                    switch (language) {
                        case 'en':
                            return 'Author';
                        case 'zh-CN':
                            return 'åšä¸»';
                        default:
                            return 'Master';
                    }
                }

                // Add "Author" identify
                const getValineDomTimer = setInterval(() => {
                    const vcards = document.querySelectorAll('#vcomments .vcards .vcard');
                    if (vcards.length > 0) {
                        let author = 'æ—å¨ç¾½';

                        if (author) {
                            for (let vcard of vcards) {
                                const vnick_dom = vcard.querySelector('.vhead .vnick');
                                const vnick = vnick_dom.innerHTML;
                                if (vnick === author) {
                                    vnick_dom.innerHTML = `${vnick} <span class="author">${getAuthor(KEEP.hexo_config.language)}</span>`
                                }
                            }
                        }
                        clearInterval(getValineDomTimer);
                    } else {
                        clearInterval(getValineDomTimer);
                    }
                }, 2000);
            }

            if ('true') {
                const loadValineTimeout = setTimeout(() => {
                    loadValine();
                    clearTimeout(loadValineTimeout);
                }, 1000);
            } else {
                window.addEventListener('DOMContentLoaded', loadValine);
            }
        </script>
    </div>



        
    
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
            2022&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">æ—å¨ç¾½</a>
        </div>
        
            <script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        è®¿é—®äººæ•°&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
                    <span id="busuanzi_container_site_pv">
                        æ€»è®¿é—®é‡&nbsp;<span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            ç”± <a target="_blank" href="https://hexo.io">Hexo</a> é©±åŠ¨&nbsp;|&nbsp;ä¸»é¢˜&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.5</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fas fa-comment"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Usage-%E4%BD%BF%E7%94%A8"><span class="nav-number">1.</span> <span class="nav-text">Usage (ä½¿ç”¨)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BuildKit"><span class="nav-number">2.</span> <span class="nav-text">BuildKit</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Format-%E6%A0%BC%E5%BC%8F"><span class="nav-number">3.</span> <span class="nav-text">Format (æ ¼å¼)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Parser-directives-%E8%A7%A3%E6%9E%90%E5%99%A8%E6%8C%87%E4%BB%A4"><span class="nav-number">4.</span> <span class="nav-text">Parser directives (è§£æå™¨æŒ‡ä»¤)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#syntax"><span class="nav-number">4.1.</span> <span class="nav-text">syntax</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#escape"><span class="nav-number">4.2.</span> <span class="nav-text">escape</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Environment-replacement-%E7%8E%AF%E5%A2%83%E6%9B%B4%E6%8D%A2"><span class="nav-number">5.</span> <span class="nav-text">Environment replacement (ç¯å¢ƒæ›´æ¢)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#dockerignore-file-dockerignore-%E6%96%87%E4%BB%B6"><span class="nav-number">6.</span> <span class="nav-text">.dockerignore file (.dockerignore æ–‡ä»¶)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#FROM-FROM-%E6%8C%87%E4%BB%A4"><span class="nav-number">7.</span> <span class="nav-text">FROM (FROM æŒ‡ä»¤)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Understanding-how-ARG-and-FROM-interact-%E7%90%86%E8%A7%A3-ARG-%E5%92%8C-FROM-%E6%80%8E%E6%A0%B7%E4%BA%A4%E4%BA%92"><span class="nav-number">7.1.</span> <span class="nav-text">Understanding how ARG and FROM interact (ç†è§£ ARG å’Œ FROM æ€æ ·äº¤äº’)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RUN-RUN-%E6%8C%87%E4%BB%A4"><span class="nav-number">8.</span> <span class="nav-text">RUN (RUN æŒ‡ä»¤)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Know-issues-RUN-RUN-%E6%8C%87%E4%BB%A4%E7%9A%84%E5%B7%B2%E7%9F%A5%E9%97%AE%E9%A2%98"><span class="nav-number">8.1.</span> <span class="nav-text">Know issues (RUN) (RUN æŒ‡ä»¤çš„å·²çŸ¥é—®é¢˜)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CMD-CMD-%E6%8C%87%E4%BB%A4"><span class="nav-number">9.</span> <span class="nav-text">CMD (CMD æŒ‡ä»¤)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#LABEL-LABEL-%E6%8C%87%E4%BB%A4"><span class="nav-number">10.</span> <span class="nav-text">LABEL (LABEL æŒ‡ä»¤)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MAINTAINER-deprecated-MAINTAINER-%E6%8C%87%E4%BB%A4-%E5%B7%B2%E8%BF%87%E6%97%B6"><span class="nav-number">11.</span> <span class="nav-text">MAINTAINER (deprecated) (MAINTAINER æŒ‡ä»¤ å·²è¿‡æ—¶)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#EXPOSE-EXPOSE-%E6%8C%87%E4%BB%A4"><span class="nav-number">12.</span> <span class="nav-text">EXPOSE (EXPOSE æŒ‡ä»¤)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ENV-ENV-%E6%8C%87%E4%BB%A4"><span class="nav-number">13.</span> <span class="nav-text">ENV (ENV æŒ‡ä»¤)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9B%BF%E4%BB%A3%E7%9A%84%E8%AF%AD%E6%B3%95"><span class="nav-number">13.1.</span> <span class="nav-text">æ›¿ä»£çš„è¯­æ³•</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ADD-ADD-%E6%8C%87%E4%BB%A4"><span class="nav-number">14.</span> <span class="nav-text">ADD (ADD æŒ‡ä»¤)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#COPY-COPY-%E6%8C%87%E4%BB%A4"><span class="nav-number">15.</span> <span class="nav-text">COPY (COPY æŒ‡ä»¤)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ENTRYPOINT-ENTRYPOINT-%E6%8C%87%E4%BB%A4"><span class="nav-number">16.</span> <span class="nav-text">ENTRYPOINT (ENTRYPOINT æŒ‡ä»¤)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Exec-form-ENTRYPOINT-example-Exec-%E5%BD%A2%E5%BC%8F-ENTRYPOINT-%E4%BE%8B%E5%AD%90"><span class="nav-number">16.1.</span> <span class="nav-text">Exec form ENTRYPOINT example (Exec å½¢å¼ ENTRYPOINT ä¾‹å­)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Shell-form-ENTRYPOINT-example-Shell-%E5%BD%A2%E5%BC%8F-ENTRYPOINT-%E4%BE%8B%E5%AD%90"><span class="nav-number">16.2.</span> <span class="nav-text">Shell form ENTRYPOINT example (Shell å½¢å¼ ENTRYPOINT ä¾‹å­)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Understand-how-CMD-and-ENTRYPOINT-interact-%E7%90%86%E8%A7%A3-CMD-%E5%92%8C-ENTRYPOINT-%E6%98%AF%E6%80%8E%E6%A0%B7%E4%BA%A4%E4%BA%92%E7%9A%84"><span class="nav-number">16.3.</span> <span class="nav-text">Understand how CMD and ENTRYPOINT interact (ç†è§£ CMD å’Œ ENTRYPOINT æ˜¯æ€æ ·äº¤äº’çš„)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#VOLUME-VOLUME-%E6%8C%87%E4%BB%A4"><span class="nav-number">17.</span> <span class="nav-text">VOLUME (VOLUME æŒ‡ä»¤)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Notes-about-specifying-volumes-%E5%85%B3%E4%BA%8E%E6%8C%87%E5%AE%9A%E5%8D%B7%E7%9A%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="nav-number">17.1.</span> <span class="nav-text">Notes about specifying volumes (å…³äºæŒ‡å®šå·çš„æ³¨æ„äº‹é¡¹)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%90%86%E8%A7%A3"><span class="nav-number">17.2.</span> <span class="nav-text">ç†è§£</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#USER-USER-%E6%8C%87%E4%BB%A4"><span class="nav-number">18.</span> <span class="nav-text">USER (USER æŒ‡ä»¤)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WORKDIR-WORKDIR-%E6%8C%87%E4%BB%A4"><span class="nav-number">19.</span> <span class="nav-text">WORKDIR (WORKDIR æŒ‡ä»¤)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ARG-ARG-%E6%8C%87%E4%BB%A4"><span class="nav-number">20.</span> <span class="nav-text">ARG (ARG æŒ‡ä»¤)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Default-values-%E9%BB%98%E8%AE%A4%E5%80%BC"><span class="nav-number">20.1.</span> <span class="nav-text">Default values (é»˜è®¤å€¼)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Scope-%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="nav-number">20.2.</span> <span class="nav-text">Scope (ä½œç”¨åŸŸ)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-ARG-variables-%E4%BD%BF%E7%94%A8-ARG-%E5%8F%98%E9%87%8F"><span class="nav-number">20.3.</span> <span class="nav-text">Using ARG variables (ä½¿ç”¨ ARG å˜é‡)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Predefined-ARGs-%E9%A2%84%E5%AE%9A%E4%B9%89%E7%9A%84-ARGs"><span class="nav-number">20.4.</span> <span class="nav-text">Predefined ARGs (é¢„å®šä¹‰çš„ ARGs)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Automatic-platform-ARGs-in-the-global-scope-%E5%85%A8%E5%B1%80%E8%8C%83%E5%9B%B4%E5%86%85%E7%9A%84%E8%87%AA%E5%8A%A8%E5%B9%B3%E5%8F%B0-ARGs"><span class="nav-number">20.5.</span> <span class="nav-text">Automatic platform ARGs in the global scope (å…¨å±€èŒƒå›´å†…çš„è‡ªåŠ¨å¹³å° ARGs)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Impact-on-build-caching-%E5%AF%B9%E6%9E%84%E5%BB%BA%E7%BC%93%E5%AD%98%E7%9A%84%E5%BD%B1%E5%93%8D"><span class="nav-number">20.6.</span> <span class="nav-text">Impact on build caching (å¯¹æ„å»ºç¼“å­˜çš„å½±å“)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ONBUILD-ONBUILD-%E6%8C%87%E4%BB%A4"><span class="nav-number">21.</span> <span class="nav-text">ONBUILD (ONBUILD æŒ‡ä»¤)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#STOPSIGNAL-STOPSIGNAL-%E6%8C%87%E4%BB%A4"><span class="nav-number">22.</span> <span class="nav-text">STOPSIGNAL (STOPSIGNAL æŒ‡ä»¤)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HEALTHCHECK-HEALTHCHECK-%E6%8C%87%E4%BB%A4"><span class="nav-number">23.</span> <span class="nav-text">HEALTHCHECK (HEALTHCHECK æŒ‡ä»¤)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SHELL-SHELL-%E6%8C%87%E4%BB%A4"><span class="nav-number">24.</span> <span class="nav-text">SHELL (SHELL æŒ‡ä»¤)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">25.</span> <span class="nav-text">å‚è€ƒ</span></a></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="æœç´¢..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>



<script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/dark-light-toggle.js"></script>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/local-search.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/code-copy.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/lazyload.js"></script>


<div class="post-scripts pjax">
    
        <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/left-side-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/libs/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/toc.js"></script>
    
</div>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/libs/pjax.min.js"></script>
<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>



</body>
</html>
